"use strict";var MyApp=angular.module("BeehivePortal",["BeehivePortal.ScenarioManager","ngAnimate","ngCookies","ngSanitize","ngResource","ui.router","ui.bootstrap","LocalStorageModule","rzModule","treeControl","ngStomp","datePicker","angular-condition-tree","awesome-context-menu","monospaced.elastic","angularjs-dropdown-multiselect","ng.jsoneditor","angular-cron-jobs","ui-notification","gridster"]).constant("ERROR_CODE",{INVALID_INPUT:"INVALID_INPUT",INVALID_TOKEN:"INVALID_TOKEN"}).constant("AUTH_EVENTS",{tokenNotGiven:"token-not-given",loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"UnauthorizedException",notAuthorized:"auth-not-authorized"}).config(["localStorageServiceProvider","$httpProvider","NotificationProvider",function(e,t,i){function n(){a--,0==a&&$("#spinner").hide()}e.setPrefix("epgApp").setStorageType("localStorage").setStorageCookie(30,"/").setNotify(!0,!0);var a=0;delete t.defaults.headers.common["X-Requested-With"],t.defaults.headers.common["Content-Type"]="application/json;charset=UTF-8",t.interceptors.push(["$q","AUTH_EVENTS","ERROR_CODE",function(e,t,i){return{request:function(e){return $("#spinner").show(),a++,e},response:function(e){return n(),e},responseError:function(a){switch(n(),$("#spinner").hide(),a.status){case 401:!a.data.errorCode==i.INVALID_TOKEN&&window.alertMessage("您没有相应的操作权限。");break;case 500:switch(a.data.errorCode){case t.notAuthenticated:window.location="#/"}}return e.reject(a)}}}]),i.setOptions({delay:1e4,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"top"})}]).run(["$rootScope","$state","$stateParams","AppUtils",function(e,t,i,n){e.$state=t,e.$stateParams=i,window.state=t,n.initialize(),window.AppUtils=n,window.ECharts=echarts,KiiReporting.KiiQueryConfig.setConfig({site:"http://121.199.7.69",port:9200,token:"Bearer super_token"})}]);angular.module("BeehivePortal").directive("propertyTree",["$compile","$http",function(e,t){return{restrict:"E",replace:!0,scope:{myProperty:"=?"},link:function(i,n){t({method:"GET",url:"app/components/portal/ThingViews/TypeView/directives/property-tree/property-tree.template.html"}).then(function(t){var a=t.data;if(i.myProperty){var r=e(a)(i);n.append(r)}i.collapseControllers={},i.propertyRequired=function(e,t){return t?!!_.find(t,function(t){return t==e}):!1}})}}}]),angular.module("BeehivePortal.ScenarioManager.OfficeAtmosphere",["mdPickers"]).run(["$templateCache","$http","$mdpTimePicker",function(e,t){t.get("app/components/portal/ScenarioManager/OfficeAtmosphere/directives/oaMctrl/oaMctrl.template.html").then(function(t){e.put("oaMctrl.template.html",t.data)}),t.get("app/components/portal/ScenarioManager/OfficeAtmosphere/directives/oaPctrl/oaPctrl.template.html").then(function(t){e.put("oaPctrl.template.html",t.data)})}]),angular.module("BeehivePortal.ScenarioManager.OfficeAtmosphere").directive("oaPctrl",["$templateCache","$compile","$timeout",function(e,t,i){return{restrict:"A",scope:{panel:"=?",output:"=?",input:"=?"},link:function(n,a){function r(){a.popover("hide"),a.popover("destroy"),$("body").unbind("click",o)}function o(e){var t=$(e.target).parents(".popover")[0],i=$(e.target).parents(".dropdown-menu"),n=$(e.target).parents(".modal");t!=s[0]&&0==i.length&&0==n.length&&r()}var s,l=e.get("oaPctrl.template.html");n.outputData={result:null},n.cancelOnClick=function(){r()},n.saveOnClick=function(){n.output&&n.output(n.outputData.result)},a.click(function(){var e=a.offset().top-n.panel.offset().top<200?"bottom":"top";a.popover({container:n.panel.selector,placement:e,trigger:"none",template:l,viewport:n.panel,content:"aaa"}),s=a.popover("show").data("bs.popover").$tip,s=$(s),t(s.find(".body-content"))(n),i(function(){$("body").on("click",o)})})}}}]),angular.module("BeehivePortal.ScenarioManager.OfficeAtmosphere").directive("oaMctrl",["$templateCache","$compile","$mdpTimePicker","$timeout",function(e,t,i,n){return{restrict:"A",scope:{panel:"=?",output:"=?",input:"=?"},link:function(i,a){function r(){a.popover("hide"),a.popover("destroy"),$("body").unbind("click",o)}function o(e){var t=$(e.target).parents(".popover")[0],i=$(e.target).parents("md-dialog");t!=s[0]&&0==i.length&&r()}var s,l=e.get("oaMctrl.template.html");i.dateTypeOptions=[{value:"daily",text:"每天"},{value:"weekday",text:"工作日"},{value:"weekend",text:"周末"}],i.selectedDateType=i.dateTypeOptions[0],i.outputData={},i.cancelOnClick=function(){r()},i.saveOnClick=function(){r()},a.click(function(){i.currentDate=new Date;var e=a.offset().top-i.panel.offset().top<200?"bottom":"top";a.popover({container:i.panel.selector,placement:e,trigger:"none",template:l,viewport:i.panel,content:"aaa"}),s=a.popover("show").data("bs.popover").$tip,s=$(s),t(s.find(".body-content"))(i),n(function(){$("body").on("click",o)})})}}}]),angular.module("BeehivePortal.ScenarioManager.OfficeAtmosphere").directive("devicePanel",["$templateCache","$compile","$mdpTimePicker","$timeout",function(e,t,i,n){return{restrict:"A",scope:{panel:"=?",output:"=?",input:"=?"},link:function(i,a){function r(){a.popover("hide"),a.popover("destroy"),$("body").unbind("click",o)}function o(e){var t=$(e.target).parents(".popover")[0],i=$(e.target).parents("md-dialog");t!=s[0]&&0==i.length&&r()}var s,l=e.get("oaMctrl.template.html");i.selectedDateType=i.dateTypeOptions[0],i.outputData={},i.cancelOnClick=function(){r()},i.saveOnClick=function(){r()},a.click(function(){var e=a.offset().top-i.panel.offset().top<200?"bottom":"top";a.popover({container:i.panel.selector,placement:e,trigger:"none",template:l,viewport:i.panel,content:"aaa"}),s=a.popover("show").data("bs.popover").$tip,s=$(s),t(s.find(".body-content"))(i),n(function(){$("body").on("click",o)})})}}}]),angular.module("BeehivePortal").factory("UserGroupListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("UserGroupListController",["$scope","$rootScope","$state","AppUtils","$uibModal","$$UserGroup","$location","$http",function(e,t,i,n,a,r){e.dataset={},e.dataset.userGroups=[],e.dataset.userGroupsForDisplay=[],e.init=function(){t.$watch("login",function(t){t&&(e.groupType=e.groupTypes[0],e.groupTypes.splice(1,1),e.$watch("groupType",function(){e.dataset.userGroups="mygroup"==e.groupType.value?r.getMyGroups():r.getList()}))})},e.groupTypes=[{text:"我的群组",value:"mygroup"},{text:"所有群组",value:"allgroup"}],e.groupType=null,e.searchValue="",e.queryOptions=[{text:"群组ID",value:"userGroupID"},{text:"群组名称",value:"userGroupName"}],e.queryUserGroups=function(t,i){var n={};i?(n[t]=i,n.includeUserData="0",e.dataset.userGroups=r.query({},n)):e.dataset.userGroups=r.getList()},e.createGroup=function(){var t=a.open({animation:!0,templateUrl:"app/components/portal/UserManager/UserGroup/UserGroupList/NewUserGroup.template.html",controller:"UserGroupListController.NewUserGroup",size:"md",resolve:{}});t.result.then(function(t){console.log(t),e.dataset.userGroups.push(t)},function(){})},e.goUserList=function(t){console.log(t),e.navigateTo(e.navMapping.GROUP_USER_LIST,{userGroupID:t.userGroupID})},e.goThingAuth=function(t){e.navigateTo(e.navMapping.GROUP_THING_AUTH,{userGroupID:t.userGroupID})},e.goEdit=function(t){e.navigateTo(e.navMapping.USER_GROUP_EDITOR,{userGroupID:t.userGroupID})},e.deleteGroup=function(t){n.confirm("删除用户群组","确定要删除用户群组["+t.userGroupName+"]吗?",function(){r.remove({},t,function(){e.dataset.userGroups=_.reject(e.dataset.userGroups,function(e){return e==t})})})}}]),angular.module("BeehivePortal").controller("UserGroupListController.NewUserGroup",["$scope","$uibModalInstance","$$UserGroup","AppUtils",function(e,t,i,n){e.newGroup={userGroupName:"",description:""},e.ok=function(){i.create({},e.newGroup,function(i){e.newGroup.userGroupID=i.userGroupID,t.close(e.newGroup)},function(){n.alert("新增群组失败！")})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("ResourceAuthorityController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("GroupUserListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("GroupUserListController",["$scope","$rootScope","$state","AppUtils","$$User","$$UserGroup","$$Permission","$q","$uibModal",function(e,t,i,n,a,r,o,s,l){e.userList=[],e.userListForDisplay=[],e.userGroup,e.init=function(){t.$watch("login",function(t){if(t){var n=i.params.userGroupID,a={userGroupID:n,includeUserData:"1"};e.userGroup=r.get({},a,function(t){e.userList=t.users})}})},e.myMenu={itemList:[{text:"查看详情",callback:function(t){e.navigateTo(e.navMapping.GROUP_USER_INFO,{userID:t.userID,userGroupID:i.params.userGroupID})}},{text:"编辑",callback:function(e){var t=l.open({animation:!0,templateUrl:"app/components/portal/UserManager/User/UserList/EditUser.template.html",controller:"UserListController.EditUser",size:"md",resolve:{user:function(){return e}}});t.result.then(function(){console.log(e)},function(){$log.info("Modal dismissed at: "+new Date)})}},{text:"删除",callback:function(t){n.confirm("提示信息","确认要将该用户移出吗？",function(){r.deleteUser({userID:t.userID,userGroupID:e.userGroup.userGroupID})})}}],setting:{}}}]),angular.module("BeehivePortal").controller("GroupThingAuthorityController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e,t,i,n,a,r,o,s,l){e.ownThings=[],e.selectedThings=[],e.settings={dataset:{},idFieldName:"globalThingID",tabs:[{dataset:[],name:"位置",mapper:{nameFieldName:"name",idFieldName:"id",mapperFieldName:"location"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"种类",mapper:{nameFieldName:"name",idFieldName:"name",mapperFieldName:"type"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"标签",mapper:{nameFieldName:"displayName",idFieldName:"displayName",mapperFieldName:"tags"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"全部",nameGenerator:function(e){return e.type+"-"+e.globalThingID}}]};var c=r.getAll().$promise;s.all([o.queryAll().$promise,c,l.queryAll().$promise]).then(function(t){var i=t[0],n=t[1],a=t[2],o=[],l=[],c=new LocationTree(_.pluck(a,"displayName"));_.each(a,function(e){var t=r.byTag({tagType:"Location",displayName:e.displayName});o.push(t.$promise)}),_.each(i,function(e){var t=r.byTag({tagType:"Custom",displayName:e.displayName});l.push(t.$promise)}),s.all([s.all(l),s.all(o)]).then(function(r){var o=r[0],s=r[1];_.each(i,function(e,t){_.each(o[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.tags)||(i.tags=[]),i.tags.indexOf(e.displayName)<0&&i.tags.push(e.displayName)})}),_.each(a,function(e,t){_.each(s[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.location)||(i.location=[]),i.location.indexOf(e.displayName)<0&&i.location.push(e.displayName)})}),a=c.tree.children,e.settings.existingNodeIDs=_.pluck(t[3],"globalThingID"),e.settings.dataset.data=n;var l=_.uniq(_.pluck(n,"type")),p=[];_.each(l,function(e){p.push({name:e})}),e.settings.tabs[0].dataset=a,e.settings.tabs[1].dataset=p,e.settings.tabs[2].dataset=_.where(i,{tagType:"Custom"}),e.settings.tabs[3].dataset=n,e.ready=!0})})}]),angular.module("BeehivePortal").controller("GroupThingACLController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e,t,i,n,a,r,o,s,l){e.ownThings=[],e.selectedThings=[],e.settings={dataset:{},idFieldName:"globalThingID",tabs:[{dataset:[],name:"位置",mapper:{nameFieldName:"name",idFieldName:"id",mapperFieldName:"location"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"种类",mapper:{nameFieldName:"name",idFieldName:"name",mapperFieldName:"type"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"标签",mapper:{nameFieldName:"displayName",idFieldName:"displayName",mapperFieldName:"tags"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"全部",nameGenerator:function(e){return e.type+"-"+e.globalThingID}}]};var c=r.getAll().$promise;s.all([o.queryAll().$promise,c,l.queryAll().$promise]).then(function(t){var i=t[0],n=t[1],a=t[2],o=[],l=[],c=new LocationTree(_.pluck(a,"displayName"));_.each(a,function(e){var t=r.byTag({tagType:"Location",displayName:e.displayName});o.push(t.$promise)}),_.each(i,function(e){var t=r.byTag({tagType:"Custom",displayName:e.displayName});l.push(t.$promise)}),s.all([s.all(l),s.all(o)]).then(function(r){var o=r[0],s=r[1];_.each(i,function(e,t){_.each(o[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.tags)||(i.tags=[]),i.tags.indexOf(e.displayName)<0&&i.tags.push(e.displayName)})}),_.each(a,function(e,t){_.each(s[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.location)||(i.location=[]),i.location.indexOf(e.displayName)<0&&i.location.push(e.displayName)})}),a=c.tree.children,e.settings.existingNodeIDs=_.pluck(t[3],"globalThingID"),e.settings.dataset.data=n;var l=_.uniq(_.pluck(n,"type")),p=[];_.each(l,function(e){p.push({name:e})}),e.settings.tabs[0].dataset=a,e.settings.tabs[1].dataset=p,e.settings.tabs[2].dataset=_.where(i,{tagType:"Custom"}),e.settings.tabs[3].dataset=n,e.ready=!0})})}]),angular.module("BeehivePortal").factory("GroupEditorService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("GroupEditorController",["$scope","$rootScope","$state","AppUtils","$$UserGroup","$$User","$$Tag","$$Permission","$q","$location","$$Thing",function(e,t,i,n,a,r,o,s,l,c,p){e.dataset={},e.group={},e.isOwner=!1,e.dataset.userList=[],e.dataset.userListForDisplay=[],e.searchValue="",e.queryOptions=[{text:"用户ID",value:"userID"},{text:"用户名称",value:"userName"}],e.queryFiled=_.clone(e.queryOptions[0]),e.queryUsers=function(t,i){var a={};i&&(a[t]=i),r.query(a,function(t){e.userList=t},function(){n.alert("Failed to load group user list!")})},e.init=function(){t.$watch("login",function(t){if(t){var n=i.params.userGroupID,r={userGroupID:n,includeUserData:"1"};e.group=a.get({},r,function(t){e.group._users=_.clone(e.group.users),e.group.tags=a.getTags({},{userGroupID:n}),e.group.things=a.getThings({},{userGroupID:n}),e.isOwner=e.isCreator(t)}),e.queryUsers(),e.tags=o.queryAll()}})},e.removeUser=function(t,i){a.deleteUser({},{userID:t.userID,userGroupID:i.userGroupID},function(){e.group._users=_.reject(i._users,function(e){return t==e})})},e.addTag=function(t,i){a.bindTag({tags:[t.fullTagName],userGroupIDs:[i.userGroupID]},function(){e.group.tags=e.group.tags||[],e.group.tags.push(t)})},e.removeTag=function(t,i){a.unbindTag({tags:[t.fullTagName],userGroupIDs:[i.userGroupID]},function(){e.group.tags.remove(t)})},e.addThings=function(t,i){a.bindThing({},{globalThingIDs:[t],userGroupIDs:[i.userGroupID]},function(){e.group.things=e.group.things||[],_.each(t,function(t){e.group.things.push(p.get({globalThingID:t}))})})},e.removeThing=function(t,i){a.unbindThing({globalThingIDs:[t.globalThingID],userGroupIDs:[i.userGroupID]},function(){e.group.things.remove(t)})},e.addUser=function(t,i){a.addUser({userID:t.userID,userGroupID:i.userGroupID},function(){e.group._users=e.group._users||[],_.find(e.group._users,function(e){return t.userID==e.userID})||e.group._users.push(t)})},e.saveGroup=function(){var t=_.pluck(e.group._users,"userID");e.group.users=t,a.update({},e.group,function(){e.navigateTo(e.navMapping.USER_GROUP)})}}]),angular.module("BeehivePortal").controller("UserThingAuthorityController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location","$$User",function(e,t,i,n,a,r,o,s,l,c){e.ownThings=[],e.selectedThings=[];var p=i.params.userID;e.init=function(){t.$watch("login",function(t){t&&(e.ownThings=c.getThings({userID:p}))})},e.addThings=function(t){var t=_.difference(t,e.ownThings);c.bindThing({thingIDs:_.pluck(t,"globalThingID"),userIDs:[p]},function(){e.ownThings=e.ownThings.concat(t)})},e.removeThing=function(t){c.unbindThing({thingIDs:[t.globalThingID],userIDs:[p]},function(){e.ownThings.remove(t)})}}]),angular.module("BeehivePortal").controller("UserThingACLController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e){e.ownThings=[],e.selectedThings=[]}]),angular.module("BeehivePortal").factory("UserListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("UserListController",["$scope","$rootScope","$state","AppUtils","$uibModal","$log","$location","$$UserManager",function(e,t,i,n,a,r,o,s){function l(){e.userListForDisplay=_.filter(e.userList,function(t,i){return i>=(e.currentIndex-1)*e.listMaxLength&&i<e.currentIndex*e.listMaxLength})}e.userList=[],e.userListForDisplay=[],e.searchValue="",e.queryOptions=[{text:"用户ID",value:"userID"},{text:"用户名称",value:"userName"}],e.queryFiled=_.clone(e.queryOptions[0]),e.myMenu={itemList:[{text:"查看详情",callback:function(t){e.navigateTo(e.navMapping.USER_INFO,{userID:t.userID})}},{text:"编辑",callback:function(e){var t=a.open({animation:!0,templateUrl:"app/components/portal/UserManager/User/EditUser.template.html",controller:"UserController.EditUser",size:"md",resolve:{user:function(){return e}}});t.result.then(function(t){_.extend(e,t)},function(){r.info("Modal dismissed at: "+new Date)})}},{text:"删除",callback:function(t){s.remove({},t,function(){console.log("用户"+t.userName+"已被删除！"),e.userList.remove(t),l()},function(){console.log("未能删除用户:"+t.userName)})}}],setting:{}},e.queryUsers=function(t,i){var a={};i&&(a[t]=i),s.query(a,function(t){console.log(t),e.userList=t,e.pageChanged()},function(){n.alert("Failed to load group user list!")})},e.init=function(){t.$watch("login",function(t){t&&(o.search({pageIndex:1}),e.currentIndex=1,e.queryUsers())})},e.pageChanged=function(){o.search({pageIndex:e.currentIndex}),l()}}]).controller("UserListController.ActivateUser",["$scope","user","$$User","$uibModalInstance",function(e,t,i,n){e.user=t,e.register=function(){i.register({},e.user,function(){AppUtils.alert("注册成功！请使用用户名登陆！"),n.close()},function(e,t){AppUtils.alert(t)})},e.cancel=function(){n.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("UserInfoService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("UserInfoController",["$scope","$rootScope","$state","AppUtils","PortalService","$$UserManager","$uibModal",function(e,t,i,n,a,r,o){var s=!1;e.init=function(){t.$watch("login",function(t){t&&(i.current.name==e.navMapping.GROUP_USER_INFO.state&&(s=!0),e.user=r.get({},{userID:i.params.userID}))})},e.changeBuilding=function(){e.refreshLevels()},e.refreshLevels=function(){e.levelOptions=e.user.building.levels,e.user.level=e.levelOptions[0],e.refreshRooms()},e.refreshRooms=function(){e.roomOptions=e.user.level.rooms,e.user.room=e.roomOptions[0]},e.goThingAuth=function(){s?e.navigateTo(e.navMapping.GROUP_USER_THING_AUTH,e.$state.params):e.navigateTo(e.navMapping.USER_THING_AUTH,e.$state.params)},e.goThingACL=function(){s?e.navigateTo(e.navMapping.GROUP_USER_THING_ACL,e.$state.params):e.navigateTo(e.navMapping.GROUP_USER_THING_ACL,e.$state.params)},e.editUser=function(){var t=o.open({animation:!0,templateUrl:"app/components/portal/UserManager/User/EditUser.template.html",controller:"UserController.EditUser",size:"lg",resolve:{user:function(){return e.user}}});t.result.then(function(t){e.user=t},function(){console.log("Modal dismissed at: "+new Date)})},e.deleteUser=function(){r.remove({},e.user,function(){e.navigateTo(e.navMapping.USER_LIST)},function(e){n.alert(e.statusText)})}}]),angular.module("BeehivePortal").factory("SearchUserService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("SearchUserController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("NewUserService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("NewUserController",["$scope","$rootScope","$state","AppUtils","$$UserManager","PortalService",function(e,t,i,n,a){e.sexOptions=[{value:1,text:"男"},{value:2,text:"女"}],e.ruleOptions=[{value:"commUser",text:"普通用户"},{value:"userAdmin",text:"用户管理员"},{value:"administrator",text:"系统管理员"}],e.newUser={userName:"",phone:"",mail:"",company:"",role:"4",roleName:"",custom:{sex:null}},e.init=function(){},e.createUser=function(){a.create(e.newUser,function(t){var i=t.userID,a=t.activityToken;n.alert("新创建的用户ID为："+i+",注册码为："+a+"。请前往登录页面进行激活。"),e.navigateTo(e.navMapping.USER_LIST)},function(e){409==e.status&&console.log(e),n.alert("User ID exists!")})}}]),angular.module("BeehivePortal").directive("triggerControlGroup",[function(){return{restrict:"E",replace:!0,scope:{trigger:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/trigger-control-group/trigger-control-group.template.html",controller:["$scope",function(e){e.deleteTrigger=function(t){e.$emit("deleteTrigger",t)},e.enableTrigger=function(t){e.$emit("enableTrigger",t)},e.disableTrigger=function(t){e.$emit("disableTrigger",t)}}]}}]),angular.module("BeehivePortal").directive("triggerCommand",["$compile","$$Tag","$$Thing","$timeout","$uibModal",function(){return{restrict:"E",replace:!0,scope:{myActions:"=?",disabled:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/trigger-command/trigger-command.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http",function(e){e.selectedActions=[],e.actionOptions=[],e.$watch("myActions",function(t){e.actionOptions=[],_.each(t,function(t,i){e.actionOptions.push({id:i,label:i,action:t})})}),e.$watch("selectedActions",function(t){_.each(t,function(t){e.myActions[t.id]._checked=!0})},!0),e.$watch("myActions",function(t){e.selectedActions=[],_.each(t,function(t,i){t._checked&&e.selectedActions.push({id:i,label:i,action:t})})})}]}}]),angular.module("BeehivePortal").directive("summaryTrigger",["$compile","$$Tag","$$Thing","$timeout","$uibModal",function(e,t,i,n,a){return{restrict:"E",replace:!0,scope:{ready:"=?",dataset:"=?",trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/summary-trigger/summary-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){function t(){var t=[];_.each(e.dataContainer.mySources,function(e){var i=new TriggerSummarySource,n={};e.thingList?n.thingList=_.pluck(e.thingList,"globalThingID"):(n.tagList=_.pluck(e.tagList,"displayName"),n.andExpress=e.andExpress),i.setSource(n),i.setName(e.name),t.push(i)}),_.each(t,function(t){t.schema=[{name:"power",type:"boolean"},{name:"dimming",type:"value"}],e.myTrigger.addSummarySource(t)})}function i(){e.summarySchema=[],_.each(e.myTrigger.summarySource,function(t){var i=_.where(t.schema,{_checked:!0});t.expressList=[],_.each(i,function(i){i.summaryAlias&&""!=i.summaryAlias&&(t.expressList.push({stateName:i.name,"function":_.clone(i["function"]),summaryAlias:i.summaryAlias}),e.summarySchema.push({name:i.summaryAlias,type:"range"}))})})}function n(){e.myTrigger.setTriggersWhen(e.myTrigger.predicate.triggersWhen.value),e.myTrigger.setCondition(e.dataContainer.summaryConditionClause)}function r(){var t=[];_.each(e.dataContainer.myTargets,function(e){var i=new TriggerTarget,n={};e.thingList?n.thingList=_.pluck(e.thingList,"globalThingID"):(n.tagList=_.pluck(e.tagList,"displayName"),n.andExpress=e.andExpress),i.setSource(n,e.sourceType,e.andExpress),t.push(i)}),_.each(t,function(){}),e.myTrigger.setTargets(t)}function o(){}e.myTrigger=_.clone(e.trigger),e.currentStep=1,e.triggerWhenConditions=[{text:"条件为真",value:Trigger.WhenEnum.TRUE},{text:"条件由假转真",value:Trigger.WhenEnum.FALSE_TO_TRUE},{text:"条件改变",value:Trigger.WhenEnum.CHANGED}],e.aggregationFunctions=[{text:"求和",value:TriggerSummarySource.FunctionEnum.SUM},{text:"计数",value:TriggerSummarySource.FunctionEnum.COUNT},{text:"最大值",value:TriggerSummarySource.FunctionEnum.MAX},{text:"最小值",value:TriggerSummarySource.FunctionEnum.MIN},{text:"平均值",value:TriggerSummarySource.FunctionEnum.AVG}],e.dataContainer={mySources:[],myTargets:[],summaryConditionClause:{}},e.summarySchema=[],e.schema=[{name:"power",type:"boolean"},{name:"dimming",type:"range"},{name:"color",type:"in",values:["red","green","blue"]}],e.init=function(){_.each(e.myTrigger.summarySource,function(t){e.dataContainer.mySources.push(t.source)})},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(a){switch(a){case 1:t();break;case 2:i();break;case 3:n();break;case 4:r();break;case 5:o()}e.currentStep=a+1,console.log(e.myTrigger)},e.createSource=function(){var t=a.open({animation:!0,templateUrl:"/app/components/TriggerManager/new-source.html",controller:"summaryTrigger.CreateSource",size:"md"});t.result.then(function(t){e.dataContainer.mySources.splice(0,0,t)})},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,{})}}]}}]).controller("summaryTrigger.CreateSource",["$uibModalInstance","$scope",function(e,t){t.createSource=function(t){var i={name:t};e.close(i)},t.cancel=function(){e.dismiss("cancel")}}]),angular.module("BeehivePortal").directive("singleTrigger",["$compile",function(){return{restrict:"E",replace:!0,scope:{trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/single-trigger/single-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http","TriggerService","$$Type","$$Trigger","AppUtils",function(e,t,i,n,a,r,o,s,l,c){function p(){e.trigger.setTriggersWhen(e.dataContainer.predicate.triggersWhen),e.trigger.setCondition(e.dataContainer.predicate.condition),d()}function d(){if(e.dataContainer.schedule.enabled){var t=_.clone(e.dataContainer.schedule);"Interval"==t.type?delete t.cron:(delete t.timeUnit,delete t.interval,t.cron=o.getRightCron(t.cron)),e.trigger.setSchedule(t)}else delete e.trigger.predicate.schedule}function u(){var t=[];e.dataContainer.targetSchemas=[],_.each(e.dataContainer.myTargets,function(i,n){var a=new TriggerTarget,r={};i.thingList?r.thingList=i.thingList:(r.tagList=i.tagList,r.andExpress=i.andExpress,r.type=i.selectedType.id),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(i).then(function(t){o.getTypeSchemas(t).then(function(t){e.dataContainer.targetSchemas[n]=o.xSchemas(t)})}),a.setSource(r,i.sourceType,i.andExpress),t.push(a)}),e.trigger.setTargets(t)}function g(){_.each(e.dataContainer.targetSchemas,function(t,i){e.trigger.targets[i].command.actions=[],_.each(t.actions,function(t,n){var a={},r=!1;a[n]={},t._checked&&_.each(t.in.properties,function(e,t){e._checked&&(a[n][t]=e.value,r=!0)}),r&&e.trigger.targets[i].command.actions.push(a)})})}function h(){l.save(e.trigger,function(t){e.trigger.triggerID=t.triggerID,c.alert("创建触发器成功！"),console.log(t)},function(e){c.alert("创建触发器失败！错误信息:"+e)})}e.currentStep=1,e.triggerWhenConditions=o.triggerWhenConditions,e.dataContainer={schedule:{},predicate:{triggersWhen:null,condition:{}},sourceSchema:null,myTargets:[],targetSchemas:[]},e.init=function(){var t=e.trigger.source.thingID;i.get({globalThingID:t},function(t){e.dataContainer.sourceSchema=o.getSchemaByType(t.type),e.dataContainer.predicate=e.trigger.predicate}),e.dataContainer.schedule=e.trigger.predicate.schedule||{},e.trigger.predicate.schedule&&(e.dataContainer.schedule.enabled=!0,e.dataContainer.schedule.cron&&(e.dataContainer.schedule.cron=o.revertCron(e.dataContainer.schedule.cron))),_.each(e.trigger.targets,function(t,i){e.dataContainer.myTargets.push(t),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(t).then(function(n){e.trigger.targets.thingTypes=n,o.getTypeSchemas(n).then(function(n){e.dataContainer.targetSchemas[i]=o.xSchemas(n),o.initTargetSchema(t,e.dataContainer.targetSchemas[i])})})})},e.goStep=function(t){e.trigger.triggerID&&(e.currentStep=t)},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(t){switch(t){case 1:p();break;case 2:u();break;case 3:g(),h()}e.currentStep=e.currentStep>2?e.currentStep:t+1,console.log(JSON.stringify(e.trigger))},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,new TriggerTarget)}}]}}]),angular.module("BeehivePortal").directive("sourcePicker",["$compile",function(){return{restrict:"E",replace:!0,scope:{mySource:"=?",ready:"=?",disabled:"=?",init:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-source/select-source.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){e.$watch("mySource.tagTypes",function(t){e.mySource.thingTypes=[],_.each(t,function(t){e.mySource.thingTypes.push({label:t,id:t})})},!0),e.$watch("mySource.sourceType",function(t){"tag"==t?delete e.mySource.thingList:delete e.mySource.tagList}),e.sourceTypes=[{text:"设备",value:"thing"},{text:"标签",value:"tag"}],e.andExpressOptions=[{text:"交集",value:!0},{text:"并集",value:!1}],e.init=function(){e.mySource=e.mySource||{},e.mySource.sourceType=e.mySource.tagList&&e.mySource.tagList.length>0?e.sourceTypes[1].value:e.sourceTypes[0].value},e.mySource.selectedType={},e.thingTypeChange=function(){}}]}}]),angular.module("BeehivePortal").directive("selectSchedule",["$compile",function(){return{restrict:"E",replace:!0,scope:{schedule:"=?",disabled:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-schedule/select-schedule.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){function t(e){return e?6==e.split(" ").length?e.substr(2):e:""}e.scheduleTypes=[{text:"间隔任务",value:"Interval"},{text:"定时任务",value:"Cron"}],e.intervalUnits=[{text:"秒",value:"Second"},{text:"分",value:"Minute"},{text:"小时",value:"Hour"},{text:"天",value:"Day"}],e.init=function(){e.schedule=e.schedule||{timeUnit:"Second",interval:0},e.initCron=t(e.schedule.cron)},e.$watch("schedule.cron",function(i){e.initCron=t(i)})}]}}]),angular.module("BeehivePortal").directive("selectPolicy",["$compile",function(){return{restrict:"E",replace:!0,scope:{policy:"=?",thingNumber:"=?",disabled:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-policy/select-policy.template.html",controller:["$scope","TriggerService","AppUtils",function(e){e.policyOptions=[{text:"所有",value:Trigger.PolicyTypeEnum.ALL},{text:"任意一个",value:Trigger.PolicyTypeEnum.ANY},{text:"指定数量",value:Trigger.PolicyTypeEnum.SOME},{text:"指定百分比",value:Trigger.PolicyTypeEnum.PERCENT}],e.init=function(){e.policy||(e.policy={groupPolicy:e.policyOptions[0].value})}}]}}]),angular.module("BeehivePortal").directive("multiSourcePicker",["$compile","$$Tag","$$Thing","$timeout","AppUtils",function(e,t,i,n,a){return{restrict:"E",replace:!0,scope:{sources:"=",resultSourceSet:"=?",disabled:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-multiple-source/select-multiple-source.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){e.removeSource=function(t){a.confirm("删除源","您确定要删除源吗？",function(){e.sources.remove(t)})}}]}}]),angular.module("BeehivePortal").directive("scheduleTrigger",["$compile",function(){return{restrict:"E",replace:!0,scope:{trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/schedule-trigger/schedule-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http","TriggerService","$$Type","$$Trigger","AppUtils",function(e,t,i,n,a,r,o,s,l,c){function p(){var t=_.clone(e.dataContainer.schedule);"Interval"==t.type?delete t.cron:(delete t.timeUnit,delete t.interval,t.cron=o.getRightCron(t.cron)),e.trigger.setSchedule(t),delete e.trigger.source,delete e.trigger.predicate.condition}function d(){var t=[];e.dataContainer.targetSchemas=[],_.each(e.dataContainer.myTargets,function(i,n){var a=new TriggerTarget,r={};i.thingList?r.thingList=i.thingList:(r.tagList=i.tagList,r.andExpress=i.andExpress,r.type=i.selectedType.id),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(i).then(function(t){o.getTypeSchemas(t).then(function(t){e.dataContainer.targetSchemas[n]=o.xSchemas(t)
})}),a.setSource(r,i.sourceType,i.andExpress),t.push(a)}),e.trigger.setTargets(t)}function u(){_.each(e.dataContainer.targetSchemas,function(t,i){e.trigger.targets[i].command.actions=[],_.each(t.actions,function(t,n){var a={},r=!1;a[n]={},t._checked&&_.each(t.in.properties,function(e,t){e._checked&&(a[n][t]=e.value,r=!0)}),r&&e.trigger.targets[i].command.actions.push(a)})})}function g(){var t=o.getDataForRequest(e.trigger,"Schedule");l.save(t,function(t){c.alert("创建触发器成功！"),e.trigger.triggerID=t.triggerID},function(e){c.alert("创建触发器失败！错误信息:"+JSON.stringify(e))})}e.currentStep=1,e.triggerWhenConditions=o.triggerWhenConditions,e.dataContainer={predicate:{},schedule:{},myTargets:[],targetSchemas:[]},e.goStep=function(t){e.trigger.triggerID&&(e.currentStep=t)},e.init=function(){e.dataContainer.predicate=e.trigger.predicate,e.dataContainer.schedule=e.trigger.predicate.schedule||{},e.dataContainer.schedule.cron&&(e.dataContainer.schedule.cron=o.revertCron(e.dataContainer.schedule.cron)),_.each(e.trigger.targets,function(t,i){e.dataContainer.myTargets.push(t),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(t).then(function(n){e.trigger.targets.thingTypes=n,o.getTypeSchemas(n).then(function(n){e.dataContainer.targetSchemas[i]=o.xSchemas(n),o.initTargetSchema(t,e.dataContainer.targetSchemas[i])})})})},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(t){switch(t){case 1:p();break;case 2:d();break;case 3:u(),g()}e.currentStep=e.currentStep>2?e.currentStep:t+1,console.log(JSON.stringify(e.trigger))},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,new TriggerTarget)}}]}}]),angular.module("BeehivePortal").directive("groupTrigger",["$compile","$$Tag","$$Thing","$timeout","$uibModal","$$Type",function(){return{restrict:"E",replace:!0,scope:{trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/group-trigger/group-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http","TriggerService","$$Type","$$Trigger",function(e,t,i,n,a,r,o,s,l){function c(){"tag"==e.dataContainer.mySource.sourceType?(e.dataContainer.mySource.thingList&&delete e.dataContainer.mySource.thingList,e.dataContainer.thingNumber=0):(e.dataContainer.thingNumber=e.dataContainer.mySource.thingList.length,e.dataContainer.mySource.tagList&&delete e.dataContainer.mySource.tagList),o.getSourceTypes(e.dataContainer.mySource).then(function(t){"tag"==e.dataContainer.mySource.sourceType&&(e.trigger.source.type=e.dataContainer.mySource.selectedType.id),o.getTypeSchemas(t).then(function(t){e.dataContainer.sourceSchema=o.xSchemas(t)})}),e.trigger.setSource(e.dataContainer.mySource,e.dataContainer.mySource.sourceType)}function p(){e.trigger.setTriggersWhen(e.dataContainer.predicate.triggersWhen),e.trigger.setCondition(e.dataContainer.predicate.condition),e.trigger.setPolicy(e.dataContainer.policy),d()}function d(){if(e.dataContainer.schedule.enabled){var t=_.clone(e.dataContainer.schedule);"Interval"==t.type?delete t.cron:(delete t.timeUnit,delete t.interval,delete t.enabled,t.cron=o.getRightCron(t.cron)),e.trigger.setSchedule(t)}else delete e.trigger.predicate.schedule}function u(){var t=[];e.dataContainer.targetSchemas=[],_.each(e.dataContainer.myTargets,function(i,n){var a=new TriggerTarget,r={};i.thingList?r.thingList=i.thingList:(r.tagList=i.tagList,r.andExpress=i.andExpress,r.type=i.selectedType.id),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(i).then(function(t){o.getTypeSchemas(t).then(function(t){e.dataContainer.targetSchemas[n]=o.xSchemas(t)})}),a.setSource(r,i.sourceType,i.andExpress),t.push(a)}),e.trigger.setTargets(t)}function g(){_.each(e.dataContainer.targetSchemas,function(t,i){e.trigger.targets[i].command.actions=[],_.each(t.actions,function(t,n){var a={},r=!1;a[n]={},t._checked&&_.each(t.in.properties,function(e,t){e._checked&&(a[n][t]=e.value,r=!0)}),r&&e.trigger.targets[i].command.actions.push(a)})})}function h(){l.save(e.trigger,function(t){e.trigger.triggerID=t.triggerID,AppUtils.alert("创建触发器成功！"),console.log(t)},function(){AppUtils.alert("创建触发器失败！错误信息:"+err)})}e.dataContainer={},e.currentStep=1,e.triggerWhenConditions=o.triggerWhenConditions,e.init=function(){e.dataContainer={mySource:{thingType:e.trigger.source.thingType,thingList:_.clone(e.trigger.source.thingList),tagList:_.clone(e.trigger.source.tagList),andExpress:e.trigger.source.andExpress},predicate:null,schedule:{},sourceSchema:null,myTargets:[],targetSchemas:[],policy:e.trigger.policy||{groupPolicy:"All"}},e.dataContainer.schedule=e.trigger.predicate.schedule||{},e.trigger.predicate.schedule&&(e.dataContainer.schedule.enabled=!0,e.dataContainer.schedule.cron&&(e.dataContainer.schedule.cron=o.revertCron(e.dataContainer.schedule.cron))),o.getSourceTypes(e.dataContainer.mySource).then(function(t){e.dataContainer.mySource.thingTypes=t,e.dataContainer.mySource.thingType?o.getSchemaByType(e.dataContainer.mySource.thingType).$promise.then(function(t){e.dataContainer.predicate=e.trigger.predicate,e.dataContainer.sourceSchema=t},function(){}):o.getTypeSchemas(t).then(function(t){e.dataContainer.predicate=e.trigger.predicate,e.dataContainer.sourceSchema=o.xSchemas(t)})}),_.each(e.trigger.targets,function(t,i){o.getSourceTypes(t).then(function(n){e.dataContainer.myTargets.push({tagList:t.tagList,thingList:t.thingList,andExpress:t.andExpress,thingType:t.thingType,thingTypes:n}),e.dataContainer.targetSchemas.push({});var a;a=t.thingType?[t.thingType]:n,o.getTypeSchemas(a).then(function(n){var a=o.xSchemas(n);o.initTargetSchema(t,a),e.dataContainer.targetSchemas[i]=a})})})},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(t){switch(t){case 1:c();break;case 2:p();break;case 3:u();break;case 4:g(),h()}e.currentStep=e.currentStep>3?e.currentStep:t+1,console.log(JSON.stringify(e.trigger))},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,new TriggerTarget)}}]}}]).controller("summaryTrigger.CreateSource",["$uibModalInstance","$scope",function(e,t){t.createSource=function(t){var i={name:t};e.close(i)},t.cancel=function(){e.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("UserGroupService",["$http","$q","Session",function(e){var t={};return t.getUserGroups=function(){return e({url:"app/data/userGroup.json",method:"get"})},t.getGroup=function(){return e({url:"app/data/group.json",method:"get"})},t}]),angular.module("BeehivePortal").controller("UserGroupController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("UserService",["$http","$q","Session",function(e){var t={};return t.getUserList=function(){return e({url:MyAPIs.SEARCH_USER,method:"get",data:{}})},t}]),angular.module("BeehivePortal").controller("UserController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").controller("UserController.EditUser",["$scope","$uibModalInstance","user","$$UserManager","PortalService","$$Thing","$$Tag","$rootScope","$$User",function(e,t,i,n,a,r,o,s,l){e.user=i,e.init=function(){s.$watch("login",function(t){t&&(e.things=l.getThings({userID:e.user.userID}),e.tags=l.getTags({userID:e.user.userID}),e.allTags=o.queryAll())})},e.ok=function(){n.update(i,function(){t.close(e.user),console.log("save user succeeded!")},function(){console.log("failed to save user!")})},e.cancel=function(){t.dismiss("cancel")},e.addTag=function(t,i){l.bindTag({tags:[t.fullTagName],userIDs:[i.userID]},function(){e.tags=e.tags||[],e.tags.push(t)})},e.removeTag=function(t,i){l.unbindTag({tags:[t.fullTagName],userIDs:[i.userID]},function(){e.tags.remove(t)})},e.addThings=function(t,i){l.bindThing({},{globalThingIDs:[t],userIDs:[i.userID]},function(){e.things=e.things||[],_.each(t,function(t){e.things.push(r.get({globalThingID:t}))})})},e.removeThing=function(t,i){l.unbindThing({globalThingIDs:[t.globalThingID],userIDs:[i.userID]},function(){e.things.remove(t)})}}]),angular.module("BeehivePortal").factory("ThingAuthorityService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("ThingAuthorityController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location","$User",function(e,t,i,n,a,r,o,s,l,c){e.ownThings=[],e.selectedThings=[],e.init=function(){t.$watch("login",function(t){if(t){var n=i.params.userID;e.things=c.getThings({userID:n})}})}}]),angular.module("BeehivePortal").factory("TypeViewService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("TypeViewController",["$scope","$rootScope","$state","AppUtils","$$Type","$uibModal",function(e,t,i,n,a,r){e.thingTypes=[],e.init=function(){e.thingTypes=a.getAll()},e.viewThings=function(t){e.navigateTo(e.navMapping.TYPE_THING_LIST,{typeName:t.type,from:"type"})},e.editType=function(e){var t=r.open({animation:!0,templateUrl:"app/components/portal/ThingViews/TypeView/EditType.template.html",controller:"TypeViewController.EditType",size:"lg",resolve:{type:_.clone(e)}});t.result.then(function(){},function(){})}}]).controller("TypeViewController.EditType",["$scope","$http","$uibModalInstance","type","$$Type","$timeout","$q",function(e,t,i,n,a,r,o){e.schema={};var s;e.init=function(){var t=new Promise(function(e){r(function(){var t=document.getElementById("jsoneditor"),i={mode:"code"};s=new JSONEditor(t,i),e(s)},50)});e.type=n;var i=a.getSchema({type:n.type}).$promise;o.all([t,i]).then(function(t){var i=t[1];i.name||(e.schema=null),e.schema=i,s.set(i)})},e.propertyRequired=function(e,t){return!!_.find(t,function(t){return t==e})},e.ok=function(){var t=s.get(),n={thingType:e.type.type,name:e.type.type,version:t.version,content:t.content};e.schema&&e.schema.id?(n.id=e.schema.id,a.updateSchema(n,function(){i.close(e.type)})):a.saveSchema(n,function(){i.close(e.type)})},e.cancel=function(){i.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("ThingListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("ThingListController",["$scope","$rootScope","$state","AppUtils","$location","$$Thing",function(e,t,i,n,a,r){e.things=[],e.thingsForDisplay=[],e.queryThings=function(t,i){e.things="type"==t?r.byType({},{typeName:i}):r.byTag({tagType:"Custom",displayName:i})},e.init=function(){var t=i.params.from,n=i.params.id,a=null;switch(t){case"type":a=e.navMapping.TYPE_THING_DETAIL,n=i.params.typeName;break;case"tag":a=e.navMapping.TAG_THING_DETAIL,n=i.params.displayName}e.queryThings(t,n);var r=_.find(e.myMenu.itemList,function(e){return"查看详情"==e.text});_.extend(r,{callback:function(t){e.navigateTo(a,_.extend({thingid:t.globalThingID},i.params))}})}}]),angular.module("BeehivePortal").controller("ThingDetailController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$uibModal","$timeout","$$Trigger","$log",function(e,t,i,n,a,r,o,s,l,c){e.thing={},e.dataset={triggers:[]};var p;e.init=function(){e.timePickerOptions={step:20,timeFormat:"g:ia",appendTo:"body"};var t=i.params.thingid;e.thing=a.get({globalThingID:t},function(i){a.getOnboardingInfo({vendorThingID:i.vendorThingID},function(t){_.extend(e.thing,t),c.debug(t)}),a.getTriggers({globalThingID:t},function(t){_.each(t,function(t){var i=new Trigger(t.type);i.init(t),e.dataset.triggers.push(i)})}),s(function(){var e={mode:"code"};p=document.getElementById("customEditor"),p=new JSONEditor(p,e)},50)}),e.dateOptions={dateDisabled:!1,formatYear:"yy",maxDate:(new Date).getTime(),minDate:new Date(2015,5,1).getTime(),startingDay:1},e.startDate=new Date,e.startDate.setDate(e.startDate.getDate()-1),e.endDate=new Date,e.endDate.setDate(e.endDate.getDate()),e.searchThingCommands(t,e.startDate,e.endDate)},e.openStartDate=function(){e.startDateOpened=!0},e.openEndDate=function(){e.endDateOpened=!0},e.searchThingCommands=function(t,i,n){var r={globalThingID:t,start:i.getTime(),end:n.getTime()+864e5-1};e.thingCommands=a.getCommands(r)},e.editCustom=function(t){e.customOnEdit=!0,p.set(t)},e.refreshStatus=function(){e.thing=a.get({globalThingID:i.params.thingid})},e.submitCustomFields=function(t){t.custom=p.get(),a.save({},t,function(){n.alert("更新设备信息成功！","提示信息"),e.customOnEdit=!1})},e.goThingACL=function(){i.go(e.navMapping.LOCATHON_THING_ACL,i.params)},e.createTriggerModal=function(){var t=o.open({animation:!0,templateUrl:"app/components/portal/ThingViews/ThingRule.template.html",controller:"ThingDetailController.CreateTrigger",size:"lg",resolve:{thing:function(){return e.thing}}});t.result.then(function(t){e.dataset.triggers.push(t)})},e.deleteTrigger=function(t){t.triggerID?l.remove({},t,function(){e.dataset.triggers.remove(t)}):e.dataset.triggers.remove(t)},e.enableTrigger=function(e){l.enable({},e,function(){e.enable()})},e.disableTrigger=function(e){l.disable({},e,function(){e.disable()})},e.$on("deleteTrigger",function(t,i){n.confirm("提示信息","您确定要删除这个触发器吗？",function(){e.deleteTrigger(i)})}),e.$on("enableTrigger",function(t,i){n.confirm("提示信息","您确定要启用这个触发器吗？",function(){e.enableTrigger(i)})}),e.$on("disableTrigger",function(t,i){n.confirm("提示信息","您确定要禁用这个触发器吗？",function(){e.disableTrigger(i)})})}]).controller("ThingDetailController.CreateTrigger",["$scope","$uibModalInstance","thing",function(e,t,i){e.triggerBO={},e.ok=function(){var n=new Trigger(Trigger.TypeEnum.SIMPLE);n.setName(e.triggerBO.triggerName),n.setSource(i.globalThingID),t.close(n)},e.cancel=function(){t.dismiss()}}]),angular.module("BeehivePortal").controller("ThingACLController",["$scope","$rootScope","$state","AppUtils","$$User",function(e,t,i,n,a){e.users=a.query({role:"4"},function(e){console.log(e)}),e.acls=[{name:"开关"},{name:"亮度"}]}]),angular.module("BeehivePortal").controller("TagViewController",["$scope","$rootScope","$state","AppUtils","$$Tag","$$Thing","$uibModal","$q","$http",function(e,t,i,n,a,r,o){e.thingTags=[],e.tagsForDisplay=[],e.init=function(){a.queryAll(function(t){e.thingTags=t},function(e){console.log(e)})},e.viewThings=function(t){e.navigateTo(e.navMapping.TAG_THING_LIST,{id:t.tagName,from:"tag",displayName:t.displayName})},e.addTag=function(){var t=o.open({animation:!0,templateUrl:"app/components/portal/ThingViews/TagView/AddTag.template.html",controller:"TagViewController.AddTag",size:"md",resolve:{}});t.result.then(function(t){e.thingTags.push(t)},function(){})},e.deleteTag=function(t){n.confirm("删除标签","是否删除标签"+t.displayName,function(){return a.remove({},{tagName:t.displayName},function(){e.thingTags.remove(t)})})},e.editTag=function(e){var t=o.open({animation:!0,templateUrl:"app/components/portal/ThingViews/TagView/EditTag.template.html",controller:"TagViewController.EditTag",size:"lg",resolve:{tag:e}});t.result.then(function(t){_.extend(e,t)},function(){})}}]),angular.module("BeehivePortal").controller("TagViewController.AddTag",["$rootScope","$scope","$uibModalInstance","$$Tag",function(e,t,i,n){t.newTag={things:[]},t.ok=function(){n.create(t.newTag,function(t){t.count=0,t.displayName=t.tagName.substr(7),t.createBy=e.credential.userID,i.close(t)},function(e){console.log(e)})},t.cancel=function(){i.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("TagViewController.EditTag",["$scope","$uibModalInstance","$$Tag","$$Thing","$timeout","tag","$q","$$Location",function(e,t,i,n,a,r,o){e.tag=r,e.existingIDs=[],e.selectedThings=[],e.init=function(){n.byTag({tagType:"Custom",displayName:r.displayName},function(t){e.selectedThings=_.uniq(_.pluck(t,"globalThingID")),e.existingIDs=_.clone(e.selectedThings)})},e.ok=function(){var a=e.selectedThings;i.update(e.tag,function(){var i=_.difference(e.existingIDs,a),r=(a.length,[]);if(i.length>0){var s=n.removeTags({things:i.join(","),tags:e.tag.displayName}).$promise;r.push(s)}if(a.length>0){var s=n.bindTags({things:a.join(","),tags:e.tag.displayName}).$promise;r.push(s)}o.all(r).then(function(){t.close(e.tag)})},function(e){AppUtils.alert(e)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("LocationViewController",["$scope","$rootScope","$state","AppUtils","$$Tag","$$Thing","$$Location","PortalService",function(e,t,i,n,a,r,o){e.things=[],e.thingsForDisplay=[],e.selectedLocation={},e.init=function(){e.locationsTree=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.locations=o.queryAll(function(t){if(e.locationTree=new LocationTree(_.pluck(t,"displayName")),e.locationTree.children){var i=e.locationTree.children[0].id;r.byTag({tagType:"Location",displayName:i})}});var t=_.find(e.myMenu.itemList,function(e){return"查看详情"==e.text});_.extend(t,{callback:function(t){e.navigateTo(e.navMapping.LOCATION_THING_DETAIL,{thingid:t.globalThingID})}})},e.selectLocation=function(t){e.things=r.byTag({tagType:"Location",displayName:t.id})},e.search=function(t){e.things=r.byTag({tagType:"Location",displayName:t.displayName})}}]),angular.module("BeehivePortal").factory("WebSocketClient",["$rootScope","$stomp","$q",function(e,t,i){var n={};return n.getClient=function(){var t=i.defer(),n=new SockJS(webSocketPath),a={Authorization:"Bearer "+e.credential.accessToken,"Content-type":"application/json"},r=Stomp.over(n);return r.connect(a,function(){r.subscribe("/topic/operator",function(){t.resolve(r)},function(e){t.reject(e)})},function(e){t.reject(e)})(),t.promise},n}]),angular.module("BeehivePortal").controller("GatewayController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$$Location","$uibModal","WebSocketClient",function(e,t,i,n,a,r,o,s){e.things=[],e.init=function(){t.$watch("login",function(t){t&&(e.locationsTree=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.selectLocation())})},t.$watch("login",function(t){t&&e.init()}),e.selectLocation=function(){a.byType({typeName:"gateway-streetlight"},function(t){e.things=_.filter(t,function(e){return"gateway-streetlight"==e.type})})},e.showGatewayThings=function(t){a.getEndNodes({},t,function(i){e.endNodes=i,_.each(i,function(i,n){e.endNodes[n].kiiThingID=t.kiiThingID,e.endNodes[n].kiiAppID=t.kiiAppID})})},e.showReplaceModal=function(e){var t=s.open({animation:!0,templateUrl:"app/components/portal/ThingManager/Gateway/Replacement.template.html",controller:"GatewayController.Replacement",size:"md",resolve:{endNode:function(){return e}}});t.result.then(function(e){_.extend(e,e)},function(){console.log("Modal dismissed at: "+new Date)})},e.removeEndNode=function(t){n.confirm("删除节点","您确认要删除这个节点吗？",function(){a.removeEndNode({},t,function(){e.endNodes.remove(t)})})}}]).controller("GatewayController.Replacement",["$scope","$uibModalInstance","$$Thing","endNode","$http",function(e,t,i,n){e.endNode={kiiAppID:n.kiiAppID,kiiThingID:n.kiiThingID,endNodeVendorThingID:n.vendorThingID,thingID:n.thingID},e.ok=function(){i.replaceEndNode({},e.endNode,function(){n.vendorThingID=e.endNode.endNodeVendorThingID,t.close(n)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("ControlThingController",["$scope","$state","AppUtils","$$Thing","$$Type","TriggerService","$timeout","$rootScope",function(e,t,i,n,a,r,o,s){function l(){var t=e.dataContainer.mySource.sourceType;"tag"==t?(e.dataContainer.mySource.thingList&&delete e.dataContainer.mySource.thingList,e.dataContainer.mySource.type=e.dataContainer.mySource.selectedType.id):e.dataContainer.mySource.tagList&&delete e.dataContainer.mySource.tagList;var i=e.dataContainer.mySource;r.getSourceTypes(i).then(function(t){r.getTypeSchemas(t).then(function(t){e.dataContainer.sourceSchema=t[0]})})}function c(){e.dataContainer={mySource:{},command:{}}}function p(){var a=e.dataContainer.sourceSchema,r=[];_.each(a.content.actions,function(e,t){var i={},n=!1;i[t]={},e._checked&&_.each(e.in.properties,function(e,a){e._checked&&(i[t][a]=e.value,n=!0)}),n&&r.push(i)});var s=["thingList","tagList","andExpress","type"];_.each(e.dataContainer.mySource,function(t,i){-1==s.indexOf(i)&&delete e.dataContainer.mySource[i]});var l=new BeehiveCommand,p=[];_.extend(l,e.dataContainer.mySource),l.command.actions=r,p.push(l),n.sendCommand(p,function(){c(),i.alert("命令已发送成功","提示信息"),t.go(t.current.name,{refreshId:~~(100*Math.random())}),e.refreshed=!1,o(function(){e.refreshed=!0})})}e.init=function(){e.currentStep=1,s.$watch("login",function(t){t&&(c(),e.refreshed=!0)})},e.nextStep=function(t){switch(t){case 1:l();break;case 2:p()}e.currentStep=2==t?2:e.currentStep+1}}]),angular.module("BeehivePortal").controller("AddThingController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$timeout","$$Supplier","ThingErrorHandler",function(e,t,i,n,a,r,o,s,l){e.types=[];e.init=function(){t.$watch("login",function(t){t&&(e.types=[],r.getAll(function(t){e.types=_.pluck(t,"type")}),e.thing=new BeehiveThing,e.suppliers=s.getAll(function(t){e.thing.kiiAppID=t[0].relationAppID}))})},e.saveThing=function(e){a.save(e,function(){n.alert("保存成功！","提示信息")},function(e){l.handle(e.data.errorCode)})}}]),angular.module("BeehivePortal.ScenarioManager.OfficeAtmosphere").factory("TriggerPanelService",["$rootScope","$timeout","$$Thing","$templateCache","AppUtils","$cacheFactory",function(e,t,i,n,a,r){function o(e,t){this.$cache=r("OfficeAtmosphere"),this._$panel=e,this.$scope=t,this._$rightPanel=e.find(".right-panel"),this._$leftPanel=e.find(".left-panel"),this._$locationPanel=this._$leftPanel.find(".item-container"),this._$controllerPanel=this._$leftPanel.find(".controller-container"),this._$toolPanel=e.find(".tool-panel"),this._$toolPanel._subControls={trash:this._$toolPanel.find(".trash")},this._$cols=this._$rightPanel.find(".col"),this.locationLink=[],this.dataContainer={sensors:[],locations:[],equipments:[],locationTree:{},popedSensors:[],popedEquipments:[],mainController:null},this.triggerControllerTypes=[{icon:"fa fa-clock-o",type:o.ControllerType.TIMER},{icon:"fa fa-user",type:o.ControllerType.CONDITION}],this._$rightPanel.cols={sensors:this._$rightPanel.find(".col.col-1"),locations:this._$rightPanel.find(".col.col-2"),mainController:this._$rightPanel.find(".col.col-3"),subController:this._$rightPanel.find(".col.col-4"),equipments:this._$rightPanel.find(".col.col-5")},this.graph=d3.select("#graph"),this.lineGroup=[],this.$scope.dataContainer=this.dataContainer,this.init()}var s={};return s.factory=function(e,t){return new o(e,t)},o.PopoverSensorTemplate=n.get("office-atmosphere.popover-sensor.template.html"),o.PopoverEquipTemplate=n.get("office-atmosphere.popover-equip.template.html"),o.DataTypes={LOCATION:"location",SENSOR:"sensor",EQUIPMENT:"equipment",CONTROLLER:"controller",MAIN_CONTROLLER:"main_controller",SUB_CONTROLLER:"sub_controller"},o.ControllerType={TIMER:"timer",CONDITION:"condition"},o.Events={ITEM_START_DRAG:"item-start-drag",ITEM_STOP_DRAG:"item-stop-drag",ITEM_START_DELETE:"item-start-delete",ITEM_STOP_DELETE:"item-stop-delete",ITEM_DESTROYED:"item_destroyed",ITEM_ADDED:"item_added"},o.DragActions={DRAGGIN_LOCATION:"DRAGGIN_LOCATION",DRAGGIN_SENSOR:"DRAGGIN_SENSOR",DRAGGIN_EQUIP:"DRAGGIN_EQUIP",DRAGGIN_CONTROLLER:"DRAGGIN_CONTROLLER"},o.prototype.init=function(){function e(){i.redraw.call(i)}var i=this;$(window).on("resize",e),this.redrawBinder=e,this._$toolPanel._subControls.trash.droppable({accept:".draggable-item",hoverClass:"active",over:function(){i._$toolPanel._subControls.trash.addClass("active")},out:function(){i._$toolPanel._subControls.trash.removeClass("active")},drop:function(){i.onDropDelete.apply(i,arguments)}}),this.$scope.locationOnClick=function(e,t){i.loadSensors.call(i,e,t)},this.$scope.selectedLocationOnClick=function(e,t){i.loadEquipments.call(i,e,t)},this.$scope.locationDoubleClick=function(e){var t=e.currentTarget._data;t.children&&t.children.length>0&&i.selectLocation(t)},this.$scope.triggerControllerTypes=this.triggerControllerTypes,$("body").on("click",i.hidePopover),t(function(){i.initControllers(),i.sensorDroppable(),i.locationDroppable(),i.equipDroppable(),i.rightPanelDraggable(),i.controllerDraggable(),i.mainControllerDroppable()}),this._$panel.on(o.Events.ITEM_START_DRAG,function(){i.onItemDragginStart.apply(i,arguments)}),this._$panel.on(o.Events.ITEM_STOP_DRAG,function(){i.onItemDragginStop.apply(i,arguments)}),this._$panel.on(o.Events.ITEM_START_DELETE,function(){i.onItemRemoveStart.apply(i,arguments)}),this._$panel.on(o.Events.ITEM_STOP_DELETE,function(){i.onItemRemoveStop.apply(i,arguments)}),this._$panel.on(o.Events.ITEM_ADDED,function(){i.onItemsChanged.apply(i,arguments)}),this._$panel.on(o.Events.ITEM_DESTROYED,function(){i.onItemsChanged.apply(i,arguments)})},o.prototype.initControllers=function(){var e=this;this._$controllerPanel.find(".draggable-item").each(function(t){this._data=e.triggerControllerTypes[t],this._dataType=o.DataTypes.CONTROLLER})},o.prototype.onItemsChanged=function(){this.redraw()},o.prototype.hidePopover=function(e){"popover"!==$(e.target).data("toggle")&&0===$(e.target).parents(".popover.in").length&&$('[data-toggle="popover"]').popover("hide")},o.prototype.loadSensors=function(e,n){var a=this;i.byTag({tagType:"Location",displayName:e.id},function(e){var i=e;a.dataContainer.popedSensors=i,t(function(){var e=$("#sensor-holder").find(".sensor"),t=$(n.currentTarget),r=t.popover("show").data("bs.popover").$tip;r.find(".popover-content").html(""),r.find(".popover-content").append(e),_.each(i,function(t,i){e[i]._data=t,e[i]._dataType=o.DataTypes.SENSOR}),a.sensorDraggable()})})},o.prototype.loadEquipments=function(e,n){var a=$(n.currentTarget),r=this;i.byTag({tagType:"Location",displayName:e.id},function(e){var i=_.uniq(_.pluck(e,"type"));r.dataContainer.popedEquipments=i,t(function(){var e=$("#equipment-holder").find(".equip").clone(),t=$(n.currentTarget),a=t.popover("show").data("bs.popover").$tip;a.find(".popover-content").html(""),a.find(".popover-content").append(e),_.each(i,function(t,i){e[i]._data=t,e[i]._dataType=o.DataTypes.EQUIPMENT}),r.equipDraggable()})}),t(function(){a.popover("show")})},o.prototype.sensorDroppable=function(){var e=this;this._$rightPanel.cols.sensors.droppable({accept:".sensor-popover .draggable-item",drop:function(){e.onSensorDrop.apply(e,arguments),e.rightPanelDraggable()}})},o.prototype.sensorDraggable=function(){var e=this,t=$(".popover.sensor-popover").find(".draggable-item");t.draggable({containment:e._$panel,helper:"clone",cursor:"move",scroll:!1,revert:function(t){return!t||t[0]!=e._$rightPanel.cols.sensors[0]},appendTo:e._$rightPanel.cols.sensors,start:function(t,i){i.helper[0]._data=i.helper.context._data,i.helper[0]._dataType=o.DataTypes.SENSOR;var t=jQuery.Event(o.Events.ITEM_START_DRAG);t._action=o.DragActions.DRAGGIN_SENSOR,$(i.helper[0]).addClass("dragged"),e._$panel.trigger(t),$(".popover.sensor-popover").hide()},stop:function(t,i){var t=jQuery.Event(o.Events.ITEM_STOP_DRAG);t._action=o.DragActions.DRAGGIN_SENSOR,$(i.helper[0]).removeClass("dragged"),e._$panel.trigger(t),$(".popover.sensor-popover").show()}})},o.prototype.locationDroppable=function(){var e=this;this._$rightPanel.cols.locations.droppable({accept:".left-panel .item-container .draggable-item",drop:function(){e.onLocationDrop.apply(e,arguments),e.rightPanelDraggable()}})},o.prototype.controllerDraggable=function(){var e=this,t=this._$controllerPanel.find(".draggable-item");t.draggable({cursor:"move",helper:"clone",scroll:!1,revert:function(e){return e&&$(e[0]).hasClass("controller-holder")?!1:!0},start:function(t,i){i.helper[0]._data=i.helper.context._data,i.helper[0]._dataType=o.DataTypes.CONTROLLER;var t=jQuery.Event(o.Events.ITEM_START_DRAG);t._action=o.DragActions.DRAGGIN_CONTROLLER,$(i.helper[0]).addClass("dragged"),e._$panel.trigger(t)},stop:function(t,i){var t=jQuery.Event(o.Events.ITEM_STOP_DRAG);t._action=o.DragActions.DRAGGIN_CONTROLLER,$(i.helper[0]).remove(),e._$panel.trigger(t)}})},o.prototype.mainControllerDroppable=function(){var e=this;this._$rightPanel.cols.mainController.find(".controller-holder").droppable({accept:".left-panel .draggable-item.controller",drop:function(){e.onMainControllerDrop.apply(e,arguments),e.rightPanelDraggable()}})},o.prototype.subControllerDroppable=function(e,t){var i=this;e.droppable({accept:".controller-container .draggable-item",drop:function(e,n){i.onSubControllerDrop.call(i,e,n,t),i.rightPanelDraggable()}})},o.prototype.onMainControllerDrop=function(e,i){var n=this;this.dataContainer.mainController=_.clone(i.helper[0]._data),this.$scope.$apply(),t(function(){var e=n._$rightPanel.cols.mainController.find(".controller-holder")[0];e._data=n.dataContainer.mainController,e._dataType=o.DataTypes.MAIN_CONTROLLER,n._$panel.trigger(o.Events.ITEM_ADDED)})},o.prototype.onSubControllerDrop=function(e,i,n){var a=this;this.dataContainer.equipments[n].subController=_.clone(i.helper[0]._data),this.$scope.$apply(),t(function(){var e=a._$rightPanel.cols.subController.find(".controller-holder").eq(n).find(".draggable-item")[0];e._data=a.dataContainer.equipments[n].subController,e._data.parent=a.dataContainer.equipments[n],e._dataType=o.DataTypes.SUB_CONTROLLER,a._$panel.trigger(o.Events.ITEM_ADDED)})},o.prototype.locationDraggable=function(){var e=this,t=[];_.each(this._$locationPanel.find(".draggable-item"),function(e){$(e).data("draggable")||t.push(e)}),$(t).draggable({cursor:"move",helper:"clone",scroll:!1,appendTo:e._$rightPanel.cols.locations,start:function(t,i){i.helper[0]._data=i.helper.context._data,i.helper[0]._dataType=o.DataTypes.LOCATION;var t=jQuery.Event(o.Events.ITEM_START_DRAG);t._action=o.DragActions.DRAGGIN_LOCATION,$(i.helper[0]).addClass("dragged"),e._$panel.trigger(t)},stop:function(t,i){var t=jQuery.Event(o.Events.ITEM_STOP_DRAG);t._action=o.DragActions.DRAGGIN_LOCATION,$(i.helper[0]).removeClass("dragged"),e._$panel.trigger(t)}}),$(t).popover({container:e._$panel.selector,placement:"right",trigger:"none",template:o.PopoverSensorTemplate,viewport:e._$panel,title:"Sensors",content:""})},o.prototype.equipDroppable=function(){var e=this;this._$rightPanel.cols.equipments.droppable({accept:".equip-popover .draggable-item",drop:function(){e.onEquipmentDrop.apply(e,arguments),e.rightPanelDraggable()}})},o.prototype.equipDraggable=function(){var e=this,t=$(".popover.equip-popover").find(".draggable-item");t.draggable({containment:e._$panel,helper:"clone",cursor:"move",scroll:!1,revert:function(t){return!t||t[0]!=e._$rightPanel.cols.equipments[0]},appendTo:e._$rightPanel.cols.equipments,start:function(t,i){i.helper[0]._data=i.helper.context._data,i.helper[0]._dataType=o.DataTypes.EQUIPMENT;var t=jQuery.Event(o.Events.ITEM_START_DRAG);t._action=o.DragActions.DRAGGIN_EQUIP,$(i.helper[0]).addClass("dragged"),e._$panel.trigger(t),$(".popover.equip-popover").hide()},stop:function(t,i){var t=jQuery.Event(o.Events.ITEM_STOP_DRAG);t._action=o.DragActions.DRAGGIN_EQUIP,$(i.helper[0]).removeClass("dragged"),e._$panel.trigger(t),$(".popover.equip-popover").show()}})},o.prototype.selectLocation=function(e){var i=this;this.$scope.selectedLocationNode=e,this.locationLink.push(e),this.$scope.$$phase||this.$scope.$apply(),t(function(){var e=i._$locationPanel.find(".draggable-item");_.each(i.$scope.selectedLocationNode.children,function(t,i){e[i]._data=t}),i.locationDraggable()})},o.prototype.backToParentLocation=function(){this.locationLink.splice(this.locationLink.length,1),this.selectLocation(this.locationLink[this.locationLink.length-1])},o.prototype.rightPanelDraggable=function(){var e=this,t=e._$toolPanel.find(".item-holder-when-draggin");_.each(this._$panel.find(".col .draggable-item"),function(e){$(e).data("draggable")&&$(e).draggable("destroy")}),this._$panel.find(".col .draggable-item:not(.tip)").draggable({cursor:"move",scroll:!1,appendTo:t,revert:function(e){return!e||e[0]!=t[0]},start:function(t,i){$(t.toElement).one("click",function(e){e.stopImmediatePropagation()});var t=jQuery.Event(o.Events.ITEM_START_DELETE);$(i.helper[0]).addClass("dragged"),e._$panel.trigger(t)
},stop:function(t,i){var t=jQuery.Event(o.Events.ITEM_STOP_DELETE);e._$panel.trigger(t),$(i.helper[0]).removeClass("dragged")}})},o.prototype.onItemRemoveStart=function(){$(".tool-panel").addClass("in")},o.prototype.onItemRemoveStop=function(){$(".tool-panel").removeClass("in")},o.prototype.onItemDragginStart=function(e){function t(){r._$rightPanel.cols.sensors.find(".tip").addClass("active")}function i(){r._$rightPanel.cols.locations.find(".tip").addClass("active")}function n(){r._$rightPanel.cols.equipments.find(".tip").addClass("active")}function a(){r._$rightPanel.cols.mainController.find(".draggable-item").hide(),r._$rightPanel.cols.subController.find(".draggable-item").hide(),r._$rightPanel.cols.mainController.find(".draggable-item").parent().siblings(".tip").show(),r._$rightPanel.cols.subController.find(".draggable-item").parent().siblings(".tip").show(),r._$rightPanel.cols.mainController.find(".tip").addClass("active in"),r._$rightPanel.cols.subController.find(".tip").addClass("active in")}var r=this;switch(e._action){case o.DragActions.DRAGGIN_SENSOR:t(e);break;case o.DragActions.DRAGGIN_LOCATION:i(e);break;case o.DragActions.DRAGGIN_EQUIP:n(e);break;case o.DragActions.DRAGGIN_CONTROLLER:a(e)}},o.prototype.onItemDragginStop=function(e){function t(){r._$rightPanel.cols.sensors.find(".tip").removeClass("active")}function i(){r._$rightPanel.cols.locations.find(".tip").removeClass("active")}function n(){r._$rightPanel.cols.equipments.find(".tip").removeClass("active")}function a(){r._$rightPanel.cols.mainController.find(".draggable-item").show(),r._$rightPanel.cols.subController.find(".draggable-item").show(),r._$rightPanel.cols.mainController.find(".draggable-item").parent().siblings(".tip").hide(),r._$rightPanel.cols.subController.find(".draggable-item").parent().siblings(".tip").hide(),r._$rightPanel.cols.mainController.find(".tip").removeClass("active in"),r._$rightPanel.cols.subController.find(".tip").removeClass("active in")}var r=this;switch(e._action){case o.DragActions.DRAGGIN_SENSOR:t();break;case o.DragActions.DRAGGIN_LOCATION:i();break;case o.DragActions.DRAGGIN_EQUIP:n();break;case o.DragActions.DRAGGIN_CONTROLLER:a(e)}},o.prototype.onDropDelete=function(e,i){var n=this,a=i.helper[0],r=a._data,s=a._dataType;switch(s){case o.DataTypes.SENSOR:this.dataContainer.sensors.remove(r);break;case o.DataTypes.LOCATION:this.dataContainer.locations.remove(r);break;case o.DataTypes.EQUIPMENT:this.dataContainer.equipments.remove(r);break;case o.DataTypes.SUB_CONTROLLER:r.parent.subController=null}$(a).remove(),this.$scope.$apply(),t(function(){n._$panel.trigger(o.Events.ITEM_DESTROYED)})},o.prototype.onSensorDrop=function(e,i){var n=this;this.dataContainer.sensors.push(i.helper[0]._data),this.$scope.$apply(),t(function(){var e=n._$rightPanel.cols.sensors.find(".sensor");_.each(n.dataContainer.sensors,function(t,i){e[i]._data=t,e[i]._dataType=o.DataTypes.SENSOR}),n._$panel.trigger(o.Events.ITEM_ADDED)})},o.prototype.onLocationDrop=function(e,i){var n=this;this.dataContainer.locations.push(i.helper[0]._data),this.$scope.$apply(),t(function(){var e=n._$rightPanel.cols.locations.find(".location");_.each(n.dataContainer.locations,function(t,i){e[i]._data=t,e[i]._dataType=o.DataTypes.LOCATION;var a=$(e[i]).offset().top-n._$panel.offset().top<200?"bottom":"top";$(e[i]).popover({container:n._$panel.selector,placement:a,template:o.PopoverEquipTemplate,trigger:"none",viewport:n._$panel,title:"Equipments",content:""})}),n._$panel.trigger(o.Events.ITEM_ADDED)})},o.prototype.onEquipmentDrop=function(e,i){var n=this,a={type:i.helper[0]._data};this.dataContainer.equipments.push(a),this.$scope.$apply(),t(function(){var e=n._$rightPanel.cols.equipments.find(".equip"),t=n._$rightPanel.cols.subController.find(".controller-holder");_.each(n.dataContainer.equipments,function(i,a){e[a]._data=i,e[a]._dataType=o.DataTypes.EQUIPMENT,n.subControllerDroppable(t.eq(a),a)}),n._$panel.trigger(o.Events.ITEM_ADDED)})},o.prototype.redraw=function(){var e=this;this.graph.selectAll("*").remove(),t(function(){e.drawLineBetweenObjs()},100)},o.prototype.drawLineBetweenObjs=function(){function e(e,i){var n=$(".panel-wrapper").offset().left,a=$(".panel-wrapper").offset().top,r=e.offset().left+e.width()/2-n,o=e.offset().top+e.height()/2-a,s=i.offset().left+i.width()/2-n,l=i.offset().top+i.height()/2-a,c=r+.382*(s-r),p=o;t.graph.append("line").attr("x1",r).attr("y1",o).attr("x2",c).attr("y2",p).attr("stroke","#fff").attr("stroke-width",1),t.graph.append("line").attr("x1",c).attr("y1",p).attr("x2",s).attr("y2",l).attr("stroke","#fff").attr("stroke-width",1)}var t=this,i=this._$rightPanel.cols.sensors.find(".sensor").find(".fa"),n=this._$rightPanel.cols.locations.find(".location").find(".fa"),a=this._$rightPanel.cols.mainController.find(".controller-holder"),r=this._$rightPanel.cols.subController.find(".controller-holder"),o=this._$rightPanel.cols.equipments.find(".equip").find(".fa"),s=a.find(".draggable-item .fa");a=s.length?s:this._$rightPanel.cols.mainController.find(".tip .fa"),r.length?r.each(function(e){var t=r.eq(e).find(".draggable-item .fa");r[e]=t.length?t[0]:r.eq(e).find(".tip .fa")}):r=this._$rightPanel.cols.subController.find(".tip .fa"),o.length&&n.length&&(_.each(r,function(t,i){e($(r[i]),a),e($(r[i]),o.eq(i))}),n.length&&e(a,n.eq(0)),_.each(i,function(t,a){e(i.eq(a),n.eq(0))}))},o.prototype.destroy=function(){$(window).unbind("resize",this.redrawBinder),$("body").unbind("click",this.hidePopover)},s}]),angular.module("BeehivePortal.ScenarioManager.OfficeAtmosphere").controller("OfficeAtmosphereController",["$scope","$rootScope","$state","AppUtils","$timeout","$interval","TriggerPanelService","$$Location",function(e,t,i,n,a,r,o,s){e.init=function(){s.queryAll(function(t){var i=$(".app-portal-scenariomanager-officeatmosphere");e.panelControl=o.factory(i,e),e.panelControl.dataContainer.locationTree=new LocationTree(_.pluck(t,"displayName")).tree,e.panelControl.selectLocation(e.panelControl.dataContainer.locationTree),e.$on("toggle-menu",function(){var t=r(function(){e.panelControl.redraw.call(e.panelControl)},50);a(function(){r.cancel(t)},1e3)}),e.toggleMenu()})},t.login&&e.init(),e.$on("tokenReady",function(t){t&&e.init()}),e.$on("$destroy",function(){e.panelControl&&e.panelControl.destroy()})}]),angular.module("BeehivePortal").factory("LineChartService",["$q","$timeout",function(e,t){var i={},n={_kii_agg_name:"测试数据",_kii_query_path:"/reporting/_search",query:{filtered:{query:{query_string:{query:"*",analyze_wildcard:!0}},filter:{bool:{must:[{range:{date:{gte:0,lte:15621208e5,format:"epoch_millis"}}},{terms:{id:[44926,63349,79191,27876,77666,47103,34346,18999,10045,17544]}}],must_not:[]}}}},size:0,aggs:{byHour:{_kii_agg_field_name:"日期",aggs:{byLocation:{_kii_agg_chart:"bar",_kii_agg_field_name:"楼层","enum":{keys:["1楼","2楼","3楼"],field:"id",values:[[18999,10045,17544],[34346,47103,77666],[27876,79191,63349,44926]]},aggs:{byThing:{terms:{field:"id"},aggs:{KwhMax:{max:{field:"Kwh"}},KwhMin:{min:{field:"Kwh"}}}},KwnD:{_kii_agg_field_name:"电量消耗",script:"doc['totalMaxConsume'] - doc['totalMinConsume']",_kii_selected:!0},totalMaxConsume:{sum_bucket:{buckets_path:"byThing>KwhMax"}},totalMinConsume:{sum_bucket:{buckets_path:"byThing>KwhMin"}}}}},date_histogram:{field:"date",interval:"hour"}}}},a={_kii_agg_name:"测试数据",_kii_query_path:"/reporting/_search",query:{filtered:{query:{query_string:{query:"*",analyze_wildcard:!0}},filter:{bool:{must:[{range:{date:{gte:0,lte:15621208e5,format:"epoch_millis"}}},{terms:{id:[44926,63349,79191,27876,77666,47103,34346,18999,10045,17544]}}],must_not:[]}}}},size:0,aggs:{byHour:{_kii_agg_field_name:"日期",aggs:{byThing:{terms:{field:"id"},aggs:{KwhMax:{max:{field:"Kwh"}},KwhMin:{min:{field:"Kwh"}}}},KwnD:{_kii_agg_field_name:"电量消耗",script:"doc['totalMaxConsume'] - doc['totalMinConsume']",_kii_selected:!0},totalMaxConsume:{sum_bucket:{buckets_path:"byThing>KwhMax"}},totalMinConsume:{sum_bucket:{buckets_path:"byThing>KwhMin"}}},date_histogram:{field:"date",interval:"hour"}}}},r={_kii_agg_name:"测试数据",_kii_query_path:"/reporting/_search",query:{filtered:{query:{query_string:{query:"*",analyze_wildcard:!0}},filter:{bool:{must:[{range:{date:{gte:0,lte:15621208e5,format:"epoch_millis"}}},{terms:{id:[44926,63349,79191,27876,77666,47103,34346,18999,10045,17544]}}],must_not:[]}}}},size:0,aggs:{byLocation:{_kii_agg_chart:"bar",_kii_agg_field_name:"楼层","enum":{keys:["1楼","2楼","3楼"],field:"id",values:[[18999,10045,17544],[34346,47103,77666],[27876,79191,63349,44926]]},aggs:{byThing:{terms:{field:"id"},aggs:{KwhMax:{max:{field:"Kwh"}},KwhMin:{min:{field:"Kwh"}}}},KwnD:{_kii_agg_field_name:"电量消耗",script:"doc['totalMaxConsume'] - doc['totalMinConsume']",_kii_selected:!0},totalMaxConsume:{sum_bucket:{buckets_path:"byThing>KwhMax"}},totalMinConsume:{sum_bucket:{buckets_path:"byThing>KwhMin"}}}},MaxKwh:{max:{field:"Kwh"}},MinKwh:{min:{field:"Kwh"}}}};return i.getQuery=function(){var i=e.defer();return t(function(){i.resolve({barQuery:r,lineQuery:n,lineGroupQuery:a})}),i.promise},i}]),angular.module("BeehivePortal").controller("LineChartController",["$scope","$rootScope","$state","AppUtils","LineChartService","$timeout",function(e,t,i,n,a,r){e.period=new KiiReporting.KiiTimePeriod(null),e.chartSources=[{value:"value",text:"电量使用"},{value:"rate",text:"功率"}],e.selectedSource="value",e.aggMethods=[{value:"avg",text:"平均值"},{value:"max",text:"最大值"},{value:"min",text:"最小值"},{value:"count",text:"计数"}],e.selectedMethod="avg",e.locations=[{text:"栋11-F22-A区",value:"B11-F22-bA"}],e.selectedLocation="B11-F22-bA",e.init=function(){a.getQuery().then(function(t){e.lineLevel=0,e.lineSplitQuery=t.lineQuery,e.barQuery=t.barQuery,e.lineGroupQuery=t.lineGroupQuery,e.lineQuery=t.lineGroupQuery})},e.onPeriodChange=function(t){e.period.setFromTime(t.from),e.period.setToTime(t.to)},e.onTimeSliceChange=function(t){e.period.setUnit(t.unit),e.period.setInterval(t.interval)},e.queryData=function(){e.refreshLine(),e.refreshPie(),e.refreshBar()},e.groupLines=function(){e.lineLevel=0,e.lineQuery=e.lineGroupQuery,e.split=!1,r(function(){e.refreshLine()})},e.splitLine=function(){e.lineLevel=1,e.lineQuery=e.lineSplitQuery,e.split=!0,r(function(){e.refreshLine()})},e.getSummary=function(t){r(function(){e.sumKwh=t.summary.MaxKwh-t.summary.MinKwh|0})},t.$watch("login",function(t){t&&e.init()})}]),angular.module("BeehivePortal").factory("FaceDetectionService",["$q","$timeout",function(){var e={};return e.ganzhiSample={_kii_agg_name:"测试数据",_kii_query_path:"/reporting/_search",query:{filtered:{query:{query_string:{query:"*",analyze_wildcard:!0}},filter:{bool:{must:[{range:{date:{gte:0,lte:15621208e5,format:"epoch_millis"}}},{terms:{id:[45650,32159,24001,67962,1484,63412,6360,89901,43668,60765]}}],must_not:[]}}}},size:0,aggs:{byHour:{_kii_agg_field_name:"日期",_kii_agg_chart:"line",aggs:{byLocation:{_kii_agg_chart:"pie",_kii_agg_field_name:"楼层号","enum":{keys:["1楼","2楼","3楼"],field:"id",values:[[45650,32159,24001],[67962,1484,63412,6360],[89901,43668,60765]]},aggs:{ganzhiRate:{"enum":{keys:["detectedT","detectedF"],field:"detected",values:[[!0],[!1]]},aggs:{count:{value_count:{field:"id"}}}},rate:{_kii_agg_field_name:"空间占用率",script:"doc.ganzhiRate.detectedT.count/(doc.ganzhiRate.detectedT.count + doc.ganzhiRate.detectedF.count)"}}}},date_histogram:{field:"date",interval:"hour"}}}},e.ganzhiGroupSample={_kii_agg_name:"测试数据",_kii_query_path:"/reporting/_search",query:{filtered:{query:{query_string:{query:"*",analyze_wildcard:!0}},filter:{bool:{must:[{range:{date:{gte:0,lte:15621208e5,format:"epoch_millis"}}},{terms:{id:[45650,32159,24001,67962,1484,63412,6360,89901,43668,60765]}}],must_not:[]}}}},size:0,aggs:{byHour:{_kii_agg_field_name:"日期",_kii_agg_chart:"line",aggs:{ganzhiRate:{"enum":{keys:["detectedT","detectedF"],field:"detected",values:[[!0],[!1]]},aggs:{count:{value_count:{field:"id"}}}},rate:{_kii_agg_field_name:"空间占用率",script:"doc.ganzhiRate.detectedT.count/(doc.ganzhiRate.detectedT.count + doc.ganzhiRate.detectedF.count)"}},date_histogram:{field:"date",interval:"hour"}}}},e.ganzhiByLocSample={_kii_agg_name:"测试数据",_kii_query_path:"/reporting/_search",query:{filtered:{query:{query_string:{query:"*",analyze_wildcard:!0}},filter:{bool:{must:[{range:{date:{gte:0,lte:15621208e5,format:"epoch_millis"}}},{terms:{id:[45650,32159,24001,67962,1484,63412,6360,89901,43668,60765]}},{term:{detected:!0}}],must_not:[]}}}},size:0,aggs:{byLocation:{_kii_agg_chart:"bar",_kii_agg_field_name:"楼层号","enum":{keys:["1楼","2楼","3楼"],field:"id",values:[[45650,32159,24001],[67962,1484,63412,6360],[89901,43668,60765]]},aggs:{count:{_kii_agg_field_name:"人气值",value_count:{field:"id"}}}}}},e.summaryQuery={_kii_agg_name:"测试数据",_kii_query_path:"/reporting/_search",query:{filtered:{query:{query_string:{query:"*",analyze_wildcard:!0}},filter:{bool:{must:[{range:{date:{gte:0,lte:15621208e5,format:"epoch_millis"}}},{terms:{id:[45650,32159,24001,67962,1484,63412,6360,89901,43668,60765]}}],must_not:[]}}}},size:0,aggs:{Detected:{_kii_agg_chart:"pie","enum":{keys:["已使用空间","未使用空间"],field:"detected",values:[[!0],[!1]]},aggs:{countT:{_kii_agg_field_name:"人气值",value_count:{field:"id"}}}}}},e}]),angular.module("BeehivePortal").controller("FaceDetectionController",["$scope","$rootScope","$state","AppUtils","FaceDetectionService","$timeout",function(e,t,i,n,a,r){e.period=new KiiReporting.KiiTimePeriod(null),e.chartSources=[{value:"value",text:"人气值"},{value:"rate",text:"占用率"}],e.selectedSource="value",e.aggMethods=[{value:"avg",text:"平均值"},{value:"max",text:"最大值"},{value:"min",text:"最小值"},{value:"count",text:"计数"}],e.selectedMethod="avg",e.locations=[{text:"栋11-F22-A区",value:"B11-F22-bA"}],e.selectedLocation="B11-F22-bA",e.init=function(){e.lineQuery=a.ganzhiGroupSample,e.lineLevel=0,e.barQuery=a.ganzhiByLocSample,e.pieQuery=a.ganzhiByLocSample,e.summaryQuery=a.summaryQuery},e.onPeriodChange=function(t){e.period.setFromTime(t.from),e.period.setToTime(t.to)},e.onTimeSliceChange=function(t){e.period.setUnit(t.unit),e.period.setInterval(t.interval)},e.queryData=function(){e.refreshBar(),e.refreshPie1(),e.refreshLine(),e.refreshPie2()},e.groupLines=function(){e.lineQuery=a.ganzhiGroupSample,e.lineLevel=0,e.split=!1,r(function(){e.refreshLine()})},e.splitLine=function(){e.lineQuery=a.ganzhiSample,e.lineLevel=1,e.split=!0,r(function(){e.refreshLine()})},e.getFigure=function(t){e.numberDetected=t.data.Detected["已使用空间"].countT,e.$apply()},t.$watch("login",function(t){t&&e.init()})}]),angular.module("BeehivePortal").factory("CustomChartsService",["$q","$timeout","$$User",function(e,t,i){function n(e){_.extend(this,{id:"",name:"",description:"",options:{level:0,query:"",interval:1,unit:"H"},widgetSetting:{size:{x:2,y:2},position:{row:0,col:0}}}),e&&_.extend(this,e)}function a(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var r="KII_CHART",o=[],s={charts:[],refresh:function(){var t=e.defer();return i.getCustomData({type:r},function(i){if(i){o=i.data;var a=_.map(o,function(e){returnCustomChartsService.getChart(e)});e.all(a).then(function(){s.charts=Array.prototype.slice.call(arguments),s.charts.pop(),s.charts=_.map(s.charts,function(e){return new n(e)}),s.charts=s.charts||[],t.resolve(s.charts)})}}),t.promise},update:function(){i.putCustomData({type:r},{data:o})},getChart:function(e){return i.getCustomData({type:e}).promise},addChart:function(e){var t=e.id;i.putCustomData({type:t},e)},updateChart:function(e){var t=e.id;i.putCustomData({type:t},e)},deleteChart:function(e){var t=e.id;i.putCustomData({type:t},{})},refreshChart:function(e){i.getCustomData({type:e},function(t){var i=_.findIndex(s.charts,{id:e});s.charts[i]=new n(t)})},CustomChart:n,factoryChart:function(){var e=n.factory();return s.charts.unshift(e),e}};return n.prototype.getWidgetSetting=function(){return this.widgetSetting},n.prototype.update=function(){return s.updateChart(this)},n.prototype.remove=function(){return s.deleteChart(this)},n.prototype.save=function(){return this.id?this.update:(this.id=a(),s.addChart(this))},n.factory=function(e){var t={name:"新建图表"};return e&&_.extend(t,e),new n(t)},s.customChartMap={sizeX:"tag.getWidgetSetting().size.x",sizeY:"tag.getWidgetSetting().size.y",row:"tag.getWidgetSetting().position.row",col:"tag.getWidgetSetting().position.col"},s.gridsterOpts={columns:6,pushing:!0,floating:!0,swapping:!1,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:1,maxRows:100,defaultSizeX:2,defaultSizeY:1,minSizeX:1,maxSizeX:null,minSizeY:1,maxSizeY:null,resizable:{enabled:!0,handles:["e","w","s","se","sw","ne","nw"],start:function(){},resize:function(){},stop:function(e,t){var i=$(t).find(".chartID").val(),n=_.find(s.charts,{id:i});n.update()}},draggable:{enabled:!0,start:function(){},drag:function(){},stop:function(e,t){var i=$(t).find(".chartID").val(),n=_.find(s.charts,{id:i});n.update()}}},s}]),angular.module("BeehivePortal").controller("CustomChartsController",["$scope","$rootScope","$state","AppUtils","CustomChartsService","$timeout",function(e,t,i,n,a){e.onEdit=[],e.init=function(){e.gridsterOpts=a.gridsterOpts,e.customChartMap=a.customChartMap,a.refresh().then(function(t){e.charts=t})},e.factoryChart=function(){a.factoryChart(),e.onEdit=[!0].concat(e.onEdit)},t.$watch("login",function(t){t&&e.init()})}]),angular.module("BeehivePortal").directive("thingSelector",["$compile","$timeout",function(){return{restrict:"E",replace:!0,scope:{selectedThings:"=?",selectedThingTypes:"=?"},templateUrl:"app/shared/directives/thing-selector/thing-selector.template.html",controller:["$scope","$$Tag","$$Thing","$$Location","$$Type","$timeout","$q",function(e,t,i,n,a,r){function o(t){e.things=_.filter(t,function(e){return e.fullKiiThingID})}e.dataset={tags:[],types:[],locations:[]},e.things=[],e.unselectedThings=[],e.thingTypes=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.init=function(){e.dataset.tags=t.queryAll(),a.getAll(function(t){e.dataset.types=_.map(t,function(e){return{name:e.type,id:e.type}})}),n.queryAll(function(t){e.dataset.locations=new LocationTree(_.pluck(t,"displayName")).tree.children})},e.selectType=function(t){i.byType({},{typeName:t.id},function(t){o(t),r(function(){e.whenThingChange()})})},e.selectLocation=function(t){i.byTag({tagType:"Location",displayName:t.id},function(t){o(t),r(function(){e.whenThingChange()})})},e.selectTag=function(t){e.things=i.byTag({tagType:"Custom",displayName:t.displayName},function(t){o(t),r(function(){e.whenThingChange()})})},e.$watch("selectedThings",function(){e.whenThingChange()}),e.whenThingChange=function(){e.unselectedThings=_.filter(e.things,e.unselectedFilter),e.thingTypes=[],e.selectedTypes=[];var t=_.uniq(_.pluck(e.unselectedThings,"type"));_.each(t,function(t){e.thingTypes.push({name:t,children:[]})}),_.each(e.unselectedThings,function(t){var i=_.find(e.thingTypes,function(e){return e.name==t.type});t=_.clone(t),t.name=t.vendorThingID+"/"+t.globalThingID,i.children.push(t)}),e.displayedThings=_.filter(e.things,function(t){return _.find(e.selectedThings,function(e){return e==t.globalThingID})});var i=_.filter(e.selectedThings,function(t){return!_.find(e.things,function(e){return e.globalThingID==t})});_.each(i,function(t){e.selectedTypes.push({name:t,id:t})});var n=_.uniq(_.pluck(e.displayedThings,"type"));e.selectedThingTypes=n,_.each(n,function(t){e.selectedTypes.push({name:t,children:[]})}),_.each(e.displayedThings,function(t){var i=_.find(e.selectedTypes,function(e){return e.name==t.type});t=_.clone(t),t.name=t.globalThingID,i.children.push(t)})},e.unselectedFilter=function(t){return!_.find(e.selectedThings,function(e){return e==t.globalThingID})},e.selectUnselectedThing=function(t){e.selectedUnselectedThing=t},e.selectSelectedThing=function(t){e.selectedSelectedThing=t},e.addThing=function(t){t&&(e.selectedThings=e.selectedThings||[],e.selectedUnselectedThing=null,e.selectedThings.push(t.globalThingID),r(function(){e.whenThingChange()}))},e.removeThing=function(t){if(t){if(!t.globalThingID)return e.selectedThings.remove(t.id),void e.whenThingChange();e.selectedSelectedThing=null,e.selectedThings.remove(t.globalThingID),r(function(){e.whenThingChange()})}}}]}}]),angular.module("BeehivePortal").directive("thingPicker",["$compile","$$Tag","$$Thing","$timeout",function(){return{restrict:"E",replace:!0,scope:{selectedNodes:"=?",settings:"=?",ready:"=?"},templateUrl:"app/shared/directives/thing-picker/thing-picker.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e,t,i,n){function a(e,t,i){e.ancentIds=t,e.id=i,_.each(e.children,function(n,r){var o=_.clone(t);o.push(e.id);var s=i+r;a(n,o,s)})}function r(){var t=[];_.each(e.tabs,function(e){_.each(e.treeRight,function(e){o(e,function(e){if(!e.children||0==e.children.length){var i=_.clone(e.reference);_.find(t,function(e){return e[s.idFieldName]==i[s.idFieldName]})||t.push(i),delete i.clones}})})}),e.selectedNodes=t,_.each(e.selectedNodes,function(t,i){e.selectedNodes[i]=_.clone(t),delete e.selectedNodes[i].ancentIds,delete e.selectedNodes[i].container,delete e.selectedNodes[i].reference,delete e.selectedNodes[i].referencedRightTree,delete e.selectedNodes[i].referencedLeftTree})}function o(e,t){if(e){if(e.children&&e.children.length)for(var i=e.children.length;i>=0;i--)o(e.children[i],t);return t(e)}}var s={tabs:[],id:"id",data:[]};e.tabs=[],e.settings=e.settings||{},e.settings=_.extend(s,e.settings),e.tabs=e.settings.tabs,e.selecteTab=function(t){n(function(){_.each(e.tabs,function(e){e.active=!1}),t.active=!0}),e.treeLeft=t.treeLeft,e.treeRight=t.treeRight},e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.$watch("ready",function(t){1==t&&n(e.onReady)}),e.init=function(){_.each(e.tabs,function(e){e.active=!1,e.treeLeft=[],e.treeRight=[]}),e.selecteTab(e.tabs[0]),e.treeLeft=e.tabs[0].treeLeft,e.treeRight=e.tabs[0].treeRight},e.onReady=function(){function t(t,i){var n=_.filter(t,function(e){return _.find(i,function(t){return t==e[s.idFieldName]})});_.each(n,function(t){_.each(t.clones,function(t){e.switchNodeReferences(t,!0)})})}function i(e,t,i){var n=i.mapper,r=i.treeLeft,s=i.treeRight,l=i.nameGenerator,c=i.name;n?_.each(e,function(e){o(e,function(e){e.children=e.children||[],e.name=e[n.nameFieldName],e.isFolder=!0,_.each(t,function(t){if(null!==t[n.mapperFieldName]&&(t[n.mapperFieldName]===e[n.idFieldName]||t[n.mapperFieldName]instanceof Array&&t[n.mapperFieldName].indexOf(e[n.idFieldName])>-1)){var i=_.clone(t);_.extend(i,{name:l(i),reference:t,referencedLeftTree:r,referencedRightTree:s}),t.clones=t.clones||[],t.clones.push(i),e.children.push(i)}})})}):_.each(e,function(e){_.extend(e,{name:l(e),reference:e,referencedLeftTree:r,referencedRightTree:s}),e.clones=e.clones||[],e.clones.push(e)}),_.each(e,function(e,t){a(e,[""],c+t.toString()),r.push(e),e.container=r}),_.each(e,function(e){o(e,function(e){e.children&&0!=e.children.length||!e.isFolder||e.container.remove(e)})})}e.existingNodes=e.settings.existingNodeIDs,e.queriedNodes=e.settings.dataset.data,_.each(e.tabs,function(t){i(t.dataset,e.queriedNodes,t)}),t(e.queriedNodes,e.existingNodes)},e.switchNode=function(e,t,i){function n(e,t){if(0==e.length)return[];var i=_.find(t,function(t){return t.id==e[0]});if(!i)return void 0;var a=n(e.removeFirst(),i.children);return void 0==a?void 0:a.concat([i])}function a(e,t){if(0!=t.length){var i=_.last(t);if(0==i.children.length&&t.length>1){var n=t[t.length-2];n.children.splice(n.children.indexOf(i),1),a(e,t.slice(0,t.length-1))}else 1==t.length&&0==i.children.length&&e.splice(e.indexOf(i),1)}}var r=n(e.ancentIds.removeFirst(),t);if(!r||0==r.length)return void(!e.isFolder&&t.indexOf(e)>-1&&(i.push(e),t.remove(e)));if(0!=_.where(r[0].children,{id:e.id}).length){r=r.reverse();var o=_.clone(r);_.each(o,function(e,t){o[t]=_.clone(e),o[t].children=[]});var s=!0,l=i;_.each(o,function(e,t){if(s){var i=_.find(l,function(t){return e.id===t.id});if(i)l=i.children;else{s=!1;for(var n=t;n<o.length;n++){var a=_.clone(o[n]);a.children=[],l.push(a),l=a.children}}}});var s=_.find(l,function(t){return t.id==e.id});s||l.push(e);var c;c=o.length>0?_.last(r).children:t,c.splice(c.indexOf(e),1),a(t,r)}},e.switchNodeReferences=function(t,i){o(t,function(t){if(!(t.children&&t.children.length>0)){if(t.reference){var n=t.reference;_.each(n.clones,function(t){i?e.switchNode(t,t.referencedLeftTree,t.referencedRightTree):e.switchNode(t,t.referencedRightTree,t.referencedLeftTree)})}else i?e.switchNode(t,t.referencedLeftTree,t.referencedRightTree):e.switchNode(t,t.referencedRightTree,t.referencedLeftTree);return!0}}),r()},e.addButtonClick=function(){e.switchNodeReferences(e.selectedLeftNode,!0),e.selectedLeftNode=null},e.removeButtonClick=function(){e.switchNodeReferences(e.selectedRightNode,!1),e.selectedRightNode=null},e.selectLeftNode=function(t){e.selectedLeftNode=t},e.selectRightNode=function(t){e.selectedRightNode=t}}]}}]),angular.module("BeehivePortal").directive("tagSelector",["$compile",function(){return{restrict:"E",scope:{selectedTags:"=?",tagTypes:"=?"},templateUrl:"app/shared/directives/tag-selector/tag-selector.template.html",controller:["$scope","$$Tag","$$Location","$$Thing",function(e,t,i,n){function a(e){var t=e.indexOf("-"),i=e.substr(0,t),n=e.substr(t+1,e.length-t-1);return r(i,n)}function r(e,t){return n.byTag({tagType:e,displayName:t})}e.settings={name:"displayName",id:"displayName",unselectedTitle:"未选标签",selectedTitle:"已选标签"},e.tagThings=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.init=function(){e.dataset={},e.dataset.tags=t.queryAll(),i.queryAll(function(t){e.dataset.locations=new LocationTree(_.pluck(t,"displayName")).tree.children}),e.whenSelectedItemChange()},e.addItem=function(t){var i="";if(i=t.fullTagName?e.addTag(t):e.addLocation(t),e.selectedTags=e.selectedTags||[],!(e.selectedTags.indexOf(i)>-1)){var n=a(i).$promise;n.then(function(t){e.selectedTags.indexOf(i)>-1||(e.selectedTags.push(i),e.tagThings.push({fullTagName:i,things:t}),e.whenSelectedItemChange())})}},e.addTag=function(t){return e.selectedTags=e.selectedTags||[],t.fullTagName},e.addLocation=function(e){var t="Location-"+e.id;return t},e.selectLeftItem=function(t){e.selectedLeftItem=t},e.selectRightItem=function(t){e.selectedRightItem=t},e.removeItem=function(t){e.selectedTags.remove(t.id),e.tagThings=_.reject(e.tagThings,function(e){return e.fullTagName==t.id}),e.whenSelectedItemChange()},e.whenSelectedItemChange=function(){e.selectedItems=[],_.each(e.selectedTags,function(t){e.selectedItems.push({name:t,id:t})}),e.tagTypes=[],_.each(e.tagThings,function(t){e.tagTypes=e.tagTypes.concat(_.pluck(t.things,"type"))}),e.tagTypes=_.uniq(e.tagTypes)},e.selectedThings=[]}]}}]),angular.module("BeehivePortal").directive("switchery",["$timeout",function(){return{restrict:"A",scope:{on:"=?switchery",disabled:"=?"},templateUrl:"app/shared/directives/switchery/switchery.template.html",replace:!0,link:function(e,t,i){e.on=e.on?!0:!1,e.yesText=i.yesText||"",e.noText=i.noText||"",e.switch=function(){e.disabled||(e.on=!e.on)}}}}]),angular.module("BeehivePortal").directive("rpTimeSlicer",["$compile",function(){return{restrict:"E",replace:!0,scope:{input:"=?",output:"=?"},templateUrl:"app/shared/directives/rp-time-slicer/rp-time-slicer.html",controller:["$scope","$$Location",function(e){function t(){if(_.isFunction(e.output)){var t={interval:parseInt(e.selectedSlice.interval),unit:e.selectedSlice.unit};e.output(t)}}e.options=[{value:"m",text:"分钟"},{value:"H",text:"小时"},{value:"d",text:"天"},{value:"w",text:"星期"},{value:"M",text:"月"},{value:"y",text:"年"}],e.init=function(){e.settings={interval:1,unit:"H"},_.extend(e.settings,e.input),e.selectedSlice={interval:e.settings.interval,unit:e.settings.unit},e.$watch("selectedSlice.interval",t),e.$watch("selectedSlice.unit",t)}}]}}]),angular.module("BeehivePortal").directive("rpDatePicker",["$compile",function(){return{restrict:"E",replace:!0,scope:{lastDate:"=?",output:"=?"},templateUrl:"app/shared/directives/rp-date-picker/rp-date-picker.html",controller:["$scope","$$Location",function(e){function t(e,t){var i=new Date(e.getTime());return i.setHours(0,0,0,0),i.setDate(e.getDate()+t),i}function i(){if(_.isFunction(e.output)){var t={isPeriod:!!e.settings.period};t.isPeriod?_.extend(t,{from:e.timePeriod.from._d,to:e.timePeriod.to._d}):_.extend(t,{interval:e.selectedLastTime.interval,unit:e.selectedLastTime.unit}),e.output(t)}}e.options=[{value:"m",text:"分钟"},{value:"h",text:"小时"},{value:"d",text:"天"},{value:"w",text:"星期"},{value:"M",text:"月"},{value:"y",text:"年"}],e.init=function(){var n=new Date;n.setHours(0,0,0,0);var a=(t(n,1),t(n,-1));e.now=moment(n),e.settings={period:!0,from:a,to:n,interval:1,unit:"d"},_.extend(e.settings,e.lastDate),e.selectedLastTime={interval:e.settings.interval,unit:e.settings.unit},e.selectedPeriod={from:e.settings.from,to:e.settings.to},e.timePeriod={from:moment(e.settings.from),to:moment(e.settings.to)},e.$watch("timePeriod.from",i),e.$watch("timePeriod.to",i),e.$watch("selectedLastTime.interval",i),e.$watch("selectedLastTime.unit",i),e.$watch("settings.period",i)}}]}}]),angular.module("BeehivePortal").directive("rangeSlider",[function(){return{restrict:"E",replace:!0,templateUrl:"app/shared/directives/range-slider/range-slider.template.html",scope:{min:"=?",max:"=?",ngModel:"=?",disabled:"=?"},link:function(e){e.$watch("ngModel",function(t,i){t=parseFloat(t),(e.min||0==e.min)&&t<e.min&&(t=i),(e.max||0==e.max)&&t>e.max&&(t=i),e.ngModel=t})}}}]),angular.module("BeehivePortal").directive("pagion",["$compile","$location",function(e,t){return{restrict:"E",replace:!0,scope:{collection:"=?",display:"=?",index:"=?",onChanged:"=?"},templateUrl:"app/shared/directives/pagion/pagion.template.html",link:function(e){function i(){e.display=_.filter(e.collection,function(t,i){return i>=(e.index-1)*e.listMaxLength&&i<e.index*e.listMaxLength})}e.listMaxLength=window.pageListMaxLength,e.index=e.index||1,e.pageChanged=function(){i(),t.search({pageIndex:e.index}),_.isFunction(e.onChanged)&&e.onChanged(index,e.display)},e.$watch("collection",function(){i()},!0)}}}]),angular.module("BeehivePortal").directive("multiSelector",["$compile",function(){return{restrict:"E",replace:!0,scope:{ngModel:"=?",options:"=?",onChange:"=?",single:"=?",disabled:"=?"},templateUrl:"app/shared/directives/multi-selector/multi-selector.template.html",controller:["$scope",function(e){if(e.dataset={settings:{externalIdProp:"",showCheckAll:!1,showUncheckAll:!1,scrollable:!1,smartButtonMaxItems:3,smartButtonTextConverter:function(e){return e}},events:{}},e.tmp={},e.onChange){var t={onItemSelect:function(t){e.single&&angular.equals(e.tmp,t)?(e.ngModel={},e.onChange(t,!1),e.tmp={}):(e.tmp=t,e.onChange(t,!0))},onItemDeselect:function(){}};_.extend(e.dataset.events,t)}e.single&&(e.dataset.settings.selectionLimit=1)}]}}]),angular.module("BeehivePortal").directive("locationSelector",["$compile",function(){return{restrict:"E",replace:!0,scope:{selectedLocation:"=?"},templateUrl:"app/shared/directives/location-selector/location-selector.template.html",controller:["$scope","$$Location",function(e,t){t.queryAll(function(t){var i=_.pluck(t,"displayName");e.locations=new LocationTree(i).tree.children}),e.selectLocation=function(t,i){e.selectedLocation=i?t.id:null},e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}}}]}}]),angular.module("BeehivePortal").directive("kiiChart",["$compile",function(){return{restrict:"E",replace:!1,scope:{query:"=?",period:"=?",window:"=?",location:"=?",refresh:"=?",level:"=?",stage:"=?",chart:"@",output:"=?"},link:function(e,t){function i(t){var i=e._kiiQuery.getAggTree(),a=t.data;
if(e.window){var i=JSON.stringify(i);i=JSON.parse(i);for(var r=e.window;r--&&i.keySet[0];)delete a[i.fieldName][i.keySet.shift()]}if(e.stage){if(0==i.keySet.length)return;a=a[i.fieldName][i.keySet[0]],i=i.children[0]}e.output&&e.output(t),n(i,a)}function n(i,n){var a=i,r=e.level;for(i.chart=e.chart||i.chart;r--;)a=a.children[0];e._chart||(e._chart=KiiReporting.KiiChart.createChart(i,a,t,{})),e._chart&&(e._chart.updateAggTree(i),e._chart.selectAggNode(a),e._chart.setData(n),e._chart.refresh())}t.css({display:"block"}),e._chart=null,e._kiiQuery=null,e._subscribed=!1,e._perviousQuery=null,e.refresh=function(){if(e.period&&e.query){if(e._perviousQuery!=e.query&&(e._kiiQuery=new KiiReporting.KiiQuery(JSON.stringify(e.query)),e._subscribed=!1,e._chart&&(e._chart.destroy(),e._chart=null)),e._kiiPeriod||(e._kiiPeriod=new KiiReporting.KiiTimePeriod(null)),e._kiiQuery.setTimePeriod(e._kiiPeriod),e._kiiPeriod.setUnit(e.period.unit),e._kiiPeriod.setInterval(e.period.interval),e._kiiPeriod.setFromTime(new Date(e.period.fromTime)),e._kiiPeriod.setToTime(new Date(e.period.toTime)),e.window){var t=new Date(e.period.fromTime);switch(e.period.unit){case"m":t.setMinutes(t.getMinutes()-e.window);break;case"H":t.setHours(t.getHours()-e.window);break;case"d":t.setDays(t.getDays()-e.window);break;case"w":t.setTime(t.getTime()-6048e5*e.window);break;case"M":t.setMonth(t.getMonth()-e.window)}e._kiiPeriod.setFromTime(t)}e._kiiQuery.query(),e._kiiQuery&&!e._subscribed&&(e._kiiQuery.subscribe(i),e._subscribed=!0)}}}}}]),angular.module("BeehivePortal").directive("jsonEditor",[function(){return{replace:!0,restrict:"E",scope:{ngModel:"=?"},templateUrl:"app/shared/directives/json-editor/json-editor.template.html",controller:["$scope",function(e){e.fieldList=[],e.typeOptions=[{text:"字符串",value:"string"},{text:"数字",value:"float"},{text:"布尔",value:"boolean"}],e.booleanValues=[{text:"true",value:!0},{text:"false",value:!1}],e.addField=function(){e.fieldList.push({type:"string",value:"",fieldName:""})},e.$watch("ngModel",function(t,i){return t?void(angular.equals(t,i)||(e.fieldList=[],_.each(t,function(t,i){e.fieldList.push({fieldName:i,value:t,type:_.isString(t)?"string":"float"})}))):void(e.ngModel={})}),e.$watch("fieldList",function(t){e.ngModel&&(_.each(e.ngModel,function(t,i){delete e.ngModel[i]}),_.each(t,function(t){if(!t.value&&0!=t.value)return void(e.ngModel[t.fieldName]=null);switch(t.type){case"boolean":e.ngModel[t.fieldName]=t.value;break;case"string":e.ngModel[t.fieldName]=t.value.toString();break;case"float":e.ngModel[t.fieldName]=parseFloat(t.value)}}))},!0)}]}}]),angular.module("BeehivePortal").directive("itemSelector",["$compile",function(){return{restrict:"E",replace:!0,scope:{items:"=?",selectedItems:"=?",settings:"=?",disabled:"=?"},templateUrl:"app/shared/directives/item-selector/item-selector.template.html",controller:["$scope",function(e){e.items=e.items||[],e.selectedItems=e.selectedItems||[];var t={name:"name",id:"name",unselectedTitle:"Unselected",selectedTitle:"Selected"};e.settings=e.settings||{},e.settings=_.extend(t,e.settings),e.$watch("items",function(){e.whenItemChange()},!0),e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.init=function(){e.whenItemChange()},e.selectLeftItem=function(t){e.selectedLeftItem=t},e.selectRightItem=function(t){e.selectedRightItem=t},e.whenItemChange=function(){e.unselectedItems=_.filter(e.items,e.unselectedFilter)},e.unselectedFilter=function(i){return!_.find(e.selectedItems,function(e){return e[t.id]==i[t.id]})},e.addItem=function(t){t&&(e.selectedLeftItem=null,e.selectedItems.push(t),e.whenItemChange())},e.removeItem=function(t){t&&(e.selectedRightItem=null,e.selectedItems.remove(t),e.whenItemChange())}}]}}]),angular.module("BeehivePortal").directive("checkTreeView",["$templateCache",function(e){return{scope:{settings:"=?",treeModel:"=?"},link:function(){var t={treeModel:"",selectedNode:null,selectedNodes:null,expandedNodes:null,onSelection:null,onNodeToggle:null,orderBy:null,reverseOrder:null};t.options={multiSelection:!0,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"},templateUrl:"check-angular-tree.template.html"};var i='<ul {{options.ulClass}} >  <li ng-repeat="node in node.{{options.nodeChildren}} | filter:filterExpression:filterComparator {{options.orderBy}}" ng-class="headClass(node)" {{options.liClass}}set-node-to-data>    <input type="checkbox" ng-model="selectedClass()!=\'\'" ng-click="selectNodeLabel(node); $event.preventDefault();"/>    <i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i>    <i class="tree-leaf-head {{options.iLeafClass}}"></i>    <div class="tree-label {{options.labelClass}}" ng-class="[selectedClass(), unselectableClass()]" tree-transclude ng-click="selectNodeLabel(node)"></div>    <treeitem ng-if="nodeExpanded()"></treeitem>  </li></ul>';e.put("check-angular-tree.template.html",i)}}}]),angular.module("BeehivePortal").directive("inputOptions",["$compile","$timeout",function(e,t){return{restrict:"A",replace:!1,scope:{ngModel:"=?",inputOptions:"=?"},link:function(i,n){function a(){var e=$(n).parent().offset(),t=$(n).offset(),i=t.top-e.top+$(n).height(),a=t.left-e.left;p.css({left:a,top:i})}function r(){var e=$(n).outerWidth();p.find("ul").css({width:e})}function o(){i.open=!0,p.find("ul").show(),r()}function s(){i.open=!1}function l(){i.options=_.filter(i.inputOptions,c)}function c(e){return e&&e.indexOf(i.ngModel||"")>-1}var p="";p+='<div class="input-options" ng-show="open">',p+='  <ul class="dropdown-menu" role="menu">',p+='    <li ng-repeat="option in options" role="menuitem" ng-click="selectOption(option)"><a>{{option}}</a></li>',p+="  </ul>",p+="</div>",p=e(p)(i),p=$(p).insertAfter(n),i.open=!1,i.focused=!0,i.options=[],$(n).parent().css("position","relative"),i.$watch("ngModel",function(){l(),i.focused&&(0==i.options.length?s():o())}),$(n).on("focus",function(){l(),a(),i.focused=!0;var e=i.options.length>0?!0:!1;e?o():s(),i.$apply()}),$(n).on("blur",function(){i.focused=!1,t(s,100),i.$apply()}),i.selectOption=function(e){i.ngModel=e}}}}]),angular.module("BeehivePortal").directive("appSlider",["$timeout",function(){return{restrict:"E",templateUrl:"app/shared/directives/app-slider/app-slider.template.html",replace:!0,scope:{min:"=?",max:"=?",isInt:"=?",ngModel:"=?",disabled:"=?"},link:function(e){e.ngModel=e.ngModel||e.min,e.rangeSlider={value:e.ngModel,options:{floor:e.min,ceil:e.max,step:e.isInt?1:.01}}}}}]),angular.module("BeehivePortal").directive("appSelect",["$timeout",function(e){return{restrict:"A",templateUrl:"app/shared/directives/app-select/app-select.template.html",replace:!0,scope:{options:"=",selectedModel:"=",extraSetting:"=?",change:"=?",disabled:"=?"},link:function(t,i,n){function a(){var e=!1;e=n.valueOnly?_.find(t.options,function(e){return e[t.setting.value]==t.selectedModel}):_.find(t.options,function(e){return angular.equals(e,t.selectedModel)}),t.selectOption(e?e:t.options[0])}t.setting={text:"text",value:"value"},t.myClass=n.class,t.setting=_.extend(t.setting,t.extraSetting),t.selectedOption={},t.$watch("selectedModel",function(e,t){angular.equals(e,t)||a()}),t.setting.text=n.text||t.setting.text,t.setting.value=n.value||t.setting.value,t.selectOption=function(i){t.selectedModel=n.valueOnly?i[t.setting.value]:_.clone(i),t.selectedOption=i,_.isFunction(t.change)&&e(function(){t.change(t.selectedModel)})},t.options&&t.options[0]&&a()}}}]),angular.module("BeehivePortal").controller("UserLoginController",["$scope","$rootScope","$state","AppUtils","Session","$$Auth","$uibModal",function(e,t,i,n,a,r,o){e.credentials={userName:"",password:"",permanentToken:!1},e.login=function(e){if("admin"==e.userName&&"admin"==e.password){var e={accessToken:"super_token",company:"12312",createBy:null,kiiLoginName:"33032719891111",kiiUserID:"f83120e36100-2cc9-5e11-19d9-0df7b818",mail:"ff",modifyBy:null,phone:"ffa",role:"4",userID:"211102",userName:"Admin"};a.setCredential(e),i.go("app.portal.Welcome"),t.login=!0}else r.login(e,function(e){a.setCredential(e),i.go("app.portal.Welcome"),t.login=!0},function(){n.alert("登陆失败")})},e.register=function(){o.open({animation:!0,templateUrl:"registerModal",controller:"UserLoginController.Register",size:"sm"})}}]),angular.module("BeehivePortal").controller("UserLoginController.Register",["$scope","$uibModalInstance","$$Auth","AppUtils","$http",function(e,t,i,n,a){e.currentStep=1,e.credentials={userName:"",newPassword:"",initPwdToken:""},e.register=function(r){switch(e.currentStep){case 1:i.activate({},r,function(t){e.credentials.initPwdToken=t.initPwdToken,e.currentStep=2},function(e,t){n.alert(t)});break;case 2:a.defaults.headers.common.Authorization="Bearer "+e.credentials.initPwdToken,i.initpassword({},r,function(){e.currentStep=3});break;case 3:t.dismiss()}},e.cancel=function(){t.dismiss("cancel")},e.initPassword=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("AdminLoginService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("AdminLoginController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").controller("WelcomeController",["$scope","$rootScope","$state","AppUtils","Session",function(){}]),angular.module("BeehivePortal").controller("UserManagerController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("TriggerService",["$rootScope","$$Type","$q","$$Thing",function(e,t,i,n){var a={};return a.triggerWhenConditions=[{text:"条件为真",value:Trigger.WhenEnum.CONDITION_TRUE},{text:"条件由假转真",value:Trigger.WhenEnum.CONDITION_FALSE_TO_TRUE},{text:"条件由真转假",value:Trigger.WhenEnum.CONDITION_CHANGED},{text:"条件改变",value:Trigger.WhenEnum.CONDITION_CHANGED}],a._ScheduleTriggerFields=["predicate","triggerName","targets","type"],a._SimpleTriggerFields=["source","predicate","triggerName","targets","type"],a._GroupTriggerFields=["source","predicate","triggerName","targets","type"],a._SummaryTriggerFields=["source","predicate","triggerName","targets","type"],a.getDataForRequest=function(e,t){var i=_.clone(e),n=null;switch(t){case"Schedule":n=a._ScheduleTriggerFields;break;case"Simple":n=a._SimpleTriggerFields;break;case"Group":n=a._GroupTriggerFields;break;case"Summary":n=a._SummaryTriggerFields}return _.each(i,function(e,t){-1==n.indexOf(t)&&delete i[t]}),i},a.getSourceTypes=function(e){return new Promise(function(a){if(e.thingList&&e.thingList.length>0){var r=e.thingTypes;if(!r){var o=[];return _.each(e.thingList,function(e){var t=n.get({globalThingID:e}).$promise;o.push(t)}),void i.all(o).then(function(e){r=_.uniq(_.pluck(e,"type")),a(r)})}return void a(r)}return e.tagList?e.selectedType&&e.selectedType.id?void a([e.selectedType.id]):e.type?void a([e.type]):void t.byTags({tags:e.tagList},function(e){a(e)}):void a([])})},a.getTypeSchemas=function(e){var t=[];return _.each(e,function(e){t.push(a.getSchemaByType(e).$promise)}),i.all(t)},a.getSchemaProperties=function(e){var t=[];return _.each(e.content.statesSchema.properties,function(e,i){t.push(_.extend({name:i},e))}),t},a.getSchemaActions=function(e){return e.content.actions},a.initSchema=function(){},a.getSchemaByType=function(e){var i,n,r={};return r.$promise=new Promise(function(e,t){i=e,n=t}),t.getSchema({type:e},function(e){_.extend(r,e),a.initSchema(r),i(r)},n),r},a.xSchemas=function(e){if(1==e.length)return e[0];var t=e[0];return _.each(e,function(){}),t},a.initTargetSchema=function(e,t){_.each(e.content.command.actions,function(e){_.each(e,function(e,i){t.content.actions[i]&&(t.content.actions[i]._checked=!0,_.each(e,function(e,n){t.content.actions[i].in.properties[n].value=e,t.content.actions[i].in.properties[n]._checked=!0}))})})},a.revertCron=function(e){return e=e.substr(2),e=e.substr(0,e.length-1)+"*"},a.getRightCron=function(e){return e="0 "+e,e.substr(0,e.lastIndexOf("*"))+"?"},a.xSchema=function(e,t){var i={statesSchema:{},actions:[]},n=e.content.statesSchema.properties,a=t.content.statesSchema.properties,r={},o=e.content.actions,s=t.content.actions,l={};return _.each(n,function(e,t){var i=a[t];i&&i.type==e.type&&(r[t]=i)}),_.each(o,function(e,t){if(s[t]){var i=s[t],n=!0;_.each(e.in.properties,function(e,t){i.in.properties[t]&&!i.in.properties[t].type!=e.type||(n=!1)}),n&&(l[t]=e)}}),i.content.statesSchema.properties=r,i.content.actions=l,i},a}]),angular.module("BeehivePortal").controller("TriggerManagerController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$$Tag","$q","$timeout","$uibModal","$$Location","$$Trigger",function(e,t,i,n,a,r,o,s,l,c,p,d){e.triggers=[],e.init=function(){d.getAll(function(t){console.log(t),_.each(t,function(t){var i=new Trigger(t.type);i.init(t),e.triggers.push(i)})})},e.createTrigger=function(){var t=c.open({animation:!0,templateUrl:"app/components/portal/TriggerManager/CreateTrigger.template.html",controller:"TriggerManagerController.CreateTrigger",size:"md",resolve:{}});t.result.then(function(t){e.triggers.splice(0,0,t)})},e.deleteTrigger=function(t){t.triggerID?d.remove({},t,function(){e.triggers.remove(t)}):e.triggers.remove(t)},e.enableTrigger=function(e){d.enable({},e,function(){e.enable()})},e.disableTrigger=function(e){d.disable({},e,function(){e.disable()})},e.$on("deleteTrigger",function(t,i){n.confirm("提示信息","您确定要删除这个触发器吗？",function(){e.deleteTrigger(i)})}),e.$on("enableTrigger",function(t,i){n.confirm("提示信息","您确定要启用这个触发器吗？",function(){e.enableTrigger(i)})}),e.$on("disableTrigger",function(t,i){n.confirm("提示信息","您确定要禁用这个触发器吗？",function(){e.disableTrigger(i)})}),e.dataset={}}]).controller("TriggerManagerController.CreateTrigger",["$scope","$uibModalInstance",function(e,t){e.triggerTypes=[{text:"定时任务",value:Trigger.TypeEnum.SIMPLE},{text:"多触发源",value:Trigger.TypeEnum.GROUP},{text:"汇总",value:Trigger.TypeEnum.SUMMARY}],e.triggerBO={},e.ok=function(e){var i=new Trigger(e.triggerType);i.setName(e.triggerName),t.close(i)},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("ThingViewsController",["$scope","$rootScope","$state","AppUtils","$uibModal",function(e,t,i,n,a){e.openRemoteControl=function(e){var t=a.open({animation:!0,templateUrl:"app/components/portal/ThingViews/RemoteControl.template.html",controller:"ThingViewsController.RemoteControl",size:"md",resolve:{thing:function(){return e}}});t.result.then(function(){console.log(e)},function(){console.log("Modal dismissed at: "+new Date)})},e.myMenu={itemList:[{text:"查看详情",callback:function(t){e.navigateTo(e.navMapping.THING_DETAIL,{thingid:t.globalThingID})}},{text:"编辑",callback:function(e){var t=a.open({animation:!0,templateUrl:"app/components/portal/ThingViews/EditThing.template.html",controller:"ThingViewsController.EditThing",size:"md",resolve:{thing:function(){return e}}});t.result.then(function(t){_.extend(e,t)},function(){console.log("Modal dismissed at: "+new Date)})}},{text:"删除",callback:function(e){console.log("Delete thing"),console.log(e)}}],setting:{}}}]).controller("ThingViewsController.RemoteControl",["$scope","$uibModalInstance","thing","$timeout","TriggerService","$$Thing",function(e,t,i,n,a,r){function o(){var t=e.sourceSchema,i=[];return _.each(t.content.actions,function(e,t){var n={},a=!1;n[t]={},e._checked&&_.each(e.in.properties,function(e,i){e._checked&&(n[t][i]=e.value,a=!0)}),a&&i.push(n)}),e.command.command.actions=i,r.sendCommand([e.command])}e.init=function(){e.command=new BeehiveCommand,_.extend(e.command,{thingList:[i.globalThingID]}),e.thing=i,e.sourceSchema=a.getSchemaByType(e.thing.type)},e.ok=function(){o().$promise.then(function(){t.close(e.thing)})},e.cancel=function(){t.dismiss("cancel")}}]).controller("ThingViewsController.EditThing",["$scope","$uibModalInstance","thing","$$Thing","$$Tag",function(e,t,i,n,a){e.thing=i,_.each(e.thing.tags,function(t,i){var n=t.split("-");n.splice(0,1),e.thing.tags[i]=n.join("-")});var r=_.clone(e.thing.tags);e.ok=function(){e.saveTags()},e.cancel=function(){t.dismiss("cancel")},a.queryAll(function(t){e.queriedTags=_.where(t,{tagType:"Custom"}),console.log(t)},function(e){console.log(e)}),e.removeTag=function(t){e.thing.tags=_.reject(e.thing.tags,function(e){return e==t})},e.saveTags=function(){var a=_.pluck(_.where(e.queriedTags,{_checked:!0}),"tagName"),o=i.tags,s=a.concat(o);n.bindTags({things:e.thing.globalThingID,tags:s.join(",")},function(){var i=_.difference(r,s);_.each(i,function(t){n.removeTag({globalThingID:e.thing.globalThingID,tagName:t})}),t.close(e.thing)})}}]),angular.module("BeehivePortal").factory("ThingErrorHandler",["ERROR_CODE","AppUtils",function(e,t){return{handle:function(i,n){var a="";switch(i){case e.INVALID_INPUT:a="检测到非法输入！请重新输入！此处只允许输入50位以内的数字或字符或下划线(_)。";break;default:a="未知错误，请联系平台呢管理员！"}t.alert(a,"提示信息",n)}}}]),angular.module("BeehivePortal").controller("ThingManagerController",["$scope","$rootScope","$state","AppUtils","$uibModal",function(){}]),angular.module("BeehivePortal").controller("SettingsController",["$scope","$rootScope","$state","AppUtils","$$User","$http",function(e,t,i,n,a){e.password={oldPassword:"",newPassword:"",confirmPassword:""},e.changePassword=function(e){return e.newPassword!=e.confirmPassword?void n.alert("新密码与输入的确认密码不一致，请重新输入！"):void a.changePassword(e,function(){n.alert("更改密码成功！")},function(){n.alert("更改密码失败！")})}}]),angular.module("BeehivePortal.ScenarioManager",["ui.router","BeehivePortal.ScenarioManager.OfficeAtmosphere"]),angular.module("BeehivePortal.ScenarioManager").controller("ScenarioManagerController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("ReportingService",["AppUtils",function(){var e={};return e}]),angular.module("BeehivePortal").controller("ReportingController",["$scope","$rootScope","$state","AppUtils",function(){}]),function(){function e(){_.extend(this,{thingList:null,tagList:null,command:{schema:"test",actions:[],schemaVersion:0,metadata:{}}})}function t(){this.name="",this.expressList=[],this.source={}}var i=function(e){var t={triggerName:"",type:e,predicate:{eventSource:"states",triggersWhen:i.WhenEnum.CONDITION_TRUE,condition:{}},source:{},targets:[],summarySource:{},recordStatus:"disable"};_.extend(this,t),e==i.TypeEnum.SUMMARY?delete this.source:delete this.summarySource};i.PolicyTypeEnum={ANY:"Any",ALL:"All",SOME:"Some",PERCENT:"Percent"},i.prototype.init=function(e){_.extend(this,e),this.triggerName||this.setName("未命名")},i.prototype.setSource=function(e,t){this.source=this.type==i.TypeEnum.SIMPLE?{thingID:e}:"thing"==t?{thingList:e.thingList}:{tagList:e.tagList,type:e.type,andExpress:e.andExpress}},i.prototype.disable=function(){this.recordStatus="disable"},i.prototype.enable=function(){this.recordStatus="enable"},i.prototype.setSchedule=function(e){this.predicate.schedule=e},i.prototype.setName=function(e){this.triggerName=e},i.prototype.setPolicy=function(e){this.policy=e},i.prototype.setTriggersWhen=function(e){this.predicate.triggersWhen=e},i.prototype.setTriggerType=function(e){this.type=e},i.prototype.setTargets=function(e){this.targets=e},i.prototype.addTarget=function(e){this.targets.push(e)},i.prototype.removeTarget=function(e){this.targets.remove(e)},i.prototype.setCondition=function(e){this.predicate.condition=e},i.WhenEnum={CONDITION_TRUE:"CONDITION_TRUE",CONDITION_FALSE_TO_TRUE:"CONDITION_FALSE_TO_TRUE",CONDITION_CHANGED:"CONDITION_CHANGED"},i.TypeEnum={SIMPLE:"Simple",GROUP:"Group",SUMMARY:"Summary"},i.prototype.addSummarySource=function(e){this.summarySource[e.name]=e},e.prototype.addAction=function(e){this.command.actions.push(e)},e.prototype.setSchemaVersion=function(e){this.command.schemaVersion=e},e.prototype.setMetaData=function(e){this.command.metadata=e},e.prototype.setSource=function(e,t,i){_.each(this,function(e,t){delete this[t]}),"thing"==t?this.thingList=e.thingList:(this.tagList=e.tagList,this.andExpress=i,this.type=e.type)},t.prototype.setSource=function(e){this.source=e},t.prototype.setName=function(e){this.name=e},t.prototype.addExpression=function(e,t,i){this.expressList.pus({stateName:e,"function":t,summaryAlias:i})},t.FunctionEnum={SUM:"Sum",COUNT:"Count",MAX:"Max",MIN:"Min",AVG:"Avg"},window.TriggerTarget=e,window.TriggerSummarySource=t,window.Trigger=i}(),function(){function e(e){var t=this;t.separator="-",t.locations=[],t.tree=new i("",""),_.each(e,function(e){t.merge(e)}),this.isHeader=!0}function t(e,n){!e instanceof i||!n instanceof i||e.name!=n.name||_.each(n.children,function(i){var n=_.find(e.children,function(e){return e.name==i.name});void 0==n?e.children.push(i):t(n,i)})}var i=function(e,t){this.id=t,this.name=e,this.container=[],this.children=[]};window.LocationTree=e,e.prototype.parse=function(e){var t=e.split(this.separator),n=new i("",""),a=n,r=[],o=this;return _.each(t,function(e){r.push(e);var t=new i(e,r.join(o.separator));t.container=a.children,a.children.push(t),a=t}),n},e.prototype.merge=function(e){var i=this.parse(e);t(this.tree,i),this.locations.push(e)}}(),function(){function e(){this.vendorThingID=null,this.location=null,this.type=null,this.globalThingID=null}window.BeehiveThing=e}(),function(){function e(){_.extend(this,{command:{actions:{},title:"Test title",description:"Test description",schema:"SmartLight",schemaVersion:1}})}window.BeehiveCommand=e}(),angular.module("BeehivePortal").filter("checked",function(){return function(e){if(_.isArray(e))return _.where(e,{_checked:!0});var t={};return _.each(e,function(e,i){e._checked&&(t[i]=e)}),t}}),angular.module("BeehivePortal").factory("SecureService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("SecureController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("PortalService",["$http","$q","Session","$state","$rootScope",function(e,t,i,n,a){var r={};return r.getStateChan=function(e){var t=[];t.push(e);for(var i=e;i.previous;)i=n.get(i.previous),t.push(i);return t.reverse(),t},r.isActive=function(e){var t=r.getStateChan(n.current),i=n.get(e);return t.indexOf(i)>-1},r.getPortalNavs=function(){return[{name:"用户管理",state:n.get("app.portal.UserManager"),icon:"fa-user",subViews:[{hidden:"commUser"==a.credential.roleName,name:"用户列表",state:n.get("app.portal.UserManager.User.UserList")},{name:"群组列表",state:n.get("app.portal.UserManager.UserGroup.UserGroupList")}]},{name:"设备管理",state:n.get("app.portal.ThingManager"),icon:"fa-desktop",subViews:[{name:"新设备",state:n.get("app.portal.ThingManager.AddThing")},{hidden:"commUser"==a.credential.roleName,name:"网关管理",state:n.get("app.portal.ThingManager.Gateway")},{name:"控制设备",state:n.get("app.portal.ThingManager.ControlThing")}]},{name:"场景管理",state:n.get("app.portal.ScenarioManager"),icon:"fa-cubes",hidden:!0,subViews:[{name:"办公室气候",state:n.get("app.portal.ScenarioManager.OfficeAtmosphere")}]},{name:"设备视图",state:n.get("app.portal.ThingViews"),icon:"fa-table",subViews:[{name:"位置视图",state:n.get("app.portal.ThingViews.LocationView")},{name:"标签视图",state:n.get("app.portal.ThingViews.TagView")},{name:"种类视图",state:n.get("app.portal.ThingViews.TypeView")}]},{name:"数据报表",state:n.get("app.portal.Reporting"),icon:"fa-area-chart",subViews:[{name:"折线图",state:n.get("app.portal.Reporting.LineChart")},{name:"感知",state:n.get("app.portal.Reporting.FaceDetection")},{name:"自定义图表",state:n.get("app.portal.Reporting.CustomCharts")}]},{name:"触发器管理",state:n.get("app.portal.TriggerManager"),icon:"fa-exchange"},{name:"设置",state:n.get("app.portal.Settings"),icon:"fa-cogs"}]},r.navMapping={USRE_MANAGEMENT:"app.portal.UserManager",THING_MANAGEMENT:"app.portal.ThingManager",THING_VIEWS:"app.portal.ThingViews",USER_LIST:"app.portal.UserManager.User.UserList",USER_GROUP:"app.portal.UserManager.UserGroup.UserGroupList",USER_GROUP_EDITOR:"app.portal.UserManager.UserGroup.UserGroupEdit",NEW_USER:"app.portal.UserManager.User.NewUser",USER_INFO:"app.portal.UserManager.User.UserInfo",LOCATION_THING_DETAIL:"app.portal.ThingViews.LocationThingDetail",TYPE_THING_DETAIL:"app.portal.ThingViews.TypeThingDetail",TAG_THING_DETAIL:"app.portal.ThingViews.TagThingDetail",LOCATION_THING_LIST:"app.portal.ThingViews.LocationThingList",TYPE_THING_LIST:"app.portal.ThingViews.TypeThingList",TAG_THING_LIST:"app.portal.ThingViews.TagThingList",USER_THING_AUTH:"app.portal.UserManager.User.UserThingAuthority",USER_THING_ACL:"app.portal.UserManager.User.UserThingACL",GROUP_USER_LIST:"app.portal.UserManager.UserGroup.GroupUserList",GROUP_USER_INFO:"app.portal.UserManager.UserGroup.UserInfo",GROUP_USER_THING_AUTH:"app.portal.UserManager.UserGroup.GroupUserThingAuthority",GROUP_USER_THING_ACL:"app.portal.UserManager.UserGroup.GroupUserThingACL",GROUP_THING_AUTH:"app.portal.UserManager.UserGroup.GroupThingAuthority",GROUP_THING_ACL:"app.portal.UserManager.UserGroup.GroupThingALC",LOCATION_VIEW:"app.portal.ThingViews.LocationView",LOCATHON_THING_ACL:"app.portal.ThingViews.LocationThingACL",TAG_THING_ACL:"app.portal.ThingViews.TagThingACL",TYPE_THING_ACL:"app.portal.ThingViews.TypeThingACL",TAG_VIEW:"app.portal.ThingViews.TagView",TYPE_VIEW:"app.portal.ThingViews.TypeView",SETTINGS:"app.portal.Settings",WELCOME:"app.portal.Welcome",TRIGGER_MANAGEMENT:"app.portal.TriggerManager"},r}]).factory("ownership",["$rootScope",function(e){return{isCreator:function(t){return t.createBy==e.credential.userID}}}]).factory("PermissionControl",["AppUtils","$state",function(e,t){var i={};return i._init=function(){i.allowedPermissions=e.getSessionItem(AppTags.PERMISSION)||[]},i.TagsEnum={GET_USER:"GET /users/*",SEARCH_USERS:"POST /users/simplequery",CREATE_USER:"POST /users",DELETE_USER:"DELETE /users/*",UPDATE_USER:"PATCH /users/*",UPDATE_THIRD_PARTY_USER:"PATCH /users/*/custom",GET_ALL_GROUPS:"GET /usergroup/list",GET_GROUP:"GET /usergroup/*",SERACH_GROUPS:"POST /usergroup/simplequery*",CREATE_USER_GROUP:"POST /usergroup",DELETE_USERGROUP:"DELETE /usergroup/*",ADD_GROUP_MEMBER:"POST /usergroup/*/user/*",REMOVE_GROUP_MEMBER:"DELETE /usergroup/*/user/*",BIND_USERGROUP_TAG:"POST /tags/*/userGroups/*",DELETE_USERGROUP_TAG:"DELETE /tags/*/userGroups/*",GET_USERGROUP_TAG:"GET /usergroup/*/tags",SEARCH_TAGS:"GET /tags/search*",SEARCH_LOCATIONS:"GET /tags/locations/*",GET_ALL_LOCATIONS:"GET /tags/locations",SEARCH_TYPES:"GET /things/types/*",GET_ALL_TYPES:"GET /things/types",DELETE_TAG:"DELETE /tags/custom/*",CREATE_TAG:"POST /tags/custom",BING_TAG:"POST /things/*/tags/*",BIND_THING_TAG_CUSTOM:"POST /things/*/tags/custom/*",UNBIND_TAG:"DELETE /things/*/tags/*",UNBIND_TAG_CUSTOM:"DELETE /things/*/tags/custom/*",GET_GROUP_PERMISSIONS:"GET /permission/userGroup/*",GET_ALL_PERMISSIONS:"GET /permission/list",BIND_PERMISSION:"POST /permission/*/userGroup/*",UNBIND_PERMISSION:"DELETE /permission/*/userGroup/*",CREATE_TRIGGER:"POST /triggers/createTrigger",SEARCH_THINGS:"GET /things/search*",GET_THING:"GET /things/*",CREATE_THING:"POST /things",DELETE_THING:"DELETE /things/*",SEARCH_THING_TYPES:"GET /things/types/",GET_TYPE_BY_TAG:"GET /things/types/tagID/*",DELETE_TRIGGER:"DELETE /triggers/*",ENABLE_TRIGGER:"PUT /triggers/*/enable",DISABLE_TRIGGER:"PUT /triggers/*/disable",GET_TRIGGERS:"GET /triggers/*"},i.allowedPermissions=[],i.loadPermissions=function(t){i.allowedPermissions=[],_.each(t,function(e){_.each(i.TagsEnum,function(t,n){t==e&&i.allowedPermissions.push(n)})}),e.setSessionItem(AppTags.PERMISSION,i.allowedPermissions)},i.getAllPermissions=function(){i.allowedPermissions=[],_.each(i.TagsEnum,function(e){i.allowedPermissions.push(e)}),i.loadPermissions(i.allowedPermissions)},i.isAllowed=function(e){return i.allowedPermissions.indexOf(e)>-1?!0:!1},i.allowAction=function(n,a){return i.isAllowed(n)?!0:(_.isFunction(a)&&a(),e.alert("对不起，您没有该资源的访问权限，请联系管理员或尝试重新登录！","没有访问权限",function(){t.go("app.portal.Welcome")}),!1)},i.destroy=function(){i.allowedPermissions=[],e.removeSessionItem(AppTags.PERMISSION)},i._init(),i}]),angular.module("BeehivePortal").factory("$$User",["$resource",function(e){var t=e(MyAPIs.USER+"/:userID",{userID:"@userID"},{get:{method:"GET",url:MyAPIs.USER+"/me"},getCustomData:{method:"GET",url:MyAPIs.USER+"/me/customData/:type",params:{type:"@type"}},putCustomData:{method:"PUT",url:MyAPIs.USER+"/me/customData/:type",params:{type:"@type"}},update:{method:"PATCH",url:MyAPIs.USER+"/me"},bindThing:{url:MyAPIs.THING+"/:globalThingIDs/users/:userIDs",params:{userIDs:"@userIDs",globalThingIDs:"@globalThingIDs"},method:"POST"},unbindThing:{url:MyAPIs.THING+"/:globalThingIDs/users/:userIDs",params:{userIDs:"@userIDs",globalThingIDs:"@globalThingIDs"},method:"DELETE"},bindTag:{url:MyAPIs.TAG+"/:tags/users/:userIDs",method:"POST",params:{userIDs:"@userIDs",tags:"@tags"}},unbindTag:{url:MyAPIs.TAG+"/:tags/users/:userIDs",method:"DELETE",params:{userIDs:"@userIDs",tags:"@tags"}},getTags:{url:MyAPIs.TAG+"/user/:userID",method:"GET",params:{userID:"@userID"},isArray:!0},getThings:{url:MyAPIs.THING+"/user/:userID",method:"GET",params:{userID:"@userID"},isArray:!0},getPermissions:{url:MyAPIs.USER+"/permissionTree",method:"GET",isArray:!0},changePassword:{url:MyAPIs.USER+"/changepassword",method:"POST"},query:{url:MyAPIs.USER+"/simplequery",method:"POST",isArray:!0,transformRequest:function(e){return JSON.stringify(e)}}});return t}]).factory("$$Auth",["$resource",function(e){var t=e(MyAPIs.OPERATOR,{},{initpassword:{method:"POST",url:MyAPIs.OPERATOR+"/initpassword"},activate:{url:MyAPIs.OPERATOR+"/activate",method:"POST"},login:{url:MyAPIs.OPERATOR+"/login",method:"POST"},logout:{url:MyAPIs.OPERATOR+"/logout",method:"POST"},validate:{url:MyAPIs.OPERATOR+"/validatetoken",method:"POST"}});return t}]).factory("$$UserManager",["$resource",function(e){var t=e(MyAPIs.USER_MANAGER+"/:userID",{userID:"@userID"},{update:{method:"PATCH",url:MyAPIs.USER_MANAGER+"/:userID",params:{userID:"@userID"}},remove:{method:"DELETE",url:MyAPIs.USER_MANAGER+"/:userID",params:{userID:"@userID"}},create:{url:MyAPIs.USER_MANAGER,method:"POST"},changePassword:{url:MyAPIs.USER_MANAGER+"/:userID/resetpassword",method:"POST",params:{userID:"@userID"}},query:{url:MyAPIs.USER+"/simplequery",method:"POST",isArray:!0,transformRequest:function(e){return JSON.stringify(e)}}});return t}]).factory("$$UserGroup",["$resource",function(e){var t=e(MyAPIs.USER_GROUP+"/:id",{id:"@userGroupID"},{addUser:{method:"POST",url:MyAPIs.USER_GROUP+"/:userGroupID/user/:userID",params:{userGroupID:"@userGroupID",userID:"@userID"}},deleteUser:{method:"DELETE",url:MyAPIs.USER_GROUP+"/:userGroupID/user/:userID",params:{userGroupID:"@userGroupID",userID:"@userID"}},update:{method:"POST",url:MyAPIs.USER_GROUP},remove:{method:"DELETE"},get:{url:MyAPIs.USER_GROUP+"/:userGroupID",method:"GET",params:{userGroupID:"@userGroupID"}},getList:{url:MyAPIs.USER_GROUP+"/all",method:"GET",isArray:!0},getMyGroups:{url:MyAPIs.USER_GROUP+"/list",method:"GET",isArray:!0},withUserData:{url:MyAPIs.USER_GROUP+"/simplequery",method:"POST",transformRequest:function(e){return e.includeUserData=1,e}},create:{url:MyAPIs.USER_GROUP,method:"POST"},query:{url:MyAPIs.USER_GROUP+"/simplequery",method:"POST",isArray:!0},getPermissions:{url:MyAPIs.USER_GROUP,method:"GET"},bindThing:{url:MyAPIs.THING+"/:globalThingIDs/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs",globalThingIDs:"@globalThingIDs"},method:"POST"},unbindThing:{url:MyAPIs.THING+"/:globalThingIDs/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs",globalThingIDs:"@globalThingIDs"},method:"DELETE"},bindTag:{url:MyAPIs.TAG+"/:tags/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs",tags:"@tags"},method:"POST"},unbindTag:{url:MyAPIs.TAG+"/:tags/userGroups/:userGroupIDs",params:{userGroupIDs:"@userGroupIDs"},method:"DELETE"},getTags:{url:MyAPIs.TAG+"/userGroup/:userGroupID",params:{userGroupID:"@userGroupID"},method:"GET",isArray:!0},getThings:{url:MyAPIs.THING+"/userGroup/:userGroupID",params:{userGroupID:"@userGroupID"},method:"GET",isArray:!0}});
return t}]).factory("$$Thing",["$resource",function(e){var t=e(MyAPIs.THING+"/:globalThingID",{},{save:{url:MyAPIs.THING,params:{globalThingID:"@globalThingID"},method:"POST"},getAll:{url:MyAPIs.THING+"/search",method:"GET",isArray:!0},remove:{method:"DELETE"},bindTags:{url:MyAPIs.THING+"/:thingids/tags/custom/:tags",params:{thingids:"@things",tags:"@tags"},method:"POST"},removeTags:{url:MyAPIs.THING+"/:things/tags/custom/:tags",params:{things:"@things",tags:"@tags"},method:"DELETE"},byTag:{url:MyAPIs.THING+"/search?tagType=:tagType&displayName=:displayName",params:{tagType:"@tagType",displayName:"@displayName"},method:"GET",isArray:!0},byType:{url:MyAPIs.THING+"/types/:typeName",params:{typeName:"@typeName"},method:"GET",isArray:!0},sendCommand:{url:MyAPIs.THING_IF+"/command/",method:"POST",isArray:!0},getTypeByTag:{method:"GET",url:MyAPIs.THING+"/types/fulltagname/:fullTagNames",isArray:!0,params:{fullTagNames:"@fullTagNames"}},getTriggers:{method:"GET",url:MyAPIs.TRIGGER+"/things/:globalThingID",isArray:!0,params:{globalThingID:"@globalThingID"}},getOnboardingInfo:{method:"GET",url:MyAPIs.ONBOARDING+"/:vendorThingID",params:{vendorThingID:"@vendorThingID"}},getEndNodes:{url:MyAPIs.THING+"/:globalThingID/endnodes",params:{globalThingID:"@globalThingID"},method:"GET",isArray:!0},getEndNode:{url:MyAPIs.CLOUD_THING_IF+"/apps/:kiiAppID/targets/THING::thingID/states",params:{thingID:"@thingID",kiiAppID:"@kiiAppID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"},method:"GET"},replaceEndNode:{url:MyAPIs.CLOUD_THING_IF+"/apps/:kiiAppID/things/:kiiThingID/end-nodes/:thingID",params:{thingID:"@thingID",kiiAppID:"@kiiAppID",kiiThingID:"@kiiThingID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"},transformRequest:function(e){return e=_.clone(e),_.each(e,function(t,i){"endNodeVendorThingID"!=i&&"endNodePassword"!=i&&delete e[i]}),JSON.stringify(e)},method:"PATCH"},removeEndNode:{method:"DELETE",url:MyAPIs.CLOUD_THING_IF+"/apps/:kiiAppID/things/:kiiThingID/end-nodes/:thingID",params:{thingID:"@thingID",kiiAppID:"@kiiAppID",kiiThingID:"@kiiThingID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"}},getCommands:{method:"POST",url:MyAPIs.THING_IF+"/command/list",isArray:!0}});return t}]).factory("$$Tag",["$resource",function(e){var t=e(MyAPIs.TAG+"/:id",{id:"@tagName"},{query:{method:"GET"},queryAll:{url:MyAPIs.TAG+"/search?tagType=Custom",method:"GET",isArray:!0},create:{url:MyAPIs.TAG+"/custom",method:"POST"},update:{url:MyAPIs.TAG+"/custom",method:"POST"},remove:{url:MyAPIs.TAG+"/custom/:id",params:{id:"@tagName"},method:"DELETE"}});return t}]).factory("$$Location",["$resource",function(e){var t=e(MyAPIs.TAG+"/:id",{id:"@tagName"},{queryAll:{method:"GET",isArray:!0,url:MyAPIs.TAG+"/search?tagType=Location"}});return t}]).factory("$$Type",["$resource",function(e){var t=e(MyAPIs.TYPE,{},{getAll:{method:"GET",isArray:!0},getSchema:{url:MyAPIs.SCHEMA+"?thingType=:type&name=:type&version=1",params:{type:"@type"},method:"GET"},saveSchema:{url:MyAPIs.SCHEMA,method:"POST"},updateSchema:{url:MyAPIs.SCHEMA+"/:id",method:"PUT",params:{id:"@id"}},byTags:{url:MyAPIs.TYPE+"/fulltagname/:tags",params:{tags:"@tags"},method:"GET",isArray:!0}});return t}]).factory("$$Permission",["$resource",function(e){var t=e(MyAPIs.PERMISSION,{},{get:{url:MyAPIs.SYSTEM_PERMISSION,method:"GET"}});return t}]).factory("$$Supplier",["$resource",function(e){var t=e(MyAPIs.SUPPLIER,{},{getAll:{url:MyAPIs.SUPPLIER+"/all",method:"GET",isArray:!0}});return t}]).factory("$$Trigger",["$resource",function(e){var t=e(MyAPIs.TRIGGER,{},{getAll:{url:MyAPIs.TRIGGER+"/all",method:"GET",isArray:!0,transformResponse:function(e){return e=JSON.parse(e),e=_.reject(e,function(e){return e.type==t.TypeEnum.SIMPLE&&e.source&&e.source.thingID?!0:!1})}},save:{url:MyAPIs.TRIGGER+"/createTrigger",method:"POST"},remove:{url:MyAPIs.TRIGGER+"/:triggerID",method:"DELETE",params:{triggerID:"@triggerID"}},enable:{url:MyAPIs.TRIGGER+"/:triggerID/enable",method:"PUT",params:{triggerID:"@triggerID"}},disable:{url:MyAPIs.TRIGGER+"/:triggerID/disable",method:"PUT",params:{triggerID:"@triggerID"}}});return t.TypeEnum={SIMPLE:"Simple",GROUP:"Group",SUMMARY:"Summary"},t}]),angular.module("BeehivePortal").controller("PortalController",["$scope","$rootScope","$state","AppUtils","Session","PortalService","ownership",function(e,t,i,n,a,r,o){e.navigateTo=function(e,t){i.go(e,_.extend(i.params,t))},e.portalInit=function(){t.$watch("login",function(t){t&&(e.portalNavs=r.getPortalNavs())}),e.getStateChan=r.getStateChan,e.isActive=r.isActive,e.navMapping=r.navMapping},e.getFirstChild=function(e){return _.find(e.subViews,function(e){return!e.hidden})},e.toggleMenu=function(){$(".left-side").toggleClass("sidebar-offcanvas"),$(".right-side").toggleClass("shrink");var t=$(".right-side").hasClass("shrink");e.$broadcast("toggle-menu",{isShrink:t})},e.logout=function(){a.destroy(),i.go("app.secure.UserLogin")},e.isCreator=o.isCreator}]),angular.module("BeehivePortal").factory("AppUtils",["$http","$location","$q","$state","$timeout","$uibModal","$rootScope",function(e,t,i,n,a,r){return window.app={},app.utils={initialize:function(){this._initialize()},_initialize:function(){this._IEPlaceholder(),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.lowerFirstLetter=function(){return this.charAt(0).toLowerCase()+this.slice(1)},Array.prototype.removeFirst=function(){return this.slice(1,this.length)},Array.prototype.remove=function(e){var t=this.indexOf(e);return t>-1?this.splice(t,1):this},window.alertMessage=function(e){app.utils.alert(e,"提示")}},_IEPlaceholder:function(){var e=document,t=e.getElementsByTagName("input"),i="placeholder"in e.createElement("input"),n=function(e){var t=e.getAttribute("placeholder"),i=e.defaultValue;""==i&&(e.value=t),$(e).on("focus",function(){e.value===t&&(this.value="")}),$(e).on("blur",function(){""===e.value&&(this.value=t)})};if(!i)for(var a=0,r=t.length;r>a;a++){var o=t[a],s=o.getAttribute("placeholder");"text"!==o.type&&"password"!==o.type||!s||n(o)}},getSessionItem:function(e){return $.parseJSON(sessionStorage.getItem(e))},setSessionItem:function(e,t){sessionStorage.setItem(e,JSON.stringify(t))},clearSession:function(){sessionStorage.clear()},removeSessionItem:function(e){sessionStorage.removeItem(e)},alert:function(e,t,i){t=t||"提示";var n="";n+='<div class="modal-content">',n+='  <div class="modal-header ng-scope">',n+='      <h3 class="modal-title">'+t+"</h3>",n+="  </div>",n+='  <div class="modal-body clearfix">',n+='    <div class="col-sm-12">',n+="      "+e,n+="    </div>",n+="  </div>",n+='  <div class="modal-footer ng-scope">',n+='      <button class="btn btn-primary" style="width:100%;" type="button" ng-click="ok()">OK</button>',n+="  </div>",n+="</div>";var a=r.open({animation:!0,template:n,controller:"AppUtils.Alert",size:"sm"});a.result.then(function(){_.isFunction(i)&&i()},function(){_.isFunction(i)&&i()})},confirm:function(e,t,i){var n="";n+='<div class="modal-content">',n+='  <div class="modal-header ng-scope">',n+='      <h3 class="modal-title">'+e+"</h3>",n+="  </div>",n+='  <div class="modal-body clearfix">',n+='    <div class="col-sm-12">',n+="      "+t,n+="    </div>",n+="  </div>",n+='  <div class="modal-footer ng-scope">',n+='      <button class="btn btn-primary" type="button" ng-click="ok()">OK</button>',n+='      <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>',n+="  </div>",n+="</div>";var a=r.open({animation:!0,template:n,controller:"AppUtils.Confirm",size:"sm",resolve:{func:function(){return i}}});return a.result}},app.utils}]),angular.module("BeehivePortal").controller("AppUtils.Confirm",["$scope","$uibModalInstance","func",function(e,t,i){e.ok=function(){t.close(i())},e.cancel=function(){t.dismiss("cancel")}}]).controller("AppUtils.Alert",["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").directive("ngRightClick",["$parse",function(e){return function(t,i,n){var a=e(n.ngRightClick);i.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),a(t,{$event:e})})})}}]).directive("permitted",["PermissionControl",function(e){return{link:function(t,i,n){var a=n.permitted.split("&"),r=!0;_.each(a,function(t){r&=e.allowAction(t)}),r||i.remove()}}}]).directive("input",[function(){return{link:function(e,t,i){e.$watch("ngModel",function(t){("range"==i.type||"number"==i.type)&&(e.ngModel=parseFloat(t))})}}}]).directive("sglclick",["$parse",function(e){return{restrict:"A",link:function(t,i,n){var a=e(n.sglclick),r=300,o=0,s=null;i.on("click",function(e){o++,1===o?s=setTimeout(function(){t.$apply(function(){a(t,{$event:e})}),o=0},r):(clearTimeout(s),o=0)})}}}]),function(){var e=appConfig[appConfig.ENV].siteUrl;window.thirdPartyAPIUrl=appConfig[appConfig.ENV].thirdPartyAPIUrl;var t=appConfig[appConfig.ENV].cloudUrl,i=e+"/beehive-portal/api";window.MyAPIs={OPERATOR:"/oauth2",USER:"/users",USER_MANAGER:"/usermanager",USER_GROUP:"/usergroup",THING:"/things",TAG:"/tags",TYPE:"/things/types",PERMISSION:"/permission",TRIGGER:"/triggers",THING_IF:"/thing-if",ONBOARDING:"/onboardinghelper",SUPPLIER:"/devicesuppliers",SYSTEM_PERMISSION:"/sys/permissionTree",USER_SYNC:"/usersync",SCHEMA:"/industrytemplate"};for(apiName in window.MyAPIs)window.MyAPIs[apiName]=i+window.MyAPIs[apiName];window.MyAPIs.CLOUD_THING_IF=t+"/thing-if",window.webSocketPath=appConfig[appConfig.ENV].wsUrl;var n="Beehive";window.AppTags={USER:n+"USER",PERMISSION:n+"PERMISSION"},window.pageListMaxLength=20,window.siteUrl=e}(),angular.module("BeehivePortal").service("Session",["localStorageService","AppUtils","$http","$rootScope","$$Auth","$$User","$q","AUTH_EVENTS",function(e,t,i,n,a,r,o,s){var l={};return window.MyApp=window.MyApp||{},l.setCredential=function(e){t.setSessionItem("credential",e),n.credential=e,window.MyApp.credential=e,i.defaults.headers.common.Authorization="Bearer "+e.accessToken},l.useCredential=function(){var e=t.getSessionItem("credential");return o(function(t,a){return e?(i.defaults.headers.common.Authorization="Bearer "+e.accessToken,void r.get(function(){l.setCredential(e),t(e),n.login=!0},function(e){a(403!=e.status?s.loginFailed:s.UnauthorizedException)})):void a(s.tokenNotGiven)})},l.getCredential=function(){return t.getSessionItem("credential")},window.MyApp.credential=l.getCredential(),l.StatusType={SIGNEDIN:"loggedin",TIMEOUT:"timeout",UNKNOWN:"unknon"},l._status=l.StatusType.UNKNOWN,l.setUser=function(e){t.setSessionItem(AppTags.USER,e),l._status=l.StatusType.SIGNEDIN},l.destroy=function(){a.logout(function(){t.clearSession(),l._status=l.StatusType.UNKNOWN})},l.currentUser=function(){return e.get(AppTags.USER)},l.getStatus=function(){return l._status},l.isAuthen=function(){return l._status==l.StatusType.SIGNEDIN},l}]),angular.module("BeehivePortal").factory("AppService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("AppController",["$scope","$rootScope","$state","AppUtils","Session","AUTH_EVENTS",function(e,t,i,n,a,r){a.useCredential().then(function(){t.login=!0,t.$broadcast("tokenReady",!0)},function(e){e==r.tokenNotGiven?i.go("app.secure.UserLogin"):n.alert("用户登录口令过期，请重新登陆！","用户登录过期",function(){n.clearSession(),i.go("app.secure.UserLogin")})}),e.thirdPartyAPIUrl=window.thirdPartyAPIUrl}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app",templateUrl:"app/app.html",controller:"AppController"}).state("app.portal",{url:"/portal",templateUrl:"app/components/portal/portal.html",controller:"PortalController"}).state("app.secure",{url:"/secure",templateUrl:"app/components/secure/secure.html",controller:"SecureController"}),t.otherwise("app/secure/UserLogin")}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager",{url:"/UserManager",templateUrl:"app/components/portal/UserManager/UserManager.html",controller:"UserManagerController",redirectTo:"app.portal.UserManager.User.UserList","abstract":!0,stateName:"用户管理"}).state("app.portal.ScenarioManager",{url:"/ScenarioManager",templateUrl:"app/components/portal/ScenarioManager/ScenarioManager.html",controller:"ScenarioManagerController","abstract":!0,stateName:"场景管理",redirectTo:"app.portal.ScenarioManager.OfficeAtmosphere"}).state("app.portal.ThingManager",{url:"/ThingManager",templateUrl:"app/components/portal/ThingManager/ThingManager.html",controller:"ThingManagerController",redirectTo:"app.portal.ThingManager.AddThing","abstract":!0,stateName:"设备管理"}).state("app.portal.Settings",{url:"/Settings",templateUrl:"app/components/portal/Settings/Settings.html",controller:"SettingsController",stateName:"设置"}).state("app.portal.Reporting",{url:"/Reporting",templateUrl:"app/components/portal/Reporting/Reporting.html",controller:"ReportingController",redirectTo:"app.portal.Reporting.LineChart","abstract":!0,stateName:"数据报表"}).state("app.portal.Welcome",{url:"/Welcome",templateUrl:"app/components/portal/Welcome/Welcome.html",controller:"WelcomeController",stateName:"欢迎"}).state("app.portal.TriggerManager",{url:"/TriggerManager",templateUrl:"app/components/portal/TriggerManager/TriggerManager.html",controller:"TriggerManagerController",stateName:"触发器管理"}).state("app.portal.ThingViews",{url:"/ThingViews",templateUrl:"app/components/portal/ThingViews/ThingViews.html",controller:"ThingViewsController",stateName:"设备视图","abstract":!0,redirectTo:"app.portal.ThingViews.LocationView"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.secure.AdminLogin",{url:"/AdminLogin",templateUrl:"app/components/secure/AdminLogin/AdminLogin.html",controller:"AdminLoginController"}).state("app.secure.UserLogin",{url:"/UserLogin",templateUrl:"app/components/secure/UserLogin/UserLogin.html",controller:"UserLoginController"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.Reporting.LineChart",{url:"/LineChart",templateUrl:"app/components/portal/Reporting/LineChart/LineChart.html",controller:"LineChartController",stateName:"折线图",previous:"app.portal.Reporting"}).state("app.portal.Reporting.FaceDetection",{url:"/FaceDetection",templateUrl:"app/components/portal/Reporting/FaceDetection/FaceDetection.html",controller:"FaceDetectionController",stateName:"位置感知",previous:"app.portal.Reporting"}).state("app.portal.Reporting.CustomCharts",{url:"/CustomCharts",templateUrl:"app/components/portal/Reporting/CustomCharts/CustomCharts.html",controller:"CustomChartsController",stateName:"自定义图表",previous:"app.portal.Reporting"})}]),angular.module("BeehivePortal.ScenarioManager").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.ScenarioManager.OfficeAtmosphere",{url:"/OfficeAtmosphere",templateUrl:"app/components/portal/ScenarioManager/OfficeAtmosphere/OfficeAtmosphere.html",controller:"OfficeAtmosphereController",stateName:"办公室气候",previous:"app.portal.ScenarioManager"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.ThingManager.AddThing",{url:"/AddThing",templateUrl:"app/components/portal/ThingManager/AddThing/AddThing.html",controller:"AddThingController",stateName:"添加新设备",previous:"app.portal.ThingManager"}).state("app.portal.ThingManager.Gateway",{url:"/Gateway",templateUrl:"app/components/portal/ThingManager/Gateway/Gateway.html",controller:"GatewayController",stateName:"网关",previous:"app.portal.ThingManager"}).state("app.portal.ThingManager.ControlThing",{url:"/ControlThing?refreshId",templateUrl:"app/components/portal/ThingManager/ControlThing/ControlThing.html",controller:"ControlThingController",stateName:"控制设备",previous:"app.portal.ThingManager"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.ThingViews.LocationView",{url:"/LocationView",templateUrl:"app/components/portal/ThingViews/LocationView/LocationView.html",controller:"LocationViewController",previous:"app.portal.ThingViews",stateName:"位置视图"}).state("app.portal.ThingViews.TypeView",{url:"/TypeView",templateUrl:"app/components/portal/ThingViews/TypeView/TypeView.html",controller:"TypeViewController",previous:"app.portal.ThingViews",stateName:"种类视图"}).state("app.portal.ThingViews.TagView",{url:"/TagView",templateUrl:"app/components/portal/ThingViews/TagView/TagView.html",controller:"TagViewController",previous:"app.portal.ThingViews",stateName:"标签视图"}).state("app.portal.ThingViews.LocationThingDetail",{url:"/LocationView/ThingDetail/:thingid?from",templateUrl:"app/components/portal/ThingViews/ThingDetail/ThingDetail.html",controller:"ThingDetailController",previous:"app.portal.ThingViews.LocationView",stateName:"设备详情"}).state("app.portal.ThingViews.TypeThingDetail",{url:"/TypeView/ThingList/:typeName/ThingDetail/:thingid?from",templateUrl:"app/components/portal/ThingViews/ThingDetail/ThingDetail.html",controller:"ThingDetailController",previous:"app.portal.ThingViews.TypeThingList",stateName:"设备详情"}).state("app.portal.ThingViews.TypeThingList",{url:"/TypeView/ThingList/:typeName?from",templateUrl:"app/components/portal/ThingViews/ThingList/ThingList.html",controller:"ThingListController",previous:"app.portal.ThingViews.TypeView",stateName:"设备列表"}).state("app.portal.ThingViews.TagThingDetail",{url:"/TagView/TagThingList/:displayName/ThingDetail/:thingid?from",templateUrl:"app/components/portal/ThingViews/ThingDetail/ThingDetail.html",controller:"ThingDetailController",previous:"app.portal.ThingViews.TagThingList",stateName:"设备详情"}).state("app.portal.ThingViews.TagThingList",{url:"/TagView/ThingList/:displayName/?type&from",templateUrl:"app/components/portal/ThingViews/ThingList/ThingList.html",controller:"ThingListController",previous:"app.portal.ThingViews.TagView",stateName:"设备列表"}).state("app.portal.ThingViews.LocationThingACL",{url:"/LocationView/ThingDetail/:thingid/acl?from",templateUrl:"app/components/portal/ThingViews/ThingACL/ThingACL.html",controller:"ThingACLController",previous:"app.portal.ThingViews.LocationThingDetail",stateName:"设备使用权限"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager.User",{url:"/User",templateUrl:"app/components/portal/UserManager/User/User.html",controller:"UserController","abstract":!0}).state("app.portal.UserManager.UserGroup",{url:"/UserGroupS",templateUrl:"app/components/portal/UserManager/UserGroup/UserGroup.html",controller:"UserGroupController","abstract":!0})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager.User.SearchUser",{url:"/SearchUser",templateUrl:"app/components/portal/UserManager/User/SearchUser/SearchUser.html",controller:"SearchUserController",stateName:"查询业主",previous:"app.portal.UserManager.User.UserList"}).state("app.portal.UserManager.User.NewUser",{url:"/NewUser",templateUrl:"app/components/portal/UserManager/User/NewUser/NewUser.html",controller:"NewUserController",stateName:"新建业主",previous:"app.portal.UserManager.User.UserList"}).state("app.portal.UserManager.User.UserList",{url:"/UserList",templateUrl:"app/components/portal/UserManager/User/UserList/UserList.html",controller:"UserListController",stateName:"业主列表",previous:"app.portal.UserManager"}).state("app.portal.UserManager.User.UserInfo",{url:"/:userID/UserInfo",templateUrl:"app/components/portal/UserManager/User/UserInfo/UserInfo.html",controller:"UserInfoController",stateName:"业主详情",previous:"app.portal.UserManager.User.UserList"}).state("app.portal.UserManager.User.UserThingAuthority",{url:"/:userID/ThingAuthority",templateUrl:"app/components/portal/UserManager/User/UserThingAuthority/UserThingAuthority.html",controller:"UserThingAuthorityController",stateName:"设备所有权",previous:"app.portal.UserManager.User.UserInfo"}).state("app.portal.UserManager.User.UserThingACL",{url:"/:userID/ThingACL",templateUrl:"app/components/portal/UserManager/User/UserThingACL/UserThingACL.html",controller:"UserThingACLController",stateName:"设备控制权",previous:"app.portal.UserManager.User.UserInfo"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager.UserGroup.UserGroupList",{url:"/UserGroupList",templateUrl:"app/components/portal/UserManager/UserGroup/UserGroupList/UserGroupList.html",controller:"UserGroupListController",stateName:"群组列表",previous:"app.portal.UserManager"}).state("app.portal.UserManager.UserGroup.UserGroupEdit",{url:"/UserGroupList/:userGroupID/edit",templateUrl:"app/components/portal/UserManager/UserGroup/GroupEditor/GroupEditor.html",controller:"GroupEditorController",stateName:"编辑群组",previous:"app.portal.UserManager.UserGroup.UserGroupList"}).state("app.portal.UserManager.UserGroup.GroupUserList",{url:"/GroupUser/:userGroupID/UserList",templateUrl:"app/components/portal/UserManager/UserGroup/GroupUserList/GroupUserList.html",controller:"GroupUserListController",stateName:"业主列表",previous:"app.portal.UserManager.UserGroup.UserGroupList"}).state("app.portal.UserManager.UserGroup.UserInfo",{url:"/:userGroupID/UserInfo/:userID",templateUrl:"app/components/portal/UserManager/User/UserInfo/UserInfo.html",controller:"UserInfoController",stateName:"用户列表",previous:"app.portal.UserManager.UserGroup.GroupUserList"}).state("app.portal.UserManager.UserGroup.GroupThingAuthority",{url:"/:userGroupID/ThingAuthority",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingAuthority/GroupThingAuthority.html",controller:"UserThingAuthorityController",stateName:"设备所有权",previous:"app.portal.UserManager.UserGroup.UserGroupEdit"}).state("app.portal.UserManager.UserGroup.GroupThingACL",{url:"/:userGroupID/ThingACL",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingACL/GroupThingACL.html",controller:"GroupThingACLController",stateName:"设备控制权",previous:"app.portal.UserManager.UserGroup.UserGroupEdit"}).state("app.portal.UserManager.UserGroup.GroupUserThingAuthority",{url:"/:userGroupID/ThingAuthority",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingAuthority/GroupThingAuthority.html",controller:"UserThingAuthorityController",stateName:"设备所有权",previous:"app.portal.UserManager.UserGroup.UserInfo"}).state("app.portal.UserManager.UserGroup.GroupUserThingACL",{url:"/:userGroupID/ThingACL",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingACL/GroupThingACL.html",controller:"GroupThingACLController",stateName:"设备控制权",previous:"app.portal.UserManager.UserGroup.UserInfo"})}]),angular.module("BeehivePortal").run(["$templateCache",function(e){e.put("app/app.html",'<div class="app"><div id="spinner" style="display:none;"><div class="loader">Loading...</div></div><div ui-view=""></div></div>'),e.put("app/components/portal/portal.html",'<div class="app-portal skin-black" id="wrapper" ng-init="portalInit()"><header class="header"><a href="index.html" class="logo">蜂巢大厦</a><nav class="navbar navbar-static-top" role="navigation"><a class="navbar-btn sidebar-toggle" ng-click="toggleMenu()"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></a><div class="navbar-right"><ul class="nav navbar-nav"><li class="dropdown messages-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-envelope"></i></a></li><li class="dropdown tasks-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-tasks"></i></a></li><li class="dropdown user user-menu" uib-dropdown=""><a href="#" class="dropdown-toggle" uib-dropdown-toggle=""><i class="fa fa-user"></i> <span>{{credential.userName}} <i class="caret"></i></span></a><ul class="dropdown-menu dropdown-custom dropdown-menu-right"><li><a ng-click="logout()"><i class="fa fa-ban fa-fw pull-right"></i> 用户登出</a></li></ul></li></ul></div></nav></header><div class="wrapper row-offcanvas row-offcanvas-left"><aside class="left-side" style="min-height: 100%;"><section class="sidebar"><div class="user-panel"><div class="pull-left image"><img src="images/kiicloud-logo.png" class="img-circle" alt="User Image"></div><div class="pull-left info"><p>Hello, {{credential.userName}}</p><a href="#"><i class="fa fa-circle text-success"></i> Online</a></div></div><form action="#" method="get" class="sidebar-form"><div class="input-group"><input type="text" name="q" class="form-control" placeholder="Search..."> <span class="input-group-btn"><button type="submit" name="seach" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button></span></div></form><ul class="sidebar-menu"><li ng-repeat="nav in portalNavs | orderBy: \'order\'" ng-class="{\'active\':isActive(nav.state.name)}" ng-if="!nav.hidden"><a ui-sref="{{(!nav.state.abstract? nav.state.name: getFirstChild(nav).state.name)}}($state.params)"><i class="fa fa-fw" ng-class="nav.icon"></i> {{nav.name}}<span class="fa arrow"></span></a><ul class="nav nav-second-level" uib-collapse="!isActive(nav.state.name)"><li ng-repeat="subNav in nav.subViews | orderBy: \'order\'" ng-if="!subNav.hidden" ng-class="{\'active\': isActive(subNav.state.name)}"><a ui-sref="{{(!subNav.state.abstract? subNav.state.name: subNav.state.redirectTo)}}($state.params)">{{subNav.name}}</a><ul class="nav nav-third-level" uib-collapse="!subNav._active"><li ng-if="!thirdNav.hidden" ng-repeat="thirdNav in subNav.subViews | orderBy: \'-order\'" ng-class="{\'active\': isActive(thirdNav.state.name)}"><a ui-sref="{{(!thirdNav.state.abstract? thirdNav.state.name: thirdNav.state.redirectTo)}}($state.params)">{{thirdNav.name}}</a></li></ul></li></ul></li></ul></section></aside><aside class="right-side shrink"><section class="content"><ol class="breadcrumb"><li ng-repeat="nav in getStateChan($state.current)"><a ui-sref="{{(!nav.abstract? nav.name: nav.redirectTo)}}($state.params)">{{nav.stateName}}</a></li></ol><div class="row portal-row" ng-if="$state.current.description && $state.current.description!=\'\'" )=""><div class="module-description">{{$state.current.description}}</div></div><div><div ui-view="" class="portal-content-body"></div></div></section></aside></div></div>'),e.put("app/components/secure/secure.html",'<div class="app-secure"><div ui-view=""></div></div>'),e.put("app/components/portal/Reporting/Reporting.html",'<div class="app-portal-reporting"><div ui-view=""></div></div>'),e.put("app/components/portal/ScenarioManager/ScenarioManager.html",'<div class="app-portal-scenariomanager"><div ui-view=""></div></div>'),e.put("app/components/portal/Settings/Settings.html",'<div class="app-portal-settings"><section class="panel"><header class="panel-heading">更改密码</header><div class="panel-body"><div class="row portal-row clearfix"><div class="col-sm-4">旧密码</div><div class="col-sm-8"><input ng-model="password.oldPassword" type="password" required="" class="form-control" placeholder="旧密码"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">新密码</div><div class="col-sm-8"><input ng-model="password.newPassword" type="password" required="" class="form-control" placeholder="新密码"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">确认密码</div><div class="col-sm-8"><input ng-model="password.confirmPassword" type="password" required="" class="form-control" placeholder="确认密码"></div></div><div class="portal-row clearfix"><input type="submit" value="提交" name="submit" ng-click="changePassword(password)" class="btn btn-danger pull-right"></div></div></section></div>'),e.put("app/components/portal/ThingManager/ThingManager.html",'<div class="app-portal-thingmanager"><div ui-view=""></div></div>'),e.put("app/components/portal/ThingViews/EditThing.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">编辑设备标签</h3></div><div class="modal-body ng-scope clearfix"><div class="col-sm-12"><form novalidate="" name="newUserForm" ng-submit="createUser()"><div class="row portal-row clearfix"><div class="col-sm-4">设备种类</div><div class="col-sm-8">{{thing.type}}</div></div><div class="row portal-row clearfix"><div class="col-sm-4">设备ID</div><div class="col-sm-8">{{thing.globalThingID}}</div></div><div class="row portal-row clearfix"><div class="col-sm-4">设备位置</div><div class="col-sm-8">{{thing.location}}</div></div><div class="row portal-row clearfix"><div class="col-sm-4">标签</div><div class="col-sm-8"><span class="label label-info" style="display:inline-block; margin-right: 5px;" ng-repeat="tag in thing.tags">{{tag}} <span class="fa fa-remove" ng-click="removeTag(tag)"></span></span></div></div><div><table><thead><tr><th width="40%">选择</th><th>标签名</th></tr></thead><tbody><tr ng-repeat="tag in queriedTags"><td><input type="checkbox" ng-model="tag._checked"></td><td>{{tag.displayName}}</td></tr></tbody></table></div></form></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">提交</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/RemoteControl.template.html",'<div class="modal-content" ng-init="init()"><div class="modal-header"><h3 class="modal-title">远程控制</h3></div><div class="modal-body clearfix"><trigger-command my-actions="sourceSchema.content.actions"></trigger-command></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">发送命令</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/ThingRule.template.html",'<div class="modal-content"><div class="modal-header"><h3 class="modal-title">编辑规则</h3></div><div class="modal-body clearfix"><div class="form-group"><label>触发器名称</label> <input class="form-control" type="text" placeholder="触发器名称" ng-model="triggerBO.triggerName"></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/ThingViews.html",'<div class="app-portal-thingviews"><div ui-view=""></div></div>'),e.put("app/components/portal/TriggerManager/CreateTrigger.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">新增触发器</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">触发器名称</div><div class="col-sm-8"><input ng-model="triggerBO.triggerName" type="text" class="form-control" placeholder="触发器名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">触发器类型</div><div class="col-sm-8"><div app-select="" selected-model="triggerBO.triggerType" options="triggerTypes" class="input-group-btn" text="text" value-only="true"></div></div></div></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok(triggerBO)" ng-disable="triggerBO.triggerName.length==0">确认</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/TriggerManager/TriggerManager.html",'<div class="app-portal-triggermanager" ng-init="init()"><div class="new-trigger" ng-click="createTrigger()"><span class="fa fa-plus"></span> 新建触发器</div><uib-accordion close-others="true"><uib-accordion-group heading="{{trigger.triggerName}}" ng-repeat="trigger in triggers"><div ng-include="\'app/components/portal/TriggerManager/TriggerSetting.template.html\'"></div></uib-accordion-group></uib-accordion></div>'),e.put("app/components/portal/TriggerManager/TriggerSetting.template.html",'<summary-trigger ng-if="trigger.type==\'Summary\'" trigger="trigger" class="trigger-setting"></summary-trigger><group-trigger ng-if="trigger.type==\'Group\'" trigger="trigger" class="trigger-setting"></group-trigger><schedule-trigger ng-if="trigger.type==\'Simple\'" trigger="trigger" class="trigger-setting"></schedule-trigger>'),e.put("app/components/portal/UserManager/UserManager.html",'<div class="app-portal-usermanager"><div ui-view=""></div></div>'),e.put("app/components/portal/Welcome/Welcome.html",'<div class="app-portal-welcome"><h3>欢迎使用蜂巢智能管理平台</h3></div>'),e.put("app/components/secure/AdminLogin/AdminLogin.html",'<div class="app-secure-adminlogin"><div ui-view=""></div></div>'),e.put("app/components/secure/UserLogin/UserLogin.html",'<div class="app-secure-userlogin"><div class="app-logo-bg"><span class="fa fa-paper-plane-o app-icon"></span> <span>蜂巢智能管理平台</span></div><div class="login-form-box"><form name="loginForm" class="form-signin" role="form" novalidate="" ng-submit="login(credentials)"><div class="form-item-header">用户登录</div><fieldset><div class="input-group margin-bottom-sm" ng-class="nameInputFoucsClass"><span class="input-group-addon"><i class="fa fa-user fa-fw"></i></span> <input type="text" class="form-control" placeholder="用户名" name="username" ng-model="credentials.userName" required="" autofocus=""></div><div class="input-group margin-bottom-sm" ng-class="pwdInputFoucsClass"><span class="input-group-addon"><i class="fa fa-unlock fa-fw"></i></span> <input type="password" class="form-control" name="password" placeholder="密码" ng-model="credentials.password" required=""></div><div class="margin-bottom-sm"><input type="checkbox" id="rememberMe" name="rememberMe"> <label for="rememberMe">记住我 <input type="checkbox" switchery="credentials.permanentToken" yes-text="是" no-text="否"></label></div><div class="item-submit"><button type="submit" class="btn btn-danger item-submit-button"><span>登录</span></button></div></fieldset></form></div><div class="tip-wrap"><a id="register" class="ui-commandlink ui-widget" ng-click="register()"><span>注册</span></a></div><div class="powered-by">Powered by <span><img class="login-logo" src="images/kiicloud-logo.png" width="60px"></span>Kii China Team<div class="version-msg">Version 1.0b</div><div class="version-msg"><a href="{{thirdPartyAPIUrl}}" target="_blank"><u>Switch To Beehive API</u></a></div></div></div><script type="text/ng-template" id="registerModal"><div class="modal-content app-secure-userlogin" id="registerModal"> <div class="modal-header ng-scope"> <h3 class="modal-title">用户激活</h3> </div> <div class="modal-body clearfix app-secure-userlogin"> <!-- step bar --> <div class="step-bar"> <div class="sui-steps-round steps-round-auto"> <div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"> <div class="round">1</div> <div class="bar"></div> <label>激活账号</label> </div> <div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"> <div class="round">2</div> <div class="bar"></div> <label>初始化密码</label> </div> <div ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"> <div class="round">3</div> <label>激活成功</label> </div> </div> </div> <!-- end of step bar --> <uib-carousel no-wrap="noWrapSlides"> <!-- ============================== select source ========================== --> <uib-slide active="currentStep == 1"> <div class="input-group margin-bottom-sm" ng-class="nameInputFoucsClass"> <span class="input-group-addon"><i class="fa fa-user fa-fw"></i></span> <input type="text" class="form-control" placeholder="用户ID" name="username" placeholder="Username or e-mail" ng-model="credentials.userName" required autofocus> </div> <div class="input-group margin-bottom-sm" ng-class="pwdInputFoucsClass"> <span class="input-group-addon"><i class="fa fa-unlock fa-fw"></i></span> <input type="password" class="form-control" name="password" placeholder="激活码" ng-model="credentials.activityToken" required /> </div> </uib-slide> <uib-slide active="currentStep == 2"> <div class="input-group margin-bottom-sm" ng-class="pwdInputFoucsClass"> <span class="input-group-addon"><i class="fa fa-unlock fa-fw"></i></span> <input type="password" class="form-control" name="password" placeholder="初始密码" ng-model="credentials.newPassword" required /> </div> <div class="input-group margin-bottom-sm" ng-class="pwdInputFoucsClass"> <span class="input-group-addon"><i class="fa fa-unlock fa-fw"></i></span> <input type="password" class="form-control" name="password" placeholder="确认密码" ng-model="credentials.confirm" required /> </div> </uib-slide> <uib-slide active="currentStep == 3"> 注册成功，请输入用户名密码登录！ </uib-slide> </uib-carousel> </div> <div class="modal-footer"> <div class="item-submit"> <button type="submit" class="btn btn-danger item-submit-button" ng-click="register(credentials)"> <span>{{currentStep == 3?\'完成\' :\'提交\'}}</span> </button> </div> </div> </div></script>'),e.put("app/shared/directives/app-select/app-select.template.html",'<div class="directive-app-select" ng-class="myClass" uib-dropdown=""><button id="search-filter" ng-disabled="disabled" type="button" class="btn btn-default" uib-dropdown-toggle="">{{selectedOption[setting.text]}}<span class="caret"></span></button><ul class="dropdown-menu" role="menu" aria-labelledby="search-filter"><li ng-repeat="option in options" role="menuitem" ng-click="selectOption(option)"><a>{{option[setting.text]}}</a></li></ul></div>'),e.put("app/shared/directives/app-slider/app-slider.template.html",'<div><rzslider rz-slider-model="rangeSlider.value" rz-slider-options="rangeSlider.options"></rzslider></div>'),e.put("app/shared/directives/check-angular-tree/check-angular-tree.html",'<treecontrol tree-model="treeModel" selected-node="settings.selectedNode" selected-nodes="settings.selectedNodes" expanded-nodes="settings.expandedNodes" on-selection="settings.onSelection" on-node-toggle="settings.onNodeToggle" options="settings.options" order-by="{{settings.orderBy}}" reverse-order="settings.reverseOrder"></treecontrol>'),e.put("app/shared/directives/item-selector/item-selector.template.html",'<div ng-init="init()"><div class="row"><div class="col-xs-5" ng-if="!disabled"><uib-tabset><uib-tab heading="{{settings.unselectedTitle}}"><treecontrol class="tree-classic" tree-model="unselectedItems" options="treeOptions" on-selection="selectLeftItem(node)">{{node[settings.name]}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-2 mid-column" style="padding-top: 130px;" ng-if="!disabled"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedLeftItem" ng-click="addItem(selectedLeftItem)">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedRightItem" ng-click="removeItem(selectedRightItem)">《撤回</button></div></div><div ng-class="{\'col-xs-12\': disabled, \'col-xs-5\': !disabled}"><uib-tabset><uib-tab heading="{{settings.selectedTitle}}"><treecontrol class="tree-classic" tree-model="selectedItems" options="treeOptions" on-selection="selectRightItem(node)">{{node[settings.name]}}</treecontrol></uib-tab></uib-tabset></div></div></div>'),e.put("app/shared/directives/json-editor/json-editor.template.html",'<div class="json-editor"><table class="table"><thead><tr><th>参数名</th><th>参数值</th><th>参数类型</th></tr></thead><tbody><tr ng-repeat="field in fieldList"><td><input type="text" ng-model="field.fieldName" class="form-control"></td><td ng-switch="" on="field.type"><input ng-switch-when="float" class="form-control" type="text" ng-model="field.value"> <input ng-switch-when="string" class="form-control" type="text" ng-model="field.value"><div ng-switch-when="boolean" app-select="" options="booleanValues" selected-model="field.value" value-only="true"></div></td><td><div app-select="" options="typeOptions" selected-model="field.type" value-only="true"></div></td></tr><tr><td colspan="3"><div class="add-arg" ng-click="addField()"><span class="fa fa-plus"></span>添加参数</div></td></tr></tbody></table></div>'),e.put("app/shared/directives/location-selector/location-selector.template.html",'<div><uib-tabset><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="locations" options="treeOptions" on-selection="selectLocation(node, selected)">{{node[\'name\']}}</treecontrol></uib-tab></uib-tabset></div>'),e.put("app/shared/directives/multi-selector/multi-selector.template.html",'<span class="app-multi-selector"><div ng-dropdown-multiselect="" options="options" selected-model="ngModel" extra-settings="dataset.settings" events="dataset.events"></div></span>'),e.put("app/shared/directives/pagion/pagion.template.html",'<div><uib-pagination total-items="collection.length" items-per-page="listMaxLength" ng-model="index" ng-change="pageChanged()" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination></div>'),e.put("app/shared/directives/range-slider/range-slider.template.html",'<div class="range-slider"><input type="range" step="1" min="{{min}}" max="{{max}}" ng-model="ngModel" ng-disabled="disabled"> <input type="text" class="range-display form-control" ng-model="ngModel" ng-disabled="disabled"></div>'),e.put("app/shared/directives/rp-date-picker/rp-date-picker.html",'<div class="row rp-date-picker" ng-init="init()"><div class="col-sm-6"><div class="input-group"><span class="input-group-addon">从</span> <input readonly="true" date-time="timePeriod.from" max-date="now" class="form-control" type="text" name="" ng-model="timePeriod.from"></div></div><div class="col-sm-6"><div class="input-group"><span class="input-group-addon">至</span> <input readonly="true" date-time="timePeriod.to" format="YYYY-MM-DD HH:mm" max-date="now" class="form-control" type="text" name="" ng-model="timePeriod.to"></div></div></div>'),e.put("app/shared/directives/rp-time-slicer/rp-time-slicer.html",'<div class="input-group rp-time-slicer" ng-init="init()"><input class="form-control" type="text" ng-model="selectedSlice.interval"> <label class="input-group-addon" app-select="" options="options" selected-model="selectedSlice.unit" value-only="true"></label></div>'),e.put("app/shared/directives/switchery/switchery.template.html",'<div class="switchery pull-right" ng-class="{\'on\':on}" ng-click="switch()"><div class="selector"><div class="option">{{yesText}}</div><div class="option">{{noText}}</div></div><div class="slider"><div class="dile"></div><div class="dile"></div><div class="dile"></div></div></div>'),e.put("app/shared/directives/tag-selector/tag-selector.template.html",'<div ng-init="init()"><div class="row"><div class="col-xs-5" ng-if="!disabled"><uib-tabset><uib-tab heading="标签"><treecontrol class="tree-classic" tree-model="dataset.tags" options="treeOptions" on-selection="selectLeftItem(node)">{{node[\'displayName\']}}</treecontrol></uib-tab><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="dataset.locations" options="treeOptions" on-selection="selectLeftItem(node)">{{node[\'name\']}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-2 mid-column" style="padding-top: 130px;" ng-if="!disabled"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedLeftItem" ng-click="addItem(selectedLeftItem)">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedRightItem" ng-click="removeItem(selectedRightItem)">《撤回</button></div></div><div ng-class="{\'col-xs-12\': disabled, \'col-xs-5\': !disabled}"><uib-tabset><uib-tab heading="已选"><treecontrol class="tree-classic" tree-model="selectedItems" options="treeOptions" on-selection="selectRightItem(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div></div></div>'),e.put("app/shared/directives/tag-selector/tree.template.html",'<ul {{options.ulclass}}=""><li ng-repeat="node in node.{{options.nodeChildren}} | filter:filterExpression:filterComparator {{options.orderBy}}" ng-class="headClass(node)" {{options.liclass}}="" set-node-to-data=""><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i> <i class="tree-leaf-head {{options.iLeafClass}}"></i><div class="tree-label {{options.labelClass}}" ng-class="[selectedClass(), unselectableClass()]" ng-click="selectNodeLabel(node)" tree-transclude=""></div><treeitem ng-if="nodeExpanded()"></treeitem></li></ul>'),e.put("app/shared/directives/thing-picker/thing-picker.template.html",'<div ng-init="init()"><div class="col-sm-5 tabs-with-border"><uib-tabset><uib-tab heading="{{tab.name}}" select="selectLocation()" active="tab.active" ng-repeat="tab in tabs"><treecontrol class="tree-classic" tree-model="tab.treeLeft" options="treeOptions" on-selection="selectLeftNode(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-sm-2 mid-column" style="padding-top: 130px;"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedLeftNode" ng-click="addButtonClick()">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedRightNode" ng-click="removeButtonClick()">《撤回</button></div></div><div class="col-sm-5 tabs-with-border"><uib-tabset><uib-tab heading="{{tab.name}}" select="selectLocation()" active="tab.active" ng-repeat="tab in tabs"><treecontrol class="tree-classic" tree-model="tab.treeRight" options="treeOptions" on-selection="selectRightNode(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div></div>'),e.put("app/shared/directives/thing-selector/thing-selector.template.html",'<div ng-init="init()"><div class="row"><div class="col-xs-4"><uib-tabset><uib-tab heading="标签"><treecontrol class="tree-classic" tree-model="dataset.tags" options="treeOptions" on-selection="selectTag(node)">{{node.displayName}}</treecontrol></uib-tab><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="dataset.locations" options="treeOptions" on-selection="selectLocation(node)">{{node.name}}</treecontrol></uib-tab><uib-tab heading="种类"><treecontrol class="tree-classic" tree-model="dataset.types" options="treeOptions" on-selection="selectType(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-3"><uib-tabset><uib-tab heading="未选设备"><treecontrol class="tree-classic" tree-model="thingTypes" options="treeOptions" on-selection="selectUnselectedThing(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-2 mid-column" style="padding-top: 130px;"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedUnselectedThing" ng-click="addThing(selectedUnselectedThing)">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedSelectedThing" ng-click="removeThing(selectedSelectedThing)">《撤回</button></div></div><div class="col-xs-3"><uib-tabset><uib-tab heading="已选设备"><treecontrol class="tree-classic" tree-model="selectedTypes" options="treeOptions" on-selection="selectSelectedThing(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div></div></div>'),e.put("app/components/portal/Reporting/CustomCharts/CustomCharts.html",'<div class="app-portal-reporting-customcharts"><div class="panel header"><div class="panel-body"><div class="panel-row"><div class="pull-left"><div class="pull-left"><div class="title pull-left"><span class="fa fa-clock-o"></span> 时间段</div><div class="pull-left time-picker"><rp-date-picker output="onPeriodChange"></rp-date-picker></div></div><div class="pull-left"><div class="pull-left"><div class="title pull-left"><span class="fa fa-map-marker"></span> <span>坐标</span></div><div class="pull-left"><div app-select="" options="locations" selected-model="selectedLocation"></div></div></div><div class="pull-left"><button class="btn btn-info" ng-click="queryData()">刷新</button> <button class="btn btn-info" ng-click="factoryChart()">新建图表</button></div></div></div></div></div></div><div gridster="gridsterOpts"><div ng-repeat="chart in charts | filter: displayTagFilter" gridster-item="customChartMap"><div class="panel"><div class="panel-heading">{{chart.name}}</div><div class="panel-body"><div ng-show="onEdit[$index]"></div><div ng-hide="onEdit[$index]"><kii-chart query="chart.query" period="period" window="0" location="" refresh-when-ready="true" stage="false" level="chart.level" style="height: 400px;"></kii-chart></div></div></div></div></div></div>'),e.put("app/components/portal/Reporting/FaceDetection/FaceDetection.html",'<div class="app-portal-reporting-facedetection"><div class="panel header"><div class="panel-body"><div class="panel-row"><div class="pull-left"><table class="table"><tbody><tr><td>指数类型</td><td><div app-select="" options="chartSources" selected-model="selectedSource" value-only="true"></div></td><td>值</td><td><div app-select="" options="aggMethods" selected-model="selectedMethod" value-only="true"></div></td></tr></tbody></table></div><div class="v-hr pull-left"></div><div class="pull-left"><div class="pull-left"><div class="title pull-left"><span class="fa fa-clock-o"></span> 时间段</div><div class="pull-left time-picker"><rp-date-picker output="onPeriodChange"></rp-date-picker></div></div><div class="pull-left"><div class="pull-left"><div class="title pull-left"><span class="fa fa-map-marker"></span> <span>坐标</span></div><div class="pull-left"><div app-select="" options="locations" selected-model="selectedLocation"></div></div></div><div class="pull-left"><button class="btn btn-info pull-left" ng-click="queryData()">刷新</button></div></div></div></div></div></div><div class="row"><div class="col-md-3"><div class="panel chart-panel"><div class="panel-heading">人气值比例</div><div class="panel-body"><kii-chart query="summaryQuery" period="period" window="0" location="" refresh="refreshPie1" stage="false" level="0" chart="pie" output="getFigure" style="height: 250px;"></kii-chart><div style="height: 182px;font-size:30px; font-weight: bold; margin:-16px; text-align: center; position:relative;"><div style="position: absolute; width: 100%; top: 50px"><span>人气值</span><br>{{numberDetected}}</div></div></div></div></div><div class="col-md-9"><div class="panel chart-panel"><div class="panel-heading">空间占用率</div><div class="panel-body"><div class="chart-container"><div class="chart-content"><kii-chart query="lineQuery" period="period" window="0" location="" refresh="refreshLine" stage="false" level="lineLevel" style="height: 400px;"></kii-chart></div><div class="chart-control"><div class="form-group"><label>单位时长</label><rp-time-slicer output="onTimeSliceChange"></rp-time-slicer></div><div><button ng-click="refreshLine()" class="btn btn-success btn-split">刷新</button> <button ng-click="groupLines()" ng-if="split" class="btn btn-warning btn-split">合并</button> <button ng-click="splitLine()" ng-if="!split" class="btn btn-info btn-split">拆分</button></div></div></div></div></div></div><div class="col-md-3"><div class="panel chart-panel"><div class="panel-heading">人气值比例</div><div class="panel-body"><kii-chart query="barQuery" period="period" window="0" location="" refresh="refreshPie2" stage="false" level="0" chart="pie" style="height: 400px;"></kii-chart></div></div></div><div class="col-md-9"><div class="panel chart-panel"><div class="panel-heading">人气值</div><div class="panel-body"><kii-chart query="pieQuery" period="period" window="0" location="" refresh="refreshBar" stage="false" level="0" style="height: 400px;"></kii-chart></div></div></div></div></div>'),e.put("app/components/portal/Reporting/LineChart/LineChart.html",'<div class="app-portal-reporting-linechart"><div class="panel header"><div class="panel-body"><div class="panel-row"><div class="pull-left"><table class="table"><tbody><tr><td>指数类型</td><td><div app-select="" options="chartSources" selected-model="selectedSource" value-only="true"></div></td><td>值</td><td><div app-select="" options="aggMethods" selected-model="selectedMethod" value-only="true"></div></td></tr></tbody></table></div><div class="v-hr pull-left"></div><div class="pull-left"><div class="pull-left"><div class="title pull-left"><span class="fa fa-clock-o"></span> 时间段</div><div class="pull-left time-picker"><rp-date-picker output="onPeriodChange"></rp-date-picker></div></div><div class="pull-left"><div class="pull-left"><div class="title pull-left"><span class="fa fa-map-marker"></span> <span>坐标</span></div><div class="pull-left"><div app-select="" options="locations" selected-model="selectedLocation"></div></div></div><div class="pull-left"><button class="btn btn-info pull-left" ng-click="queryData()">刷新</button></div></div></div></div></div></div><div class="row"><div class="col-md-3"><div class="panel chart-panel"><div class="panel-heading"></div><div class="panel-body"><div style="height: 420px;font-size:30px; font-weight: bold; text-align: center; position:relative;"><div style="position: absolute; width: 100%; top: 190px">{{sumKwh}}<br><span>耗电总量</span></div></div></div></div></div><div class="col-md-9"><div class="panel chart-panel"><div class="panel-heading">电量消耗</div><div class="panel-body"><div class="chart-container"><div class="chart-content"><kii-chart query="lineQuery" period="period" window="0" location="" refresh="refreshLine" stage="false" level="lineLevel" style="height: 400px;"></kii-chart></div><div class="chart-control"><div class="form-group"><label>单位时长</label><rp-time-slicer output="onTimeSliceChange"></rp-time-slicer></div><div><button ng-click="refreshLine()" class="btn btn-success btn-split">刷新</button> <button ng-click="groupLines()" ng-if="split" class="btn btn-warning btn-split">合并</button> <button ng-click="splitLine()" ng-if="!split" class="btn btn-info btn-split">拆分</button></div></div></div></div></div></div><div class="col-md-3"><div class="panel chart-panel"><div class="panel-heading">电量消耗</div><div class="panel-body"><kii-chart query="barQuery" period="period" window="0" location="" refresh="refreshPie" stage="false" level="0" output="getSummary" style="height: 400px;"></kii-chart></div></div></div><div class="col-md-9"><div class="panel chart-panel"><div class="panel-heading">电量消耗</div><div class="panel-body"><kii-chart query="barQuery" period="period" window="0" chart="pie" location="" refresh="refreshBar" stage="false" level="0" style="height: 400px;"></kii-chart></div></div></div></div></div>'),e.put("app/components/portal/ScenarioManager/OfficeAtmosphere/OfficeAtmosphere.html",'<div class="app-portal-scenariomanager-officeatmosphere clearfix"><div class="left-panel"><div class="item-container clearfix"><div class="draggable-item sensor" ng-repeat="location in selectedLocationNode.children" sglclick="locationOnClick(location, $event)" ng-dblclick="locationDoubleClick($event)" data-toggle="popover"><div class="icon-holder"><span class="fa fa-building"></span></div><div class="name"><span>{{location.name}}</span></div></div></div><hr><div class="controller-container clearfix"><div ng-repeat="controllerType in triggerControllerTypes" class="controller draggable-item icon-only" ctr-type="{{controllerType.type}}"><div class="icon-holder"><span class="{{controllerType.icon}}"></span></div></div></div></div><div class="right-panel clearfix"><div class="panel-bg"><div class="drawing-container"><svg width="100%" height="100%" id="svg"><g id="graph" fill="blue" stroke="2"></g></svg></div></div><div class="panel-wrapper clearfix"><div class="col col-1"><div class="draggable-item sensor" ng-repeat="sensor in dataContainer.sensors"><div class="icon-holder"><span class="fa fa-rss"></span></div><div class="name"><span>{{sensor.vendorThingID}}</span></div></div><div class="dragged tip" ng-class="{\'in\': dataContainer.sensors.length == 0}"><div class="icon-holder"><span class="fa fa-plus"></span></div><div class="name"><span>Drag Sensor</span></div></div></div><div class="col col-2"><div class="draggable-item location" ng-click="selectedLocationOnClick(location, $event)" ng-repeat="location in dataContainer.locations" data-toggle="popover"><div class="icon-holder"><span class="fa fa-building"></span></div><div class="name"><span>{{location.name}}</span></div></div><div class="dragged tip" ng-class="{\'in\': dataContainer.locations.length == 0}"><div class="icon-holder"><span class="fa fa-plus"></span></div><div class="name"><span>Drag Location</span></div></div></div><div class="col col-3"><div class="controller-holder"><div ng-if="dataContainer.mainController && dataContainer.mainController.type == \'timer\'" ng-click="mainControllerOnClick(dataContainer.mainController, $event)" class="controller draggable-item icon-only main-controller" ctr-type="{{dataContainer.mainController.type}}" oa-mctrl="" panel="panelControl._$panel"><div class="icon-holder"><span class="{{dataContainer.mainController.icon}}"></span></div></div><div ng-if="dataContainer.mainController && dataContainer.mainController.type == \'condition\'" ng-click="mainControllerOnClick(dataContainer.mainController, $event)" class="controller draggable-item icon-only main-controller" ctr-type="{{dataContainer.mainController.type}}" oa-pctrl="" panel="panelControl._$panel"><div class="icon-holder"><span class="{{dataContainer.mainController.icon}}"></span></div></div><div class="tip icon-only"><div class="icon-holder"><span class="fa fa-circle-o"></span></div></div></div></div><div class="col col-4"><div class="icon-only tip" ng-if="dataContainer.equipments.length == 0"><div class="icon-holder"><span class="fa fa-circle-o"></span></div></div><div class="controller-holder" ng-repeat="equipment in dataContainer.equipments"><div ng-switch="equipment.subController.type"><div ng-switch-when="timer" ng-if="equipment.subController" class="draggable-item icon-only sub-controller" ctr-type="{{equipment.subController.type}}" oa-mctrl="" panel="panelControl._$panel"><div class="icon-holder"><span class="fa" ng-class="equipment.subController.icon"></span></div></div><div ng-switch-when="condition" ng-if="equipment.subController" class="draggable-item icon-only sub-controller" ctr-type="{{equipment.subController.type}}" oa-pctrl="" panel="panelControl._$panel"><div class="icon-holder"><span class="fa" ng-class="equipment.subController.icon"></span></div></div></div><div class="icon-only tip" ng-style="{\'display\': equipment.subController?\'none\': \'block\'}"><div class="icon-holder"><span class="fa fa-circle-o"></span></div></div></div></div><div class="col col-5"><div class="draggable-item equip" ng-repeat="equipment in dataContainer.equipments"><div class="icon-holder"><span class="fa fa-lightbulb-o"></span></div><div class="name"><span>{{equipment.type}}</span></div></div><div class="dragged tip" ng-class="{\'in\': dataContainer.equipments.length == 0}"><div class="icon-holder"><span class="fa fa-plus"></span></div><div class="name"><span>Drag Equips</span></div></div></div><div class="tool-panel"><div class="item-holder-when-draggin trash"><span class="fa fa-trash"></span></div></div></div></div><div class="bottom-bar"><div class="bg"></div></div><div class="hidden" id="sensor-holder"><div class="draggable-item sensor" ng-repeat="sensor in dataContainer.popedSensors"><div class="icon-holder"><span class="fa fa-rss"></span></div><div class="name"><span>{{sensor.vendorThingID}}</span></div></div></div><div class="hidden" id="equipment-holder"><div class="draggable-item equip" ng-repeat="equip in dataContainer.popedEquipments"><div class="icon-holder"><span class="fa fa-lightbulb-o"></span></div><div class="name"><span>{{equip}}</span></div></div></div><script type="text/ng-template" id="office-atmosphere.popover-sensor.template.html"><div class="popover sensor-popover" role="tooltip"> <div class="arrow"></div> <h3 class="popover-title"></h3> <div class="popover-content clearfix"></div> </div></script><script type="text/ng-template" id="office-atmosphere.popover-equip.template.html"><div class="popover equip-popover" role="tooltip"> <div class="arrow"></div> <h3 class="popover-title"></h3> <div class="popover-content clearfix"></div> </div></script></div>'),e.put("app/components/portal/ThingManager/AddThing/AddThing.html",'<div class="app-portal-thingmanager-addthing" ng-init="init()"><div class="panel"><div class="panel-heading">添加新设备</div><div class="panel-body"><div class="row"><div class="col-xs-6"><div class="form-group"><label>vendorThingID</label> <input class="form-control" type="text" ng-model="thing.vendorThingID"></div><div class="form-group"><label>种类</label> <input class="form-control" type="text" ng-model="thing.type" input-options="types"></div><div class="form-group"><label>供应商</label><div app-select="" options="suppliers" text="name" value="relationAppID" selected-model="thing.kiiAppID" value-only="true"></div></div><div class="form-group"><label>自定义字段</label><div><json-editor ng-model="thing.custom"></json-editor></div></div><div class="form-group"><button ng-click="saveThing(thing)" class="btn btn-success pull-right">添加设备</button></div></div><div class="col-xs-6"><div class="form-group"><label>位置</label> <input class="form-control" type="text" ng-model="thing.location"></div><div class="form-group"><location-selector selected-location="thing.location"></location-selector></div></div></div></div></div></div>'),e.put("app/components/portal/ThingManager/ControlThing/ControlThing.html",'<div class="app-portal-thingmanager-controlthing" ng-init="init()"><div class="panel"><div class="panel-heading">发送设备命令</div><div class="panel-body"><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><source-picker my-source="dataContainer.mySource" init="init" ng-if="refreshed"></source-picker></uib-slide><uib-slide active="currentStep == 2"><trigger-command my-actions="dataContainer.sourceSchema.content.actions" ng-if="refreshed"></trigger-command></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><button class="btn btn-danger pull-right margin-left" ng-click="nextStep(currentStep)">{{currentStep < 2?\'下一步\':\'完成\'}}</button> <button class="btn btn-success pull-right" ng-click="currentStep = currentStep - 1" ng-show="currentStep>1">上一步</button></div></div></div></div>'),e.put("app/components/portal/ThingManager/Gateway/Gateway.html",'<div class="app-portal-thingmanager-gateway"><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><div class="row clearfix"><div class="col-xs-4 clearfix"><uib-tabset><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="locationTree" options="treeOptions" on-selection="selectLocation(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-8 clearfix"><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">ID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">种类</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="thing in things" ng-click="showGatewayThings(thing)"><td>{{thing.globalThingID}}</td><td class="sorting_1">{{thing.type}}</td></tr></tbody></table></div></div></div></section><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><table class="table"><thead><th>设备ID</th><th>状态</th><th>操作</th></thead><tbody><tr ng-repeat="thing in endNodes"><td>{{thing.vendorThingID}}</td><td>{{thing.status}}</td><td width="124px"><button class="btn btn-info" ng-click="showReplaceModal(thing)">替换</button> <button class="btn btn-danger" ng-click="removeEndNode(thing)">删除</button></td></tr></tbody></table></div></section></div>'),e.put("app/components/portal/ThingManager/Gateway/Replacement.template.html",'<div class="modal-content"><div class="modal-header"><h3 class="modal-title">替换设备</h3></div><div class="modal-body clearfix"><div class="form-group"><label>endNodeVendorThingID</label> <input class="form-control" type="text" ng-model="endNode.endNodeVendorThingID"></div><div class="form-group"><label>endNodePassword</label> <input class="form-control" type="text" ng-model="endNode.endNodePassword"></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/LocationView/LocationView.html",'<div class="app-portal-thingviews-locationview" ng-init="init()"><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><div class="row clearfix"><div class="col-xs-4 clearfix"><uib-tabset><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="locationTree.tree.children" options="treeOptions" on-selection="selectLocation(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-8 clearfix"><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">ID</th><th>vendorThingID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">种类</th><th class="text-center">已登陆</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="thing in thingsForDisplay" context-menu="myMenu" target="thing"><td>{{thing.globalThingID}}</td><td>{{thing.vendorThingID}}</td><td class="sorting_1">{{thing.type}}</td><td class="text-center"><span class="fa" ng-class="thing.fullKiiThingID?\'fa-check\': \'fa-remove\'"></span></td></tr></tbody></table><div class="pull-right"><pagion collection="things" display="thingsForDisplay"></pagion></div></div></div></div></section></div>'),e.put("app/components/portal/ThingViews/TagView/AddTag.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">新增标签</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">标签名称</div><div class="col-sm-8"><input ng-model="newTag.displayName" type="text" class="form-control" placeholder="标签名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">描述</div><div class="col-sm-8"><input ng-model="newTag.description" type="text" class="form-control" placeholder="描述"></div></div></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/TagView/DeleteTag.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">删除标签</h3></div><div class="modal-body clearfix"><div class="col-sm-12">是否删除标签: {{tag.displayName}}</div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/TagView/EditTag.template.html",'<div class="modal-content" ng-init="init()"><div class="modal-header ng-scope"><h3 class="modal-title">编辑标签</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">标签名称</div><div class="col-sm-8"><input ng-model="tag.displayName" ng-disabled="true" type="text" class="form-control" placeholder="标签名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">描述</div><div class="col-sm-8"><input ng-model="tag.description" type="text" class="form-control" placeholder="描述"></div></div><thing-selector selected-things="selectedThings"></thing-selector></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">更新</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/TagView/TagView.html",'<div class="app-portal-thingviews-tagview" ng-init="init()"><div class="row portal-row"><div class="col-lg-12"><button class="btn btn-danger" ng-click="addTag()">新增标签</button></div></div><div class="portal-row"><div class="modules-outputs-content graph-tile" ng-repeat="tag in tagsForDisplay"><div class="module-top"><div class="overlay" ng-click="viewThings(tag)"><div class="viewReport">查看</div></div><div class="outputs-content-img"><img ng-src="{{\'images/tag.jpeg\'}}"></div></div><div class="moduleDetails"><div class="per-info"><span class="info">{{tag.displayName}}</span></div><div class="modulesActionBottom"><div class="item action-button" ng-click="goThingAuth(group)"><span class="fa fa-cloud-download"></span> <span class="item-text">添加设备</span></div></div></div><div class="modulesActionsTop"><i class="fa fa-pencil-square-o" uib-tooltip="编辑" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top" ng-click="editTag(tag)"></i> <i class="fa fa-trash-o" uib-tooltip="删除" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top" ng-click="deleteTag(tag)"></i></div></div></div><div class="portal-row"><div class="pull-right"><pagion collection="thingTags" display="tagsForDisplay"></pagion></div></div></div>'),e.put("app/components/portal/ThingViews/ThingACL/ThingACL.html",'<div class="app-portal-thingviews-thingacl"><div class="panel"><div class="panel-heading"><span>设备使用权限控制</span></div><div class="panel-body"><div class="portal-row"><label ng-repeat="acl in acls"><input type="checkbox" ng-model="acl._checked">{{acl.name}}</label></div><div class="portal-row"><table class="table"><thead><th>用户姓名</th><th>用户ID</th><th>选择</th></thead><tbody><tr ng-repeat="user in users"><td>{{user.userName}}</td><td>{{user.userID}}</td><td><input type="checkbox" ng-model="user._checked"></td></tr></tbody></table></div></div></div></div>'),e.put("app/components/portal/ThingViews/ThingDetail/ThingDetail.html",'<div class="app-portal-thingviews-thingdetail" ng-init="init()"><div class="row"><div class="col-sm-5"><div class="panel"><div class="panel-heading">属性</div><div class="panel-body"><table><tr><td class="title">设备ID</td><td>{{thing.globalThingID}}</td></tr><tr><td class="title">vendorThingID</td><td>{{thing.vendorThingID}}</td></tr><tr><td class="title">设备位置</td><td>{{thing.location}}</td></tr><tr><td class="title">设备种类</td><td>{{thing.type}}</td></tr><tr><td class="title">位置</td><td>{{thing.location}}</td></tr><tr><td class="title">标签</td><td>{{thing.tags.join(\', \')}}</td></tr><tr><td class="title">已登录</td><td><span class="fa" ng-class="thing.fullKiiThingID?\'fa-check\': \'fa-remove\'"></span></td></tr></table></div></div><div class="panel"><div class="panel-heading">设备状态 <span class="fa fa-refresh operator" ng-click="refreshStatus()"></span></div><div class="panel-body"><table ng-show="!statusOnEdit"><tr ng-repeat="(key, value) in thing.status"><td class="title">{{key}}</td><td>{{value}}</td></tr></table></div></div></div><div class="col-sm-7"><div class="panel" ng-if="thing.kiiAppID"><div class="panel-heading">设备登录信息</div><div class="panel-body"><table><tr><td class="title">kiiAppID</td><td>{{thing.kiiAppID}}</td></tr><tr><td class="title">kiiAppKey</td><td>{{thing.kiiAppKey}}</td></tr><tr><td class="title">ownerID</td><td>{{thing.ownerID}}</td></tr><tr><td class="title">ownerToken</td><td>{{thing.ownerToken}}</td></tr><tr><td class="title">kiiSiteUrl</td><td>{{thing.kiiSiteUrl}}</td></tr><tr><td class="title">password</td><td>{{thing.password}}</td></tr></table></div></div><div class="panel"><div class="panel-heading">自定义字段 <span ng-show="!customOnEdit" class="fa fa-edit" ng-click="editCustom(thing.custom)"></span> <span ng-show="customOnEdit" class="fa fa-remove" ng-click="customOnEdit = false"></span></div><div class="panel-body"><table ng-show="!customOnEdit"><tr ng-repeat="(key, value) in thing.custom"><td class="title">{{key}}</td><td>{{value}}</td></tr></table><div ng-show="customOnEdit"><div class="form-group"><div id="customEditor" style="height:300px; width:100%;"></div></div><div><button class="btn btn-success pull-right" ng-click="submitCustomFields(thing)">更新</button></div></div></div></div></div></div><div class="panel"><div class="panel-heading">触发器</div></div><div class="new-trigger" ng-click="createTriggerModal()"><span class="fa fa-plus"></span> 新建触发器</div><uib-accordion close-others="true"><uib-accordion-group heading="{{trigger.triggerName}}" ng-repeat="trigger in dataset.triggers"><single-trigger trigger="trigger"></single-trigger></uib-accordion-group></uib-accordion><div class="panel"><div class="panel-heading">控制历史</div><div class="panel-body"><div class="time-picker-group"><div class="row"><div class="col-xs-6"><label>起始日期</label></div><div class="col-xs-6"><label>结束日期</label></div></div><div class="row"><div class="col-xs-6"><p class="input-group"><input type="text" class="form-control" uib-datepicker-popup="" ng-model="startDate" is-open="startDateOpened" datepicker-options="dateOptions" ng-required="true" close-text="Close"> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="openStartDate()"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div><div class="col-xs-6"><p class="input-group"><input type="text" class="form-control" uib-datepicker-popup="" ng-model="endDate" is-open="endDateOpened" datepicker-options="dateOptions" ng-required="true" close-text="Close"> <span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="openEndDate()"><i class="glyphicon glyphicon-calendar"></i></button></span></p></div></div><div><button class="btn btn-success" ng-click="searchThingCommands(thing.globalThingID, startDate, endDate)">查询</button></div></div><hr><table class="table"><thead><tr><th>ID</th><th>行业模板</th><th>操作</th><th>状态</th><th>发送时间</th></tr></thead><tbody><tr ng-repeat="command in thingCommands"><td>{{command.commandID}}</td><td>{{command.schema}}</td><td>{{command.actions}}</td><td>{{command.commandState}}</td><td>{{command.createdAt | date:\'yyyy-MM-dd HH:mm:ss\'}}</td></tr></tbody></table></div></div><hr><div class="clearfix"><div class="pull-right"><button class="btn btn-danger" ng-click="openRemoteControl(thing)" ng-if="thing.fullKiiThingID">远程控制</button> <button class="btn btn-danger" ng-click="goThingACL()">控制权限</button></div></div></div>'),e.put("app/components/portal/ThingViews/ThingList/ThingList.html",'<div class="app-portal-thingviews-thinglist" ng-init="init()"><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><table class="table table-striped table-bordered table-hover dataTable no-footer" role="grid"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">设备ID</th><th class="sorting">vendorThingID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">种类</th><th class="sorting" rowspan="1" colspan="1">位置</th><th class="sorting" rowspan="1" colspan="1">标签</th><th class="text-center">已登陆</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="thing in things" context-menu="myMenu" target="thing"><td>{{thing.globalThingID}}</td><td>{{thing.vendorThingID}}</td><td class="sorting_1">{{thing.type}}</td><td>{{thing.location}}</td><td>{{thing.tags.join(\',\')}}</td><td class="text-center"><span class="fa" ng-class="thing.fullKiiThingID?\'fa-check\': \'fa-remove\'"></span></td></tr></tbody></table><div class="pull-right"><pagion collection="things" display="thingsForDisplay"></pagion></div></div></section></div>'),e.put("app/components/portal/ThingViews/TypeView/EditType.template.html",'<div class="modal-content" ng-init="init()"><div class="modal-header ng-scope"><h3 class="modal-title">编辑类型</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">类型名称</div><div class="col-sm-8"><input ng-model="type.type" ng-disabled="true" type="text" class="form-control" placeholder="标签名称"></div></div><div class="row portal-row clearfix"><uib-tabset><uib-tab heading="行业模板" ng-if="schema" active="schemaViewActive"><div class="form-group"><label>版本：{{schema.version}}</label></div><hr><div class="form-group"><h4>属性</h4><table class="table"><thead><th>名称</th><th>种类</th><th>值域</th><th>描述</th></thead><tbody><tr ng-repeat="(key, value) in schema.content.statesSchema.properties"><td>{{key}}</td><td><code class="bg-primary">{{value.type}}</code></td><td><code ng-if="value.minimum || value.minimum == 0">{{\'> \' + value.minimum}}</code> <code ng-if="value.maximum || value.maximum == 0">{{\'< \' + value.maximum}}</code></td><td>{{value.description}}</td></tr></tbody></table></div><hr><div class="form-group"><h4>命令</h4><uib-accordion close-others="oneAtATime"><uib-accordion-group heading="{{key}}" ng-repeat="(key, value) in schema.content.actions"><div class="form-group"><uib-tabset><uib-tab heading="输入"><property-tree my-property="value.in"></property-tree></uib-tab><uib-tab heading="输出"><property-tree my-property="value.out"></property-tree></uib-tab></uib-tabset></div></uib-accordion-group></uib-accordion></div></uib-tab><uib-tab heading="编辑行业模板" active="schemaEditorActive"><div id="jsoneditor" style="height:300px; width:100%;"></div></uib-tab></uib-tabset></div></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">更新</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/TypeView/TypeView.html",'<div class="app-portal-thingviews-typeview" ng-init="init()"><div class="modules-outputs-content graph-tile" ng-repeat="type in thingTypes"><div class="module-top"><div class="overlay"><div class="viewReport" ng-click="viewThings(type)">查看</div></div><div class="outputs-content-img"><img ng-src="{{\'images/bulb.jpeg\'}}"></div></div><div class="moduleDetails"><div class="per-info"><span class="info">{{type.type}}<br>设备数量： {{type.count}}</span></div><div class="modulesActionBottom"></div></div><div class="modulesActionsTop"><i class="fa fa-pencil-square-o" uib-tooltip="编辑" ng-click="editType(type)" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top"></i> <i class="fa fa-trash-o" uib-tooltip="删除" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top"></i></div></div></div>'),e.put("app/components/portal/UserManager/ThingAuthority/ThingAuthority.html",'<div class="app-portal-usermanager-thingauthority" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-selector selected-things="things"></thing-selector></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/User/EditUser.template.html",'<div class="modal-content app-portal-usermanager-user" ng-init="init()"><div class="modal-header ng-scope"><h3 class="modal-title">编辑用户资料</h3></div><div class="modal-body ng-scope"><form novalidate="" name="newUserForm" ng-submit="createUser()"><table class="detail-content"><tr><td>姓名</td><td><div class="input-group"><input type="text" class="form-control" placeholder="姓名" required="" ng-model="user.userName"><div app-select="" selected-model="user.custom.sex" options="sexOptions" class="btn-group input-group-btn" text="text"></div></div></td></tr><tr><td>身份证</td><td><input ng-model="user.userID" type="text" required="" class="form-control" placeholder="身份证" ng-disabled="true"></td></tr><tr><td>公司</td><td><input ng-model="user.company" type="text" class="form-control" placeholder="公司"></td></tr><tr><td>电话</td><td><input type="text" class="form-control" placeholder="电话" ng-model="user.phone"></td></tr><tr><td>邮箱地址</td><td><input type="text" class="form-control" placeholder="邮箱地址" ng-model="user.mail"></td></tr></table></form><hr><uib-tabset><uib-tab heading="设备组"><div class="clearfix form-group"><span ng-repeat="tag in tags" class="btn btn-info username">{{tag.displayName}} <span class="fa fa-remove" ng-click="removeTag(tag, user)"></span></span></div><div class="form-group"><table><tr><td><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></td><td><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button></span></div></td></tr></table></div><div><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">标签名</th><th class="sorting" rowspan="1" colspan="1">设备数</th><th class="sorting" rowspan="1" colspan="1" width="80px">操作</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="tag in tagsForDisplay"><td>{{tag.displayName}}</td><td>{{tag.count}}</td><td align="center"><button class="btn btn-success" ng-click="addTag(tag, user)">添加</button></td></tr></tbody></table><div class="pull-right"><pagion collection="allTags" display="tagsForDisplay"></pagion></div></div></uib-tab><uib-tab heading="设备"><div class="clearfix form-group"><span ng-repeat="thing in things" class="btn btn-info username">{{thing.vendorThingID}} <span class="fa fa-remove" ng-click="removeThing(thing, user)"></span></span></div><thing-selector selected-things="selectedThings"></thing-selector><hr><div class="pull-right"><button class="btn btn-success" ng-click="addThings(selectedThings, user)">添加设备</button></div></uib-tab></uib-tabset></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/UserManager/User/User.html",'<div class="app-portal-usermanager-user"><div ui-view=""></div></div>'),e.put("app/components/portal/UserManager/UserGroup/UserGroup.html",'<div class="app-portal-usermanager-usergroup"><div ui-view=""></div></div>'),e.put("app/components/portal/TriggerManager/directives/group-trigger/group-trigger.template.html",'<div ng-init="init()" class="group-trigger"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="currentStep = 1">1</div><div class="bar"></div><label>触发器源</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="currentStep = 2">2</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="currentStep = 3">3</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>4, \'current\': currentStep==4, \'todo\': currentStep<4}"><div class="round" ng-click="currentStep = 4">4</div><label>触发命令</label></div></div></div><hr><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><source-picker my-source="dataContainer.mySource" disabled="trigger.triggerID"></source-picker></uib-slide><uib-slide active="currentStep == 2"><uib-tabset><uib-tab heading="触发条件集"><div class="trigger-when"><span>何时触发：</span><div app-select="" value-only="true" selected-model="dataContainer.predicate.triggersWhen" options="triggerWhenConditions" disabled="trigger.triggerID"></div></div><div><condition-tree schema="dataContainer.sourceSchema.content.statesSchema.properties" result="dataContainer.predicate.condition" disabled="trigger.triggerID"></condition-tree></div></uib-tab><uib-tab heading="触发策略"><select-policy thing-number="dataContainer.thingNumber" policy="dataContainer.policy" disabled="trigger.triggerID"></select-policy></uib-tab><uib-tab heading="定时器"><div class="form-group text-left"><label><input type="checkbox" ng-disabled="!!trigger.triggerID" ng-model="dataContainer.schedule.enabled">启用定时器</label></div><select-schedule schedule="dataContainer.schedule" ng-if="dataContainer.schedule.enabled" disabled="trigger.triggerID"></select-schedule></uib-tab></uib-tabset></uib-slide><uib-slide active="currentStep == 3"><div class="new-source" ng-click="createTarget()" ng-if="!trigger.triggerID"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker sources="dataContainer.myTargets" disabled="trigger.triggerID"></multi-source-picker></uib-slide><uib-slide active="currentStep == 4"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{\'命令-\' + ($index + 1)}}" ng-repeat="targetSchema in dataContainer.targetSchemas"><trigger-command my-actions="targetSchema.content.actions" disabled="trigger.triggerID"></trigger-command></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><trigger-control-group trigger="trigger"></trigger-control-group><div class="pull-right" ng-if="!trigger.triggerID"><button class="btn btn-success" ng-click="previousStep(currentStep)" ng-show="currentStep>1">上一步</button> <button class="btn btn-danger" ng-click="nextStep(currentStep)">{{currentStep < 4?\'下一步\':\'完成\'}}</button></div></div></div>'),e.put("app/components/portal/TriggerManager/directives/schedule-trigger/schedule-trigger.template.html",'<div ng-init="init()"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="goStep(1)">1</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="goStep(2)">2</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="goStep(3)">3</div><label>触发命令</label></div></div></div><hr><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><select-schedule schedule="dataContainer.schedule" disabled="trigger.triggerID"></select-schedule></uib-slide><uib-slide active="currentStep == 2"><div class="new-source" ng-click="createTarget()" ng-if="!trigger.triggerID"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker sources="dataContainer.myTargets" disabled="trigger.triggerID"></multi-source-picker></uib-slide><uib-slide active="currentStep == 3"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{\'命令-\' + ($index + 1)}}" ng-repeat="targetSchema in dataContainer.targetSchemas"><trigger-command my-actions="targetSchema.content.actions" disabled="trigger.triggerID"></trigger-command></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><trigger-control-group trigger="trigger"></trigger-control-group><div class="pull-right"><button class="btn btn-success" ng-click="previousStep(currentStep)" ng-show="currentStep>1" ng-if="!trigger.triggerID">上一步</button> <button class="btn btn-info" ng-click="nextStep(currentStep)" ng-if="!trigger.triggerID">{{currentStep < 3?\'下一步\':\'完成\'}}</button></div></div></div>'),e.put("app/components/portal/TriggerManager/directives/select-multiple-source/select-multiple-source.template.html",'<div><uib-accordion close-others="true" class="multi-source"><uib-accordion-group heading="{{source.name ||(\'源-\' + ($index + 1))}}" ng-repeat="source in sources"><div ng-if="!disabled"><button class="btn btn-danger pull-right" ng-click="removeSource(source)"><span class="fa fa-remove"></span>删除源</button></div><source-picker my-source="source" disabled="disabled"></source-picker></uib-accordion-group></uib-accordion></div>'),e.put("app/components/portal/TriggerManager/directives/select-policy/select-policy.template.html",'<div class="select-policy text-left" ng-init="init()"><div class="form-group">当<div app-select="" options="policyOptions" selected-model="policy.groupPolicy" value-only="true" disabled="disabled"></div>的源设备的条件被满足时触发。</div><div class="form-group" ng-if="policy.groupPolicy==\'Some\'"><label>满足条件的设备数量：</label><div class="range-container"><range-slider min="0" max="thingNumber" ng-model="policy.criticalNumber" disabled="disabled"></range-slider>个设备</div></div><div class="form-group" ng-if="policy.groupPolicy==\'Percent\'"><label>满足条件的设备百分比：</label><div class="range-container"><range-slider min="0" max="100" ng-model="policy.criticalPercent" disabled="disabled"></range-slider>%</div></div></div>'),e.put("app/components/portal/TriggerManager/directives/select-schedule/select-schedule.template.html",'<div class="select-schedule text-left" ng-init="init()"><div class="form-group"><span>定时器类型</span><div app-select="" disabled="disabled" selected-model="schedule.type" value-only="true" options="scheduleTypes"></div></div><div class="form-group" ng-if="schedule.type != \'Cron\'"><table><tr><td><input type="text" ng-disabled="disabled" ng-model="schedule.interval" class="form-control"></td><td><div disabled="disabled" app-select="" selected-model="schedule.timeUnit" options="intervalUnits" value-only="true"></div></td></tr></table></div><div class="form-group" ng-if="schedule.type == \'Cron\'"><cron-selection ng-disabled="disabled" output="schedule.cron" init="initCron"></cron-selection></div></div>'),e.put("app/components/portal/TriggerManager/directives/select-source/select-source.template.html",'<div ng-init="init()"><div class="text-left clearfix"><div class="pull-left"><span>源类型</span><div app-select="" disabled="disabled" selected-model="mySource.sourceType" options="sourceTypes" class="input-group-btn" text="text" value-only="true"></div></div><div class="pull-left" style="margin-left: 50px" ng-if="mySource.sourceType == \'tag\'"><span>交并集</span><div app-select="" disabled="disabled" selected-model="mySource.andExpress" options="andExpressOptions" value-only="true"></div></div><div class="pull-left" style="margin-left: 50px" ng-if="mySource.sourceType == \'tag\'"><span>设备类型</span><multi-selector single="true" ng-if="!disabled" ng-model="mySource.selectedType" options="mySource.thingTypes" on-change="thingTypeChange"></multi-selector><button ng-if="disabled" disabled="disabled" class="btn btn-default">{{mySource.type}}</button></div></div><hr><div ng-if="!disabled"><div ng-show="mySource.sourceType ==\'thing\'"><thing-selector selected-things="mySource.thingList" selected-thing-types="mySource.thingTypes"></thing-selector></div><div ng-show="mySource.sourceType ==\'tag\'"><tag-selector selected-tags="mySource.tagList" tag-types="mySource.tagTypes"></tag-selector></div></div><div ng-if="disabled"><div ng-if="mySource.thingList.length>0">已选设备: {{mySource.thingList.join(\',\')}}</div><div ng-if="mySource.tagList.length>0">已选标签: {{mySource.tagList.join(\',\')}}</div></div></div>'),e.put("app/components/portal/TriggerManager/directives/single-trigger/single-trigger.template.html",'<div ng-init="init()"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="goStep(1)">1</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="goStep(2)">2</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="goStep(3)">3</div><label>触发命令</label></div></div></div><hr><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><uib-tabset><uib-tab heading="条件"><div class="trigger-when"><span>何时触发：</span><div app-select="" value-only="true" disabled="trigger.triggerID" selected-model="dataContainer.predicate.triggersWhen" options="triggerWhenConditions"></div></div><div><condition-tree disabled="trigger.triggerID" schema="dataContainer.sourceSchema.content.statesSchema.properties" result="dataContainer.predicate.condition"></condition-tree></div></uib-tab><uib-tab heading="定时器"><div class="form-group text-left"><label><input type="checkbox" ng-disabled="!!trigger.triggerID" ng-model="dataContainer.schedule.enabled">启用定时器</label></div><select-schedule ng-if="dataContainer.schedule.enabled" disabled="trigger.triggerID" schedule="dataContainer.schedule"></select-schedule></uib-tab></uib-tabset></uib-slide><uib-slide active="currentStep == 2"><div class="new-source" ng-click="createTarget()" ng-if="!trigger.triggerID"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker sources="dataContainer.myTargets" disabled="trigger.triggerID"></multi-source-picker></uib-slide><uib-slide active="currentStep == 3"><uib-accordion close-others="true" class="multi-source"><uib-accordion-group heading="{{\'命令-\' + ($index + 1)}}" ng-repeat="targetSchema in dataContainer.targetSchemas"><trigger-command disabled="trigger.triggerID" my-actions="targetSchema.content.actions"></trigger-command></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><trigger-control-group trigger="trigger"></trigger-control-group><div class="pull-right" ng-if="!trigger.triggerID"><button class="btn btn-success" ng-click="previousStep(currentStep)" ng-show="currentStep>1">上一步</button> <button class="btn btn-danger" ng-click="nextStep(currentStep)">{{currentStep < 3?\'下一步\':\'完成\'}}</button></div></div></div>'),e.put("app/components/portal/TriggerManager/directives/summary-trigger/summary-trigger.template.html",'<div ng-init="init()"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="currentStep = 1">1</div><div class="bar"></div><label>触发器源</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="currentStep = 2">2</div><div class="bar"></div><label>触发表达式</label></div><div class="wrap" ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="currentStep = 3">3</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>4, \'current\': currentStep==4, \'todo\': currentStep<4}"><div class="round" ng-click="currentStep = 4">4</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>5, \'current\': currentStep==5, \'todo\': currentStep<5}"><div class="round" ng-click="currentStep = 5">5</div><label>触发命令</label></div></div></div><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><div class="new-source" ng-click="createSource()"><span class="fa fa-plus"></span> 新建源</div><multi-source-picker sources="dataContainer.mySources"></multi-source-picker></uib-slide><uib-slide active="currentStep == 2"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{name}}" ng-repeat="(name, source) in trigger.summarySource"><div class="source-aggregation-settings"><table class="table"><thead><tr role="row"><th>字段名</th><th>聚合函数</th><th>聚合名</th><th>选择</th></tr></thead><tbody><tr ng-repeat="field in source.schema"><td>{{field.name}}</td><td><div app-select="" selected-model="field[\'function\']" disabled="!field._checked" value-only="true" options="aggregationFunctions"></div></td><td><input type="text" ng-model="field.summaryAlias" class="form-control" ng-disabled="!field._checked"></td><td><input type="checkbox" ng-model="field._checked"></td></tr></tbody></table></div></uib-accordion-group></uib-accordion></uib-slide><uib-slide active="currentStep == 3"><div class="trigger-when"><span>何时触发：</span><div app-select="" selected-model="myTrigger.predicate.triggersWhen" options="triggerWhenConditions"></div></div><div><condition-tree schema="summarySchema" result="dataContainer.summaryConditionClause"></condition-tree></div></uib-slide><uib-slide active="currentStep == 4"><div class="new-source" ng-click="createTarget()"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker ready="ready" dataset="dataset" sources="dataContainer.myTargets"></multi-source-picker></uib-slide><uib-slide active="currentStep == 5"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{ \'目标源-\' + ($index + 1) }}" ng-repeat="target in myTrigger.targets"><textarea type="text" class="form-control" ng-model="target.command"></textarea></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><button class="btn btn-danger pull-right margin-left" ng-click="nextStep(currentStep)">{{currentStep<5?\'下一步\':\'完成\'}}< button=""><button class="btn btn-success pull-right" ng-click="previousStep(currentStep)" ng-show="currentStep>1">上一步</button></5?\'下一步\':\'完成\'}}<></button></div><script type="text/ng-template" id="/app/components/TriggerManager/new-source.html"><div class="modal-content"> <div class="modal-header ng-scope"> <h3 class="modal-title">新增触发源</h3> </div> <div class="modal-body clearfix"> <div class="col-sm-12"> <div class="row portal-row clearfix"> <div class="col-sm-4">触发源名称</div> <div class="col-sm-8"><input ng-model="sourceName" type="text" class="form-control" placeholder="触发源名称" /></div> </div> </div> </div> <div class="modal-footer ng-scope"> <button class="btn btn-primary" type="button" ng-click="createSource(sourceName)" ng-disable="sourceName.length==0">确认</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button> </div> </div></script></div>'),e.put("app/components/portal/TriggerManager/directives/trigger-command/trigger-command.template.html",'<div class="text-left trigger-command"><div class="form-group"><label>可选命令：</label><div><multi-selector ng-model="selectedActions" options="actionOptions" disabled="disabled"></multi-selector></div></div><div class="form-group"><uib-accordion close-others="oneAtATime"><uib-accordion-group heading="{{action.label}}" ng-repeat="action in selectedActions"><table class="table"><thead><th>名称</th><th>种类</th><th>值</th><th>值域</th><th>描述</th><th>选择</th></thead><tbody><tr ng-repeat="(propertyKey, propertyValue) in action.action.in.properties"><td><span ng-if="!propertyValue.properties">{{propertyKey}}</span> <a ng-if="propertyValue.properties" style="cursor:pointer" ng-click="collapseControllers[propertyKey] = !collapseControllers[propertyKey]">{{propertyKey}}</a></td><td><code class="bg-primary">{{propertyValue.type}}</code></td><td><div class="clearfix pull-left"><div ng-if="propertyValue.type==\'boolean\'"><div switchery="propertyValue.value" yes-text="开" no-text="关" disabled="disabled"></div></div><div ng-if="propertyValue.type==\'string\'"><input class="form-control" type="text" ng-model="propertyValue.value" ng-disabled="disabled"></div><div ng-if="propertyValue.type==\'integer\' || propertyValue.type==\'float\'"><div ng-if="(propertyValue.minimum || propertyValue.minimum == 0) && (propertyValue.maximum || propertyValue.maximum == 0)" class="range-type"><div class="range-container"><input class="form-control" type="range" min="{{propertyValue.minimum}}" max="{{propertyValue.maximum}}" ng-model="propertyValue.value" step="{{propertyValue.type==\'integer\'?1: 0.01}}" ng-disabled="disabled"></div><input ng-model="propertyValue.value" class="form-control pull-left" type="text" ng-disabled="true"></div><div ng-if="(!propertyValue.minimum && propertyValue.minimum != 0) || (!propertyValue.maximum && propertyValue.maximum != 0)"><input class="form-control" type="number" ng-model="propertyValue.value" ng-disabled="disabled"></div></div></div></td><td><code ng-if="propertyValue.minimum || propertyValue.minimum == 0">{{\'> \' + propertyValue.minimum}}</code> <code ng-if="propertyValue.maximum || propertyValue.maximum == 0">{{\'< \' + propertyValue.maximum}}</code></td><td>{{propertyValue.description}}</td><td><input type="checkbox" ng-model="propertyValue._checked" ng-disabled="propertyRequired(propertyKey, myProperty.required) || disabled"></td></tr></tbody></table></uib-accordion-group></uib-accordion></div></div>'),e.put("app/components/portal/TriggerManager/directives/trigger-control-group/trigger-control-group.template.html",'<div class="form-group pull-left"><button class="btn btn-danger" ng-click="deleteTrigger(trigger)">删除触发器</button> <button class="btn btn-info" ng-if="trigger.recordStatus == \'disable\' && trigger.triggerID" ng-click="enableTrigger(trigger)">启用触发器</button> <button class="btn btn-info" ng-if="trigger.recordStatus != \'disable\' && trigger.triggerID" ng-click="disableTrigger(trigger)">禁用触发器</button></div>'),e.put("app/components/portal/UserManager/User/NewUser/NewUser.html",'<div class="app-portal-usermanager-user-newuser" ng-init="init()"><section class="panel"><header class="panel-heading">用户信息</header><div class="panel-body"><form novalidate="" name="newUserForm" ng-submit="createUser()"><table class="detail-content"><tr><td width="50px"><label>姓名</label></td><td><div class="input-group"><input type="text" class="form-control" placeholder="姓名" required="" ng-model="newUser.displayName"><div app-select="" selected-model="newUser.custom.sex" options="sexOptions" class="btn-group input-group-btn" text="text" value-only="true"></div></div></td><td width="50px"><label>角色</label></td><td><div app-select="" selected-model="newUser.roleName" value-only="true" options="ruleOptions"></div></td></tr></table><div class="form-group"><label>用户名</label> <input ng-model="newUser.userName" type="text" required="" class="form-control" placeholder="用户名"></div><div class="form-group"><label>公司</label> <input ng-model="newUser.company" type="text" class="form-control" placeholder="公司"></div><div class="form-group"><label>电话</label> <input type="text" class="form-control" placeholder="电话" ng-model="newUser.phone" required=""></div><div class="form-group"><label>邮箱地址</label> <input type="text" class="form-control" placeholder="邮箱地址" ng-model="newUser.mail" required=""></div><div class="form-group"><input type="submit" value="提交" name="submit" class="btn btn-danger pull-right"></div></form></div></section></div>'),e.put("app/components/portal/UserManager/User/SearchUser/SearchUser.html",'<div class="app-portal-usermanager-user-searchuser"><div ui-view=""></div></div>'),e.put("app/components/portal/UserManager/User/UserInfo/UserInfo.html",'<div class="app-portal-usermanager-user-userinfo" ng-init="init()"><section class="panel"><header class="panel-heading">用户信息</header><div class="panel-body"><div class="row portal-row clearfix"><div class="col-sm-4">姓名</div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" placeholder="姓名" ng-model="user.userName" ng-disabled="true"> <span class="btn-group input-group-btn"><button class="btn btn-default" disabled="">{{user.custom.sex.text}}</button></span></div></div></div><div class="row portal-row clearfix"><div class="col-sm-4">身份证</div><div class="col-sm-8"><input ng-model="user.userID" type="text" class="form-control" placeholder="身份证" ng-disabled="true"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">公司</div><div class="col-sm-8"><input ng-model="user.company" type="text" class="form-control" placeholder="身份证" ng-disabled="true"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">电话</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="电话" ng-model="user.phone" ng-disabled="true"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">邮箱地址</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="邮箱地址" ng-model="user.mail" ng-disabled="true"></div></div><div class="portal-row clearfix"><div class="pull-right"><button class="btn btn-danger" ng-click="editUser()">编辑</button> <button class="btn btn-danger" ng-click="deleteUser()">删除</button> <button class="btn btn-danger" ng-click="goThingAuth()">设备拥有权限</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/User/UserList/ActivateUser.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">激活用户</h3></div><div class="modal-body ng-scope"><form novalidate="" name="newUserForm"><div class="row portal-row clearfix"><div class="col-sm-4">姓名</div><div class="col-sm-8"><div class="input-group">{{user.userName}}</div></div></div><div class="row portal-row clearfix"><div class="col-sm-4">密码</div><div class="col-sm-8"><input ng-model="user.password" type="text" required="" class="form-control" placeholder="用户密码"></div></div></form></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="register()">激活</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/UserManager/User/UserList/UserList.html",'<div class="app-portal-usermanager-user-userlist" ng-init="init()"><section class="panel"><header class="panel-heading">业主信息</header><div class="panel-body"><div class="row"><div class="col-sm-6"><button class="btn btn-danger pull-left" ng-click="navigateTo(navMapping.NEW_USER)">新增业主+</button></div><div class="pull-right col-sm-6"><div class="row"><div class="col-sm-4"><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button></span></div></div></div></div></div></div><div class="panel-body"><table class="table table-striped table-bordered table-hover dataTable no-footer break-word"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">业主ID</th><th class="sorting" rowspan="1" colspan="1">业主姓名</th><th class="sorting" rowspan="1" colspan="1">性别</th><th class="sorting" rowspan="1" colspan="1">邮箱</th><th class="sorting" rowspan="1" colspan="1">电话</th><th class="sorting" rowspan="1" colspan="1">公司</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="user in userListForDisplay" context-menu="myMenu" target="user"><td>{{user.userID}}</td><td>{{user.userName}}</td><td>{{user.custom.sex}}</td><td>{{user.mail}}</td><td>{{user.phone}}</td><td class="center">{{user.company}}</td></tr></tbody></table><div class="pull-right"><pagion collection="userList" display="userListForDisplay"></pagion></div></div></section></div>'),e.put("app/components/portal/UserManager/User/UserThingACL/UserThingACL.html",'<div class="app-portal-usermanager-userthingacl" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-selector selected-things="selectedThings"></thing-selector></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/User/UserThingAuthority/UserThingAuthority.html",'<div class="app-portal-usermanager-userthingauthority" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div><span ng-repeat="thing in ownThings" class="btn btn-info username">{{user.userName}} <span class="fa fa-remove" ng-click="removeThing(user, thing)"></span></span></div><div class="portal-row clearfix"><thing-selector selected-things="selectedThings"></thing-selector></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger" ng-click="addThings(selectedThings)">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupEditor/GroupEditor.html",'<div class="app-portal-usermanager-usergroup-groupeditor" ng-init="init()"><section class="panel"><header class="panel-heading">群组信息</header><div class="panel-body"><div class="form-group"><label>群组名称</label> <input ng-model="group.userGroupName" type="text" class="form-control" placeholder="群组名称" ng-disabled="!isOwner"></div><div class="form-group"><label>描述</label> <input ng-model="group.description" type="text" class="form-control" placeholder="描述" ng-disabled="!isOwner"></div><hr><div class="clearfix" ng-if="isOwner"><button class="btn btn-success pull-right" ng-click="saveGroup()">保存</button></div></div></section><section class="panel"><div class="panel-heading">群组资源</div><div class="panel-body"><uib-tabset><uib-tab heading="用户"><div class="clearfix form-group"><span ng-repeat="user in group._users" class="btn btn-info username">{{user.userName}} <span class="fa fa-remove" ng-if="isOwner && user.userID != credential.userID" ng-click="removeUser(user, group)"></span></span></div><div class="form-group" ng-if="isOwner"><table><tr><td><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></td><td><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button></span></div></td></tr></table></div><table ng-if="isOwner" class="table table-striped table-bordered table-hover dataTable no-footer break-word"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">业主ID</th><th class="sorting" rowspan="1" colspan="1">业主姓名</th><th class="sorting" rowspan="1" colspan="1">性别</th><th class="sorting" rowspan="1" colspan="1">邮箱</th><th class="sorting" rowspan="1" colspan="1">电话</th><th class="sorting" rowspan="1" colspan="1">公司</th><th class="sorting" rowspan="1" colspan="1">操作</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="user in dataset.userListForDisplay"><td>{{user.userID}}</td><td>{{user.userName}}</td><td>{{user.custom.sex.text}}</td><td>{{user.mail}}</td><td>{{user.phone}}</td><td class="center">{{user.company}}</td><td align="center"><button class="btn btn-success" ng-click="addUser(user,group)">添加</button></td></tr></tbody></table><div class="pull-right" ng-if="isOwner"><pagion collection="userList" display="dataset.userListForDisplay"></pagion></div></uib-tab><uib-tab heading="设备组"><div class="clearfix form-group"><span ng-repeat="tag in group.tags" class="btn btn-info username">{{tag.displayName}} <span ng-if="isCreator(tag)" class="fa fa-remove" ng-click="removeTag(tag, group)"></span></span></div><div><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">标签名</th><th class="sorting" rowspan="1" colspan="1">设备数</th><th class="sorting" rowspan="1" colspan="1" width="80px">操作</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="tag in tagsForDisplay"><td>{{tag.displayName}}</td><td>{{tag.count}}</td><td align="center"><button class="btn btn-success" ng-click="addTag(tag, group)">添加</button></td></tr></tbody></table><div class="pull-right"><pagion collection="tags" display="tagsForDisplay"></pagion></div></div></uib-tab><uib-tab heading="设备"><div class="clearfix form-group"><span ng-repeat="thing in group.things" class="btn btn-info username">{{thing.vendorThingID}} <span ng-if="isCreator(thing)" class="fa fa-remove" ng-click="removeThing(thing, group)"></span></span></div><thing-selector selected-things="selectedThings"></thing-selector><hr><div class="pull-right"><button class="btn btn-success" ng-click="addThings(selectedThings, group)">添加设备</button></div></uib-tab></uib-tabset></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupThingACL/GroupThingACL.html",'<div class="app-portal-usermanager-groupthingacl" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-picker existing-nodes="ownThings" selected-nodes="selectedThings" settings="settings" ready="ready"></thing-picker></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupThingAuthority/GroupThingAuthority.html",'<div class="app-portal-usermanager-groupthingauthority" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-picker existing-nodes="ownThings" selected-nodes="selectedThings" settings="settings" ready="ready"></thing-picker></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupUserList/AddUser.template.html",'<div class="modal-content"><div class="modal-header"><h3 class="modal-title">添加用户</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">查询用户</div><div class="col-sm-8"><div class="input-group"><div class="btn-group input-group-btn" uib-dropdown=""><button id="search-filter" type="button" class="btn btn-default" uib-dropdown-toggle="">用户名<span class="caret"></span></button><ul class="dropdown-menu" role="menu" aria-labelledby="search-filter"><li role="menuitem"><a>用户名</a></li><li role="menuitem"><a>ID</a></li></ul></div><input type="text" class="form-control" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button">Go!</button></span></div></div></div></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupUserList/GroupUserList.html",'<div class="app-portal-usermanager-usergroup-groupuserlist" ng-init="init()"><section class="panel"><header class="panel-heading">用户列表</header><div class="panel-body"><div class="clearfix portal-row row"><div class="col-sm-6"><span>群组名称：</span> <span>{{userGroup.name}}</span></div><div class="pull-right col-sm-6"><div class="input-group"><div class="btn-group input-group-btn" uib-dropdown=""><button id="search-filter" type="button" class="btn btn-default" uib-dropdown-toggle="">用户名<span class="caret"></span></button><ul class="dropdown-menu" role="menu" aria-labelledby="search-filter"><li role="menuitem"><a>用户名</a></li><li role="menuitem"><a>ID</a></li></ul></div><input type="text" class="form-control" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button">Go!</button></span></div></div></div><div class="portal-row"><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">ID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">用户名</th><th class="sorting" rowspan="1" colspan="1">邮箱</th><th class="sorting" rowspan="1" colspan="1">电话</th><th class="sorting" rowspan="1" colspan="1">地址</th><th class="sorting" rowspan="1" colspan="1">状态</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="user in userListForDisplay" context-menu="myMenu" target="user"><td>{{user.userID}}</td><td class="sorting_1">{{user.userName}}</td><td>{{user.email}}</td><td>{{user.phone}}</td><td class="center">{{user.address}}</td><td class="center">{{user.status}}</td></tr></tbody></table><div class="pull-right"><pagion collection="userList" display="userListForDisplay"></pagion></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/ResourceAuthority/ResourceAuthority.html",'<div class="app-portal-usermanager-usergroup-resourceauthority"><div ui-view=""></div></div>'),e.put("app/components/portal/UserManager/UserGroup/UserGroupList/NewUserGroup.template.html",'<div class="modal-content app-portal-usermanager-usergroup-usergrouplist"><div class="modal-header"><h3 class="modal-title">新增群组</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">群组名称</div><div class="col-sm-8"><input ng-model="newGroup.userGroupName" type="text" class="form-control" placeholder="群组名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">描述</div><div class="col-sm-8"><input ng-model="newGroup.description" type="text" class="form-control" placeholder="描述"></div></div></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">提交</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/UserManager/UserGroup/UserGroupList/UserGroupList.html",'<div class="app-portal-usermanager-usergroup-usergrouplist" ng-init="init()"><div class="panel"><div class="panel-body"><div app-select="" selected-model="groupType" options="groupTypes" class="input-group-btn" text="text"></div></div></div><div class="panel"><div class="panel-body"><div class="row clearfix"><div class="col-sm-6"><button class="btn btn-danger" ng-click="createGroup()">新增群组+</button></div><div class="pull-right col-sm-6"><div class="col-sm-4"><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUserGroups(queryFiled.value, searchValue)">Go!</button></span></div></div></div></div></div></div><div class="portal-row"><div class="modules-outputs-content graph-tile" ng-repeat="group in dataset.userGroupsForDisplay"><div class="module-top"><div class="overlay" ng-click="goUserList(group)"><div class="viewReport">查看</div></div><div class="outputs-content-img"><img ng-src="{{\'images/group.jpg\'}}"></div></div><div class="moduleDetails"><div class="per-info"><span class="info">{{group.userGroupName}}</span></div><div class="modulesActionBottom"><div class="item action-button" ng-click="goThingAuth(group)"><span class="fa fa-cloud-download"></span> <span class="item-text">设置权限</span></div></div></div><div class="modulesActionsTop"><i class="fa fa-pencil-square-o" uib-tooltip="编辑" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top" ng-click="goEdit(group)"></i> <i class="fa fa-trash-o" ng-click="deleteGroup(group)" uib-tooltip="删除" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top"></i></div></div></div><div class="pull-right"><pagion collection="dataset.userGroups" display="dataset.userGroupsForDisplay"></pagion></div></div>'),e.put("app/components/portal/ScenarioManager/OfficeAtmosphere/directives/devicePanel/devicePanel.html",'<div class="popover device-panel" role="tooltip"><div class="arrow"></div><div class="clearfix body-content"><hr><div class="pull-right"><button class="btn btn-success">保存</button> <button class="btn btn-default" ng-click="cancelOnClick($event)">取消</button></div></div></div>'),e.put("app/components/portal/ScenarioManager/OfficeAtmosphere/directives/oaMctrl/oaMctrl.template.html",'<div class="popover oa-mctrl" role="tooltip"><div class="arrow"></div><div class="clearfix body-content"><div class="pull-left"><div class="input-group"><span class="input-group-addon">重复</span><div app-select="" options="dateTypeOptions" selected-model="selectedDateType"></div></div></div><div class="pull-left"><mdp-time-picker ng-model="currentDate"></mdp-time-picker></div><div class="pull-right"><button class="btn btn-success" ng-click="saveOnClick($event)">保存</button> <button class="btn btn-default" ng-click="cancelOnClick($event)">取消</button></div></div></div>'),e.put("app/components/portal/ScenarioManager/OfficeAtmosphere/directives/oaPctrl/oaPctrl.template.html",'<div class="popover oa-pctrl" role="tooltip"><div class="arrow"></div><div class="clearfix body-content"><condition-tree schema="input.schema.properties" result="outputData.result"></condition-tree><hr><div class="pull-right"><button class="btn btn-success">保存</button> <button class="btn btn-default" ng-click="cancelOnClick($event)">取消</button></div></div></div>'),e.put("app/components/portal/ThingViews/TypeView/directives/property-tree/property-tree.template.html",'<div><div class="form-group"><label>名称</label><div>{{myProperty.title}}</div></div><div class="form-group"><label>属性</label><table class="table"><thead><th>名称</th><th>种类</th><th>值域</th><th>描述</th><th>必须</th></thead><tbody><tr ng-repeat-start="(propertyKey, propertyValue) in myProperty.properties"><td><span ng-if="!propertyValue.properties">{{propertyKey}}</span> <a ng-if="propertyValue.properties" style="cursor:pointer" ng-click="collapseControllers[propertyKey] = !collapseControllers[propertyKey]">{{propertyKey}}</a></td><td><code class="bg-primary">{{propertyValue.type}}</code></td><td><code ng-if="propertyValue.minimum || propertyValue.minimum == 0">{{\'> \' + propertyValue.minimum}}</code> <code ng-if="propertyValue.maximum || propertyValue.maximum == 0">{{\'< \' + propertyValue.maximum}}</code></td><td>{{propertyValue.description}}</td><td><span class="fa" ng-class="propertyRequired(propertyKey, myProperty.required)?\'fa-check text-success\': \'fa-remove text-danger\'"></span></td></tr><tr ng-repeat-end=""><td colspan="5" ng-if="propertyValue.properties" ng-show="collapseControllers[propertyKey]" style="background: rgba(0,0,0,0.05); padding-left:20px;"><div uib-collapse="!collapseControllers[propertyKey]"><property-tree my-property="propertyValue"></property-tree></div></td></tr></tbody></table></div></div>')
}]);