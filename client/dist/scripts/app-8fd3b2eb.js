!function(){var e=function(){Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=i.length;return function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var s=[];for(var o in r)e.call(r,o)&&s.push(o);if(t)for(var a=0;n>a;a++)e.call(r,i[a])&&s.push(i[a]);return s}}()),/**@license MIT-promiscuous library-©2013 Ruben Verborgh*/
"undefined"==typeof Promise&&/**@license MIT-promiscuous-©Ruben Verborgh*/
!function(e,t){function i(e,t){return(typeof t)[0]==e}function n(s,o){return o=function a(l,u,c,p,d,g){function h(e){return function(t){d&&(d=0,a(i,e,t))}}if(p=a.q,l!=i)return n(function(e,t){p.push({p:this,r:e,j:t,1:l,0:u})});if(c&&i(e,c)|i(t,c))try{d=c.then}catch(m){u=0,c=m}if(i(e,d))try{d.call(c,h(1),u=h(0))}catch(m){u(m)}else for(o=function(t,o){return i(e,t=u?t:o)?n(function(e,i){r(this,e,i,c,t)}):s},g=0;g<p.length;)d=p[g++],i(e,l=d[u])?r(d.p,d.r,d.j,c,l):(u?d.r:d.j)(c)},o.q=[],s.call(s={then:function(e,t){return o(e,t)},"catch":function(e){return o(0,e)}},function(e){o(i,1,e)},function(e){o(i,0,e)}),s}function r(n,r,s,o,a){setTimeout(function(){try{o=a(o),a=o&&i(t,o)|i(e,o)&&o.then,i(e,a)?o==n?s(TypeError()):a.call(o,r,s):r(o)}catch(l){s(l)}})}function s(e){return n(function(t){t(e)})}Promise=n,n.resolve=s,n.reject=function(e){return n(function(t,i){i(e)})},n.all=function(e){return n(function(t,i,n,r){r=[],n=e.length||t(r),e.map(function(e,o){s(e).then(function(e){r[o]=e,--n||t(r)},i)})})}}("f","o");var e,t,i,n,r,s,o,a,l,u,c,p,d,g,h,m,f,v=function(e,t){return function(){return e.apply(t,arguments)}},_=function(e,t){function i(){this.constructor=e}for(var n in t)y.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},y={}.hasOwnProperty;return f="undefined"!=typeof exports&&null!==exports?new Object:this,f.KiiSocialNetworkName={FACEBOOK:1,TWITTER:2,QQ:3,GOOGLEPLUS:4,RENREN:5},f.KiiSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api",CN3:"https://api-cn3.kii.com/api"},f.Kii=function(){function e(){}var t,i;return i=null,t=null,e.getBuildNumber=function(){return"1"},e.getSDKVersion=function(){return"2.3.0"},e.getBaseURL=function(){return i._baseURL},e.getAppID=function(){return i._appID},e.getAdditionalHeaders=function(){return t},e.setAdditionalHeaders=function(e){return t=e},e.getAppKey=function(){return i._appKey},e.isLogging=function(){return i._logging},e.setLogging=function(e){return i._logging=e,f.Kii.logger("Setting logging: "+e),f.Kii.logger("Base URL: "+i._baseURL)},e.setAccessTokenExpiration=function(e){if(!i)throw new f.IllegalStateException("Kii is not initialized");if(isNaN(parseInt(e,10)))throw new f.InvalidArgumentException("expiresIn should be a number");if(0>e)throw new f.InvalidArgumentException("expiresIn should not negative number");return i?i._expiresIn=e:void 0},e.getAccessTokenExpiration=function(){if(!i)throw new f.IllegalStateException("Kii is not initialized");return i._expiresIn},e.initializeWithSite=function(e,t,n,r){return i=new g(e,t,n),f.Kii.logger("Initialized "+e+", "+t+", "+n),"object"===u._type(r)?f.KiiAnalytics._initializeWithSite(e,t,n,r.deviceId):void 0},e.initialize=function(e,t,i){return f.Kii.initializeWithSite(e,t,f.KiiSite.US,i)},e.logger=function(e){return i._logging?console.log(e):void 0},e.bucketWithName=function(e){var t;return t=new f.KiiBucket(e,null)},e.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucket(e,null)},e.groupWithName=function(e){return new f.Kii.groupWithNameAndMembers(e,null)},e.groupWithNameAndMembers=function(e,t){return new f.KiiGroup.groupWithNameAndMembers(e,t)},e.logOut=function(){return i._currentUser=null,f.KiiSocialConnect.logOutAll()},e.loggedIn=function(){return null!=i._currentUser},e.getCurrentUser=function(){var e;return null!=i._currentUser?(e=new f.KiiUser,e._uuid=i._currentUser._uuid,e._username=i._currentUser._username,e._displayName=i._currentUser._displayName,e._password=i._currentUser._password,e._emailAddress=i._currentUser._emailAddress,e._phoneNumber=i._currentUser._phoneNumber,e._country=i._currentUser._country,e._created=i._currentUser._created,e._modified=i._currentUser._modified,e._emailVerified=i._currentUser._emailVerified,e._phoneVerified=i._currentUser._phoneVerified,e._accessToken=i._currentUser._accessToken,e._customInfo=i._currentUser._customInfo,e._expiresAt=i._currentUser._expiresAt,e._thirdPartyAccounts=i._currentUser._thirdPartyAccounts,e._disabled=i._currentUser._disabled,f.Kii.logger("my instance:"),f.Kii.logger(e),e):null},e.setCurrentUser=function(e){return i._currentUser=new f.KiiUser,i._currentUser._uuid=e._uuid,i._currentUser._username=e._username,i._currentUser._displayName=e._displayName,i._currentUser._password=e._password,i._currentUser._emailAddress=e._emailAddress,i._currentUser._phoneNumber=e._phoneNumber,i._currentUser._country=e._country,i._currentUser._created=e._created,i._currentUser._modified=e._modified,i._currentUser._emailVerified=e._emailVerified,i._currentUser._phoneVerified=e._phoneVerified,i._currentUser._accessToken=e._accessToken,i._currentUser._customInfo=e._customInfo,i._currentUser._expiresAt=e._expiresAt,i._currentUser._thirdPartyAccounts=e._thirdPartyAccounts,i._currentUser._disabled=e._disabled,f.Kii.logger("my instance:"),f.Kii.logger(i._currentUser)},e.authenticateAsAppAdmin=function(e,t,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(u._Error(arguments[0]))}},n._authenticateAsAppAdminUsingCallbacks(e,t,o)}}(this))},e._authenticateAsAppAdminUsingCallbacks=function(e,t,i){var n,r;return r=new o("/oauth2/token",!1),r.setAnonymous(!0),r.setMethod("POST"),r.setData({client_id:e,client_secret:t}),n={success:function(){return function(e){var t,n,r;return r=e.access_token,n=e.id,f.Kii.logger("token: "+r),f.Kii.logger("id: "+n),t=new f.KiiAppAdminContext({token:r,id:n}),null!=i?i.success(t):void 0}}(this),failure:function(){return function(e,t){return f.Kii.logger("error: "+e),f.Kii.logger("statusCode: "+t),null!=i?i.failure(e,t):void 0}}(this)},r.execute(n,!1)},e.authenticateAsAdminWithToken=function(e){return new f.KiiAppAdminContext({token:e})},e.serverCodeEntry=function(e){if(!u._validateServerCodeEntryName(e))throw new f.InvalidArgumentException("entryName is invalid");return new f.KiiServerCodeEntry(e)},e.serverCodeEntryWithVersion=function(e,t){if(!u._validateServerCodeEntryName(e))throw new f.InvalidArgumentException("entryName is invalid");if(!u._validateServerCodeEnryVersion(t))throw new f.InvalidArgumentException("version is invalid");return new f.KiiServerCodeEntry(e,t)},e._setHttpRequestType=function(e){return f.Kii.logger("Set http request as "+e),i._httpRequestType=e},e._getHttpRequestType=function(){return i._httpRequestType},e._getKiiUtilities=function(){return u},e.topicWithName=function(e){var t;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return t=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID(),new f.KiiTopic(t,e)},e.listTopics=function(t,i){return e._listTopics(t,i)},e._listTopics=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=t&&t.success.apply(t,arguments),r(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),s(arguments[0])}},e._listTopicsUsingCallbacks(o,i,n)})},e._listTopicsUsingCallbacks=function(t,i,n){var r,s,o;return s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/topics","string"==typeof i&&""!==i&&(s=s+"?paginationKey="+encodeURIComponent(i)),o=p.createXHRWrapper("GET",s),o.setKiiHeaders(),null!=n?o.setAuthToken(n._getToken()):o.setCurrentUserToken(),r={success:function(){var i,n,r,s,a,l;for(n=JSON.parse(o.xhr.responseText),l=[],s=n.topics,i=0,r=s.length;r>i;i++)a=s[i],l.push(e.topicWithName(a.topicID));return null!=t?t.success(l,void 0===n.paginationKey?null:n.paginationKey):void 0},failure:function(){var i,n;return n=o.getErrorString("list topics"),i=u._Error(n,e),null!=t?t.failure(i):void 0}},o.send(r)},e}(),f._KiiHttpRequestType={jQuery:"jQuery",XMLHttpRequest:"XMLHttpRequest",Titanium:"Titanium"},g=function(){function e(e,t,i){this._appKey=t,this._appID=e,this._baseURL=i,this._expiresIn=0}return e.prototype._logging=!1,e.prototype._baseURL=null,e.prototype._currentUser=null,e.prototype._httpRequestType=null,e}(),f.KiiACL=function(){function e(){this._thingWithID=v(this._thingWithID,this),this._userWithID=v(this._userWithID,this),this._groupWithID=v(this._groupWithID,this),this._getRequest=v(this._getRequest,this),this._saveItr=v(this._saveItr,this),this._saveUsingCallbacks=v(this._saveUsingCallbacks,this),this.save=v(this.save,this),this._getKeyOfEntry=v(this._getKeyOfEntry,this),this.removeACLEntry=v(this.removeACLEntry,this),this.putACLEntry=v(this.putACLEntry,this),this._listACLEntriesUsingCallbacks=v(this._listACLEntriesUsingCallbacks,this),this.listACLEntries=v(this.listACLEntries,this),this.aclPath=v(this.aclPath,this),this._setParent=v(this._setParent,this),this._entriesMap={}}return e.prototype._setParent=function(e){this._parent=e},e.prototype.aclPath=function(){var e,t,i,n,r,s,o,a,l,u;return this._parent instanceof f.KiiObject?(n=this._parent,null!=n.getBucket().getUser()?u=n.getBucket().getUser():null!=n.getBucket().getGroup()?i=n.getBucket().getGroup():null!=n.getBucket().getThing()&&(a=n.getBucket().getThing()),t=n.getBucket()._getQualifiedBucketName(),r=n.getUUID()):this._parent instanceof f.KiiBucket?(e=this._parent,null!=e.getUser()?u=e.getUser():null!=e.getGroup()?i=e.getGroup():null!=e.getThing()&&(a=e.getThing()),t=e._getQualifiedBucketName()):this._parent instanceof f.KiiTopic?l=this._parent:f.Kii.logger("Invalid ACL parent. Must belong to a KiiObject"),s="/",null!=i?s+="groups/"+i.getUUID()+"/":null!=u?s+="users/"+u.getUUID()+"/":null!=a&&(s+="things/"+a.getThingID()+"/"),l?(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/",0!==l._uri.indexOf(o)?s=null:s+=l._uri.substr(o.length)+"/acl"):s+=null!=r?"buckets/"+t+"/objects/"+r+"/acl":"buckets/"+t+"/acl",s},e.prototype.listACLEntries=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._listACLEntriesUsingCallbacks(r)}}(this))},e.prototype._listACLEntriesUsingCallbacks=function(e){var t,i;return f.Kii.logger("Listing ACL entries"),i=this._getRequest({path:this.aclPath(),withApp:!0}),t={success:function(t){return function(i,n){var r,s,o,a,l,u,c,p;if(300>n&&n>=200){u=[];for(a in i)for(p=i[a],"WRITE_EXISTING_OBJECT"===a?r=f.KiiACLAction.KiiACLObjectActionWrite:"READ_EXISTING_OBJECT"===a?r=f.KiiACLAction.KiiACLObjectActionRead:"QUERY_OBJECTS_IN_BUCKET"===a?r=f.KiiACLAction.KiiACLBucketActionQueryObjects:"CREATE_OBJECTS_IN_BUCKET"===a?r=f.KiiACLAction.KiiACLBucketActionCreateObjects:"DROP_BUCKET_WITH_ALL_CONTENT"===a?r=f.KiiACLAction.KiiACLBucketActionDropBucket:"SUBSCRIBE_TO_TOPIC"===a?r=f.KiiACLAction.KiiACLSubscribeToTopic:"SEND_MESSAGE_TO_TOPIC"===a&&(r=f.KiiACLAction.KiiACLSendMessageToTopic),o=0,l=p.length;l>o;o++)s=p[o],null!=s.groupID?c=t._groupWithID(s.groupID):null!=s.userID?c=t._userWithID(s.userID):null!=s.thingID&&(c=t._thingWithID(s.thingID)),u.push(f.KiiACLEntry.entryWithSubject(c,r));return e.success(t,u)}return e.failure(t,"Unable to retrieve ACL list")}}(this),failure:function(t){return function(i){return e.failure(t,i)}}(this)},i.execute(t,!1)},e.prototype.putACLEntry=function(e){var t;if(!(e instanceof f.KiiACLEntry))throw new f.InvalidArgumentException("invalid entry");return t=this._getKeyOfEntry(e),this._entriesMap[t]=e},e.prototype.removeACLEntry=function(e){var t;if(!(e instanceof f.KiiACLEntry))throw new f.InvalidArgumentException("invalid entry");return t=this._getKeyOfEntry(e),delete this._entriesMap[t]},e.prototype._getKeyOfEntry=function(e){var t,i,n;return t=e.getActionString(),i=e.getEntityString(),n=e.getGrant(),t+"/"+i+":"+n},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._saveUsingCallbacks(r)}}(this))},e.prototype._saveUsingCallbacks=function(e){var t;return f.Kii.logger("SAving acl"),this._entriesMap?(t=Object.keys(this._entriesMap),f.Kii.logger("Saving total entries : "+t.length),t.length<1?void e.failure(this,"There is no entry to save."):this._saveItr(t,0,e)):void e.failure(this,"There is no entry to save.")},e.prototype._saveItr=function(e,t,i){var n,r,s,o;return r=this._entriesMap[e[t]],s=this.aclPath()+"/"+r.getActionString()+"/"+r.getEntityString(),f.Kii.logger("Saving single @path: "+s),f.Kii.logger("Saving  entries index : "+t),o=this._getRequest({path:s,withApp:!0}),o.setMethod(r.getGrant()===!0?"PUT":"DELETE"),n=null,o.execute({success:function(n){return function(){return n.removeACLEntry(r),t<e.length-1?n._saveItr(e,t+1,i):i.success(n)}}(this),failure:function(e){return function(t){return i.failure(e,t)}}(this)},!1)},e.aclWithParent=function(e){var t;return t=new f.KiiACL,t._setParent(e),t},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._groupWithID=function(e){var t;return t=f.KiiGroup.groupWithID(e)},e.prototype._userWithID=function(e){return"ANONYMOUS_USER"===e?new f.KiiAnonymousUser:"ANY_AUTHENTICATED_USER"===e?new f.KiiAnyAuthenticatedUser:f.KiiUser.userWithID(e)},e.prototype._thingWithID=function(e){return f.KiiThing.thingWithID(e)},e}(),f.KiiACLAction={KiiACLActionStart:-1,KiiACLBucketActionCreateObjects:0,KiiACLBucketActionQueryObjects:1,KiiACLBucketActionDropBucket:2,KiiACLObjectActionRead:3,KiiACLObjectActionWrite:4,KiiACLSubscribeToTopic:5,KiiACLSendMessageToTopic:6,KiiACLActionEnd:7},f.KiiACLEntry=function(){function e(){this.getEntityString=v(this.getEntityString,this),this.getActionString=v(this.getActionString,this),this.getGrant=v(this.getGrant,this),this.setGrant=v(this.setGrant,this),this.getSubject=v(this.getSubject,this),this.setSubject=v(this.setSubject,this),this.getAction=v(this.getAction,this),this.setAction=v(this.setAction,this),this._action=-1,this._grant=!0}return e.prototype.setAction=function(e){if(e>f.KiiACLAction.KiiACLActionStart&&e<f.KiiACLAction.KiiACLActionEnd)return this._action=e;throw new f.InvalidACLAction},e.prototype.getAction=function(){return this._action},e.prototype.setSubject=function(e){if(e instanceof f.KiiGroup&&null!=e.getID()||e instanceof f.KiiUser&&null!=e.getID()||e instanceof f.KiiAnyAuthenticatedUser||e instanceof f.KiiAnonymousUser||e instanceof f.KiiThing&&null!=e.getThingID())return this._subject=e;throw new f.InvalidACLSubject},e.prototype.getSubject=function(){return this._subject},e.prototype.setGrant=function(e){if(e===!0||e===!1)return this._grant=e;throw new f.InvalidACLGrant},e.prototype.getGrant=function(){return this._grant},e.entryWithSubject=function(e,t){var i;return f.Kii.logger("EWS: "+e+", "+t),i=new f.KiiACLEntry,i.setSubject(e),i.setAction(t),i},e.prototype.getActionString=function(){var e;switch(f.Kii.logger("Action: "+this.action),this._action){case f.KiiACLAction.KiiACLBucketActionCreateObjects:e="CREATE_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionQueryObjects:e="QUERY_OBJECTS_IN_BUCKET";break;case f.KiiACLAction.KiiACLBucketActionDropBucket:e="DROP_BUCKET_WITH_ALL_CONTENT";break;case f.KiiACLAction.KiiACLObjectActionRead:e="READ_EXISTING_OBJECT";break;case f.KiiACLAction.KiiACLObjectActionWrite:e="WRITE_EXISTING_OBJECT";break;case f.KiiACLAction.KiiACLSubscribeToTopic:e="SUBSCRIBE_TO_TOPIC";break;case f.KiiACLAction.KiiACLSendMessageToTopic:e="SEND_MESSAGE_TO_TOPIC";break;default:return e}return e},e.prototype.getEntityString=function(){var e,t;return this._subject instanceof f.KiiGroup?(e=this._subject.getUUID(),t="GroupID"):this._subject instanceof f.KiiUser?(e=this._subject.getUUID(),t="UserID"):this._subject instanceof f.KiiAnyAuthenticatedUser?(t="UserID",e="ANY_AUTHENTICATED_USER"):this._subject instanceof f.KiiAnonymousUser?(t="UserID",e="ANONYMOUS_USER"):this._subject instanceof f.KiiThing&&(t="ThingID",e=this._subject.getThingID()),t+":"+e},e}(),f.KiiBucket=function(){function e(e,t){if(this.objectWithJSON=v(this.objectWithJSON,this),this._getHttpUri=v(this._getHttpUri,this),this._generatePath=v(this._generatePath,this),this._getRequest=v(this._getRequest,this),this._deleteUsingCallbacks=v(this._deleteUsingCallbacks,this),this["delete"]=v(this["delete"],this),this.count=v(this.count,this),this._countWithQueryUsingCallbacks=v(this._countWithQueryUsingCallbacks,this),this.countWithQuery=v(this.countWithQuery,this),this._executeQueryUsingCallbacks=v(this._executeQueryUsingCallbacks,this),this.executeQuery=v(this.executeQuery,this),this.acl=v(this.acl,this),this.createObjectWithID=v(this.createObjectWithID,this),this.createObjectWithType=v(this.createObjectWithType,this),this.createObject=v(this.createObject,this),this._getQualifiedBucketName=v(this._getQualifiedBucketName,this),this._setBucketName=v(this._setBucketName,this),this.getBucketName=v(this.getBucketName,this),this.getThing=v(this.getThing,this),this.getGroup=v(this.getGroup,this),this.getUser=v(this.getUser,this),!u._isNonEmptyString(e))throw f.InvalidArgumentException("Specified bucket name is null or empty.");this._bucketName=e,null!=t&&(t instanceof f.KiiGroup?this._group=t:t instanceof f.KiiUser?this._user=t:t instanceof f.KiiThing&&(this._thing=t))}return e.prototype._className="KiiBucket",e.prototype.getUser=function(){return this._user},e.prototype.getGroup=function(){return this._group},e.prototype.getThing=function(){return this._thing},e.prototype.getBucketName=function(){return this._bucketName},e.prototype._setBucketName=function(e){this._bucketName=e},e.prototype._getQualifiedBucketName=function(){return this._bucketName},e.prototype.createObject=function(){return f.KiiObject.objectWithBucket(this,null)},e.prototype.createObjectWithType=function(e){return f.KiiObject.objectWithBucket(this,e)},e.prototype.createObjectWithID=function(e){if(!f.KiiObject.isValidObjectID(e))throw f.InvalidArgumentException("Specified obejctID is invalid.");return f.KiiObject.objectWithID(this,e)},e.prototype.acl=function(){return f.KiiACL.aclWithParent(this)},e.prototype.executeQuery=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._executeQueryUsingCallbacks(e,s)}}(this))},e.prototype._executeQueryUsingCallbacks=function(e,t){var i,n,r,s;return r=this._generatePath()+"/query",i={},null!=e?i=e._dictValue():i.bucketQuery={clause:f.KiiQuery._emptyDictValue()},s=this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.QueryRequest+json"),s.setData(i),n={success:function(i){return function(n,r){var s,o,a,l,u,c;if(300>r&&r>=200){for(c=[],l=n.results,s=0,o=l.length;o>s;s++)u=l[s],c.push(i.objectWithJSON(u));if(null!=n.nextPaginationKey?(a=new f.KiiQuery(e),a.setPaginationKey(n.nextPaginationKey)):a=null,null!=t)return t.success(e,c,a)}else if(null!=t)return t.failure(i,"Unable to parse response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},s.execute(n,!1)},e.prototype.countWithQuery=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._countWithQueryUsingCallbacks(e,s)}}(this))},e.prototype._countWithQueryUsingCallbacks=function(e,t){var i,n,r,s;return r=this._generatePath()+"/query",i={},null!=e?i=e._dictValue():(i.bucketQuery={clause:f.KiiQuery._emptyDictValue()},e=f.KiiQuery.queryWithClause()),i.bucketQuery.aggregations=[{type:"COUNT",putAggregationInto:"count_field"}],s=this._getRequest({path:r,withApp:!0}),s.setMethod("POST"),s.setContentType("application/vnd.kii.QueryRequest+json"),s.setData(i),n={success:function(i){return function(n,r){var s;if(300>r&&r>=200){if(s=n.aggregations.count_field,null!=t)return t.success(i,e,s)}else if(null!=t)return t.failure(i,"Unable to parse response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},s.execute(n,!1)},e.prototype.count=function(e){var t;return t=f.KiiQuery.queryWithClause(),this.countWithQuery(t,e)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i;return i=this._getRequest({path:this._generatePath(),withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(){return null!=e?e.success(t):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e._bucketWithName=function(e,t){var i;return i=new f.KiiBucket(e,t)},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._generatePath=function(){var e;return e=null!=this._user?"/users/"+this._user.getUUID()+"/buckets/"+this._getQualifiedBucketName():null!=this._group?"/groups/"+this._group.getUUID()+"/buckets/"+this._getQualifiedBucketName():null!=this._thing?"/things/"+this._thing.getThingID()+"/buckets/"+this._getQualifiedBucketName():"/buckets/"+this._getQualifiedBucketName()},e.prototype._getHttpUri=function(){return f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/"+this._generatePath()},e.prototype.objectWithJSON=function(e){var t;return t=this.createObject(),t._updateWithJSON(e),t},e}(),f.KiiEncryptedBucket=function(e){function t(e,i){if(this._getQualifiedBucketName=v(this._getQualifiedBucketName,this),!u._isNonEmptyString(e))throw f.InvalidArgumentException("Specified bucket name is null or empty.");f.KiiEncryptedBucket._isEncrypted(e)?t.__super__.constructor.call(this,e.replace("CRYPTO:",""),i):t.__super__.constructor.call(this,e,i)}return _(t,e),t.prototype._getQualifiedBucketName=function(){return"CRYPTO:"+this._bucketName},t._bucketWithName=function(e,t){var i;return i=new f.KiiEncryptedBucket(e,t)},t._isEncrypted=function(e){var t;return t=0===e.indexOf("CRYPTO:")},t}(f.KiiBucket),f.KiiEncryptedBucketAdmin=function(e){function t(e,i,n){this.acl=v(this.acl,this),this.createObjectWithID=v(this.createObjectWithID,this),this.createObjectWithType=v(this.createObjectWithType,this),this.createObject=v(this.createObject,this),this._getRequest=v(this._getRequest,this),t.__super__.constructor.call(this,e,i),this._adminToken=n}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype.createObject=function(){return f.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},t.prototype.createObjectWithType=function(e){return f.KiiObjectAdmin.objectWithBucket(this,e,this._adminToken)},t.prototype.createObjectWithID=function(e){return f.KiiObjectAdmin.objectWithID(this,e,this._adminToken)},t.prototype.acl=function(){var e;return e=new f.KiiACLAdmin(this,this._adminToken)},t}(f.KiiEncryptedBucket),f.KiiBucketAdmin=function(e){function t(e,i,n){this.acl=v(this.acl,this),this.createObjectWithID=v(this.createObjectWithID,this),this.createObjectWithType=v(this.createObjectWithType,this),this.createObject=v(this.createObject,this),this._getRequest=v(this._getRequest,this),t.__super__.constructor.call(this,e,i),this._adminToken=n}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype.createObject=function(){return f.KiiObjectAdmin.objectWithBucket(this,null,this._adminToken)},t.prototype.createObjectWithType=function(e){return f.KiiObjectAdmin.objectWithBucket(this,e,this._adminToken)},t.prototype.createObjectWithID=function(e){return f.KiiObjectAdmin.objectWithID(this,e,this._adminToken)},t.prototype.acl=function(){var e;return e=new f.KiiACLAdmin(this,this._adminToken)},t}(f.KiiBucket),f.KiiGroup=function(){function e(){this._setAuthToken=v(this._setAuthToken,this),this._getHttpURI=v(this._getHttpURI,this),this._listTopicsUsingCallbacks=v(this._listTopicsUsingCallbacks,this),this.listTopics=v(this.listTopics,this),this.topicWithName=v(this.topicWithName,this),this._setOwnerFromContext=v(this._setOwnerFromContext,this),this._userWithID=v(this._userWithID,this),this._getRequest=v(this._getRequest,this),this._updateWithJSON=v(this._updateWithJSON,this),this._getOwnerUsingCallbacks=v(this._getOwnerUsingCallbacks,this),this.getOwner=v(this.getOwner,this),this._deleteUsingCallbacks=v(this._deleteUsingCallbacks,this),this["delete"]=v(this["delete"],this),this._refreshUsingCallbacks=v(this._refreshUsingCallbacks,this),this.refresh=v(this.refresh,this),this._saveUsingCallbacks=v(this._saveUsingCallbacks,this),this.save=v(this.save,this),this._changeGroupNameUsingCallbacks=v(this._changeGroupNameUsingCallbacks,this),this.changeGroupName=v(this.changeGroupName,this),this._saveMembers=v(this._saveMembers,this),this._getMemberListUsingCallbacks=v(this._getMemberListUsingCallbacks,this),this.getMemberList=v(this.getMemberList,this),this._removeMember=v(this._removeMember,this),this._addMember=v(this._addMember,this),this.removeUser=v(this.removeUser,this),this.addUser=v(this.addUser,this),this.encryptedBucketWithName=v(this.encryptedBucketWithName,this),this.bucketWithName=v(this.bucketWithName,this),this.objectURI=v(this.objectURI,this),this._setOwner=v(this._setOwner,this),this.getCachedOwner=v(this.getCachedOwner,this),this._setName=v(this._setName,this),this.getName=v(this.getName,this),this.getID=v(this.getID,this),this._setUUID=v(this._setUUID,this),this.getUUID=v(this.getUUID,this),this._setAddMembers=v(this._setAddMembers,this),this._getRemoveMembers=v(this._getRemoveMembers,this),this._getAddMembers=v(this._getAddMembers,this),this._addMembers={},this._removeMembers={}}return e.prototype._getAddMembers=function(){return this._addMembers},e.prototype._getRemoveMembers=function(){return this._removeMembers},e.prototype._setAddMembers=function(e){var t,i,n,r;if(null!=e){for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(this.addUser(n));return r}},e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getID=function(){return this._uuid},e.prototype.getName=function(){return this._groupName},e.prototype._setName=function(e){this._groupName=e},e.prototype.getCachedOwner=function(){return this._owner},e.prototype._setOwner=function(e){this._owner=e},e.prototype.objectURI=function(){return null!=this._uuid?"kiicloud://groups/"+this._uuid:null},e.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucket(e,this)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucket(e,this)},e.prototype.addUser=function(e){var t;return null==e?void f.Kii.logger("Passed member is null"):null==e.getUUID()?void f.Kii.logger("Passed member ID is null"):(t=e.getUUID(),t in this._addMembers||(this._addMembers[t]=e),t in this._removeMembers?delete this._removeMembers[t]:void 0)},e.prototype.removeUser=function(e){var t;return null==e?void f.Kii.logger("Passed member is null"):null==e.getUUID()?void f.Kii.logger("Passed member uuid is null"):(t=e.getUUID(),t in this._removeMembers||(this._removeMembers[t]=e),t in this._addMembers?delete this._addMembers[t]:void 0)},e.prototype._addMember=function(e,t){var i,n;return f.Kii.logger("Adding member "+e.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+e.getUUID(),withApp:!0}),n.setMethod("PUT"),i={success:function(i){return function(){return delete i._addMembers[e.getUUID()],i._saveMembers(t)}}(this),failure:function(i){return function(n){var r,s,o;return r=function(){var t,i;t=this._addMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),s=function(){var t,i;t=this._removeMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),t.failure(i,n,r,s)}}(this)},n.execute(i,!1)},e.prototype._removeMember=function(e,t){var i,n;return f.Kii.logger("Removing member "+e.getUUID()+" to group "+this._groupName),n=this._getRequest({path:"/groups/"+this._uuid+"/members/"+e.getUUID(),withApp:!0}),n.setMethod("DELETE"),i={success:function(i){return function(){return delete i._getRemoveMembers()[e.getUUID()],i._saveMembers(t)}}(this),failure:function(i){return function(n){var r,s,o;return r=function(){var t,i;t=this._addMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),s=function(){var t,i;t=this._removeMembers,i=[];for(o in t)e=t[o],i.push(e);return i}.call(i),t.failure(i,n,r,s)}}(this)},n.execute(i,!1)},e.prototype.getMemberList=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._getMemberListUsingCallbacks(r)}}(this))},e.prototype._getMemberListUsingCallbacks=function(e){var t,i;return f.Kii.logger("Getting member list for group "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid+"/members",withApp:!0}),i.setAccept("application/vnd.kii.MembersRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,a,l;if(300>n&&n>=200){for(a=[],l=i.members,r=0,s=l.length;s>r;r++)o=l[r],a.push(t._userWithID(o.userID));if(null!=e)return e.success(t,a)}else if(null!=e)return e.failure(t,"Unable to get member list of group")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype._saveMembers=function(e){var t,i;return t=Object.keys(this._addMembers),i=Object.keys(this._removeMembers),0===t.length&&0===i.length&&e.success(this),t.length>0?void this._addMember(this._addMembers[t[0]],e):void(i.length>0&&this._removeMember(this._removeMembers[i[0]],e))},e.prototype.changeGroupName=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._changeGroupNameUsingCallbacks(e,s)}}(this))},e.prototype._changeGroupNameUsingCallbacks=function(e,t){var i,n;return f.Kii.logger("Saving group: "+this.name),null!=this._uuid?(i=this._getRequest({path:"/groups/"+this._uuid+"/name",withApp:!0}),i.setContentType("text/plain"),i.setMethod("PUT"),i.setData(e),n={success:function(i){return function(n,r){if(300>r&&r>=200){if(i._setName(e),null!=t)return t.success(i)}else if(null!=t)return t.failure(i,"Unable to change group name - invalid response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},i.execute(n,!0)):t.failure(this,"Invalid group. Save the group on the server before updating the name.")},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){var i;return null!=e&&e.failure.apply(e,arguments),i=u._Error(arguments[1],t),i.addMembersArray=arguments[2],i.removeMembersArray=arguments[3],n(i)}},t._saveUsingCallbacks(r)}}(this))},e.prototype._saveUsingCallbacks=function(e){var t,i,n;return f.Kii.logger("Saving group: "+this.name),null==this._uuid?(i=this._getRequest({path:"/groups",withApp:!0}),i.setContentType("application/vnd.kii.GroupCreationRequest+json"),i.setMethod("POST"),t={},null!=this._groupName&&(t.name=this._groupName),this._setOwnerFromContext(t),i.setData(t),n={success:function(t){return function(i,n){return 300>n&&n>=200?(t._setUUID(i.groupID),t._saveMembers(e)):void 0}}(this),failure:function(t){return function(i){var n,r,s,o;
return null!=e?(n=function(){var e,t;e=this._addMembers,t=[];for(o in e)r=e[o],t.push(r);return t}.call(t),s=function(){var e,t;e=this._removeMembers,t=[];for(o in e)r=e[o],t.push(r);return t}.call(t),e.failure(t,i,n,s)):void 0}}(this)},i.execute(n,!1)):this._saveMembers(e)},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._refreshUsingCallbacks(r)}}(this))},e.prototype._refreshUsingCallbacks=function(e){var t,i;return f.Kii.logger("Refreshing group: "+this._groupName),i=new this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setAccept("application/vnd.kii.GroupRetrievalResponse+json"),t={success:function(t){return function(i){return t._updateWithJSON(i),null!=e?e.success(t):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i;return f.Kii.logger("Deleting group: "+this._groupName),i=this._getRequest({path:"/groups/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e.prototype.getOwner=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._getOwnerUsingCallbacks(r)}}(this))},e.prototype._getOwnerUsingCallbacks=function(e){return f.Kii.logger("Getting owner of group "+this._groupName),this.refresh({success:function(){return function(t){return null!=e?e.success(t,t.getCachedOwner()):void 0}}(this),failure:function(){return function(t,i){return null!=e?e.failure(t,i):void 0}}(this)})},e.groupWithName=function(e){return f.KiiGroup.groupWithNameAndMembers(e,null)},e.groupWithNameAndMembers=function(e,t){var i;return i=new f.KiiGroup,i._setName(e),i._setAddMembers(t),i},e.groupWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("groupID should not null or empty");return t=new f.KiiGroup,t._setUUID(e),t},e.groupWithURI=function(e){var t,i,n,r;if(n=null,r=e.substr("kiicloud://".length),i=r.split("/"),t=i.length,!(t>0))throw new f.InvalidURIException;return n=new f.KiiGroup,n._setUUID(i[t-1]),n},e._groupWithJSON=function(e){var t;return t=new f.KiiGroup,null!=e.groupID&&t._setUUID(e.groupID),null!=e.name&&t._setName(e.name),null!=e.owner&&t._setOwner(f.KiiUser.userWithID(e.owner)),t},e.prototype._updateWithJSON=function(e){return null!=e.groupID&&this._setUUID(e.groupID),this._setName(null!=e.name?e.name:null),this._setOwner(null!=e.owner?this._userWithID(e.owner):null)},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._userWithID=function(e){var t;return t=f.KiiUser.userWithID(e)},e.prototype._setOwnerFromContext=function(e){return null!=f.Kii.getCurrentUser()?(this._owner=f.Kii.getCurrentUser(),e.owner=this._owner.getUUID()):void 0},e.prototype.topicWithName=function(e){var t,i;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopic(i,e)},e.prototype.listTopics=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,t)}}(this))},e.prototype._listTopicsUsingCallbacks=function(e,t){var i,n,r;return n=this._getHttpURI()+"/topics","string"==typeof t&&""!==t&&(n=n+"?paginationKey="+encodeURIComponent(t)),r=p.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(t){return function(){var i,n,s,o,a,l;for(n=JSON.parse(r.xhr.responseText),l=[],o=n.topics,i=0,s=o.length;s>i;i++)a=o[i],l.push(t.topicWithName(a.topicID));return null!=e?e.success(l,void 0===n.paginationKey?null:n.paginationKey):void 0}}(this),failure:function(t){return function(){var i,n;return n=r.getErrorString("list topics"),i=u._Error(n,t),null!=e?e.failure(i):void 0}}(this)},r.send(i)},e.prototype._getHttpURI=function(){return f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/groups/"+this.getID()},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e}(),f.KiiObject=function(){function e(){this._deleteBodyUsingCallbacks=v(this._deleteBodyUsingCallbacks,this),this.deleteBody=v(this.deleteBody,this),this._publishBodyExpiresInUsingCallbacks=v(this._publishBodyExpiresInUsingCallbacks,this),this.publishBodyExpiresIn=v(this.publishBodyExpiresIn,this),this._publishBodyExpiresAtUsingCallbacks=v(this._publishBodyExpiresAtUsingCallbacks,this),this.publishBodyExpiresAt=v(this.publishBodyExpiresAt,this),this._publishBodyUsingCallbacks=v(this._publishBodyUsingCallbacks,this),this.publishBody=v(this.publishBody,this),this._downloadBodyUsingCallbacks=v(this._downloadBodyUsingCallbacks,this),this.downloadBody=v(this.downloadBody,this),this._uploadBodyUsingCallbacks=v(this._uploadBodyUsingCallbacks,this),this.uploadBody=v(this.uploadBody,this),this._moveBodyUsingCallbacks=v(this._moveBodyUsingCallbacks,this),this.moveBody=v(this.moveBody,this),this._parseObjectUri=v(this._parseObjectUri,this),this._userWithID=v(this._userWithID,this),this._setAuthorizationHeader=v(this._setAuthorizationHeader,this),this._getToken=v(this._getToken,this),this._getRequest=v(this._getRequest,this),this._setETag=v(this._setETag,this),this._deleteUsingCallbacks=v(this._deleteUsingCallbacks,this),this["delete"]=v(this["delete"],this),this._refreshUsingCallbacks=v(this._refreshUsingCallbacks,this),this.refresh=v(this.refresh,this),this._saveUsingCallbacks=v(this._saveUsingCallbacks,this),this.save=v(this.save,this),this._saveAllFieldsUsingCallbacks=v(this._saveAllFieldsUsingCallbacks,this),this.saveAllFields=v(this.saveAllFields,this),this._performUpdate=v(this._performUpdate,this),this._performSave=v(this._performSave,this),this._updateWithJSON=v(this._updateWithJSON,this),this.objectURI=v(this.objectURI,this),this.objectACL=v(this.objectACL,this),this.getGeoPoint=v(this.getGeoPoint,this),this.setGeoPoint=v(this.setGeoPoint,this),this.get=v(this.get,this),this.set=v(this.set,this),this._getPath=v(this._getPath,this),this._setBodyContentType=v(this._setBodyContentType,this),this.getBodyContentType=v(this.getBodyContentType,this),this._setBucket=v(this._setBucket,this),this.getBucket=v(this.getBucket,this),this._setObjectType=v(this._setObjectType,this),this.getObjectType=v(this.getObjectType,this),this._setModified=v(this._setModified,this),this.getModified=v(this.getModified,this),this._setCreated=v(this._setCreated,this),this.getCreated=v(this.getCreated,this),this._setUUID=v(this._setUUID,this),this.getUUID=v(this.getUUID,this),this._customInfo={},this._alteredFields=[]}return e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getCreated=function(){return this._created},e.prototype._setCreated=function(e){this._created=e},e.prototype.getModified=function(){return this._modified},e.prototype._setModified=function(e){this._modified=e},e.prototype.getObjectType=function(){return this._objectType},e.prototype._setObjectType=function(e){this._objectType=e},e.prototype.getBucket=function(){return f.Kii.logger("GEtting bucket "+this._bucket),this._bucket},e.prototype._setBucket=function(e){this._bucket=e},e.prototype.getBodyContentType=function(){return this._bodyContentType},e.prototype._setBodyContentType=function(e){this._bodyContentType=e},e.prototype._getPath=function(){var e;return e=null!=this._bucket.getUser()?"/users/"+this._bucket.getUser().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":null!=this._bucket.getGroup()?"/groups/"+this._bucket.getGroup().getUUID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":null!=this._bucket.getThing()?"/things/"+this._bucket.getThing().getThingID()+"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/":"/buckets/"+this._bucket._getQualifiedBucketName()+"/objects/",null!=this._uuid&&(e+=this._uuid),e},e.prototype.set=function(e,t){return this._customInfo[e]=t,this._alteredFields.push(e)},e.prototype.get=function(e){return this._customInfo[e]},e.prototype.setGeoPoint=function(e,t){if(!(t instanceof f.KiiGeoPoint))throw f.InvalidArgumentException("Specified kiiGeoPoint is not an instance of KiiGeoPoint");return this._customInfo[e]=t._toDict(),this._alteredFields.push(e)},e.prototype.getGeoPoint=function(e){var t,i,n;return n=this._customInfo[e],t=n.lat,i=n.lon,f.KiiGeoPoint.geoPoint(t,i)},e.prototype.objectACL=function(){return f.KiiACL.aclWithParent(this)},e.prototype.objectURI=function(){var e,t;return e="kiicloud://",null!=this._bucket&&null!=this._uuid&&(t=e,null!=this._bucket.getGroup()?t+="groups/"+this._bucket.getGroup().getUUID()+"/":null!=this._bucket.getUser()?t+="users/"+this._bucket.getUser().getUUID()+"/":null!=this._bucket.getThing()&&(t+="things/"+this._bucket.getThing().getThingID()+"/"),t+="buckets/"+this._bucket._getQualifiedBucketName()+"/objects/"+this._uuid),t},e.prototype._updateWithJSON=function(e){var t,i,n;i=[];for(t in e)n=e[t],"_id"===t?null==this._uuid?(f.Kii.logger("Setting uuid: "+n),i.push(this._uuid=n)):i.push(void 0):i.push("createdAt"===t||"_created"===t||"created"===t?this._created=n:"modifiedAt"===t||"_modified"===t||"modified"===t?this._modified=n:"_owner"===t?this._owner=this._userWithID(n):"_dataType"===t?this._objectType=n:"_calculated"===t?this._customInfo[t]=n:"_"!==t[0]?this._customInfo[t]=n:"_version"===t?this._etag=n:void 0);return i},e.prototype._performSave=function(e){var t,i,n,r;return i=this._getPath(),n=new this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),t=this._customInfo,n.setData(t),null!=this._objectType&&n.setContentType("application/vnd."+f.Kii.getAppID()+"."+this._objectType+"+json"),r={success:function(t){return function(i,n,r){if(300>n&&n>=200){if(t._etag=r.ETag,null==i.objectID)return e.failure(t,"No objectID response");if(t._uuid=i.objectID,delete i.objectID,t._updateWithJSON(i),t._alteredFields=[],null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!1)},e.prototype._performUpdate=function(e,t,i){var n,r,s,o,a,l,u,c,p;if(l=this._getPath(),c=new this._getRequest({path:l,withApp:!0}),n={},e)for(c.addHeader("X-HTTP-Method-Override","PATCH"),c.setMethod("POST"),u=this._alteredFields,s=0,a=u.length;a>s;s++)o=u[s],n[o]=this._customInfo[o];else c.setMethod("PUT"),n=this._customInfo;if(c.setData(n),r=this._created>0,!i)if(r){if(null==this._etag)return void t.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");c.addHeader("If-Match",this._etag)}else{if(e&&null==this._etag)return void t.failure(this,"IllegalState! Call KiiObject#refresh() prior call this method.");c.addHeader("If-None-Match","*")}return null!=this._objectType&&c.setContentType("application/vnd."+f.Kii.getAppID()+"."+this._objectType+"+json"),p={success:function(e){return function(i,n,r){if(300>n&&n>=200){if(e._etag=r.ETag,e._updateWithJSON(i),e._alteredFields=[],null!=t)return t.success(e)}else if(null!=t)return t.failure(e,"Unable to parse response")}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},c.execute(p,!1)},e.prototype.saveAllFields=function(e,t){return null==t&&(t=!0),new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(u._Error(arguments[1],i))}},i._saveAllFieldsUsingCallbacks(s,t)}}(this))},e.prototype._saveAllFieldsUsingCallbacks=function(e,t){return null==t&&(t=!0),null!=this._uuid?this._performUpdate(!1,e,t):this._performSave(e)},e.prototype.save=function(e,t){return null==t&&(t=!0),new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(u._Error(arguments[1],i))}},i._saveUsingCallbacks(s,t)}}(this))},e.prototype._saveUsingCallbacks=function(e,t){return null==t&&(t=!0),null!=this._uuid?this._performUpdate(!0,e,t):this._performSave(e)},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._refreshUsingCallbacks(r)}}(this))},e.prototype._refreshUsingCallbacks=function(e){var t,i,n;return t=this._getPath(),n=new this._getRequest({path:t,withApp:!0}),i={success:function(t){return function(i,n,r){if(300>n&&n>=200){if(t._etag=r.ETag,t._updateWithJSON(i),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(i,!1)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i,n;return t=this._getPath(),n=new this._getRequest({path:t,withApp:!0}),n.setMethod("DELETE"),i={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(i,!0)},e.objectWithBucket=function(e,t){var i;return f.Kii.logger("Creating object w type: "+t),i=new f.KiiObject,i._setBucket(e),i._setObjectType(t),f.Kii.logger(i),i},e.objectWithID=function(e,t){var i;return f.Kii.logger("Creating object with id: "+t),i=new f.KiiObject,i._setBucket(e),i._setUUID(t),f.Kii.logger(i),i},e.prototype._setETag=function(e){this._etag=e},e.objectWithURI=function(e){var t,i,n,r,s,o,a,l;if(o=e.substr("kiicloud://".length),s=o.split("/"),r=s.length,f.Kii.logger(s),!(r>=4))throw new f.InvalidURIException;return i=4===r?1:3,n=s[i],l=null,"groups"===s[0]?l=new f.KiiGroup.groupWithID(s[1]):"users"===s[0]?l=f.KiiUser.userWithID(s[1]):"things"===s[0]&&(l=f.KiiThing.thingWithID(s[1])),t=null,t=f.KiiEncryptedBucket._isEncrypted(n)?new f.KiiEncryptedBucket._bucketWithName(n,l):new f.KiiBucket._bucketWithName(n,l),f.Kii.logger(t),a=t.createObject(),a._setUUID(s[r-1]),f.Kii.logger(a),a},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.prototype._getToken=function(){var e,t;return e=f.KiiUser.getCurrentUser(),t=e?e.getAccessToken():null,t?t:null},e.prototype._setAuthorizationHeader=function(e){var t;return t=this._getToken(),t?e.setRequestHeader("Authorization","Bearer "+t):void 0},e.prototype._userWithID=function(e){var t;return t=f.KiiUser.userWithID(e)},e.prototype._parseObjectUri=function(e){var t,i,n,r;if(n=e.replace(/^kiicloud:\/\//g,"").split("/"),r=n[0],"users"===r)i={appID:f.Kii.getAppID(),userID:n[1],type:"APP_AND_USER"},t={targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]};else if("groups"===r)i={appID:f.Kii.getAppID(),groupID:n[1],type:"APP_AND_GROUP"},t={targetObjectScope:i,targetBucketID:n[3],targetObjectID:n[5]};else{if("things"===r)throw new f.InvalidURIException;i={appID:f.Kii.getAppID(),type:"APP"},t={targetObjectScope:i,targetBucketID:n[1],targetObjectID:n[3]}}return t},e.prototype.moveBody=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){var e;return null!=t&&t.failure.apply(t,arguments),e=u._Error(arguments[2],i),e.targetObjectUri=arguments[1],r(e)}},i._moveBodyUsingCallbacks(e,s)}}(this))},e.prototype._moveBodyUsingCallbacks=function(e,t){var i,n,r,s,o;if(null==e)return t.failure(this,null,f.InvalidArgumentException("targetObjectUri is required"));if(null==this.getUUID())return t.failure(this,e,f.InvalidArgumentException("Source object is not saved on the cloud"));s=this._getPath()+"/body/move",o=new this._getRequest({path:s,withApp:!0}),o.setMethod("POST"),o.setContentType("application/vnd.kii.ObjectBodyMoveRequest+json");try{o.setData(this._parseObjectUri(e))}catch(i){return n=i,t.failure(this,e,"Not support to move body of thing scope object.")}return r={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?t.success(i,e):null!=t?t.failure(i,e,"Unable to parse response"):void 0}}(this),failure:function(i){return function(n){return null!=t?t.failure(i,e,n):void 0}}(this)},o.execute(r,!0)},e.prototype.uploadBody=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){var e;return null!=t&&null!=(e=t.success)&&e.apply(t,arguments),n(arguments[0])},failure:function(){var e;return null!=t&&null!=(e=t.failure)&&e.apply(t,arguments),r(u._Error(arguments[1],i))},progress:function(){var e;return null!=t&&null!=(e=t.progress)?e.apply(t,arguments):void 0}},i._uploadBodyUsingCallbacks(e,s)}}(this))},e.prototype._uploadBodyUsingCallbacks=function(e,t){var i,n,r,s,o;return e&&e instanceof Blob?(r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",i="application/octet-stream",e.type&&(i=e.type),s=p.createXHRWrapper("PUT",r),o=s.xhr,o.setRequestHeader("Content-Type",i),o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(o),n={success:function(e){return function(){return e._setBodyContentType(i),null!=t?t.success(e):void 0}}(this),failure:function(e){return function(){var i,n;if(i="failed to upload body. statusCode: "+o.status,null!=t)try{if(n=JSON.parse(decodeURIComponent(o.responseText)),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" message: "+n.message}catch(r){}finally{f.Kii.logger("Failure: "+i),f.Kii.logger(o.responseText),t.failure(e,i)}}}(this),progress:function(){return function(e){return t&&t.progress?t.progress(e):void 0}}(this)},s.sendData(e,n)):void t.failure(this,"Invalid parameter")},e.prototype.downloadBody=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){var t;return null!=e&&null!=(t=e.success)&&t.apply(e,arguments),i(arguments)},failure:function(){var i;return null!=e&&null!=(i=e.failure)&&i.apply(e,arguments),n(u._Error(arguments[1],t))},progress:function(){var t;return null!=e&&null!=(t=e.progress)?t.apply(e,arguments):void 0}},t._downloadBodyUsingCallbacks(r)}}(this))},e.prototype._downloadBodyUsingCallbacks=function(e){var t,i,n,r;return i=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",n=p.createXHRWrapper("GET",i),r=n.xhr,r.setRequestHeader("x-kii-appid",f.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),r.responseType="blob",t={success:function(t){return function(){var i;return i=r.status,t._setBodyContentType(r.getResponseHeader("content-type")),null!=e?e.success(t,r.response):void 0}}(this),failure:function(t){return function(){var i,n,s,o;return null!=e?(i="failed to download body. statusCode: "+r.status,n=new FileReader,o=null,s=t,n.onload=function(){var t;o=this.result;try{if(t=JSON.parse(decodeURIComponent(o)),null!=t.errorCode&&(i+=" error code: "+t.errorCode),null!=t.message)return i+=" message: "+t.message}catch(n){}finally{f.Kii.logger("Failure: "+i),f.Kii.logger(r.response),e.failure(s,i)}},n.readAsText(r.response)):void 0}}(this),progress:function(){return function(t){return e&&e.progress?e.progress(t):void 0}}(this)},n.send(t)},e.prototype.publishBody=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._publishBodyUsingCallbacks(r)}}(this))},e.prototype._publishBodyUsingCallbacks=function(e){var t,i,n,r,s,o;return r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",s=p.createXHRWrapper("POST",r),o=s.xhr,o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),o.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(o),n={success:function(t){return function(){var i;if(null!=e)try{return i=JSON.parse(o.responseText),i.url?e.success(t,i.url):e.failure(t,"failed to parse response")}catch(n){return e.failure(t,"failed to parse response")}}}(this),failure:function(t){return function(){var i,n;if(null!=e){i="failed to publish body. statusCode: "+o.status;try{if(n=JSON.parse(o.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{e.failure(t,i)}}}}(this)},i={},t=JSON.stringify(i),s.sendData(t,n)},e.prototype.publishBodyExpiresAt=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._publishBodyExpiresAtUsingCallbacks(e,s)}}(this))},e.prototype._publishBodyExpiresAtUsingCallbacks=function(e,t){var i,n,r,s,o,a;return s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",o=p.createXHRWrapper("POST",s),a=o.xhr,a.setRequestHeader("x-kii-appid",f.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(a),r={success:function(e){return function(){var i;if(null!=t)try{return i=JSON.parse(a.responseText),i.url?t.success(e,i.url):t.failure(e,"failed to parse response")}catch(n){return t.failure(e,"failed to parse response")}}}(this),failure:function(e){return function(){var i,n;if(null!=t){i="failed to publish body. statusCode: "+a.status,null==a.responseText&&t.failure(e,i);try{if(n=JSON.parse(a.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{t.failure(e,i)}}}}(this)},n={},n.expiresAt=e,i=JSON.stringify(n),o.sendData(i,r)},e.prototype.publishBodyExpiresIn=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._publishBodyExpiresInUsingCallbacks(e,s)}}(this))},e.prototype._publishBodyExpiresInUsingCallbacks=function(e,t){var i,n,r,s,o,a;return s=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body/publish",o=p.createXHRWrapper("POST",s),a=o.xhr,a.setRequestHeader("x-kii-appid",f.Kii.getAppID()),a.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),a.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),a.setRequestHeader("Content-Type","application/vnd.kii.ObjectBodyPublicationRequest+json"),this._setAuthorizationHeader(a),r={success:function(e){return function(){var i;try{return i=JSON.parse(a.responseText),i.url?t.success(e,i.url):t.failure(e,"failed to parse response")}catch(n){return t.failure(e,"failed to parse response")}}}(this),failure:function(e){return function(){var i,n;i="failed to publish body. statusCode: "+a.status;try{if(n=JSON.parse(a.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(r){}finally{t.failure(e,i)}}}(this)},n={},n.expiresIn=e,i=JSON.stringify(n),o.sendData(i,r)},e.prototype.deleteBody=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._deleteBodyUsingCallbacks(r)}}(this))},e.prototype._deleteBodyUsingCallbacks=function(e){var t,i,n,r;return i=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+this._getPath()+"/body",n=p.createXHRWrapper("DELETE",i),r=n.xhr,r.setRequestHeader("x-kii-appid",f.Kii.getAppID()),r.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),r.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),this._setAuthorizationHeader(r),t={success:function(t){return function(){return t._setBodyContentType(null),null!=e?e.success(t):void 0}}(this),failure:function(t){return function(){var i,n;if(null!=e){i="failed to delete body. statusCode: "+r.status;try{if(n=JSON.parse(r.responseText),null!=n.errorCode&&(i+=" error code: "+n.errorCode),null!=n.message)return i+=" error message: "+n.message}catch(s){}finally{e.failure(t,i)}}}}(this)},n.send(t)},e.isValidObjectID=function(e){var t;return t=/^[a-zA-Z0-9-_.]{2,100}$/i,"string"!==(typeof e).toLowerCase()?!1:null!==e.match(t)?!0:!1},e}(),f.KiiQuery=function(){function e(e){return this._dictValue=v(this._dictValue,this),this.sortByAsc=v(this.sortByAsc,this),this.sortByDesc=v(this.sortByDesc,this),this.setLimit=v(this.setLimit,this),this.getLimit=v(this.getLimit,this),this._setClause=v(this._setClause,this),this.setPaginationKey=v(this.setPaginationKey,this),this.getPaginationKey=v(this.getPaginationKey,this),this._clone=v(this._clone,this),this._clone(e)}return e.prototype._clone=function(e){var t,i;if(null==e||"object"!=typeof e)return e;i=new e.constructor;for(t in e)i[t]=this._clone(e[t]);return i},e.prototype.getPaginationKey=function(){return this._paginationKey},e.prototype.setPaginationKey=function(e){this._paginationKey=e},e.prototype._setClause=function(e){this._clause=e},e.prototype.getLimit=function(){return this._limit},e.prototype.setLimit=function(e){if(e>0)return this._limit=e;throw new f.InvalidLimitException},e.queryWithClause=function(e){var t;return t=new f.KiiQuery,t._setClause(e),t},e.prototype.sortByDesc=function(e){return this._sortField=e,this._sortDescending=!0},e.prototype.sortByAsc=function(e){return this._sortField=e,this._sortDescending=!1},e._emptyDictValue=function(){return{type:"all"}},e.prototype._dictValue=function(){var e,t;return t={},t.bestEffortLimit=this._limit,null!=this._paginationKey&&(t.paginationKey=this._paginationKey),e={descending:this._sortDescending},e.clause=null!=this._clause?this._clause._getDictValue():f.KiiQuery._emptyDictValue(),null!=this._sortField&&(e.orderBy=this._sortField),t.bucketQuery=e,t},e}(),f.KiiClause=function(){function e(){this._getDictValue=v(this._getDictValue,this),this._setDictValue=v(this._setDictValue,this),this._setWhereClauses=v(this._setWhereClauses,this),this._setWhereType=v(this._setWhereType,this)}return e.constructor=function(){return e._whereClauses=[],e._dictExpression={}},e.prototype._setWhereType=function(e){this._whereType=e},e.prototype._setWhereClauses=function(e){this._whereClauses=e},e.prototype._setDictValue=function(e){this._dictExpression=e},e.prototype._getDictValue=function(){var e,t,i,n,r,s;if(s={},null!=this._whereClauses&&null!=this._whereType)if(t=[],1===this._whereClauses.length)e=this._whereClauses[0],s="not"===this._whereType?{type:this._whereType,clause:e._getDictValue()}:e._getDictValue();else{for(r=this._whereClauses,i=0,n=r.length;n>i;i++)e=r[i],t.push(e._getDictValue());s={type:this._whereType,clauses:t}}else null!=this._whereClauses?this._whereClauses.length>0&&(s=this._whereClauses[0]._getDictValue()):null!=this._dictExpression&&(s=this._dictExpression);return null==s&&(s=f.KiiQuery.emptyDictValue()),s},e.createWithWhere=function(e,t){var i;return i=new f.KiiClause,i._setWhereType(e),i._setWhereClauses(t),i},e.create=function(e,t,i){var n,r;return r=new f.KiiClause,n={},"="===e?(n.type="eq",n.field=t,n.value=i):"<"===e?(n.type="range",n.field=t,n.upperLimit=i,n.upperIncluded=!1):"<="===e?(n.type="range",n.field=t,n.upperLimit=i,n.upperIncluded=!0):">"===e?(n.type="range",n.field=t,n.lowerLimit=i,n.lowerIncluded=!1):">="===e?(n.type="range",n.field=t,n.lowerLimit=i,n.lowerIncluded=!0):"in"===e?(n.type="in",n.field=t,n.values=i):"prefix"===e&&(n.type="prefix",n.field=t,n.prefix=i),r._setDictValue(n),r},e.and=function(){return e.createWithWhere("and",arguments)},e.or=function(){return e.createWithWhere("or",arguments)},e.equals=function(e,t){return null!=t._className&&(t=t.objectURI),f.KiiClause.create("=",e,t)},e.notEquals=function(e,t){return null!=t._className&&(t=t.objectURI),f.KiiClause.createWithWhere("not",[f.KiiClause.equals(e,t)])},e.greaterThan=function(e,t){return f.KiiClause.create(">",e,t)},e.greaterThanOrEqual=function(e,t){return f.KiiClause.create(">=",e,t)},e.lessThan=function(e,t){return f.KiiClause.create("<",e,t)},e.lessThanOrEqual=function(e,t){return f.KiiClause.create("<=",e,t)},e["in"]=function(e,t){return f.KiiClause.create("in",e,t)},e.inClause=function(e,t){return f.KiiClause.create("in",e,t)},e.startsWith=function(e,t){return f.KiiClause.create("prefix",e,t)},e.geoDistance=function(e,t,i,n){var r,s,o,a,l;if(a=function(e){return"string"==typeof e&&e.length>0},o=function(e){return null==e?!1:e instanceof f.KiiGeoPoint},!a(e))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!o(t))throw f.InvalidArgumentException("center is not a reference of KiiGeoPoint.");if(l="^[a-zA-Z_][a-zA-Z0-9_]*$",null!=n&&!n.match(l))throw f.InvalidArgumentException("putDistanceInto is invalid.");if(0>=i||i>2e7||isNaN(i))throw f.InvalidArgumentException("radius is invalid.");return s=new f.KiiClause,r={},r.type="geodistance",r.field=e,t=t._toDict(),r.center=t,r.radius=i,r.putDistanceInto=n,s._setDictValue(r),s},e.geoBox=function(e,t,i){var n,r,s,o,a,l;if(o=function(e){return"string"==typeof e&&e.length>0},s=function(e){return null==e?!1:e instanceof f.KiiGeoPoint},!o(e))throw f.InvalidArgumentException("Specified key is not a string or is an empty string.");if(!s(t)||!s(i))throw f.InvalidArgumentException("northEast or southWest is not a reference of KiiGeoPoint.");return r=new f.KiiClause,n={},n.type="geobox",n.field=e,a=t._toDict(),l=i._toDict(),n.box={ne:a,sw:l},r._setDictValue(n),r},e}(),o=function(){function e(e,t){this.execute=v(this.execute,this),this.setAdminToken=v(this.setAdminToken,this),this.addHeader=v(this.addHeader,this),this.setAccept=v(this.setAccept,this),this.getAccept=v(this.getAccept,this),this.setAnonymous=v(this.setAnonymous,this),this.isAnonymous=v(this.isAnonymous,this),this.setContentType=v(this.setContentType,this),this.getContentType=v(this.getContentType,this),this.setData=v(this.setData,this),this.getData=v(this.getData,this),this.setHeaders=v(this.setHeaders,this),this.getHeaders=v(this.getHeaders,this),this.setMethod=v(this.setMethod,this),this.getMethod=v(this.getMethod,this),this.setPath=v(this.setPath,this),this.getPath=v(this.getPath,this),this._path=t?"/apps/"+f.Kii.getAppID()+e:e,this._method="GET",this._headers={accept:"*/*"},this._contentType="application/json",this._anonymous=!1,this._success=function(){return function(){}
}(this),this._failure=function(){return function(){}}(this),this._httpRequest=null}return e.prototype.getPath=function(){return this._path},e.prototype.setPath=function(e){this._path=e},e.prototype.getMethod=function(){return this._method},e.prototype.setMethod=function(e){this._method=e},e.prototype.getHeaders=function(){return this._headers},e.prototype.setHeaders=function(e){this._headers=e},e.prototype.getData=function(){return this._data},e.prototype.setData=function(e){this._data=e},e.prototype.getContentType=function(){return this._contentType},e.prototype.setContentType=function(e){this._contentType=e},e.prototype.isAnonymous=function(){return this._anonymous},e.prototype.setAnonymous=function(e){this._anonymous=e},e.prototype.getAccept=function(){return this._accept},e.prototype.setAccept=function(e){this._accept=e},e.prototype.addHeader=function(e,t){return this._headers[e]=t},e.prototype.setAdminToken=function(e){return this._adminToken=e},e.prototype.execute=function(e,t){var i,n,r,s,o,a,l;if(this._success=null!=e.success?e.success:this._success,this._failure=null!=e.failure?e.failure:this._failure,this._ignoreBody=t,a=f.Kii.getBaseURL()+this._path,f.Kii.logger("POSTING: "),f.Kii.logger(this._data),o=u._isJSONType(this._contentType)?JSON.stringify(this._data):this._data,f.Kii.logger("Making request["+this._method+"] to "+a+" with data: "+o),i=f.Kii.getAdditionalHeaders(),null!=i)for(r in i)l=i[r],this._headers[r]=l;this._headers["x-kii-appid"]=f.Kii.getAppID(),this._headers["x-kii-appkey"]=f.Kii.getAppKey(),this._headers["x-kii-sdk"]=f.KiiSDKClientInfo.getSDKClientInfo(),null!=this._accept&&(this._headers.accept=this._accept),this._anonymous||null==f.KiiUser.getCurrentUser()||(this._headers.Authorization="Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),null!=this._adminToken&&(this._headers.Authorization="Bearer "+this._adminToken),null!=this._contentType&&(this._headers["Content-Type"]=this._contentType),f.Kii.logger("Headers: "),f.Kii.logger(this._headers),e={onComplete:function(e){return function(){var t,i,n,r,s,o,a,l,u;if(u=e._httpRequest.xhr,4===u.readyState){if(200<=(a=u.status)&&400>a){if(f.Kii.logger("Completed Request["+u.status+"]"),f.Kii.logger(u.responseText),l=e._parseResponseHeaders(u.getAllResponseHeaders()),e._ignoreBody)return e._success(null,u.status);try{o=JSON.parse(u.responseText)}catch(r){t=r,o=null}return null!=o?null!=o.errorCode?(i=o.errorCode,null!=o.message&&(i+=": "+o.message),e._failure(i,u.status,o.errorCode)):e._success(o,u.status,l):e._success(null,u.status,null)}f.Kii.logger("Error loading data..."),i=u.status+" : "+f.Kii.getBaseURL()+e._path;try{o=JSON.parse(decodeURIComponent(u.responseText))}catch(s){n=s,o=null}return null!=o&&null!=o.errorCode&&(i=o.errorCode,null!=o.message&&(i+=": "+o.message)),f.Kii.logger("Failure: "+i),f.Kii.logger(u.responseText),e._failure(i,u.status)}}}(this),onError:function(e){return function(){var t,i,n,r,s;s=e._httpRequest.xhr,f.Kii.logger("Error loading data..."),t=s.status+" : "+f.Kii.getBaseURL()+e._path;try{r=JSON.parse(decodeURIComponent(s.responseText))}catch(n){i=n,r=null}return null!=r&&null!=r.errorCode&&(t=r.errorCode,null!=r.message&&(t+=": "+r.message)),f.Kii.logger("Failure: "+t),f.Kii.logger(s.responseText),e._failure(t,s.status)}}(this)},this._httpRequest=this._createHttpRequest(this._method,a,e),null==this._httpRequest.xhr&&this._failure("Cross-Origin Resource Sharing is not supported by the browser.",0),s=this._headers;for(n in s)l=s[n],this._httpRequest.xhr.setRequestHeader(n,l);return"GET"!==this._method&&"DELETE"!==this._method?this._httpRequest.xhr.send(o):this._httpRequest.xhr.send()},e.prototype._createHttpRequest=function(e,t,i){var n;return n=null,null===f.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(f.Kii.logger("Use jQuery"),n=new s(e,t,i)):"undefined"!=typeof XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),n=new d(e,t,i)):"undefined"!=typeof Titanium&&(f.Kii.logger("Use Titanium"),n=new l(e,t,i)):(f.Kii.logger("Use http request backdoor"),f.Kii._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.Kii.logger("Use jQuery"),n=new s(e,t,i)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),n=new d(e,t,i)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),n=new l(e,t,i))),n},e.prototype._parseResponseHeaders=function(e){var t,i,n,r,s,o,a;if(n={},!e)return n;for(i=e.split("\r\n"),r=0;r<i.length;)t=i[r],s=t.indexOf(": "),s>0&&(o=t.substring(0,s),a=t.substring(s+2),n[o]=a),r++;return n},e}(),f.KiiUser=function(){function e(){this._setAuthToken=v(this._setAuthToken,this),this._getHttpURI=v(this._getHttpURI,this),this._clone=v(this._clone,this),this._getSubscriberPath=v(this._getSubscriberPath,this),this.pushSubscription=v(this.pushSubscription,this),this._listTopicsUsingCallbacks=v(this._listTopicsUsingCallbacks,this),this.listTopics=v(this.listTopics,this),this.topicWithName=v(this.topicWithName,this),this._groupWithJSON=v(this._groupWithJSON,this),this._setAuthHeader=v(this._setAuthHeader,this),this._getXhrWrapper=v(this._getXhrWrapper,this),this._getRequest=v(this._getRequest,this),this._updateWithJSON=v(this._updateWithJSON,this),this._validateLocalPhoneNumber=v(this._validateLocalPhoneNumber,this),this._validateIdentityData=v(this._validateIdentityData,this),this._updateWithUserFields=v(this._updateWithUserFields,this),this._updateWithIdentityData=v(this._updateWithIdentityData,this),this._deleteUsingCallbacks=v(this._deleteUsingCallbacks,this),this["delete"]=v(this["delete"],this),this._refreshUsingCallbacks=v(this._refreshUsingCallbacks,this),this.refresh=v(this.refresh,this),this._saveUsingCallbacks=v(this._saveUsingCallbacks,this),this.save=v(this.save,this),this._changeEmailUsingCallbacks=v(this._changeEmailUsingCallbacks,this),this.changeEmail=v(this.changeEmail,this),this._changePhoneUsingCallbacks=v(this._changePhoneUsingCallbacks,this),this.changePhone=v(this.changePhone,this),this._ownerOfGroupsUsingCallbacks=v(this._ownerOfGroupsUsingCallbacks,this),this.ownerOfGroups=v(this.ownerOfGroups,this),this._memberOfGroupsUsingCallbacks=v(this._memberOfGroupsUsingCallbacks,this),this.memberOfGroups=v(this.memberOfGroups,this),this.resendPhoneNumberVerification=v(this.resendPhoneNumberVerification,this),this.resendEmailVerification=v(this.resendEmailVerification,this),this._resendVerificationUsingCallbacks=v(this._resendVerificationUsingCallbacks,this),this.resendVerification=v(this.resendVerification,this),this.verifyPhoneNumber=v(this.verifyPhoneNumber,this),this._verifyCredentialsUsingCallbacks=v(this._verifyCredentialsUsingCallbacks,this),this.verifyCredentials=v(this.verifyCredentials,this),this._updatePasswordUsingCallbacks=v(this._updatePasswordUsingCallbacks,this),this.updatePassword=v(this.updatePassword,this),this._updateUsingCallbacks=v(this._updateUsingCallbacks,this),this.update=v(this.update,this),this._putIdentityUsingCallbacks=v(this._putIdentityUsingCallbacks,this),this.putIdentity=v(this.putIdentity,this),this._registerUsingCallbacks=v(this._registerUsingCallbacks,this),this.register=v(this.register,this),this._authenticateWithToken=v(this._authenticateWithToken,this),this._authenticate=v(this._authenticate,this),this.encryptedBucketWithName=v(this.encryptedBucketWithName,this),this.bucketWithName=v(this.bucketWithName,this),this.get=v(this.get,this),this.set=v(this.set,this),this.objectURI=v(this.objectURI,this),this.getAccessTokenObject=v(this.getAccessTokenObject,this),this._setExpiresAt=v(this._setExpiresAt,this),this._setAccessToken=v(this._setAccessToken,this),this.getAccessToken=v(this.getAccessToken,this),this.getLinkedSocialAccounts=v(this.getLinkedSocialAccounts,this),this._setPhoneVerified=v(this._setPhoneVerified,this),this.getPhoneVerified=v(this.getPhoneVerified,this),this._setEmailVerified=v(this._setEmailVerified,this),this.getEmailVerified=v(this.getEmailVerified,this),this._setModified=v(this._setModified,this),this.getModified=v(this.getModified,this),this._setCreated=v(this._setCreated,this),this.getCreated=v(this.getCreated,this),this.setCountry=v(this.setCountry,this),this.getCountry=v(this.getCountry,this),this._clearPassword=v(this._clearPassword,this),this._setPassword=v(this._setPassword,this),this._setPhoneNumber=v(this._setPhoneNumber,this),this.getPhoneNumber=v(this.getPhoneNumber,this),this._setEmailAddress=v(this._setEmailAddress,this),this.getEmailAddress=v(this.getEmailAddress,this),this.isPseudoUser=v(this.isPseudoUser,this),this.setDisplayName=v(this.setDisplayName,this),this.getDisplayName=v(this.getDisplayName,this),this._setDisabled=v(this._setDisabled,this),this.disabled=v(this.disabled,this),this._setUsername=v(this._setUsername,this),this.getUsername=v(this.getUsername,this),this.getID=v(this.getID,this),this._setUUID=v(this._setUUID,this),this.getUUID=v(this.getUUID,this),this._customInfo={}}return e.prototype.getUUID=function(){return this._uuid},e.prototype._setUUID=function(e){this._uuid=e},e.prototype.getID=function(){return this._uuid},e.prototype.getUsername=function(){return this._username},e.prototype._setUsername=function(e){var t;if(t=u._trim(e),f.Kii.logger("Setting username: "+t),u._validateUsername(t))return this._username=t;throw new f.InvalidUsernameException},e.prototype.disabled=function(){return this._disabled},e.prototype._setDisabled=function(e){this._disabled=e},e.prototype.getDisplayName=function(){return this._displayName},e.prototype.setDisplayName=function(e){if(!u._validateDisplayName(e))throw new f.InvalidDisplayNameException;return this._displayName=e},e.prototype.isPseudoUser=function(){return null!=this._hasPassword?!this._hasPassword:!this._username&&!this._emailAddress&&!this._phoneNumber},e.prototype.getEmailAddress=function(){return this._emailAddress},e.prototype._setEmailAddress=function(e){var t;if(t=u._trim(e),f.Kii.logger("Setting email: "+t),u._validateEmail(t))return this._emailAddress=t;throw new f.InvalidEmailException},e.prototype.getPhoneNumber=function(){return this._phoneNumber},e.prototype._setPhoneNumber=function(e){if(f.Kii.logger("Setting phone number: "+e),u._validatePhoneNumber(e))return this._phoneNumber=e;throw new f.InvalidPhoneNumberException},e.prototype._setPassword=function(e){if(u._validatePassword(e))return this._password=e;throw new f.InvalidPasswordException},e.prototype._clearPassword=function(){return this._password=null},e.prototype.getCountry=function(){return this._country},e.prototype.setCountry=function(e){if(u._validateCountryCode(e))return this._country=e;throw new f.InvalidCountryException},e.prototype.getCreated=function(){return this._created},e.prototype._setCreated=function(e){this._created=e},e.prototype.getModified=function(){return this._modified},e.prototype._setModified=function(e){this._modified=e},e.prototype.getEmailVerified=function(){return this._emailVerified},e.prototype._setEmailVerified=function(e){this._emailVerified=e},e.prototype.getPhoneVerified=function(){return this._phoneVerified},e.prototype._setPhoneVerified=function(e){this._phoneVerified=e},e.prototype.getLinkedSocialAccounts=function(){return f.Kii.logger("third party accounts: "+this._thirdPartyAccounts),null!=this._thirdPartyAccounts?this._thirdPartyAccounts:this._thirdPartyAccounts={}},e.prototype.getAccessToken=function(){return f.Kii.logger("Getting access token: "+this._accessToken),this._accessToken},e.prototype._setAccessToken=function(e){return this._accessToken=e,f.Kii.logger("Setting access token: "+this._accessToken)},e.prototype._setExpiresAt=function(e){return this._expiresAt=e,f.Kii.logger("Setting expires at: "+this._expiresAt)},e.prototype.getAccessTokenObject=function(){var e;return e=null,null!=this._accessToken&&(e={access_token:this._accessToken,expires_at:this._expiresAt}),e},e.prototype.objectURI=function(){var e;return e=null,null!=this._uuid&&(e="kiicloud://users/"+this._uuid),e},e.prototype.set=function(e,t){return f.Kii.logger(this),f.Kii.logger(this._customInfo),this._customInfo[e]=t},e.prototype.get=function(e){return this._customInfo[e]},e.getCurrentUser=function(){return f.Kii.getCurrentUser()},e.userWithUsername=function(e,t){var i;return i=new f.KiiUser,i._setUsername(e),i._setPassword(t),i},e._userWithEmailAddress=function(e,t){var i;return i=new f.KiiUser,i._setEmailAddress(e),i._setPassword(t),i},e._userWithPhoneNumber=function(e,t){var i;return i=new f.KiiUser,i._setPhoneNumber(e),i._setPassword(t),i},e.userWithPhoneNumber=function(t,i){return e._userWithPhoneNumber(t,i)},e.userWithPhoneNumberAndUsername=function(e,t,i){var n;return n=new f.KiiUser,n._setPhoneNumber(e),n._setUsername(t),n._setPassword(i),n},e.userWithEmailAddress=function(t,i){return e._userWithEmailAddress(t,i)},e.userWithEmailAddressAndUsername=function(e,t,i){var n;return n=new f.KiiUser,n._setEmailAddress(e),n._setUsername(t),n._setPassword(i),n},e.userWithEmailAddressAndPhoneNumber=function(e,t,i){var n;return n=new f.KiiUser,n._setEmailAddress(e),n._setPhoneNumber(t),n._setPassword(i),n},e.userWithCredentials=function(e,t,i,n){var r;return r=new f.KiiUser,r._setEmailAddress(e),r._setPhoneNumber(t),r._setUsername(i),r._setPassword(n),r},e._validateURI=function(e){var t,i,n;return e=u._trim(e),i=/^kiicloud:\/\/users\/(.*$)/i,"string"===(typeof e).toLowerCase()&&(t=e.match(i),null!=t&&(n=t[1])),n},e.userWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("userID should not null or empty");return t=new f.KiiUser,t._setUUID(e),t},e.userWithURI=function(e){var t,i;if(f.Kii.logger("About to extract from: "+e),i=f.KiiUser._validateURI(e),f.Kii.logger("Extracted uuid from uri: "+i),null==i)throw new f.InvalidURIException;return t=new f.KiiUser,t._setUUID(i),t},e.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucket(e,this)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucket(e,this)},e.prototype._authenticate=function(e){var t,i,n,r,s,o;return f.Kii.logger("Authenticating user:"),f.Kii.logger(this),f.Kii.logger("Email verified: "+this._emailVerified),f.Kii.logger("Phone verified: "+this._phoneVerified),null!=this._username?o=this._username:null!=this._emailAddress&&this._emailVerified===!0?o=this._emailAddress:null!=this._phoneNumber&&this._phoneVerified===!0?o=this._phoneNumber:null!=this._emailAddress?o=this._emailAddress:null!=this._phoneNumber&&(o=this._phoneNumber),n={username:o,password:this._password},r=new Date,i=r.getTime(),f.Kii.getAccessTokenExpiration()>0&&(n.expiresAt=u._safeCalculateExpiresAtAsNumber(f.Kii.getAccessTokenExpiration(),i)),s=this._getRequest({path:"/oauth2/token",withApp:!1}),s.setAnonymous(!0),s.setMethod("POST"),s.setData(n),t={success:function(t){return function(n){return t._setUUID(n.id),t._clearPassword(),t._setAccessToken(n.access_token),null!=n.expires_in&&(r=new Date,i=r.getTime(),t._expiresAt=u._safeCalculateExpiresAtAsDate(n.expires_in,i)),f.Kii.setCurrentUser(t),null!=e?e.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(t){return function(i){return t._clearPassword(),null!=e?e.failure(t,i):void 0}}(this)},s.execute(t,!1)},e.prototype._authenticateWithToken=function(e,t,i){var n,r;return f.Kii.logger("Authenticating user "+this),f.Kii.logger(t),r=this._getRequest({path:"/users/me",withApp:!0}),r.setAnonymous(!0),r.addHeader("Authorization","Bearer "+e),n={success:function(n){return function(r){return n._updateWithJSON(r),n._setAccessToken(e),n._setExpiresAt("undefined"==typeof i?new Date(u.MAX_DATE_IN_MILLIS):i),f.Kii.setCurrentUser(n),null!=t?t.success(f.Kii.getCurrentUser()):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},r.execute(n,!1)},e.authenticate=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success.apply(n,arguments),r(arguments[0])},failure:function(){var e;return null!=n&&n.failure.apply(n,arguments),e=u._Error(arguments[1]),e.target=arguments[0],s(e)}},e._authenticateUsingCallbacks(t,i,o)})},e._authenticateUsingCallbacks=function(e,t,i){var n,r,s;try{if(f.Kii.logger("UserIdentifier: "+e),!u._validatePassword(t))throw new f.InvalidPasswordException;if(u._validateEmail(e))s=f.KiiUser._userWithEmailAddress(e,t);else if(u._validatePhoneNumber(e))s=f.KiiUser._userWithPhoneNumber(e,t);else{if(!u._validateUsername(e))throw new f.InvalidUserIdentifierException;s=f.KiiUser.userWithUsername(e,t)}return s._authenticate(i)}catch(r){if(n=r,null!=s&&s._clearPassword(),null!=i)return i.failure(null,n.message)}},e.authenticateWithToken=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){var e;return null!=i&&i.failure.apply(i,arguments),e=u._Error(arguments[1]),e.target=arguments[0],s(e)}},e._authenticateWithTokenUsingCallbacks(t,o,n)})},e._authenticateWithTokenUsingCallbacks=function(e,t,i){var n,r;return n=u._type(i),"undefined"!==n&&"date"!==n?t.failure(null,f.InvalidArgumentException("Specified expiresAt must be a Date")):(r=new f.KiiUser,r._authenticateWithToken(e,t,i))},e.prototype.register=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._registerUsingCallbacks(r)}}(this))},e.prototype._registerUsingCallbacks=function(e){var t,i,n,r,s,o;if(f.Kii.logger("Registering user "+this),t={password:this._password},null!=this._username&&(t.loginName=this._username),null!=this._displayName&&(t.displayName=this._displayName),null!=this._emailAddress&&(t.emailAddress=this._emailAddress),null!=this._phoneNumber&&(t.phoneNumber=this._phoneNumber),!this._validateLocalPhoneNumber(this._phoneNumber,this._country))return void e.failure(this,"needs to provide country for the local phone number");null!=this._country&&(t.country=this._country),f.Kii.logger("CINFO"),f.Kii.logger(this._customInfo),n=this._customInfo;for(i in n)o=n[i],f.Kii.logger("Key/val: "+i+"/"+o),t[i]=o;return s=this._getRequest({path:"/users",withApp:!0}),s.setMethod("POST"),s.setData(t),s.setAnonymous(!0),s.setContentType("application/vnd.kii.RegistrationRequest+json"),r={success:function(t){return function(i){return f.Kii.logger("Succreg"),t._updateWithJSON(i),t._authenticate(e)}}(this),failure:function(t){return function(i){return f.Kii.logger("Failreg"),t._clearPassword(),null!=e?e.failure(t,i):void 0}}(this)},s.execute(r,!1)},e.registerAsPseudoUser=function(t,i){return new Promise(function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1]))}},e._registerAsPseudoUserUsingCallbacks(s,i)})},e._registerAsPseudoUserUsingCallbacks=function(e,t){var i,n,r,s,o;return r=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users",s=p.createXHRWrapper("POST",r),o=s.xhr,o.setRequestHeader("x-kii-appid",f.Kii.getAppID()),o.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),o.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),o.setRequestHeader("Content-Type","application/vnd.kii.RegistrationAndAuthorizationRequest+json"),n={success:function(){var t,i,n,s;try{return o.status<300&&o.status>=200?(n=JSON.parse(o.responseText),t=n._accessToken,s=new f.KiiUser,s._updateWithJSON(n),s._setAccessToken(t),s._setExpiresAt(new Date(u.MAX_DATE_IN_MILLIS)),f.Kii.setCurrentUser(s),e.success(s)):(i=o.status+" : "+r,e.failure(null,i))}catch(a){return e.failure(null,"failed to parse response")}},failure:function(){var t,i;t="failed to register pseudo user. statusCode: "+o.status;try{if(i=JSON.parse(o.responseText),null!=i.errorCode&&(t+=" error code: "+i.errorCode),null!=i.message)return t+=" error message: "+i.message}catch(n){}finally{e.failure(null,t)}}},null==t&&(t={}),i=JSON.stringify(t),s.sendData(i,n)},e.prototype.putIdentity=function(e,t,i,n,r){return new Promise(function(s){return function(o,a){var l;return l={success:function(){return null!=i&&i.success.apply(i,arguments),o(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),a(u._Error(arguments[1],s))}},s._putIdentityUsingCallbacks(e,t,l,n,r)}}(this))},e.prototype._putIdentityUsingCallbacks=function(e,t,i,n,r){var s,o,a,l,c;if(f.Kii.logger("Put identity user: "+this._uuid),o={},!this.isPseudoUser())return void(null!=i&&i.failure(this,"This user has the identity already"));if(null==e)return void(null!=i&&i.failure(this,"identityData is null"));try{this._validateIdentityData(e)}catch(a){return l=a,void(null!=i&&i.failure(this,l))}return c=!1,null!=e.emailAddress&&(c=!0),null!=e.phoneNumber&&(c=!0),null!=e.username&&(c=!0),c?null==t?void(null!=i&&i.failure(this,"password is null")):u._validatePassword(t)?(s=null!=n?n.country:null,null==e.phoneNumber||this._validateLocalPhoneNumber(e.phoneNumber,s)?this.refresh({failure:function(e){return function(t,n){return f.Kii.logger("Failreg"),null!=i?i.failure(e,n):void 0}}(this),success:function(s){return function(a){var l,u,c,p,d,g,h,m,v,_;if(!a.isPseudoUser())return void(null!=i&&i.failure(a,"This user has the identity already"));if(o=s._clone(a._customInfo),null!=e.emailAddress&&(o.emailAddress=e.emailAddress),null!=e.phoneNumber&&(o.phoneNumber=e.phoneNumber),null!=e.username&&(o.loginName=e.username),o.password=t,null!=n)for(c in n)m=n[c],o[c]=m;if(null!=r)for(l=0,p=r.length;p>l;l++)d=r[l],delete o[d];return h=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/"+s._uuid),v=s._getXhrWrapper("POST",h),_=v.xhr,s._setAuthHeader(_),_.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),g={success:function(){var t,o;try{return o=JSON.parse(_.responseText),_.status<300&&_.status>=200?(a._setModified(o.modifiedAt),a._updateWithIdentityData(e),a._updateWithUserFields(n,r),s._hasPassword=!0,i.success(a)):(t=_.status+" : "+h,i.failure(s,t))}catch(l){return i.failure(s,"failed to parse response")}},failure:function(){var e,t;e="failed to put identity data. statusCode: "+_.status;try{if(t=JSON.parse(_.responseText),null!=t.errorCode&&(e+=" error code: "+t.errorCode),null!=t.message)return e+=" error message: "+t.message}catch(n){}finally{i.failure(s,e)}}},u=JSON.stringify(o),v.sendData(u,g)}}(this)}):void i.failure(this,"needs to provide country for the local phone number")):void(null!=i&&i.failure(this,"invalid password")):void(null!=i&&i.failure(this,"needs to provide at least one of login name, email address or phone number"))},e.prototype.update=function(e,t,i,n){return new Promise(function(r){return function(s,o){var a;return a={success:function(){return null!=t&&t.success.apply(t,arguments),s(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),o(u._Error(arguments[1],r))}},r._updateUsingCallbacks(e,a,i,n)}}(this))},e.prototype._updateUsingCallbacks=function(e,t,i,n){var r,s,o,a,l,u,c,p,d,g,h,m;if(f.Kii.logger("update user: "+this._uuid),s={},l=!1,c=!1,u=!1,null!=e){try{this._validateIdentityData(e)}catch(o){return a=o,void(null!=t&&t.failure(this,a))}null!=e.emailAddress&&(l=!0),null!=e.phoneNumber&&(l=!0),null!=e.username&&(l=!0)}if(null!=i)for(d in i){m=i[d],c=!0;break}if(null!=n)for(p=0,g=n.length;g>p;p++){h=n[p],u=!0;break}return l||c||u?(r=null!=i?i.country:null,null==e||null==e.phoneNumber||this._validateLocalPhoneNumber(e.phoneNumber,r)?this.refresh({failure:function(e){return function(i,n){return f.Kii.logger("Failreg"),null!=t?t.failure(e,n):void 0}}(this),success:function(r){return function(o){var a,u,c,p,g,v,_;if(o.isPseudoUser()&&l)return void(null!=t&&t.failure(o,"Pseudo user must use putIdentity()"));if(s=r._clone(o._customInfo),null!=e&&(null!=e.emailAddress&&(s.emailAddress=e.emailAddress),null!=e.phoneNumber&&(s.phoneNumber=e.phoneNumber),null!=e.username&&(s.loginName=e.username)),null!=i)for(d in i)m=i[d],s[d]=m;if(null!=n)for(u=0,c=n.length;c>u;u++)h=n[u],delete s[h];return g=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/"+r._uuid),v=r._getXhrWrapper("POST",g,!1),_=v.xhr,r._setAuthHeader(_),_.setRequestHeader("Content-Type","application/vnd.kii.UserUpdateRequest+json"),p={success:function(){var a,l;try{return l=JSON.parse(_.responseText),_.status<300&&_.status>=200?(o._setModified(s.modifiedAt),o._updateWithIdentityData(e),o._updateWithUserFields(i,n),t.success(o)):(a=_.status+" : "+g,t.failure(r,a))}catch(u){return t.failure(r,"failed to parse response")}},failure:function(){var e,i;e="failed to update user. statusCode: "+_.status;try{if(i=JSON.parse(_.responseText),null!=i.errorCode&&(e+=" error code: "+i.errorCode),null!=i.message)return e+=" error message: "+i.message}catch(n){}finally{t.failure(r,e)}}},a=JSON.stringify(s),v.sendData(a,p)}}(this)}):void t.failure(this,"needs to provide country for the local phone number")):void t.failure(this,"all arguments are null or empty")},e.prototype.updatePassword=function(e,t,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(u._Error(arguments[1],n))}},n._updatePasswordUsingCallbacks(e,t,o)}}(this))},e.prototype._updatePasswordUsingCallbacks=function(e,t,i){var n,r,s,o;return f.Kii.logger("Updating password from "+e+" to "+t),u._validatePassword(t)?(n={oldPassword:e,newPassword:t},r="/users/"+this._uuid+"/password",s=this._getRequest({path:r,withApp:!0}),s.setMethod("PUT"),s.setData(n),s.setContentType("application/vnd.kii.ChangePasswordRequest+json"),o={success:function(e){return function(t,n){if(e._clearPassword,300>n&&n>=200){if(null!=i)return i.success(e)}else if(null!=i)return i.failure(e,"Unable to change password")}}(this),failure:function(e){return function(t){return e._clearPassword,null!=i?i.failure(e,t):void 0}}(this)},s.execute(o,!0)):null!=i?i.failure(this,(new f.InvalidPasswordException).message):void 0},e.resetPassword=function(t,i){return new Promise(function(n,r){var s;return s={success:function(){return null!=i&&i.success(),n()},failure:function(){return null!=i&&i.failure(arguments[0]),r(u._Error(arguments[0]))}},e._resetPasswordUsingCallbacks(t,s)})},e._resetPasswordUsingCallbacks=function(e,t){var i,n,r,s;if(f.Kii.logger("Resetting password with identifier: "+e),u._validateEmail(e))i="EMAIL";else if(null!=t)return void t.failure("Invalid user identifier. Must be a valid email address");return null!=i?(n="/users/"+i+":"+e+"/password/request-reset",r=new o(n,!0),r.setMethod("POST"),r.setAnonymous(!0),s={success:function(e,i){return 300>i&&i>=200&&null!=t?t.success():null!=t?t.failure("Unable to reset password"):void 0},failure:function(e){return null!=t?t.failure(e):void 0}},r.execute(s,!0)):void 0},e.resetPasswordWithNotificationMethod=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success(),r()},failure:function(){return null!=n&&n.failure(arguments[0]),s(u._Error(arguments[0]))}},e._resetPasswordWithNotificationMethodUsingCallbacks(t,i,o)})},e._resetPasswordWithNotificationMethodUsingCallbacks=function(e,t,i){var n,r,s,o,a,l;return"string"!=typeof e?void(null!=i&&i.failure("given userIdentifier is not string")):""===e?void(null!=i&&i.failure("given userIdentifier is empty")):"EMAIL"!==t&&"SMS"!==t?void(null!=i&&i.failure("notificationMethod should be 'EMAIL' or 'SMS'")):(r=u._validateEmail(e)?"EMAIL:"+e:u._isGlobalPhoneNumber(e)?"PHONE:"+e:e,r=encodeURIComponent(r),n={notificationMethod:t},o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users/"+r+"/password/request-reset",a=p.createXHRWrapper("POST",o),l=a.xhr,l.setRequestHeader("x-kii-appid",f.Kii.getAppID()),l.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),l.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),l.setRequestHeader("Content-Type","application/vnd.kii.ResetPasswordRequest+json"),s={success:function(){return null!=i?i.success():void 0},failure:function(){var e,t;e="failed to reset password. statusCode: "+l.status;try{if(t=JSON.parse(l.responseText),null!=t.errorCode&&(e+=" error code: "+t.errorCode),null!=t.message)return e+=" error message: "+t.message}catch(n){}finally{null!=i&&i.failure(e)}}},a.sendData(JSON.stringify(n),s))},e.prototype.verifyCredentials=function(e,t,i){return new Promise(function(n){return function(r,s){var o;return o={success:function(){return null!=i&&i.success.apply(i,arguments),r(arguments[0])},failure:function(){return null!=i&&i.failure.apply(i,arguments),s(u._Error(arguments[1],n))}},n._verifyCredentialsUsingCallbacks(e,t,o)}}(this))},e.prototype._verifyCredentialsUsingCallbacks=function(e,t,i){var n,r,s;return f.Kii.logger("Verifying "+e+" with code: "+t),n="/users/me/"+e+"/verify",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),r.setData({verificationCode:t}),r.setContentType("application/vnd.kii.AddressVerificationRequest+json"),s={success:function(t){return function(n,r){if(300>r&&r>=200){if("email-address"===e?t._setEmailVerified(!0):"phone-number"===e&&t._setPhoneVerified(!0),null!=i)return i.success(t)}else if(null!=i)return i.failure(t,"Unable to verify "+e)}}(this),failure:function(e){return function(t){return null!=i?i.failure(e,t):void 0}}(this)},r.execute(s,!0)},e.prototype.verifyPhoneNumber=function(e,t){return this.verifyCredentials("phone-number",e,t)},e.prototype.resendVerification=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._resendVerificationUsingCallbacks(e,s)}}(this))},e.prototype._resendVerificationUsingCallbacks=function(e,t){var i,n,r,s;return f.Kii.logger("Resending verification "+e),i=this.getID(),n="/users/"+i+"/"+e+"/resend-verification",r=this._getRequest({path:n,withApp:!0}),r.setMethod("POST"),s={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?t.success(i):null!=t?t.failure(i,"Unable to resend "+e+" verification"):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},r.execute(s,!0)},e.prototype.resendEmailVerification=function(e){return this.resendVerification("email-address",e)},e.prototype.resendPhoneNumberVerification=function(e){return this.resendVerification("phone-number",e)},e.prototype.memberOfGroups=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._memberOfGroupsUsingCallbacks(r)}}(this))},e.prototype._memberOfGroupsUsingCallbacks=function(e){var t,i,n;return f.Kii.logger("Getting groups for member "+this._uuid),i="/groups/?is_member="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,a,l;if(300>n&&n>=200){for(s=[],l=i.groups,o=0,a=l.length;a>o;o++)r=l[o],s.push(t._groupWithJSON(r));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,"Unable to retrieve groups")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(t,!1)},e.prototype.ownerOfGroups=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._ownerOfGroupsUsingCallbacks(r)}}(this))},e.prototype._ownerOfGroupsUsingCallbacks=function(e){var t,i,n;return f.Kii.logger("Getting groups owned by the user "+this._uuid),i="/groups/?owner="+this._uuid,n=this._getRequest({path:i,withApp:!0}),n.setAccept("application/vnd.kii.GroupsRetrievalResponse+json"),t={success:function(t){return function(i,n){var r,s,o,a,l;
if(300>n&&n>=200){for(s=[],l=i.groups,o=0,a=l.length;a>o;o++)r=l[o],s.push(t._groupWithJSON(r));if(null!=e)return e.success(t,s)}else if(null!=e)return e.failure(t,"Unable to retrieve groups")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(t,!1)},e.prototype.changePhone=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._changePhoneUsingCallbacks(e,s)}}(this))},e.prototype._changePhoneUsingCallbacks=function(e,t){var i,n,r;return f.Kii.logger("Updating phone number to "+e),i="/users/"+this._uuid+"/phone-number",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.PhoneNumberModificationRequest+json"),n.setData({phoneNumber:e}),r={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?(i._setPhoneVerified(!1),i._setPhoneNumber(e),t.success(i)):null!=t?t.failure(i,"Unable to update phone number"):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!0)},e.prototype.changeEmail=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments[0])},failure:function(){return null!=t&&t.failure.apply(t,arguments),r(u._Error(arguments[1],i))}},i._changeEmailUsingCallbacks(e,s)}}(this))},e.prototype._changeEmailUsingCallbacks=function(e,t){var i,n,r;return f.Kii.logger("Updating email address to: "+e),u._validateEmail(e)?(i="/users/"+this._uuid+"/email-address",n=this._getRequest({path:i,withApp:!0}),n.setMethod("PUT"),n.setContentType("application/vnd.kii.EmailAddressModificationRequest+json"),n.setData({emailAddress:e}),r={success:function(i){return function(n,r){return 300>r&&r>=200&&null!=t?(i._setEmailVerified(!1),i._setEmailAddress(e),t.success(i)):null!=t?t.failure(i,"Unable to update email address"):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(e,i):void 0}}(this)},n.execute(r,!0)):t.failure(this,"Invalid email address format")},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._saveUsingCallbacks(r)}}(this))},e.prototype._saveUsingCallbacks=function(e){var t,i,n,r;return f.Kii.logger("Saving user: "+this._uuid),i="/users/"+this._uuid,f.Kii.logger("CUSTOMINFO: "),f.Kii.logger(this._customInfo),n=this._getRequest({path:i,withApp:!0}),n.setMethod("POST"),n.setContentType("application/vnd.kii.UserUpdateRequest+json"),t=this._customInfo,null!=this._country&&(t.country=this._country),null!=this._displayName&&(t.displayName=this._displayName),n.setData(t),r={success:function(t){return function(i,n){if(300>n&&n>=200){if(t._setModified(i.modifiedAt),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},n.execute(r,!1)},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._refreshUsingCallbacks(r)}}(this))},e.prototype._refreshUsingCallbacks=function(e){var t,i;return f.Kii.logger("Refreshing user: "+this._uuid),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),t={success:function(t){return function(i,n){if(300>n&&n>=200){if(t._updateWithJSON(i),null!=e)return e.success(t)}else if(null!=e)return e.failure(t,"Unable to parse response")}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!1)},e.prototype["delete"]=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(){return null!=e&&e.success.apply(e,arguments),i(arguments[0])},failure:function(){return null!=e&&e.failure.apply(e,arguments),n(u._Error(arguments[1],t))}},t._deleteUsingCallbacks(r)}}(this))},e.prototype._deleteUsingCallbacks=function(e){var t,i;return f.Kii.logger("Deleting user..."),i=this._getRequest({path:"/users/"+this._uuid,withApp:!0}),i.setMethod("DELETE"),t={success:function(t){return function(i,n){return 300>n&&n>=200&&null!=e?e.success(t):null!=e?e.failure(t,"Unable to parse response"):void 0}}(this),failure:function(t){return function(i){return null!=e?e.failure(t,i):void 0}}(this)},i.execute(t,!0)},e.logOut=function(){return f.Kii.logOut()},e.loggedIn=function(){return f.Kii.loggedIn()},e.prototype._updateWithIdentityData=function(e){return null!=e&&(null!=e.username&&(this._username=e.username),null!=e.emailAddress&&(this._emailAddress=e.emailAddress),null!=e.phoneNumber)?this._phoneNumber=e.phoneNumber:void 0},e.prototype._updateWithUserFields=function(e,t){var i,n,r,s,o,a;if(null!=e)for(n in e)a=e[n],"displayName"===n?this._displayName=a:"country"===n?this._country=a:""===n?(f.Kii.logger("Setting empty to custom info"),this._customInfo[n]=a):n.substring(0,!0)&&(f.Kii.logger("Setting to custom info"),this._customInfo[n]=a);if(null!=t){for(o=[],i=0,r=t.length;r>i;i++)s=t[i],o.push(delete this._customInfo[s]);return o}},e.prototype._validateIdentityData=function(e){if(null!=e){if(null!=e.emailAddress&&!u._validateEmail(e.emailAddress))throw"invalid email";if(null!=e.phoneNumber&&!u._validatePhoneNumber(e.phoneNumber))throw"invalid phone number";if(null!=e.username&&!u._validateUsername(e.username))throw"invalid username"}},e.prototype._validateLocalPhoneNumber=function(e,t){return null==e||u._isGlobalPhoneNumber(e)?!0:null!=t?u._validateCountryCode(t):!1},e.prototype._updateWithJSON=function(e){var t,i,n,r;f.Kii.logger("Updating with:"),f.Kii.logger(e),this._thirdPartyAccounts={},i=[];for(t in e)r=e[t],f.Kii.logger("key/val => "+t+"/"+r),f.Kii.logger("Substr "+t.substring(0,1)),"userID"===t||"id"===t?i.push(this._uuid=r):"created"===t||"createdAt"===t||"_created"===t?i.push(this._created=r):"modified"===t||"modifiedAt"===t||"_modified"===t?i.push(this._modified=r):"loginName"===t?i.push(this._username=r):"displayName"===t?i.push(this._displayName=r):"country"===t?(f.Kii.logger("Is setting country"),i.push(this._country=r)):"emailAddress"===t?i.push(this._emailAddress=r):"phoneNumber"===t?i.push(this._phoneNumber=r):"emailAddressVerified"===t?(f.Kii.logger("Email verified: "+r),i.push(this._emailVerified=r)):"phoneNumberVerified"===t?(f.Kii.logger("Phone verified: "+r),i.push(this._phoneVerified=r)):"_hasPassword"===t?(f.Kii.logger("_hasPassword: "+r),i.push(this._hasPassword=r)):"_thirdPartyAccounts"===t?(null!=r.hotmail&&(n=r.hotmail,n.type="live",r.live=n,delete r.hotmail),f.Kii.logger("_thirdPartyAccounts: "+r),i.push(this._thirdPartyAccounts=r)):"_disabled"===t?(f.Kii.logger("disabled: "+r),i.push(this._disabled=r)):""===t?(f.Kii.logger("Setting empty to custom info"),i.push(this._customInfo[t]=r)):t.substring(0,!0)?(f.Kii.logger("Setting to custom info"),i.push(this._customInfo[t]=r)):i.push(f.Kii.logger("Doing nothing"));return i},e.prototype._getRequest=function(e){var t,i,n;return t=e.path,n=e.withApp,i=new o(t,n)},e.findUserByEmail=function(t,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=u._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):e._findUserByEmail(t,i)},e._findUserByEmail=function(t,i,n){var r,s,o;return null==t||""===t?(s=f.InvalidArgumentException("email should not null or empty"),r=u._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/EMAIL:"+t),e._findUserRequestImpl(o,i,n))},e.findUserByPhone=function(t,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=u._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):e._findUserByPhone(t,i)},e._findUserByPhone=function(t,i,n){var r,s,o;return null==t||""===t?(s=f.InvalidArgumentException("phone should not null or empty"),r=u._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/PHONE:"+t),e._findUserRequestImpl(o,i,n))},e.findUserByUsername=function(t,i){var n,r;return null==f.KiiUser.getCurrentUser()||null==f.KiiUser.getCurrentUser().getAccessToken()?(r=f.IllegalStateException("User is not logged in"),n=u._Error(r),null!=i&&"function"==typeof i.failure&&i.failure(r),Promise.reject(n)):e._findUserByUsername(t,i)},e._findUserByUsername=function(t,i,n){var r,s,o;return null==t||""===t?(s=f.InvalidArgumentException("username should not null or empty"),r=u._Error(s),null!=n?(null!=i&&"function"==typeof i.failure&&i.failure(n,s),r.target=n):null!=i&&"function"==typeof i.failure&&i.failure(s),Promise.reject(r)):(o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/users/LOGIN_NAME:"+t),e._findUserRequestImpl(o,i,n))},e._findUserRequestImpl=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){var e;return null!=i&&null!=(e=i.success)&&e.apply(i,arguments),r(null!=n?arguments:arguments[0])},failure:function(){var e;return null!=i&&null!=(e=i.failure)&&e.apply(i,arguments),s(null!=n?u._Error(arguments[1],arguments[0]):u._Error(arguments[0]))}},e._findUserRequestImplUsingCallbacks(t,o,n)})},e._findUserRequestImplUsingCallbacks=function(e,t,i){var n,r,s;return r=p.createXHRWrapper("GET",e),s=r.xhr,s.setRequestHeader("x-kii-appid",f.Kii.getAppID()),s.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),s.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),null!=i?s.setRequestHeader("Authorization","Bearer "+i._getToken()):s.setRequestHeader("Authorization","Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),n={success:function(){var e,n;if(null!=t)try{return e=JSON.parse(s.responseText),null!=i?(n=new f.KiiUserAdmin(i._getToken()),n._updateWithJSON(e),t.success(i,n)):(n=new f.KiiUser,n._updateWithJSON(e),t.success(n))}catch(r){return null!=i?t.failure(i,"Unable to parse response"):t.failure("Unable to parse response")}},failure:function(){var e,n;if(null!=t){e="Failed to find user. statusCode: "+s.status;try{if(n=JSON.parse(s.responseText),null!=n.errorCode&&(e+=" error code: "+n.errorCode),null!=n.message)return e+=" error message: "+n.message}finally{null!=i?t.failure(i,e):t.failure(e)}}}},r.send(n)},e.prototype._getXhrWrapper=function(e,t){var i,n;return i=p.createXHRWrapper(e,t),n=i.xhr,n.setRequestHeader("x-kii-appid",f.Kii.getAppID()),n.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),n.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),i},e.prototype._setAuthHeader=function(e){var t;return t=f.KiiUser.getCurrentUser(),null!=t?e.setRequestHeader("Authorization","Bearer "+t.getAccessToken()):void 0},e.prototype._groupWithJSON=function(e){return f.KiiGroup._groupWithJSON(e)},e.prototype.topicWithName=function(e){var t,i;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopic(i,e)},e.prototype.listTopics=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,t)}}(this))},e.prototype._listTopicsUsingCallbacks=function(e,t){var i,n,r;return n=this._getHttpURI()+"/topics","string"==typeof t&&""!==t&&(n=n+"?paginationKey="+encodeURIComponent(t)),r=p.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(t){return function(){var i,n,s,o,a,l;for(n=JSON.parse(r.xhr.responseText),l=[],o=n.topics,i=0,s=o.length;s>i;i++)a=o[i],l.push(t.topicWithName(a.topicID));return null!=e?e.success(l,void 0===n.paginationKey?null:n.paginationKey):void 0}}(this),failure:function(t){return function(){var i,n;return n=r.getErrorString("list topics"),i=u._Error(n,t),null!=e?e.failure(i):void 0}}(this)},r.send(i)},e.prototype.pushSubscription=function(){return new f.KiiPushSubscription(this)},e.prototype._getSubscriberPath=function(){return"users/"+this.getID()},e.prototype._clone=function(e){var t,i;if(null==e||"object"!=typeof e)return e;i=new e.constructor;for(t in e)i[t]=this._clone(e[t]);return i},e.prototype._getHttpURI=function(){return f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/users/"+this.getID()},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e}(),u=function(){function e(){}return e.MAX_DATE_IN_MILLIS=864e13,e.MIN_DATE_IN_MILLIS=-864e13,e._validateEmail=function(t){var i;return t=e._trim(t),i=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):t.match(i)?!0:!1},e._validatePhoneNumber=function(t){var i;return t=e._trim(t),i=/^[\\+]?[0-9]{10,}$/i,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):t.match(i)?!0:!1},e._isGlobalPhoneNumber=function(t){var i;return t=e._trim(t),i=/^[\\+]{1}[0-9]{2}/,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):t.match(i)?!0:!1},e._validateLocalPhone=function(t){var i;return t=e._trim(t),i=/^\d+$/,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):t.match(i)?!0:(f.Kii.logger("Invalid format"),!1)},e._assertLocalPhoneIsValid=function(t){if(!e._validateLocalPhone(t))throw new f.InvalidLocalPhoneNumberException},e._validateCountryCode=function(t){var i;return t=e._trim(t),i=/^[a-z]{2}$/i,"string"!==(typeof t).toLowerCase()?(f.Kii.logger("Not string"),!1):t.match(i)?(f.Kii.logger("Is true"),!0):!1},e._assertCountryCodeIsValid=function(t){if(!e._validateCountryCode(t))throw new f.InvalidCountryException},e._validatePassword=function(e){var t;return f.Kii.logger("Validating password: "+e),t=/^[\x20-\x7E]{4,50}$/,"string"!==(typeof e).toLowerCase()?(f.Kii.logger("not string"),!1):e.match(t)?(f.Kii.logger("matched"),!0):(f.Kii.logger("other exception"),!1)},e._assertPasswordIsValid=function(t){if(!e._validatePassword(t))throw new f.InvalidPasswordException},e._validateUsername=function(e){var t;return t=/^[a-zA-Z0-9-_\\.]{3,64}$/i,"string"!==(typeof e).toLowerCase()?!1:e.match(t)?!0:!1},e._validateDisplayName=function(t){var i;return"string"===e._type(t)&&1<=(i=t.length)&&50>=i},e._trim=function(e){var t;return t=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,(e||"").replace(t,"")},e._safeAddTicks=function(t,i){if(isNaN(parseInt(t,10))||isNaN(parseInt(i,10)))throw new f.InvalidArgumentException("Parameters should be a number");if(Math.abs(t+i)>e.MAX_DATE_IN_MILLIS)throw new f.ArithmeticException("Addition of "+t+" and "+i+" result in long overflow");return t+i},e._safeMultiplyTicks=function(t,i){if(isNaN(parseInt(t,10))||isNaN(parseInt(i,10)))throw new f.InvalidArgumentException("Parameters should be a number");if(Math.abs(t*i)>e.MAX_DATE_IN_MILLIS)throw new f.ArithmeticException("Multiplication of "+t+" and "+i+" result in long overflow");return t*i},e._safeCalculateExpiresAtAsNumber=function(t,i){var n,r,s,o;o=0;try{s=e._safeMultiplyTicks(t,1e3),o=e._safeAddTicks(i,s)}catch(r){if(n=r,!(n instanceof f.ArithmeticException))throw n;o=e.MAX_DATE_IN_MILLIS}return o},e._safeCalculateExpiresAtAsDate=function(t,i){var n,r,s,o;o=0;try{s=e._safeMultiplyTicks(t,1e3),o=e._safeAddTicks(i,s)}catch(r){if(n=r,!(n instanceof f.ArithmeticException))throw n;o=e.MAX_DATE_IN_MILLIS}return new Date(o)},e._isJSONType=function(e){var t;return t=/\+?json(;.*)?$/i,e.match(t)},e._type=function(e){var t;return void 0===e||null===e?String(e):(t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},t[Object.prototype.toString.call(e)])},e._disableCacheURL=function(e){return e+=-1!==e.indexOf("?")?"&disable_cache=":"?disable_cache=",e+=(new Date).getTime()},e._validateServerCodeEntryName=function(t){var i;return i=/^[a-zA-Z][_a-zA-Z0-9]*$/i,"string"===e._type(t)&&t.match(i)},e._validateServerCodeEntryArgument=function(t){return"null"===e._type(t)||"object"===e._type(t)&&Object.keys(t).length>0},e._validateServerCodeEnryVersion=function(t){return"string"===e._type(t)&&""!==t},e._isNonEmptyString=function(e){return"string"!=typeof e?!1:e.length>0},e._Error=function(e,t){var i;return i=Error(e),null!=t&&(i.target=t),i},e}(),f.KiiSocialConnect=function(){function e(){}var t;return t=null,e.setupNetwork=function(){},e.logIn=function(i,n,r){return null==t&&(t=new m),new Promise(function(t,s){var o,a,l,c;c={success:function(){return null!=r&&r.success.apply(r,arguments),t(arguments)},failure:function(){var e;return null!=r&&r.failure.apply(r,arguments),e=u._Error(arguments[2]),e.network=i,s(e)}};try{return e._logInUsingCallbacks(i,n,c)}catch(a){return l=a,null!=r&&"function"==typeof r.failure&&r.failure(null,i,l),o=u._Error(l),o.network=i,s(o)}})},e._logInUsingCallbacks=function(e,i,n){var r;return r=!1,null!=t&&(f.Kii.logger("And manager: "),f.Kii.logger(t._getManager(e)),t._getManager(e)&&(t._getManager(e)._logIn(i,n),r=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(n),r||null==n?void 0:n.failure(f.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.linkCurrentUserWithNetwork=function(i,n,r){return null==t&&(t=new m),new Promise(function(t,s){var o,a,l,c,p;p={success:function(){return null!=r&&r.success.apply(r,arguments),t(arguments)},failure:function(){var e;return null!=r&&r.failure.apply(r,arguments),e=u._Error(arguments[2]),e.target=arguments[0],e.network=i,s(e)}};try{return e._linkCurrentUserWithNetworkUsingCallbacks(i,n,p)}catch(l){return c=l,o=f.KiiUser.getCurrentUser(),null!=r&&"function"==typeof r.failure&&r.failure(o,i,c),a=u._Error(c),a.target=o,a.network=i,s(a)}})},e._linkCurrentUserWithNetworkUsingCallbacks=function(e,i,n){var r;return f.Kii.logger("Trying with instance"),f.Kii.logger(t),r=!1,null!=t&&(f.Kii.logger("And manager: "),f.Kii.logger(t._getManager(e)),t._getManager(e)&&(t._getManager(e)._linkWithCurrentUser(i,n),r=!0)),f.Kii.logger("Callbacks"),f.Kii.logger(n),r||null==n?void 0:n.failure(f.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.unLinkCurrentUserFromNetwork=function(i,n){return null==t&&(t=new m),new Promise(function(t,r){var s;return s={success:function(){return null!=n&&n.success.apply(n,arguments),t(arguments)},failure:function(){var e;return null!=n&&n.failure.apply(n,arguments),e=u._Error(arguments[2]),e.target=arguments[0],e.network=i,r(e)}},e._unLinkCurrentUserWithNetworkUsingCallbacks(i,s)})},e._unLinkCurrentUserWithNetworkUsingCallbacks=function(e,i){if(f.Kii.logger("Trying with instance"),f.Kii.logger(t),null!=t){if(f.Kii.logger("And manager: "),f.Kii.logger(t._getManager(e)),t._getManager(e))return t._getManager(e)._unlinkFromCurrentUser(i)}else if(null!=i)return i.failure(f.KiiUser.getCurrentUser(),e,"Unable to get network. Please ensure the network name is one of the supported KiiSocialNetworkName values")},e.getAccessTokenForNetwork=function(e){return null!=t?t._getManager(e)._getToken():void 0},e.getAccessTokenExpirationForNetwork=function(e){return null!=t?t._getManager(e)._getTokenExpiration():void 0},e.getAccessTokenObjectForNetwork=function(e){return null!=t?t._getManager(e)._getTokenObject():void 0},e.logOutAll=function(){var e,i,n,r,s;return null!=t&&(e=t._getManager(f.KiiSocialNetworkName.FACEBOOK),null!=e&&e._logOut(),s=t._getManager(f.KiiSocialNetworkName.TWITTER),null!=s&&s._logOut(),n=t._getManager(f.KiiSocialNetworkName.QQ),null!=n&&n._logOut(),i=t._getManager(f.KiiSocialNetworkName.GOOGLEPLUS),null!=i&&i._logOut(),r=t._getManager(f.KiiSocialNetworkName.RENREN),null!=r)?r._logOut():void 0},e}(),m=function(){function e(){this._getManager=v(this._getManager,this)}return e.prototype._getManager=function(e){return e===f.KiiSocialNetworkName.FACEBOOK?null!=this._facebookManager?this._facebookManager:this._facebookManager=new f.KiiSCNFacebook:e===f.KiiSocialNetworkName.TWITTER?null!=this._twitterManager?this._twitterManager:this._twitterManager=new f.KiiSCNTwitter:e===f.KiiSocialNetworkName.QQ?null!=this._qqManager?this._qqManager:this._qqManager=new f.KiiSCNQQ:e===f.KiiSocialNetworkName.GOOGLEPLUS?null!=this._googleManager?this._googleManager:this._googleManager=new f.KiiSCNGoogle:e===f.KiiSocialNetworkName.RENREN?null!=this._renrenManager?this._renrenManager:this._renrenManager=new f.KiiSCNRenRen:void 0},e}(),f.KiiSocialConnectNetwork=function(){function e(e){this._network=e,this._unlink=v(this._unlink,this),this._link=v(this._link,this),this._register=v(this._register,this),this._getAccessToken=v(this._getAccessToken,this),this._createTokenObject=v(this._createTokenObject,this),this._unlinkFromCurrentUser=v(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=v(this._linkWithCurrentUser,this),this._logOut=v(this._logOut,this),this._logIn=v(this._logIn,this),this._isAuthenticated=v(this._isAuthenticated,this),this._getTokenObject=v(this._getTokenObject,this),this._setTokenObject=v(this._setTokenObject,this),this._getTokenExpiration=v(this._getTokenExpiration,this),this._setTokenExpiration=v(this._setTokenExpiration,this),this._getToken=v(this._getToken,this),this._setToken=v(this._setToken,this),this._getNetwork=v(this._getNetwork,this),this._setNetwork=v(this._setNetwork,this),this._tokenExpiration=null,this._token=null}return e.prototype._className="KiiSocialConnectNetwork",e.prototype._setNetwork=function(e){this._network=e},e.prototype._getNetwork=function(){return this._network},e.prototype._setToken=function(e){this._token=e},e.prototype._getToken=function(){return this._token},e.prototype._setTokenExpiration=function(e){this._tokenExpiration=e},e.prototype._getTokenExpiration=function(){return this._tokenExpiration},e.prototype._setTokenObject=function(e){this._tokenObject=e},e.prototype._getTokenObject=function(){return this._tokenObject},e.prototype._isAuthenticated=function(){return null!=this._tokenObject},e.prototype._logIn=function(){},e.prototype._logOut=function(){return this._token=null,this._tokenExpiration=null,this._tokenObject=null},e.prototype._linkWithCurrentUser=function(){},e.prototype._unlinkFromCurrentUser=function(){},e.prototype._createTokenObject=function(){},e.prototype._getAccessToken=function(){},e.prototype._register=function(e,t,i,n,r){var s,a,l,c,p;return f.Kii.getAccessTokenExpiration()>0&&(a=new Date,s=a.getTime(),i.expiresAt=u._safeCalculateExpiresAtAsNumber(f.Kii.getAccessTokenExpiration(),s)),c=new o("/integration/"+e,!0),c.setMethod("POST"),c.setData(i),c.setAnonymous(!0),c.setContentType(t),p=this._getAccessToken(n),l={success:function(e){return function(t){var i,o,l,c;return e._setToken(p),o=e._createTokenObject(n,t),e._setTokenObject(o),l=new f.KiiUser,l._updateWithJSON(t),l._setAccessToken(t.access_token),null!=t.expires_in&&(a=new Date,s=a.getTime(),c=u._safeCalculateExpiresAtAsDate(t.expires_in,s),l._setExpiresAt(c)),f.Kii.setCurrentUser(l),i={success:function(t){return null!=r?r.success(t,e._network):void 0},failure:function(t,i){return null!=r?r.failure(t,e._network,i):void 0}},l.refresh(i)}}(this),failure:function(e){return function(t){return null!=r?r.failure(null,e._network,t):void 0}}(this)},c.execute(l,!1)},e.prototype._link=function(e,t,i,n,r){var s,a,l;return a=new o("/users/me/"+e+"/link",!0),a.setMethod("POST"),a.setData(i),a.setContentType(t),l=this._getAccessToken(n),s={success:function(e){return function(t){var i;return e._setToken(l),i=e._createTokenObject(n,t),e._setTokenObject(i),null!=r?r.success(f.KiiUser.getCurrentUser(),e._network):void 0}}(this),failure:function(e){return function(t){return null!=r?r.failure(f.KiiUser.getCurrentUser(),e._network,t):void 0}}(this)},a.execute(s,!0)},e.prototype._unlink=function(e,t){var i,n;return i=new o("/users/me/"+e+"/unlink",!0),i.setMethod("POST"),n={success:function(e){return function(){return e._setToken(null),e._setTokenExpiration(null),e._setTokenObject(null),null!=t?t.success(f.KiiUser.getCurrentUser(),e._network):void 0}}(this),failure:function(e){return function(i){return null!=t?t.failure(f.KiiUser.getCurrentUser(),e._network,i):void 0}}(this)},i.execute(n,!0)},e}(),f.KiiSCNFacebook=function(e){function t(){this._unlinkFromCurrentUser=v(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=v(this._linkWithCurrentUser,this),this._logOut=v(this._logOut,this),this._logIn=v(this._logIn,this),this._getAccessToken=v(this._getAccessToken,this),this._createTokenObject=v(this._createTokenObject,this),this._setup=v(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.FACEBOOK)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("should auth fb"),f.Kii.logger("Checking options"),null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token},this._register("facebook","application/vnd.kii.AuthTokenFacebookRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out fb")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:e.access_token},this._link("facebook","application/vnd.kii.LinkFacebookRequest+json",i,e,t)}return null!=t?t.failure(null,this._network,"A KiiUser must be logged in before linking to Facebook"):void 0},t.prototype._unlinkFromCurrentUser=function(e){return null!=f.KiiUser.getCurrentUser()?this._unlink("facebook",e):null!=e?e.failure("A KiiUser must be logged in before unlinking from Facebook"):void 0},t}(f.KiiSocialConnectNetwork),f.InvalidDisplayNameException=function(){return this.message="Unable to set displayName. Must be between 1-50 characters."},f.InvalidPasswordException=function(){return this.message="Unable to set password. Must be between 4-50 characters composed with ascii (exclude control character)"},f.InvalidUsernameException=function(){return this.message="Unable to set username. Must be between 3 and 64 characters, which can include alphanumeric characters as well as underscores '_' and periods '.'"},f.InvalidUserIdentifierException=function(){return this.message="User identifier should be one of user name, phone number or email"},f.InvalidEmailException=function(){return this.message="Unable to set email address. Must be a valid email"},f.InvalidPhoneNumberException=function(){return this.message="Unable to set phone number. Must begin with a '+' and be at least 10 digits"},f.InvalidLocalPhoneNumberException=function(){return this.message="Unable to set phone number. Must be a sequence of numbers"},f.InvalidCountryException=function(){return this.message="Unable to set country code. Must be 2 alphabetic characters. Ex: US, JP, CN"},f.InvalidURIException=function(){return this.message="Unable to set URI. Must be of the form kiicloud://some/path/to/object/or/entity"},f.InvalidACLAction=function(){return this.message="Unable to set ACL action. Must be one of the permitted values in KiiACLAction"},f.InvalidACLSubject=function(){return this.message="Unable to set ACL subject. Must be of type KiiUser or KiiGroup"},f.InvalidACLGrant=function(){return this.message="Unable to set ACL grant. Must be a boolean type"},f.InvalidLimitException=function(){return this.message="Unable to set query limit. Must be an integer > 0"},f.InvalidArgumentException=function(e){return this.message="InvalidArgument: "+e},f.IllegalStateException=function(e){return this.message="IllegalState: "+e},f.ArithmeticException=function(e){return this.message="ArithmeticException"+e},f.KiiAppAdminContext=function(){function e(e){this.listTopics=v(this.listTopics,this),this.topicWithName=v(this.topicWithName,this),this.loadThingWithThingID=v(this.loadThingWithThingID,this),this.loadThingWithVendorThingID=v(this.loadThingWithVendorThingID,this),this.registerOwnerWithVendorThingID=v(this.registerOwnerWithVendorThingID,this),this.registerOwnerWithThingID=v(this.registerOwnerWithThingID,this),this.thingWithID=v(this.thingWithID,this),this.registerThing=v(this.registerThing,this),this._getToken=v(this._getToken,this),this._getId=v(this._getId,this),this._objectWithURI=v(this._objectWithURI,this),this._token=e.token,this._id=e.id}return e.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucketAdmin(e,null,this._token)},e.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucketAdmin(e,null,this._token)},e.prototype.groupWithName=function(e){var t;return t=f.KiiGroupAdmin._groupWithName(e,this._token)},e.prototype.userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._token)},e.prototype.objectWithURI=function(e){var t;return t=this._objectWithURI(e)},e.prototype._userWithLoginName=function(e,t){var i,n,r;return r=new f.KiiUserAdmin(this._token),n=r._getRequest({path:"/users/LOGIN_NAME:"+e,withApp:!0}),n.setAdminToken(this._token),i={success:function(){return function(e,i){if(300>i&&i>=200){if(r._updateWithJSON(e),null!=t)return t.success(r)}else if(null!=t)return t.failure("Unable to parse response")}}(this),failure:function(){return function(e){return null!=t?t.failure(e):void 0}}(this)},n.execute(i,!1)},e.prototype._objectWithURI=function(e){var t,i,n,r,s,o,a,l,u;if(!e)throw new f.InvalidURIException;if(u=0===e.indexOf("kiicloud://"),o=e.substr("kiicloud://".length),s=o.split("/"),r=s.length,!(r>=4&&u))throw new f.InvalidURIException;if(i=4===r?1:3,n=s[i],l=null,"groups"===s[0]&&6===r)l=new f.KiiGroupAdmin._groupWithID(s[1],this._token);else if("users"===s[0]&&6===r)l=f.KiiUserAdmin._userWithID(s[1],this._token);else if("things"===s[0]&&6===r)l=f.KiiThingAdmin.thingWithID(s[1],this._token);else if(4!==r)throw new f.InvalidURIException;return t=new f.KiiBucketAdmin(n,l,this._token),a=t.createObject(),a._setUUID(s[r-1]),a},e.prototype._getId=function(){return this._id},e.prototype._getToken=function(){return this._token},e.prototype.groupWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("groupID should not null or empty");return t=f.KiiGroupAdmin._groupWithID(e,this._token)},e.prototype.groupWithURI=function(e){var t,i,n;if(null==e)throw new f.InvalidURIException;if(0!==e.indexOf("kiicloud://"))throw new f.InvalidURIException;if(n=e.substr("kiicloud://".length),t=n.split("/"),2!==t.length||"groups"!==t[0])throw new f.InvalidURIException;return i=f.KiiGroupAdmin._groupWithID(t[1],this._token)},e.prototype.findUserByEmail=function(e,t){return f.KiiUser._findUserByEmail(e,t,this)},e.prototype.findUserByPhone=function(e,t){return f.KiiUser._findUserByPhone(e,t,this)
},e.prototype.findUserByUsername=function(e,t){return f.KiiUser._findUserByUsername(e,t,this)},e.prototype.registerThing=function(e,t){return f.KiiThingAdmin.register(e,t,this._token)},e.prototype.thingWithID=function(e){return f.KiiThingAdmin.thingWithID(e,this._token)},e.prototype.registerOwnerWithThingID=function(e,t,i){return f.KiiThingAdmin.registerOwnerWithThingID(e,t,i,this._token)},e.prototype.registerOwnerWithVendorThingID=function(e,t,i){return f.KiiThingAdmin.registerOwnerWithVendorThingID(e,t,i,this._token)},e.prototype.thingWithID=function(e){return f.KiiThingAdmin.thingWithID(e,this._token)},e.prototype.loadThingWithVendorThingID=function(e,t){return f.KiiThingAdmin.loadWithVendorThingID(e,t,this._token)},e.prototype.loadThingWithThingID=function(e,t){return f.KiiThingAdmin.loadWithThingID(e,t,this._token)},e.prototype.topicWithName=function(e){if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopicAdmin(f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID(),e,this._token)},e.prototype.listTopics=function(e,t){return f.Kii._listTopics(e,t,this)},e}(),f.KiiACLAdmin=function(e){function t(e,i){this._userWithID=v(this._userWithID,this),this._groupWithID=v(this._groupWithID,this),this._getRequest=v(this._getRequest,this),t.__super__.constructor.call(this),this._setParent(e),this._adminToken=i}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._groupWithID=function(e){var t;return t=f.KiiGroupAdmin._groupWithID(e,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._adminToken)},t}(f.KiiACL),f.KiiGroupAdmin=function(e){function t(e){this.topicWithName=v(this.topicWithName,this),this._setAuthToken=v(this._setAuthToken,this),this._setOwnerFromContext=v(this._setOwnerFromContext,this),this._userWithID=v(this._userWithID,this),this.bucketWithName=v(this.bucketWithName,this),this._getRequest=v(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return _(t,e),t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t._groupWithName=function(e,t){return f.KiiGroupAdmin._groupWithNameAndMembers(e,null,t)},t._groupWithNameAndMembers=function(e,t,i){var n;return n=new f.KiiGroupAdmin(i),n._setName(e),n._setAddMembers(t),n},t._groupWithID=function(e,t){var i;return i=new f.KiiGroupAdmin(t),i._setUUID(e),i},t.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._adminToken)},t.prototype._setOwnerFromContext=function(){},t._groupWithJSON=function(e,t){var i;return i=new f.KiiGroupAdmin(t),null!=e.groupID&&i._setUUID(e.groupID),null!=e.name&&i._setName(e.name),null!=e.owner&&i._setOwner(f.KiiUserAdmin._userWithID(e.owner,t)),i},t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype.topicWithName=function(e){var t,i;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return i=this._getHttpURI(),new f.KiiTopicAdmin(i,e,this._adminToken)},t}(f.KiiGroup),f.KiiObjectAdmin=function(e){function t(e){this._userWithID=v(this._userWithID,this),this.objectACL=v(this.objectACL,this),this._getToken=v(this._getToken,this),this._getRequest=v(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return _(t,e),t.prototype._getRequest=function(e){var i;return f.Kii.logger("admin req: "+this._adminToken),i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._getToken=function(){return this._adminToken?this._adminToken:null},t.objectWithBucket=function(e,t,i){var n;return f.Kii.logger("Creating object w type: "+t),n=new f.KiiObjectAdmin(i),n._setBucket(e),n._setObjectType(t),f.Kii.logger(n),n},t.objectWithID=function(e,t,i){var n;return f.Kii.logger("Creating object w id: "+t),n=new f.KiiObjectAdmin(i),n._setBucket(e),n._setUUID(t),f.Kii.logger(n),n},t.prototype.objectACL=function(){var e;return e=new f.KiiACLAdmin(this,this._adminToken)},t.prototype._userWithID=function(e){var t;return t=f.KiiUserAdmin._userWithID(e,this._adminToken)},t}(f.KiiObject),f.KiiUserAdmin=function(e){function t(e){this.topicWithName=v(this.topicWithName,this),this.pushSubscription=v(this.pushSubscription,this),this._groupWithJSON=v(this._groupWithJSON,this),this.bucketWithName=v(this.bucketWithName,this),this._setAuthHeader=v(this._setAuthHeader,this),this._setAuthToken=v(this._setAuthToken,this),this._getRequest=v(this._getRequest,this),t.__super__.constructor.call(this),this._adminToken=e}return _(t,e),t._userWithID=function(e,t){var i;return i=new f.KiiUserAdmin(t),i._setUUID(e),i},t.prototype._getRequest=function(e){var i;return i=t.__super__._getRequest.call(this,e),i.setAdminToken(this._adminToken),i},t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype._setAuthHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this._adminToken)},t.prototype.bucketWithName=function(e){var t;return t=new f.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){var t;return t=new f.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype._groupWithJSON=function(e){var t;return t=new f.KiiGroupAdmin._groupWithJSON(e,this._adminToken)},t.prototype.pushSubscription=function(){return new f.KiiPushSubscriptionAdmin(this,this._adminToken)},t.prototype.topicWithName=function(e){var t;if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");if(t=this.getID(),!t)throw"can not instantiate topic from instance which doesn't have ID";return new f.KiiTopicAdmin(this._getHttpURI(),e,this._adminToken)},t}(f.KiiUser),f.KiiAnonymousUser=function(){function e(){this.getID=v(this.getID,this)}return e.prototype.getID=function(){return"ANONYMOUS_USER"},e}(),f.KiiAnyAuthenticatedUser=function(){function e(){this.getID=v(this.getID,this)}return e.prototype.getID=function(){return"ANY_AUTHENTICATED_USER"},e}(),f.KiiSDKClientInfo=function(){function e(){}return e.getSDKClientInfo=function(){return null==e._clientInfo&&(e._clientInfo="sn=jss;sv="+f.Kii.getSDKVersion()),e._clientInfo},e}(),f.KiiSCNTwitter=function(e){function t(){this._unlinkFromCurrentUser=v(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=v(this._linkWithCurrentUser,this),this._logOut=v(this._logOut,this),this._logIn=v(this._logIn,this),this._getAccessToken=v(this._getAccessToken,this),this._createTokenObject=v(this._createTokenObject,this),this._setup=v(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.TWITTER)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={oauth_token:e.oauth_token,oauth_token_secret:e.oauth_token_secret},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.oauth_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("Checking options"),f.Kii.logger(e),null==e||!e.oauth_token&&!e.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!e.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!e.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},this._register("twitter","application/vnd.kii.AuthTokenTwitterRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out twitter")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null==f.KiiUser.getCurrentUser())return void t.failure(null,this._network,"No user logged in");if(null==e||!e.oauth_token&&!e.oauth_token_secret)throw f.InvalidArgumentException("Both options.oauth_token and options.oauth_token_secret are required");if(!e.oauth_token)throw f.InvalidArgumentException("options.oauth_token is required");if(!e.oauth_token_secret)throw f.InvalidArgumentException("options.oauth_token_secret is required");return i={accessToken:e.oauth_token,accessTokenSecret:e.oauth_token_secret},this._link("twitter","application/vnd.kii.LinkTwitterRequest+json",i,e,t)},t.prototype._unlinkFromCurrentUser=function(e){return null==f.KiiUser.getCurrentUser()?void e.failure(null,this._network,"No user logged in"):this._unlink("twitter",e)},t}(f.KiiSocialConnectNetwork),f.KiiGeoPoint=function(){function e(e,t){var i;if(this._latitude=e,this._longitude=t,this._toDict=v(this._toDict,this),this.getLongitude=v(this.getLongitude,this),this.getLatitude=v(this.getLatitude,this),i=function(e,t,i){return i>e&&t>i&&!isNaN(i)},!i(-90,90,this._latitude)||!i(-180,180,this._longitude))throw f.InvalidArgumentException("Specified latitide or longitude is invalid")}return e.prototype.getLatitude=function(){return this._latitude},e.prototype.getLongitude=function(){return this._longitude},e.geoPoint=function(e,t){return new f.KiiGeoPoint(e,t)},e.prototype._toDict=function(){var e;return e={_type:"point",lat:this._latitude,lon:this._longitude}},e}(),s=function(){function e(e,t,i){this.xhr=$.ajaxSettings.xhr(),t=u._disableCacheURL(t),this.xhr.open(e,t,!0),this.xhr.onreadystatechange=i.onComplete}return e}(),d=function(){function e(e,t,i){t=u._disableCacheURL(t),this.xhr=new XMLHttpRequest,"withCredentials"in this.xhr?(this.xhr.open(e,t,!0),this.xhr.onreadystatechange=i.onComplete):this.xhr=null}return e}(),l=function(){function e(e,t,i){this.xhr=Ti.Network.createHTTPClient(),t=u._disableCacheURL(t),this.xhr.open(e,t,!0),this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError}return e}(),p=function(){function e(){}return e.createXHRWrapper=function(e,t){var i;return i=null,null===f.Kii._getHttpRequestType()?"undefined"!=typeof jQuery?(f.Kii.logger("Use jQuery"),i=new r(e,t)):"undefined"!=typeof XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),i=new c(e,t)):"undefined"!=typeof Titanium&&(f.Kii.logger("Use Titanium"),i=new a(e,t)):(f.Kii.logger("Use http request backdoor"),f.Kii._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.Kii.logger("Use jQuery"),i=new r(e,t)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),i=new c(e,t)):f.Kii._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),i=new a(e,t))),i},e}(),c=function(){function e(e,t){this.setAuthToken=v(this.setAuthToken,this),this.setAdminOrUserToken=v(this.setAdminOrUserToken,this),this.setCurrentUserToken=v(this.setCurrentUserToken,this),this.setContentType=v(this.setContentType,this),this.setKiiHeaders=v(this.setKiiHeaders,this),this.getErrorCode=v(this.getErrorCode,this),this.getErrorString=v(this.getErrorString,this),this.sendData=v(this.sendData,this),this.send=v(this.send,this),this._setUpCallbacks=v(this._setUpCallbacks,this);var i,n,r;if(t=u._disableCacheURL(t),this.xhr=new XMLHttpRequest,this.method=e,"withCredentials"in this.xhr){if(this.xhr.open(e,t,!0),i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}else this.xhr=null}return e.prototype.getAppID=function(){return f.Kii.getAppID()},e.prototype.getAppKey=function(){return f.Kii.getAppKey()},e.prototype.getLogger=function(){return f.Kii.logger()},e.prototype._setUpCallbacks=function(e){return e&&e.progress?"PUT"===this.method?this.xhr.upload.addEventListener("progress",e.progress,!1):this.xhr.addEventListener("progress",e.progress,!1):void 0},e.prototype.send=function(e){var t;return this._setUpCallbacks(e),t={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(t.getLogger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(t.getLogger("Error loading data..."),t.getLogger("callback : "+e),null!=e)return e.failure()}}(this)},this.xhr.onreadystatechange=t.onComplete,this.xhr.send()},e.prototype.sendData=function(e,t){var i;return this._setUpCallbacks(t),i={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(e.getLogger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(e.getLogger("Error loading data..."),null!=t)return t.failure()}}(this)},this.xhr.onreadystatechange=i.onComplete,this.xhr.send(e)},e.prototype.getErrorString=function(e){var t,i;t=e+" failed. statusCode: "+this.xhr.status;try{return i=JSON.parse(decodeURIComponent(this.xhr.responseText)),null!=i.errorCode&&(t+=" error code: "+i.errorCode),null!=i.message&&(t+=" message: "+i.message),t}catch(n){return t}},e.prototype.getErrorCode=function(){var e;try{return e=JSON.parse(decodeURIComponent(this.xhr.responseText)),e.errorCode}catch(t){return null}},e.prototype.setKiiHeaders=function(){return this.xhr.setRequestHeader("x-kii-appid",this.getAppID()),this.xhr.setRequestHeader("x-kii-appkey",this.getAppKey()),this.xhr.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo())},e.prototype.setContentType=function(e){return this.xhr.setRequestHeader("Content-Type",e)},e.prototype.setCurrentUserToken=function(){var e,t;return t=null!=(e=this.getCurrentUser())?e.getAccessToken():void 0,null!=t?(this.xhr.setRequestHeader("authorization","bearer "+t),!0):!1},e.prototype.setAdminOrUserToken=function(e){var t,i;return i=null!=e?e._getToken():null!=(t=this.getCurrentUser())?t.getAccessToken():void 0,null!=i?(this.xhr.setRequestHeader("authorization","bearer "+i),!0):!1},e.prototype.setAuthToken=function(e){return null!=e?this.xhr.setRequestHeader("authorization","bearer "+e):void 0},e.prototype.getCurrentUser=function(){return f.KiiUser.getCurrentUser()},e}(),a=function(e){function t(e,t){this.sendData=v(this.sendData,this),this.send=v(this.send,this);var i,n,r;if(t=u._disableCacheURL(t),this.xhr=Ti.Network.createHTTPClient(),this.method=e,this.xhr.open(e,t,!0),i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return _(t,e),t.prototype.send=function(e){var t;return this._setUpCallbacks(e),t={onComplete:function(t){return function(){var i;if(4===t.xhr.readyState)if(200<=(i=t.xhr.status)&&400>i){if(f.Kii.logger("Completed Request["+t.xhr.status+"]"),null!=e)return e.success()}else if(f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+e),null!=e)return e.failure()}}(this),onError:function(){return function(){return f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+e),null!=e?e.failure():void 0}}(this)},this.xhr.onload=t.onComplete,this.xhr.onerror=t.onError,this.xhr.send()},t.prototype.sendData=function(e,t){var i;return this._setUpCallbacks(t),i={onComplete:function(e){return function(){var i;if(4===e.xhr.readyState)if(200<=(i=e.xhr.status)&&400>i){if(f.Kii.logger("Completed Request["+e.xhr.status+"]"),null!=t)return t.success()}else if(f.Kii.logger("Error loading data..."),null!=t)return t.failure()}}(this),onError:function(){return function(){return f.Kii.logger("Error loading data..."),f.Kii.logger("callback : "+t),null!=t?t.failure():void 0}}(this)},this.xhr.onload=i.onComplete,this.xhr.onerror=i.onError,this.xhr.send(e)},t}(c),r=function(e){function t(e,t){var i,n,r;if(t=u._disableCacheURL(t),this.xhr=$.ajaxSettings.xhr(),this.xhr.open(e,t,!0),this.method=e,i=f.Kii.getAdditionalHeaders(),null!=i)for(n in i)r=i[n],this.xhr.setRequestHeader(n,r)}return _(t,e),t}(c),f.KiiSCNQQ=function(e){function t(){this._unlinkFromCurrentUser=v(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=v(this._linkWithCurrentUser,this),this._logOut=v(this._logOut,this),this._logIn=v(this._logIn,this),this._getAccessToken=v(this._getAccessToken,this),this._createTokenObject=v(this._createTokenObject,this),this._setup=v(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.QQ)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token,openID:e.openID},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("Checking options"),f.Kii.logger(e),null==e||!e.access_token&&!e.openID)throw f.InvalidArgumentException("Both options.access_token and options.openID are required");if(!e.access_token)throw f.InvalidArgumentException("options.access_token is required");if(!e.openID)throw f.InvalidArgumentException("options.openID is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token,openID:e.openID},this._register("qq","application/vnd.kii.AuthTokenQQRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out qq")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null==f.KiiUser.getCurrentUser())return void t.failure(null,this._network,"No user logged in");if(null==e||!e.access_token&&!e.openID)throw f.InvalidArgumentException("Both options.access_token and options.openID are required");if(!e.access_token)throw f.InvalidArgumentException("options.access_token is required");if(!e.openID)throw f.InvalidArgumentException("options.openID is required");return i={accessToken:e.access_token,openID:e.openID},this._link("qq","application/vnd.kii.LinkQQRequest+json",i,e,t)},t.prototype._unlinkFromCurrentUser=function(e){return null==f.KiiUser.getCurrentUser()?void e.failure(null,this._network,"No user logged in"):this._unlink("qq",e)},t}(f.KiiSocialConnectNetwork),f.KiiServerCodeEntry=function(){function e(e,t){this.entryName=e,this.version=t}return e.prototype.execute=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=t&&t.success.apply(t,arguments),n(arguments)},failure:function(){var e;return null!=t&&t.failure.apply(t,arguments),e=u._Error(arguments[3],i),e.argument=arguments[1],r(e)}},i._executeUsingCallbacks(e,s)}}(this))},e.prototype._executeUsingCallbacks=function(e,t){var i,n,r,s,o,a,l,c;return u._validateServerCodeEntryArgument(e)?(r=null!=e?e:{},a=null!=(n=this.version)?n:"current",i=JSON.stringify(r),o=f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+("/server-code/versions/"+a+"/"+this.entryName),l=p.createXHRWrapper("POST",o),c=l.xhr,c.setRequestHeader("x-kii-appid",f.Kii.getAppID()),c.setRequestHeader("x-kii-appkey",f.Kii.getAppKey()),c.setRequestHeader("x-kii-sdk",f.KiiSDKClientInfo.getSDKClientInfo()),c.setRequestHeader("Content-Type","application/json"),null!=f.KiiUser.getCurrentUser()&&c.setRequestHeader("Authorization","Bearer "+f.KiiUser.getCurrentUser().getAccessToken()),s={success:function(i){return function(){var n,r,s,o;o=c.getResponseHeader("X-Step-count");try{if(s=JSON.parse(c.responseText),r=new f.KiiServerCodeExecResult(s,o),null!=t)return t.success(i,e,r)}catch(a){if(null!=t)return n="fail to parse response. statusCode: "+c.status+" executedSteps: "+o+" error code: failed_to_parse_response response: "+c.responseText,t.failure(i,e,null,n)}}}(this),failure:function(i){return function(){var n,r,s,o;o=c.getResponseHeader("X-Step-count"),n={statusCode:c.status,executedSteps:o},r="fail to execute server code. statusCode: "+c.status+" executedSteps: "+o;try{if(s=JSON.parse(c.responseText),null!=s.errorCode&&(r+=" error code: "+s.errorCode),null!=s.message&&(r+=" message: "+s.message),null!=s.details&&null!=s.details.message)return r+=" detailMessage: "+s.details.message}catch(a){return r+=" error code: failed_to_parse_response message: "+c.responseText}finally{null!=t&&t.failure(i,e,null,r)}}}(this)},l.sendData(i,s)):t.failure(this,e,null,f.InvalidArgumentException("arugment is invalid"))},e.prototype.getEntryName=function(){return this.entryName},e}(),f.KiiServerCodeExecResult=function(){function e(e,t){this.returnObject=e,this.exeSteps=t}return e.prototype.getExecutedSteps=function(){return this.exeSteps},e.prototype.getReturnedValue=function(){return this.returnObject},e}(),f.KiiThing=function(){function e(e){this.fields=e,this._getSubscriberPath=v(this._getSubscriberPath,this),this._setAuthToken=v(this._setAuthToken,this),this._getHttpURI=v(this._getHttpURI,this),this.pushSubscription=v(this.pushSubscription,this),this._listTopicsUsingCallbacks=v(this._listTopicsUsingCallbacks,this),this.listTopics=v(this.listTopics,this),this.topicWithName=v(this.topicWithName,this),this.encryptedBucketWithName=v(this.encryptedBucketWithName,this),this.bucketWithName=v(this.bucketWithName,this),this._changeStatus=v(this._changeStatus,this),this.enable=v(this.enable,this),this.disable=v(this.disable,this),this.unregisterOwner=v(this.unregisterOwner,this),this._getOwnerURL=v(this._getOwnerURL,this),this.registerOwner=v(this.registerOwner,this),this.isOwner=v(this.isOwner,this),this.deleteThing=v(this.deleteThing,this),this.update=v(this.update,this),this._refresh=v(this._refresh,this),this.refresh=v(this.refresh,this),this.getDisabled=v(this.getDisabled,this),this.getCreated=v(this.getCreated,this),this.getAccessToken=v(this.getAccessToken,this),this.getVendorThingID=v(this.getVendorThingID,this),this.getThingID=v(this.getThingID,this),this._renewThingFields=v(this._renewThingFields,this),null!=this.fields&&this._renewThingFields(this.fields)}return e.prototype._renewThingFields=function(e){return this.fields=e,this._thingID=e._thingID,this._vendorThingID=e._vendorThingID,this._accessToken=e._accessToken,this._created=new Date(e._created),this._disabled=e._disabled,delete this.fields._thingID,delete this.fields._vendorThingID,delete this.fields._accessToken,delete this.fields._created,delete this.fields._disabled},e.prototype.getThingID=function(){return this._thingID},e.prototype.getVendorThingID=function(){return this._vendorThingID},e.prototype.getAccessToken=function(){return this._accessToken},e.prototype.getCreated=function(){return this._created},e.prototype.getDisabled=function(){return this._disabled},e.register=function(e,t){return new Promise(function(i,n){var r,s;return s=p.createXHRWrapper("POST",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things"),s.setKiiHeaders(),s.setContentType("application/vnd.kii.ThingRegistrationAndAuthorizationRequest+json"),r={success:function(){var e,n;return e=JSON.parse(decodeURIComponent(s.xhr.responseText)),n=new f.KiiThing(e),null!=t&&t.success(n),i(n)},failure:function(){var e,i;return i=s.getErrorString("register thing"),e=u._Error(i),null!=t&&t.failure(e),n(e)}},s.sendData(JSON.stringify(e),r)})},e.prototype.refresh=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(n){return t._renewThingFields(n),null!=e&&e.success(t),i(t)},failure:function(i){var r;return r=u._Error(i,t),null!=e&&e.failure(r),n(r)}},t._refresh(r)}}(this))},e.prototype._refresh=function(e){var t,i,n;return t=null!=this._thingID?this._thingID:"VENDOR_THING_ID:"+this._vendorThingID,n=p.createXHRWrapper("GET",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t),n.setKiiHeaders(),this._setAuthToken(n),i={success:function(){return function(){var t;return t=JSON.parse(decodeURIComponent(n.xhr.responseText)),e.success(t)}}(this),failure:function(){return function(){var t;return t=n.getErrorString("refresh thing"),e.failure(t)}}(this)},n.send(i)},e.prototype.update=function(e){return new Promise(function(t){return function(i,n){var r;return r={success:function(r){var s,o,a,l,c;o=t.fields;for(s in o)l=o[s],r[s]=l;return t.fields=r,c=p.createXHRWrapper("PATCH",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t._thingID),c.setKiiHeaders(),c.setContentType("application/vnd.kii.ThingUpdateRequest+json"),t._setAuthToken(c),a={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=c.getErrorString("update thing"),i=u._Error(r,t),null!=e&&e.failure(i),n(i)}},c.sendData(JSON.stringify(t.fields),a),"function"==typeof t._testOnUpdateRequest?t._testOnUpdateRequest():void 0},failure:function(i){var r;return r=u._Error(i,t),null!=e&&e.failure(r),n(r)}},t._refresh(r)}}(this))},e.prototype.deleteThing=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=p.createXHRWrapper("DELETE",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+t._thingID),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=s.getErrorString("delete thing"),i=u._Error(r,t),null!=e&&e.failure(i),n(i)}},s.send(r)}}(this))},e.prototype.isOwner=function(e,t){return new Promise(function(i){return function(n,r){var s,o,a,l,c,d;try{l=i._getOwnerURL(i._thingID,e)}catch(o){return a=o,s=u._Error(a,i),null!=t&&t.failure(s),void r(s)}return d=p.createXHRWrapper("HEAD",l),d.setKiiHeaders(),i._setAuthToken(d),c={success:function(){return null!=t&&t.success(i,e,!0),n([i,e,!0])},failure:function(){var o;return 404===d.xhr.status?(null!=t&&t.success(i,e,!1),void n([i,e,!1])):(o=d.getErrorString("register owner"),s=u._Error(o,i),null!=t&&t.failure(s),r(s))}},d.send(c)}}(this))},e.prototype.registerOwner=function(e,t){return new Promise(function(i){return function(n,r){var s,o,a,l,c,d;try{l=i._getOwnerURL(i._thingID,e)}catch(o){return a=o,s=u._Error(a,i),null!=t&&t.failure(s),void r(s)}return d=p.createXHRWrapper("PUT",l),d.setKiiHeaders(),i._setAuthToken(d),c={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e;return e=d.getErrorString("register owner"),s=u._Error(e,i),null!=t&&t.failure(s),r(s)}},d.send(c)}}(this))},e.registerOwnerWithThingID=function(e,t,i){return f.KiiThing._registerOwnerWithIdentifier(e,t,i)},e.registerOwnerWithVendorThingID=function(e,t,i){return u._isNonEmptyString(e)?f.KiiThing._registerOwnerWithIdentifier("VENDOR_THING_ID:"+e,t,i):f.KiiThing._registerOwnerWithIdentifier(null,t,i)},e._registerOwnerWithIdentifier=function(e,t,i){return new Promise(function(n,r){var s,o,a,l,c,d;if(!u._isNonEmptyString(e))return s=u._Error("identifier is null or empty"),null!=i&&i.failure(s),void r(s);if(null==t)return s=u._Error("owner is null"),null!=i&&i.failure(s),void r(s);try{l=f.KiiThing.prototype._getOwnerURL(e,t)}catch(o){return a=o,s=u._Error(a),null!=i&&i.failure(s),void r(s)}return d=p.createXHRWrapper("PUT",l),d.setKiiHeaders(),f.KiiThing.prototype._setAuthToken(d),c={success:function(){return null!=i&&i.success(t),n([t])},failure:function(){var e;return e=d.getErrorString("register owner"),s=u._Error(e),null!=i&&i.failure(s),r(s)}},d.send(c)})},e.prototype._getOwnerURL=function(e,t){var i,n;if(t instanceof f.KiiUser)i=t.getID(),n="user";else{if(!(t instanceof f.KiiGroup))throw"owner should be instance of user or group";i=t.getID(),n="group"}if(null==i)throw"owner instance does not have id";return f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e+"/ownership/"+n+":"+i},e.prototype.unregisterOwner=function(e,t){return new Promise(function(i){return function(n,r){var s,o,a,l,c,d;try{l=i._getOwnerURL(i._thingID,e)}catch(o){return a=o,s=u._Error(a,i),null!=t&&t.failure(s),void r(s)}return d=p.createXHRWrapper("DELETE",l),d.setKiiHeaders(),i._setAuthToken(d),c={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e;return e=d.getErrorString("unregister owner"),s=u._Error(e,i),null!=t&&t.failure(s),r(s)}},d.send(c)}}(this))},e.prototype.disable=function(e){return this._changeStatus(!0,e)},e.prototype.enable=function(e){return this._changeStatus(!1,e)},e.prototype._changeStatus=function(e,t){return new Promise(function(i){return function(n,r){var s,o,a;return a=p.createXHRWrapper("PUT",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+i._thingID+"/status"),a.setKiiHeaders(),i._setAuthToken(a),a.setContentType("application/vnd.kii.ThingStatusUpdateRequest+json"),o={success:function(){return i._disabled=e,null!=t&&t.success(i),n(i)},failure:function(){var n,s;return s=a.getErrorString("disable thing "+e),n=u._Error(s,i),null!=t&&t.failure(n),r(n)}},s={disabled:e},a.sendData(JSON.stringify(s),o)}}(this))},e.loadWithVendorThingID=function(e,t){var i;return i="VENDOR_THING_ID:"+e,f.KiiThing._load(i,t)},e.loadWithThingID=function(e,t){return f.KiiThing._load(e,t)},e._load=function(e,t){return new Promise(function(i,n){var r,s;return s=p.createXHRWrapper("GET",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e),s.setKiiHeaders(),f.KiiThing.prototype._setAuthToken(s),r={success:function(){var e,n;return e=JSON.parse(decodeURIComponent(s.xhr.responseText)),n=new f.KiiThing(e),null!=t&&t.success(n),i(n)},failure:function(){var e,i;return i=s.getErrorString("load thing"),e=u._Error(i),null!=t&&t.failure(e),n(e)}},s.send(r)})},e.prototype.bucketWithName=function(e){return new f.KiiBucket._bucketWithName(e,this)},e.prototype.encryptedBucketWithName=function(e){return new f.KiiEncryptedBucket(e,this)},e.prototype.topicWithName=function(e){if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopic(this._getHttpURI(),e)},e.prototype.listTopics=function(e,t){return new Promise(function(i){return function(n,r){var s;return s={success:function(){return null!=e&&e.success.apply(e,arguments),n(arguments)},failure:function(){return null!=e&&e.failure.apply(e,arguments),r(arguments[0])}},i._listTopicsUsingCallbacks(s,t)}}(this))},e.prototype._listTopicsUsingCallbacks=function(e,t){var i,n,r;return n=this._getHttpURI()+"/topics","string"==typeof t&&""!==t&&(n=n+"?paginationKey="+encodeURIComponent(t)),r=p.createXHRWrapper("GET",n),r.setKiiHeaders(),this._setAuthToken(r),i={success:function(t){return function(){var i,n,s,o,a,l;for(n=JSON.parse(r.xhr.responseText),l=[],o=n.topics,i=0,s=o.length;s>i;i++)a=o[i],l.push(t.topicWithName(a.topicID));return null!=e?e.success(l,void 0===n.paginationKey?null:n.paginationKey):void 0}}(this),failure:function(t){return function(){var i,n;return n=r.getErrorString("list topics"),i=u._Error(n,t),null!=e?e.failure(i):void 0}}(this)},r.send(i)},e.prototype.pushSubscription=function(){return new f.KiiPushSubscription(this)},e.prototype._getHttpURI=function(){return f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+this.getThingID()},e.thingWithID=function(e){var t;if(null==e||""===e)throw new f.InvalidArgumentException("thingID should not null or empty");return t=new f.KiiThing,t._thingID=e,t},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e.prototype._getSubscriberPath=function(){return"things/"+this.getThingID()},e}(),f.KiiTopic=function(){function e(e,t){this._getHttpUri=v(this._getHttpUri,this),this._setAuthToken=v(this._setAuthToken,this),this.acl=v(this.acl,this),this.deleteTopic=v(this.deleteTopic,this),this.sendMessage=v(this.sendMessage,this),this.save=v(this.save,this),this.exists=v(this.exists,this),this.getName=v(this.getName,this),this._uri=e+"/topics/"+t,this._name=t}return e.prototype.getName=function(){return this._name},e.prototype.exists=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=p.createXHRWrapper("HEAD",t._uri),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(!0),i(!0)},failure:function(){var r,o;return 404===s.xhr.status?(null!=e&&e.success(!1),void i(!1)):(o=s.getErrorString("check topic"),r=u._Error(o,t),null!=e&&e.failure(r),n(r))
}},s.send(r)}}(this))},e.prototype.save=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=p.createXHRWrapper("PUT",t._uri),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=s.getErrorString("save topic"),i=u._Error(r,t),null!=e&&e.failure(i),n(i)}},s.send(r)}}(this))},e.prototype.sendMessage=function(e,t){return new Promise(function(i){return function(n,r){var s,o;return o=p.createXHRWrapper("POST",i._uri+"/push/messages"),o.setKiiHeaders(),i._setAuthToken(o),o.setContentType("application/vnd.kii.SendPushMessageRequest+json"),s={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e,n;return n=o.getErrorString("send messages"),e=u._Error(n,i),null!=t&&t.failure(e),r(e)}},o.sendData(JSON.stringify(e),s)}}(this))},e.prototype.deleteTopic=function(e){return new Promise(function(t){return function(i,n){var r,s;return s=p.createXHRWrapper("DELETE",t._uri),s.setKiiHeaders(),t._setAuthToken(s),r={success:function(){return null!=e&&e.success(t),i(t)},failure:function(){var i,r;return r=s.getErrorString("delete topic"),i=u._Error(r,t),null!=e&&e.failure(i),n(i)}},s.send(r)}}(this))},e.prototype.acl=function(){return f.KiiACL.aclWithParent(this)},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e.prototype._getHttpUri=function(){return this._uri},e}(),f.KiiPushMessageBuilder=function(){function e(e){this.data=e,this.mqttData=v(this.mqttData,this),this.jpushData=v(this.jpushData,this),this.apnsCategory=v(this.apnsCategory,this),this.apnsContentAvailable=v(this.apnsContentAvailable,this),this.apnsBadge=v(this.apnsBadge,this),this.apnsSound=v(this.apnsSound,this),this.apnsAlert=v(this.apnsAlert,this),this.apnsData=v(this.apnsData,this),this.gcmRestrictedPackageName=v(this.gcmRestrictedPackageName,this),this.gcmTimeToLive=v(this.gcmTimeToLive,this),this.gcmDelayWhileIdle=v(this.gcmDelayWhileIdle,this),this.gcmCollapseKey=v(this.gcmCollapseKey,this),this.gcmData=v(this.gcmData,this),this.enableMqtt=v(this.enableMqtt,this),this.enableJpush=v(this.enableJpush,this),this.enableApns=v(this.enableApns,this),this.enableGcm=v(this.enableGcm,this),this.setSendToProduction=v(this.setSendToProduction,this),this.setSendToDevelopment=v(this.setSendToDevelopment,this),this.build=v(this.build,this),this.gcm={},this.apns={},this.jpush={},this.mqtt={},this.gcm.enabled=!0,this.apns.enabled=!0,this.jpush.enabled=!0,this.mqtt.enabled=!0}return e.prototype.build=function(){var e;return e={},e.data=this.data,e.gcm=this.gcm,e.apns=this.apns,e.jpush=this.jpush,e.mqtt=this.mqtt,null!=this.sendToDevelopment&&(e.sendToDevelopment=this.sendToDevelopment),null!=this.sendToProduction&&(e.sendToProduction=this.sendToProduction),e},e.prototype.setSendToDevelopment=function(e){return this.sendToDevelopment=e,this},e.prototype.setSendToProduction=function(e){return this.sendToProduction=e,this},e.prototype.enableGcm=function(e){return this.gcm.enabled=e,this},e.prototype.enableApns=function(e){return this.apns.enabled=e,this},e.prototype.enableJpush=function(e){return this.jpush.enabled=e,this},e.prototype.enableMqtt=function(e){return this.mqtt.enabled=e,this},e.prototype.gcmData=function(e){return this.gcm.data=e,this},e.prototype.gcmCollapseKey=function(e){return this.gcm.collapseKey=e,this},e.prototype.gcmDelayWhileIdle=function(e){return this.gcm.delayWhileIdle=e,this},e.prototype.gcmTimeToLive=function(e){return this.gcm.timeToLive=e,this},e.prototype.gcmRestrictedPackageName=function(e){return this.gcm.restrictedPackageName=e,this},e.prototype.apnsData=function(e){return this.apns.data=e,this},e.prototype.apnsAlert=function(e){return this.apns.alert=e,this},e.prototype.apnsSound=function(e){return this.apns.sound=e,this},e.prototype.apnsBadge=function(e){return this.apns.badge=e,this},e.prototype.apnsContentAvailable=function(e){return 0!==e&&(this.apns.contentAvailable=!0),this},e.prototype.apnsCategory=function(e){return this.apns.category=e,this},e.prototype.jpushData=function(e){return this.jpush.data=e,this},e.prototype.mqttData=function(e){return this.mqtt.data=e,this},e}(),f.KiiPushSubscription=function(){function e(e){this._subscriber=e,this._setAuthToken=v(this._setAuthToken,this),this._getRequestHTTPURI=v(this._getRequestHTTPURI,this),this._validateTarget=v(this._validateTarget,this),this.isSubscribed=v(this.isSubscribed,this),this.unsubscribe=v(this.unsubscribe,this),this.subscribe=v(this.subscribe,this)}return e.prototype.getSubscriber=function(){return this._subscriber},e.prototype.subscribe=function(e,t){return new Promise(function(i){return function(n,r){var s,o,a;return i._validateTarget(e)?(s=i._getRequestHTTPURI(e),a=p.createXHRWrapper("PUT",s),a.setKiiHeaders(),i._setAuthToken(a),o={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e,n;return n=a.getErrorString("subscribe"),e=u._Error(n,i),null!=t&&t.failure(e),r(e)}},a.send(o)):(null!=t&&t.failure(f.InvalidArgumentException("target is invalid")),void r(u._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},e.prototype.unsubscribe=function(e,t){return new Promise(function(i){return function(n,r){var s,o,a;return i._validateTarget(e)?(s=i._getRequestHTTPURI(e),a=p.createXHRWrapper("DELETE",s),a.setKiiHeaders(),i._setAuthToken(a),o={success:function(){return null!=t&&t.success(i,e),n([i,e])},failure:function(){var e,n;return n=a.getErrorString("unsubscribe"),e=u._Error(n,i),null!=t&&t.failure(e),r(e)}},a.send(o)):(null!=t&&t.failure(f.InvalidArgumentException("target is invalid")),void r(u._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},e.prototype.isSubscribed=function(e,t){return new Promise(function(i){return function(n,r){var s,o,a;return i._validateTarget(e)?(s=i._getRequestHTTPURI(e),a=p.createXHRWrapper("GET",s),a.setKiiHeaders(),i._setAuthToken(a),o={success:function(){return null!=t&&t.success(i,e,!0),n([i,e,!0])},failure:function(){var s,o,l;return l=a.getErrorCode(),"FILTER_NOT_FOUND"===l||"PUSH_SUBSCRIPTION_NOT_FOUND"===l?(null!=t&&t.success(i,e,!1),n([i,e,!1])):(o=a.getErrorString("Check is subscribed"),s=u._Error(o,i),null!=t&&t.failure(s),r(s))}},a.send(o)):(null!=t&&t.failure(f.InvalidArgumentException("target is invalid")),void r(u._Error(f.InvalidArgumentException("target is invalid"),i)))}}(this))},e.prototype._validateTarget=function(e){return null!=e&&(e instanceof f.KiiBucket||e instanceof f.KiiTopic)},e.prototype._getRequestHTTPURI=function(e){var t;return e instanceof f.KiiBucket?t=e._getHttpUri()+"/filters/all/push/subscriptions/"+this._subscriber._getSubscriberPath():e instanceof f.KiiTopic?t=e._getHttpUri()+"/push/subscriptions/"+this._subscriber._getSubscriberPath():void 0},e.prototype._setAuthToken=function(e){return e.setCurrentUserToken()},e}(),f.KiiThingAdmin=function(e){function t(e,i,n,r){this._adminToken=r,this.topicWithName=v(this.topicWithName,this),this.bucketWithName=v(this.bucketWithName,this),this.pushSubscription=v(this.pushSubscription,this),this._setAuthToken=v(this._setAuthToken,this),t.__super__.constructor.call(this,e),null!=i&&(this._thingID=i),null!=n&&(this._vendorThingID=n)}return _(t,e),t.register=function(e,t,i){return new Promise(function(n,r){var s,o;return o=p.createXHRWrapper("POST",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things"),o.setKiiHeaders(),o.setContentType("application/vnd.kii.ThingRegistrationAndAuthorizationRequest+json"),o.setAuthToken(i),s={success:function(){var e,r;return e=JSON.parse(decodeURIComponent(o.xhr.responseText)),r=new f.KiiThingAdmin(e,null,null,i),null!=t&&t.success(r),n(r)},failure:function(){var e,i;return i=o.getErrorString("register thing"),e=u._Error(i),null!=t&&t.failure(e),r(e)}},o.sendData(JSON.stringify(e),s)})},t.registerOwnerWithThingID=function(e,t,i,n){return f.KiiThingAdmin._registerOwnerWithIdentifier(e,t,i,n)},t.registerOwnerWithVendorThingID=function(e,t,i,n){return f.KiiThingAdmin._registerOwnerWithIdentifier("VENDOR_THING_ID:"+e,t,i,n)},t._registerOwnerWithIdentifier=function(e,t,i,n){return new Promise(function(r,s){var o,a,l,c;if(t instanceof f.KiiUser)o=t.getID(),l="user";else{if(!(t instanceof f.KiiGroup))throw"owner should be instance of user or group";o=t.getID(),l="group"}if(null==o)throw"owner instance does not have id";return c=p.createXHRWrapper("PUT",f.Kii.getBaseURL()+"/apps/"+f.Kii.getAppID()+"/things/"+e+"/ownership/"+l+":"+o),c.setKiiHeaders(),c.setAuthToken(n),a={success:function(){return null!=i&&i.success(t),r([t])},failure:function(){var e,t;return t=c.getErrorString("register owner"),e=u._Error(t),null!=i&&i.failure(e),s(e)}},c.send(a)})},t.loadWithVendorThingID=function(e,t,i){var n;return n=new f.KiiThingAdmin(null,null,e,i),n.refresh(t)},t.loadWithThingID=function(e,t,i){var n;return n=new f.KiiThingAdmin(null,e,null,i),n.refresh(t)},t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype.pushSubscription=function(){return new f.KiiPushSubscriptionAdmin(this,this._adminToken)},t.prototype.bucketWithName=function(e){return new f.KiiBucketAdmin(e,this,this._adminToken)},t.prototype.encryptedBucketWithName=function(e){return new f.KiiEncryptedBucketAdmin(e,this,this._adminToken)},t.prototype.topicWithName=function(e){if("string"!=typeof e||""===e)throw new f.InvalidArgumentException("topicName should not null or empty");return new f.KiiTopicAdmin(this._getHttpURI(),e,this._adminToken)},t.thingWithID=function(e,t){var i;return i=new f.KiiThingAdmin(null,e,null,t)},t}(f.KiiThing),f.KiiTopicAdmin=function(e){function t(e,i,n){this._adminToken=n,this.acl=v(this.acl,this),this._setAuthToken=v(this._setAuthToken,this),t.__super__.constructor.call(this,e,i)}return _(t,e),t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t.prototype.acl=function(){return new f.KiiACLAdmin(this,this._adminToken)},t}(f.KiiTopic),f.KiiPushSubscriptionAdmin=function(e){function t(e,i){this._adminToken=i,this._setAuthToken=v(this._setAuthToken,this),t.__super__.constructor.call(this,e)}return _(t,e),t.prototype._setAuthToken=function(e){return e.setAuthToken(this._adminToken)},t}(f.KiiPushSubscription),f.KiiAnalyticsSite={US:"https://api.kii.com/api",JP:"https://api-jp.kii.com/api",CN:"https://api-cn2.kii.com/api",SG:"https://api-sg.kii.com/api",CN3:"https://api-cn3.kii.com/api"},f.KiiAnalytics=function(){function e(){}var t;return t=null,e.getBaseURL=function(){return t._baseURL},e.getAppID=function(){return t._appID},e.getAppKey=function(){return t._appKey},e.getAppKey=function(){return t._appKey},e.getDeviceId=function(){return t._deviceId},e.isLogging=function(){return t._logging},e.setLogging=function(e){return f.KiiAnalytics.logger("Setting logging: "+e),t._logging=e},e.initializeWithSite=function(e,t,i,n){return f.KiiAnalytics._initializeWithSite(e,t,i,n)},e.initialize=function(e,t,i){return f.KiiAnalytics._initializeWithSite(e,t,f.KiiAnalyticsSite.US,i)},e._initializeWithSite=function(e,i,n,r){return t=new h(e,i,n,r),(null!=r?r.length:void 0)>0&&t._deviceId!==r&&(t._deviceId=r),f.KiiAnalytics.logger("Initialized "+e+", "+i+", "+n)},e.error=function(e){return console.log("KiiAnalytics SDK Error => "+e)},e.logger=function(e){return t._logging?console.log("KiiAnalytics => "+e):void 0},e.trackEvent=function(e){return f.KiiAnalytics.trackEventWithExtras(e,null)},e.trackEventWithExtras=function(e,t){return f.KiiAnalytics.trackEventWithExtrasAndCallbacks(e,t,null)},e.trackEventWithExtrasAndCallbacks=function(t,i,n){return new Promise(function(r,s){var o;return o={success:function(){return null!=n&&n.success(),r()},failure:function(){return null!=n&&n.failure.apply(n,arguments),s(u._Error(arguments[0]))}},e._trackEventWithExtrasAndCallbacks(t,i,o)})},e._trackEventWithExtrasAndCallbacks=function(i,r,s){var o,a,l,u,c,p,d,g,h,m,v;p=Math.round((new Date).getTime()),c="^[a-zA-Z][a-zA-Z0-9_]{0,63}$",f.KiiAnalytics.logger("deviceId = "+t._deviceId),d={_triggeredAt:p,_uploadedAt:p,_deviceID:t._deviceId,_type:i},a=function(e){return null!=e&&null!=e.match(c)},o=function(e){var t,i,n,r;for(t=0,i=e.length;i>t;t++){if(r=e[t],n=typeof r,"string"!==n&&"boolean"!==n&&"number"!==n)return!1;if("string"===n){if(r.length<=0)return!1}else if("number"===n&&(!isFinite(r)||isNaN(r)))return!1}return!0},l=function(e){var t;return t=typeof e,"string"===t?e.length>0:"number"===t?isFinite(e)&&!isNaN(e):"object"===t?e instanceof Array&&e.length>0&&o(e):"boolean"===t?!0:!1};for(u in r)m=r[u],a(u)&&l(m)?d[u]=m:f.KiiAnalytics.logger("ignoring invalid key/value pair, key:"+u+" value:"+m);return h=e.getBaseURL()+"/apps/"+e.getAppID()+"/event",v=n.createXHRWrapper("POST",h),v.setKiiHeaders(),v.setContentType("application/vnd.kii.Event+json"),g={success:function(){return null!=s?s.success():void 0},failure:function(){var e;return e=v.getErrorString("track event"),null!=s?s.failure(e,v.xhr.status):void 0}},v.sendData(JSON.stringify(d),g)},e.setBaseURL=function(e){return f.KiiAnalytics.logger("Setting base URL: "+e),t._baseURL=e},e.getSDKVersion=function(){return f.Kii.getSDKVersion()},e._setHttpRequestType=function(e){return f.KiiAnalytics.logger("Set http request as "+e),t._httpRequestType=e},e._getHttpRequestType=function(){return t._httpRequestType},e}(),h=function(){function e(t,i,n,r){null==n&&(n=f.KiiAnalyticsSite.US),r||(r=e.generateDeviceId()),this._appKey=i,this._appID=t,this._baseURL=n,this._deviceId=r}return e.prototype._httpRequestType=null,e.generateDeviceId=function(){var e;return e=function(e){var t;return t=(Math.random().toString(16)+"000000000").substr(2,8),e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t},e()+e(!0)+e(!0)+e()},e}(),i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _(t,e),t.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},t.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},t.prototype.getLogger=function(){return f.KiiAnalytics.logger()},t.prototype.getCurrentUser=function(){return null},t}(c),e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _(t,e),t.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},t.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},t.prototype.getLogger=function(){return f.KiiAnalytics.logger()},t.prototype.getCurrentUser=function(){return null},t}(r),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return _(t,e),t.prototype.getAppID=function(){return f.KiiAnalytics.getAppID()},t.prototype.getAppKey=function(){return f.KiiAnalytics.getAppKey()},t.prototype.getLogger=function(){return f.KiiAnalytics.logger()},t.prototype.getCurrentUser=function(){return null},t}(a),n=function(){function n(){}return n.createXHRWrapper=function(n,r){var s;return s=null,null===f.KiiAnalytics._getHttpRequestType()?"undefined"!=typeof jQuery?(f.KiiAnalytics.logger("Use jQuery"),s=new e(n,r)):"undefined"!=typeof XMLHttpRequest?(f.KiiAnalytics.logger("Use XMLHttpRequest"),s=new i(n,r)):"undefined"!=typeof Titanium&&(f.KiiAnalytics.logger("Use Titanium"),s=new t(n,r)):(f.KiiAnalytics.logger("Use http request backdoor"),f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.jQuery?(f.KiiAnalytics.logger("Use jQuery"),s=new e(n,r)):f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.XMLHttpRequest?(f.Kii.logger("Use XMLHttpRequest"),s=new i(n,r)):f.KiiAnalytics._getHttpRequestType()===f._KiiHttpRequestType.Titanium&&(f.Kii.logger("Use Titanium"),s=new t(n,r))),s},n}(),f.KiiSCNGoogle=function(e){function t(){this._unlinkFromCurrentUser=v(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=v(this._linkWithCurrentUser,this),this._logOut=v(this._logOut,this),this._logIn=v(this._logIn,this),this._getAccessToken=v(this._getAccessToken,this),this._createTokenObject=v(this._createTokenObject,this),this._setup=v(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.GOOGLEPLUS)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("should auth google"),f.Kii.logger("Checking options"),null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token},this._register("google","application/vnd.kii.AuthTokenGoogleRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out google")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:e.access_token},this._link("google","application/vnd.kii.LinkGoogleRequest+json",i,e,t)}return null!=t?t.failure(null,this._network,"A KiiUser must be logged in before linking to Google"):void 0},t.prototype._unlinkFromCurrentUser=function(e){return null!=f.KiiUser.getCurrentUser()?this._unlink("google",e):null!=e?e.failure("A KiiUser must be logged in before unlinking from Google"):void 0},t}(f.KiiSocialConnectNetwork),f.KiiSCNRenRen=function(e){function t(){this._unlinkFromCurrentUser=v(this._unlinkFromCurrentUser,this),this._linkWithCurrentUser=v(this._linkWithCurrentUser,this),this._logOut=v(this._logOut,this),this._logIn=v(this._logIn,this),this._getAccessToken=v(this._getAccessToken,this),this._createTokenObject=v(this._createTokenObject,this),this._setup=v(this._setup,this),t.__super__.constructor.call(this,f.KiiSocialNetworkName.RENREN)}return _(t,e),t.prototype._setup=function(e,i,n){return this._key=e,this._secret=i,this._extras=n,t.__super__._setup.call(this,this._key,this._secret,this._extras)},t.prototype._createTokenObject=function(e,t){var i;return i={access_token:e.access_token},null!=t&&null!=t.new_user_created&&(i.kii_new_user=t.new_user_created),i},t.prototype._getAccessToken=function(e){return e.access_token},t.prototype._logIn=function(e,t){var i;if(f.Kii.logger("should auth renren"),f.Kii.logger("Checking options"),null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return null!=f.KiiUser.getCurrentUser()&&f.KiiUser.logOut(),i={accessToken:e.access_token},this._register("renren","application/vnd.kii.AuthTokenRenRenRequest+json",i,e,t)},t.prototype._logOut=function(){return t.__super__._logOut.apply(this,arguments),f.Kii.logger("Log out renren")},t.prototype._linkWithCurrentUser=function(e,t){var i;if(null!=f.KiiUser.getCurrentUser()){if(null==e||!e.access_token)throw f.InvalidArgumentException("options.access_token is required");return i={accessToken:e.access_token},this._link("renren","application/vnd.kii.LinkRenRenRequest+json",i,e,t)}return null!=t?t.failure(null,this._network,"A KiiUser must be logged in before linking to RenRen"):void 0},t.prototype._unlinkFromCurrentUser=function(e){return null!=f.KiiUser.getCurrentUser()?this._unlink("renren",e):null!=e?e.failure("A KiiUser must be logged in before unlinking from RenRen"):void 0},t}(f.KiiSocialConnectNetwork),f};!function(){var t="undefined"!=typeof module&&null!==module;t&&module.exports?module.exports={exportedClasses:["ForTest","Kii","KiiACL","KiiACLAdmin","KiiACLEntry","KiiAnalytics","KiiAnonymousUser","KiiAnyAuthenticatedUser","KiiAppAdminContext","KiiBucket","KiiBucketAdmin","KiiClause","KiiEncryptedBucket","KiiEncryptedBucketAdmin","KiiGeoPoint","KiiGroup","KiiGroupAdmin","KiiObject","KiiObjectAdmin","KiiPushSubscription","KiiPushSubscriptionAdmin","KiiQuery","KiiSCNFacebook","KiiSCNGoogle","KiiSCNQQ","KiiSCNRenRen","KiiSCNTwitter","KiiSDKClientInfo","KiiServerCodeEntry","KiiServerCodeExecResult","KiiSocialConnect","KiiSocialConnectNetwork","KiiThing","KiiThingAdmin","KiiTopic","KiiPushMessageBuilder","KiiTopicAdmin","KiiUser","KiiUserAdmin","KiiSocialNetworkName","KiiSite","_KiiHttpRequestType","KiiACLAction","KiiAnalyticsSite","InvalidDisplayNameException","InvalidPasswordException","InvalidUsernameException","InvalidUserIdentifierException","InvalidEmailException","InvalidPhoneNumberException","InvalidLocalPhoneNumberException","InvalidCountryException","InvalidURIException","InvalidACLAction","InvalidACLSubject","InvalidACLGrant","InvalidLimitException","InvalidArgumentException","IllegalStateException","ArithmeticException"],create:function(){return e.call(this)}}:e()}()}();var MyApp=angular.module("BeehivePortal",["ngAnimate","ngCookies","ngSanitize","ngResource","ui.router","ui.bootstrap","LocalStorageModule","rzModule","treeControl","angular-condition-tree","awesome-context-menu","monospaced.elastic","angularjs-dropdown-multiselect","ng.jsoneditor","angular-cron-jobs"]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).config(["localStorageServiceProvider","$httpProvider",function(e,t){function i(){n--,0==n&&$("#spinner").hide()}e.setPrefix("epgApp").setStorageType("localStorage").setStorageCookie(30,"/").setNotify(!0,!0);var n=0;delete t.defaults.headers.common["X-Requested-With"],t.defaults.headers.common["Content-Type"]="application/json;charset=UTF-8",t.defaults.headers.common.Authorization="Bearer d31032a0-8ebf-11e5-9560-00163e02138f",t.interceptors.push(["$q",function(e){return{request:function(e){return $("#spinner").show(),n++,e.url.indexOf("api/users")>-1&&(e.headers.Authorization="Bearer d31032a0-8ebf-11e5-9560-00163e02138f"),e},response:function(e){return i(),e},responseError:function(t){return i(),$("#spinner").hide(),401==t.status&&window.alertMessage("您没有相应的操作权限。"),e.reject(t)}}}])}]).run(["$rootScope","$state","$stateParams","AppUtils",function(e,t,i,n){e.$state=t,e.$stateParams=i,window.state=t,n.initialize(),window.AppUtils=n}]);angular.module("BeehivePortal").directive("propertyTree",["$compile","$http",function(e,t){return{restrict:"E",replace:!0,scope:{myProperty:"=?"},link:function(i,n){t({method:"GET",url:"app/components/portal/ThingViews/TypeView/directives/property-tree/property-tree.template.html"}).then(function(t){var r=t.data;if(i.myProperty){var s=e(r)(i);n.append(s)}i.collapseControllers={},i.propertyRequired=function(e,t){return t?!!_.find(t,function(t){return t==e}):!1}})}}}]),angular.module("BeehivePortal").factory("UserGroupListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("UserGroupListController",["$scope","$rootScope","$state","AppUtils","$uibModal","$$UserGroup","$location","$http","PermissionControl",function(e,t,i,n,r,s,o,a,l){e.userGroups=[],e.userGroupsForDisplay=[],e.init=function(){e.groupType=e.groupTypes[0],l.isAllowed("GET_ALL_GROUPS")||e.groupTypes.splice(1,1),e.$watch("groupType",function(t,i){t!=i&&(e.userGroups="mygroup"==e.groupType.value?s.getMyGroups():s.getList())})},e.groupTypes=[{text:"我的群组",value:"mygroup"},{text:"所有群组",value:"allgroup"}],e.groupType=null,e.searchValue="",e.queryOptions=[{text:"群组ID",value:"userGroupID"},{text:"群组名称",value:"userGroupName"}],e.queryUserGroups=function(t,i){var n={};i?(n[t]=i,n.includeUserData="0",e.userGroups=s.query({},n)):e.userGroups=s.getList()},e.createGroup=function(){var t=r.open({animation:!0,templateUrl:"app/components/portal/UserManager/UserGroup/UserGroupList/NewUserGroup.template.html",controller:"UserGroupListController.NewUserGroup",size:"md",resolve:{}});t.result.then(function(t){console.log(t),e.userGroups.push(t)},function(){})},e.goUserList=function(t){console.log(t),e.navigateTo(e.navMapping.GROUP_USER_LIST,{userGroupID:t.userGroupID})},e.goThingAuth=function(t){e.navigateTo(e.navMapping.GROUP_THING_AUTH,{userGroupID:t.userGroupID})},e.goEdit=function(t){e.navigateTo(e.navMapping.USER_GROUP_EDITOR,{userGroupID:t.userGroupID})},e.deleteGroup=function(t){n.confirm("删除用户群组","确定要删除用户群组["+t.userGroupName+"]吗?",function(){s.remove({},t,function(){e.userGroups=_.reject(e.userGroups,function(e){return e==t})})})}}]),angular.module("BeehivePortal").controller("UserGroupListController.NewUserGroup",["$scope","$uibModalInstance","$$UserGroup","AppUtils",function(e,t,i,n){e.newGroup={userGroupName:"",description:""},e.ok=function(){i.create({},e.newGroup,function(i){console.log(i),t.close(e.newGroup)},function(){n.alert("新增群组失败！")})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("ResourceAuthorityController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("GroupUserListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("GroupUserListController",["$scope","$rootScope","$state","AppUtils","$$User","$$UserGroup","$$Permission","$q","$uibModal",function(e,t,i,n,r,s,o,a,l){e.userList=[],e.userListForDisplay=[],e.userGroup,e.init=function(){if(!e.PermissionControl.isAllowed("GET_GROUP"))return void i.go("app.portal.Welcome");var t=i.params.userGroupID,n={userGroupID:t,includeUserData:"1"};e.userGroup=s.get({},n,function(t){e.userList=t.users})},e.myMenu={itemList:[{text:"查看详情",callback:function(t){e.navigateTo(e.navMapping.GROUP_USER_INFO,{userID:t.userID,userGroupID:i.params.userGroupID})},hidden:!e.PermissionControl.isAllowed("GET_USER")},{text:"编辑",callback:function(e){var t=l.open({animation:!0,templateUrl:"app/components/portal/UserManager/User/UserList/EditUser.template.html",controller:"UserListController.EditUser",size:"md",resolve:{user:function(){return e}}});t.result.then(function(){console.log(e)},function(){$log.info("Modal dismissed at: "+new Date)})},hidden:!e.PermissionControl.isAllowed("GET_USER")||!e.PermissionControl.isAllowed("UPDATE_USER")},{text:"删除",callback:function(t){n.confirm("提示信息","确认要将该用户移出吗？",function(){s.deleteUser({userID:t.userID,userGroupID:e.userGroup.userGroupID})})},hidden:!e.PermissionControl.isAllowed("!REMOVE_GROUP_MEMBER")}],setting:{}}}]),angular.module("BeehivePortal").controller("GroupThingAuthorityController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e,t,i,n,r,s,o,a,l){e.ownThings=[],e.selectedThings=[],e.settings={dataset:{},idFieldName:"globalThingID",tabs:[{dataset:[],name:"位置",mapper:{nameFieldName:"name",idFieldName:"id",mapperFieldName:"location"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"种类",mapper:{nameFieldName:"name",idFieldName:"name",mapperFieldName:"type"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"标签",mapper:{nameFieldName:"displayName",idFieldName:"displayName",mapperFieldName:"tags"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"全部",nameGenerator:function(e){return e.type+"-"+e.globalThingID}}]};var u=s.getAll().$promise;a.all([o.queryAll().$promise,u,l.queryAll().$promise]).then(function(t){var i=t[0],n=t[1],r=t[2],o=[],l=[],u=new LocationTree(_.pluck(r,"displayName"));_.each(r,function(e){var t=s.byTag({tagType:"Location",displayName:e.displayName});o.push(t.$promise)}),_.each(i,function(e){var t=s.byTag({tagType:"Custom",displayName:e.displayName});l.push(t.$promise)}),a.all([a.all(l),a.all(o)]).then(function(s){var o=s[0],a=s[1];_.each(i,function(e,t){_.each(o[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.tags)||(i.tags=[]),i.tags.indexOf(e.displayName)<0&&i.tags.push(e.displayName)})}),_.each(r,function(e,t){_.each(a[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.location)||(i.location=[]),i.location.indexOf(e.displayName)<0&&i.location.push(e.displayName)})}),r=u.tree.children,e.settings.existingNodeIDs=_.pluck(t[3],"globalThingID"),e.settings.dataset.data=n;var l=_.uniq(_.pluck(n,"type")),c=[];_.each(l,function(e){c.push({name:e})}),e.settings.tabs[0].dataset=r,e.settings.tabs[1].dataset=c,e.settings.tabs[2].dataset=_.where(i,{tagType:"Custom"}),e.settings.tabs[3].dataset=n,e.ready=!0})})}]),angular.module("BeehivePortal").controller("GroupThingACLController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e,t,i,n,r,s,o,a,l){e.ownThings=[],e.selectedThings=[],e.settings={dataset:{},idFieldName:"globalThingID",tabs:[{dataset:[],name:"位置",mapper:{nameFieldName:"name",idFieldName:"id",mapperFieldName:"location"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"种类",mapper:{nameFieldName:"name",idFieldName:"name",mapperFieldName:"type"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"标签",mapper:{nameFieldName:"displayName",idFieldName:"displayName",mapperFieldName:"tags"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"全部",nameGenerator:function(e){return e.type+"-"+e.globalThingID}}]};var u=s.getAll().$promise;a.all([o.queryAll().$promise,u,l.queryAll().$promise]).then(function(t){var i=t[0],n=t[1],r=t[2],o=[],l=[],u=new LocationTree(_.pluck(r,"displayName"));_.each(r,function(e){var t=s.byTag({tagType:"Location",displayName:e.displayName});o.push(t.$promise)}),_.each(i,function(e){var t=s.byTag({tagType:"Custom",displayName:e.displayName});l.push(t.$promise)}),a.all([a.all(l),a.all(o)]).then(function(s){var o=s[0],a=s[1];_.each(i,function(e,t){_.each(o[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.tags)||(i.tags=[]),i.tags.indexOf(e.displayName)<0&&i.tags.push(e.displayName)})}),_.each(r,function(e,t){_.each(a[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.location)||(i.location=[]),i.location.indexOf(e.displayName)<0&&i.location.push(e.displayName)})}),r=u.tree.children,e.settings.existingNodeIDs=_.pluck(t[3],"globalThingID"),e.settings.dataset.data=n;var l=_.uniq(_.pluck(n,"type")),c=[];_.each(l,function(e){c.push({name:e})}),e.settings.tabs[0].dataset=r,e.settings.tabs[1].dataset=c,e.settings.tabs[2].dataset=_.where(i,{tagType:"Custom"}),e.settings.tabs[3].dataset=n,e.ready=!0})})}]),angular.module("BeehivePortal").factory("GroupEditorService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("GroupEditorController",["$scope","$rootScope","$state","AppUtils","$$UserGroup","$$User","$$Tag","$$Permission","$q","$location",function(e,t,i,n,r,s,o,a,l,u){function c(){e.userListForDisplay=_.filter(e.userList,function(t,i){return i>=(e.currentIndex-1)*e.listMaxLength&&i<e.currentIndex*e.listMaxLength})}e.group={},e.userList=[],e.userListForDisplay=[],e.currentIndex=1,e.pageChanged=function(){u.search({pageIndex:e.currentIndex}),c()},e.searchValue="",e.queryOptions=[{text:"用户ID",value:"userID"},{text:"用户名称",value:"userName"}],e.queryFiled=_.clone(e.queryOptions[0]),e.queryUsers=function(t,i){var r={role:"4"};i&&(r[t]=i),s.query(r,function(t){console.log(t),e.userList=t,e.pageChanged()},function(){n.alert("Failed to load group user list!")})},e.init=function(){var t=i.params.userGroupID,n={userGroupID:t,includeUserData:"1"};e.PermissionControl.allowAction("GET_GROUP")&&(e.group=r.get({},n,function(){e.group._users=_.clone(e.group.users)}),e.PermissionControl.isAllowed("ADD_GROUP_MEMBER")&&e.PermissionControl.isAllowed("SEARCH_USERS")&&e.queryUsers(),e.tags=o.queryAll(),e.PermissionControl.isAllowed("GET_GROUP_PERMISSIONS")&&(e.groupPermission=a.byGroup({userGroupID:t}),e.PermissionControl.isAllowed("GET_ALL_PERMISSIONS")&&(e.permissionList=a.getList(),l.all([e.permissionList.$promise,e.groupPermission.$promise]).then(function(){_.each(e.groupPermission,function(t){e.permissionList=_.reject(e.permissionList,function(e){return e.id==t.id
})})}))))},e.removeUser=function(t,i){r.deleteUser({},{userID:t.userID,userGroupID:i.userGroupID},function(){e.group._users=_.reject(i._users,function(e){return t==e})})},e.addUser=function(t,i){r.addUser({userID:t.userID,userGroupID:i.userGroupID},function(){e.group._users=e.group._users||[],_.find(e.group._users,function(e){return t.userID==e.userID})||e.group._users.push(t)})},e.saveGroup=function(){var t=_.pluck(e.group._users,"userID");e.group.users=t,r.update({},e.group,function(){e.navigateTo(e.navMapping.USER_GROUP)})},e.bindPermission=function(t,i){var n={permissionID:t.id,userGroupID:i.userGroupID},r=function(){var i=_.clone(t);e.groupPermission.push(i),e.permissionList.remove(t)};a.bindGroup(n,r)},e.unbindPermission=function(t,i){var n,r;n={permissionID:t.id,userGroupID:i.userGroupID},r=function(){var i=_.clone(t);e.groupPermission.remove(t),e.permissionList.push(i)},a.unbindGroup(n,r)}}]),angular.module("BeehivePortal").controller("UserThingAuthorityController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e,t,i,n,r,s,o,a,l){e.ownThings=[],e.selectedThings=[],e.settings={dataset:{},idFieldName:"globalThingID",tabs:[{dataset:[],name:"位置",mapper:{nameFieldName:"name",idFieldName:"id",mapperFieldName:"location"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"种类",mapper:{nameFieldName:"name",idFieldName:"name",mapperFieldName:"type"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"标签",mapper:{nameFieldName:"displayName",idFieldName:"displayName",mapperFieldName:"tags"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"全部",nameGenerator:function(e){return e.type+"-"+e.globalThingID}}]};var u=s.getAll().$promise;a.all([o.queryAll().$promise,u,l.queryAll().$promise]).then(function(t){var i=t[0],n=t[1],r=t[2],o=[],l=[],u=new LocationTree(_.pluck(r,"displayName"));_.each(r,function(e){var t=s.byTag({tagType:"Location",displayName:e.displayName});o.push(t.$promise)}),_.each(i,function(e){var t=s.byTag({tagType:"Custom",displayName:e.displayName});l.push(t.$promise)}),a.all([a.all(l),a.all(o)]).then(function(s){var o=s[0],a=s[1];_.each(i,function(e,t){_.each(o[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.tags)||(i.tags=[]),i.tags.indexOf(e.displayName)<0&&i.tags.push(e.displayName)})}),_.each(r,function(e,t){_.each(a[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.location)||(i.location=[]),i.location.indexOf(e.displayName)<0&&i.location.push(e.displayName)})}),r=u.tree.children,e.settings.existingNodeIDs=_.pluck(t[3],"globalThingID"),e.settings.dataset.data=n;var l=_.uniq(_.pluck(n,"type")),c=[];_.each(l,function(e){c.push({name:e})}),e.settings.tabs[0].dataset=r,e.settings.tabs[1].dataset=c,e.settings.tabs[2].dataset=_.where(i,{tagType:"Custom"}),e.settings.tabs[3].dataset=n,e.ready=!0})})}]),angular.module("BeehivePortal").controller("UserThingACLController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e){e.ownThings=[],e.selectedThings=[]}]),angular.module("BeehivePortal").factory("UserListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("UserListController",["$scope","$rootScope","$state","AppUtils","$uibModal","$log","$location","$$User",function(e,t,i,n,r,s,o,a){function l(){e.userListForDisplay=_.filter(e.userList,function(t,i){return i>=(e.currentIndex-1)*e.listMaxLength&&i<e.currentIndex*e.listMaxLength})}e.userList=[],e.userListForDisplay=[],e.searchValue="",e.queryOptions=[{text:"用户ID",value:"userID"},{text:"用户名称",value:"userName"}],e.queryFiled=_.clone(e.queryOptions[0]),e.myMenu={itemList:[{text:"查看详情",callback:function(t){e.navigateTo(e.navMapping.USER_INFO,{userID:t.userID})},hidden:!e.PermissionControl.isAllowed("GET_USER")},{text:"编辑",callback:function(e){var t=r.open({animation:!0,templateUrl:"app/components/portal/UserManager/User/EditUser.template.html",controller:"UserController.EditUser",size:"md",resolve:{user:function(){return e}}});t.result.then(function(t){_.extend(e,t)},function(){s.info("Modal dismissed at: "+new Date)})},hidden:!e.PermissionControl.isAllowed("GET_USER")||!e.PermissionControl.allowAction("UPDATE_USER")},{text:"删除",callback:function(t){a.remove({},t,function(){console.log("用户"+t.userName+"已被删除！"),e.userList.remove(t),l()},function(){console.log("未能删除用户:"+t.userName)})},hidden:!e.PermissionControl.isAllowed("DELETE_USER")}],setting:{}},e.queryUsers=function(t,i){var r={role:"4"};i&&(r[t]=i),a.query(r,function(t){console.log(t),e.userList=t,e.pageChanged()},function(){n.alert("Failed to load group user list!")})},e.init=function(){o.search({pageIndex:1}),e.currentIndex=1,e.PermissionControl.allowAction("SEARCH_USERS")&&e.queryUsers()},e.pageChanged=function(){o.search({pageIndex:e.currentIndex}),l()}}]).controller("UserListController.ActivateUser",["$scope","user","$$User","$uibModalInstance",function(e,t,i,n){e.user=t,e.register=function(){i.register({},e.user,function(){AppUtils.alert("注册成功！请使用用户名登陆！"),n.close()},function(e,t){AppUtils.alert(t)})},e.cancel=function(){n.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("UserInfoService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("UserInfoController",["$scope","$rootScope","$state","AppUtils","PortalService","$$User","$uibModal",function(e,t,i,n,r,s,o){e.init=function(){if(e.PermissionControl.allowAction("GET_USER")){var t=!1;i.current.name==e.navMapping.GROUP_USER_INFO.state&&(t=!0),e.user=s.get({},{userID:i.params.userID})}},e.changeBuilding=function(){e.refreshLevels()},e.refreshLevels=function(){e.levelOptions=e.user.building.levels,e.user.level=e.levelOptions[0],e.refreshRooms()},e.refreshRooms=function(){e.roomOptions=e.user.level.rooms,e.user.room=e.roomOptions[0]},e.goThingAuth=function(){fromUserGroup?e.navigateTo(e.navMapping.GROUP_USER_THING_AUTH,e.$state.params):e.navigateTo(e.navMapping.USER_THING_AUTH,e.$state.params)},e.goThingACL=function(){fromUserGroup?e.navigateTo(e.navMapping.GROUP_USER_THING_ACL,e.$state.params):e.navigateTo(e.navMapping.GROUP_USER_THING_ACL,e.$state.params)},e.editUser=function(){var t=o.open({animation:!0,templateUrl:"app/components/portal/UserManager/User/EditUser.template.html",controller:"UserController.EditUser",size:"md",resolve:{user:function(){return e.user}}});t.result.then(function(t){e.user=t},function(){console.log("Modal dismissed at: "+new Date)})},e.deleteUser=function(){s.remove({},e.user,function(){e.navigateTo(e.navMapping.USER_LIST)},function(e){n.alert(e.statusText)})}}]),angular.module("BeehivePortal").factory("SearchUserService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("SearchUserController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("NewUserService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("NewUserController",["$scope","$rootScope","$state","AppUtils","$$User","PortalService",function(e,t,i,n,r){e.sexOptions=[{id:1,text:"男"},{id:2,text:"女"}],e.newUser={userID:"",userName:"",phone:"",mail:"",company:"",role:"4",custom:{sex:{},id:"",building:null,level:null,room:null}},e.init=function(){},e.createUser=function(){r.create(e.newUser,function(){e.navigateTo(e.navMapping.USER_LIST)},function(e){409==e.status&&console.log(e),n.alert("User ID exists!")})}}]),angular.module("BeehivePortal").directive("triggerControlGroup",[function(){return{restrict:"E",replace:!0,scope:{trigger:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/trigger-control-group/trigger-control-group.template.html",controller:["$scope",function(e){e.deleteTrigger=function(t){e.$emit("deleteTrigger",t)},e.enableTrigger=function(t){e.$emit("enableTrigger",t)},e.disableTrigger=function(t){e.$emit("disableTrigger",t)}}]}}]),angular.module("BeehivePortal").directive("triggerCommand",["$compile","$$Tag","$$Thing","$timeout","$uibModal",function(){return{restrict:"E",replace:!0,scope:{myActions:"=?",disabled:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/trigger-command/trigger-command.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http",function(e){e.selectedActions=[],e.actionOptions=[],e.$watch("myActions",function(t){e.actionOptions=[],_.each(t,function(t,i){e.actionOptions.push({id:i,label:i,action:t})})}),e.$watch("selectedActions",function(t){_.each(t,function(t){e.myActions[t.id]._checked=!0})},!0),e.$watch("myActions",function(t){e.selectedActions=[],_.each(t,function(t,i){t._checked&&e.selectedActions.push({id:i,label:i,action:t})})})}]}}]),angular.module("BeehivePortal").directive("summaryTrigger",["$compile","$$Tag","$$Thing","$timeout","$uibModal",function(e,t,i,n,r){return{restrict:"E",replace:!0,scope:{ready:"=?",dataset:"=?",trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/summary-trigger/summary-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){function t(){var t=[];_.each(e.dataContainer.mySources,function(e){var i=new TriggerSummarySource,n={};e.thingList?n.thingList=_.pluck(e.thingList,"globalThingID"):(n.tagList=_.pluck(e.tagList,"displayName"),n.andExpress=e.andExpress),i.setSource(n),i.setName(e.name),t.push(i)}),_.each(t,function(t){t.schema=[{name:"power",type:"boolean"},{name:"dimming",type:"value"}],e.myTrigger.addSummarySource(t)})}function i(){e.summarySchema=[],_.each(e.myTrigger.summarySource,function(t){var i=_.where(t.schema,{_checked:!0});t.expressList=[],_.each(i,function(i){i.summaryAlias&&""!=i.summaryAlias&&(t.expressList.push({stateName:i.name,"function":_.clone(i["function"]),summaryAlias:i.summaryAlias}),e.summarySchema.push({name:i.summaryAlias,type:"range"}))})})}function n(){e.myTrigger.setTriggersWhen(e.myTrigger.predicate.triggersWhen.value),e.myTrigger.setCondition(e.dataContainer.summaryConditionClause)}function s(){var t=[];_.each(e.dataContainer.myTargets,function(e){var i=new TriggerTarget,n={};e.thingList?n.thingList=_.pluck(e.thingList,"globalThingID"):(n.tagList=_.pluck(e.tagList,"displayName"),n.andExpress=e.andExpress),i.setSource(n,e.sourceType,e.andExpress),t.push(i)}),_.each(t,function(){}),e.myTrigger.setTargets(t)}function o(){}e.myTrigger=_.clone(e.trigger),e.currentStep=1,e.triggerWhenConditions=[{text:"条件为真",value:Trigger.WhenEnum.TRUE},{text:"条件由假转真",value:Trigger.WhenEnum.FALSE_TO_TRUE},{text:"条件改变",value:Trigger.WhenEnum.CHANGED}],e.aggregationFunctions=[{text:"求和",value:TriggerSummarySource.FunctionEnum.SUM},{text:"计数",value:TriggerSummarySource.FunctionEnum.COUNT},{text:"最大值",value:TriggerSummarySource.FunctionEnum.MAX},{text:"最小值",value:TriggerSummarySource.FunctionEnum.MIN},{text:"平均值",value:TriggerSummarySource.FunctionEnum.AVG}],e.dataContainer={mySources:[],myTargets:[],summaryConditionClause:{}},e.summarySchema=[],e.schema=[{name:"power",type:"boolean"},{name:"dimming",type:"range"},{name:"color",type:"in",values:["red","green","blue"]}],e.init=function(){_.each(e.myTrigger.summarySource,function(t){e.dataContainer.mySources.push(t.source)})},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(r){switch(r){case 1:t();break;case 2:i();break;case 3:n();break;case 4:s();break;case 5:o()}e.currentStep=r+1,console.log(e.myTrigger)},e.createSource=function(){var t=r.open({animation:!0,templateUrl:"/app/components/TriggerManager/new-source.html",controller:"summaryTrigger.CreateSource",size:"md"});t.result.then(function(t){e.dataContainer.mySources.splice(0,0,t)})},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,{})}}]}}]).controller("summaryTrigger.CreateSource",["$uibModalInstance","$scope",function(e,t){t.createSource=function(t){var i={name:t};e.close(i)},t.cancel=function(){e.dismiss("cancel")}}]),angular.module("BeehivePortal").directive("singleTrigger",["$compile",function(){return{restrict:"E",replace:!0,scope:{trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/single-trigger/single-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http","TriggerService","$$Type","$$Trigger","AppUtils",function(e,t,i,n,r,s,o,a,l,u){function c(){e.trigger.setTriggersWhen(e.dataContainer.predicate.triggersWhen),e.trigger.setCondition(e.dataContainer.predicate.condition),p()}function p(){e.dataContainer.schedule.enabled?("interval"==e.dataContainer.schedule.type?delete e.dataContainer.schedule.cron:(delete e.dataContainer.schedule.timeUnit,delete e.dataContainer.schedule.interval,e.dataContainer.schedule.cron="0 "+e.dataContainer.schedule.cron),e.trigger.setSchedule(e.dataContainer.schedule),console.log(e.dataContainer.schedule)):delete e.trigger.predicate.schedule}function d(){var t=[];e.dataContainer.targetSchemas=[],_.each(e.dataContainer.myTargets,function(i,n){var r=new TriggerTarget,s={};i.thingList?s.thingList=i.thingList:(s.tagList=i.tagList,s.andExpress=i.andExpress,s.type=i.selectedType.id),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(i).then(function(t){o.getTypeSchemas(t).then(function(t){e.dataContainer.targetSchemas[n]=o.xSchemas(t)})}),r.setSource(s,i.sourceType,i.andExpress),t.push(r)}),e.trigger.setTargets(t)}function g(){_.each(e.dataContainer.targetSchemas,function(t,i){e.trigger.targets[i].command.actions=[],_.each(t.actions,function(t,n){var r={},s=!1;r[n]={},t._checked&&_.each(t.in.properties,function(e,t){e._checked&&(r[n][t]=e.value,s=!0)}),s&&e.trigger.targets[i].command.actions.push(r)})})}function h(){l.save(e.trigger,function(t){e.trigger.triggerID=t.triggerID,u.alert("创建触发器成功！"),console.log(t)},function(e){u.alert("创建触发器失败！错误信息:"+e)})}e.currentStep=1,e.triggerWhenConditions=o.triggerWhenConditions,e.dataContainer={schedule:{},predicate:{triggersWhen:null,condition:{}},sourceSchema:null,myTargets:[],targetSchemas:[]},e.init=function(){var t=e.trigger.source.thingID;i.get({globalThingID:t},function(t){e.dataContainer.sourceSchema=o.getSchemaByType(t.type),e.dataContainer.predicate=e.trigger.predicate}),e.dataContainer.schedule=e.trigger.predicate.schedule||{},e.trigger.predicate.schedule&&(e.dataContainer.schedule.enabled=!0),_.each(e.trigger.targets,function(t,i){e.dataContainer.myTargets.push(t),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(t).then(function(n){e.trigger.targets.thingTypes=n,o.getTypeSchemas(n).then(function(n){e.dataContainer.targetSchemas[i]=o.xSchemas(n),o.initTargetSchema(t,e.dataContainer.targetSchemas[i])})})})},e.goStep=function(t){e.trigger.triggerID&&(e.currentStep=t)},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(t){switch(t){case 1:c();break;case 2:d();break;case 3:g(),h()}e.currentStep=e.currentStep>2?e.currentStep:t+1,console.log(JSON.stringify(e.trigger))},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,new TriggerTarget)}}]}}]),angular.module("BeehivePortal").directive("sourcePicker",["$compile",function(){return{restrict:"E",replace:!0,scope:{mySource:"=?",ready:"=?",disabled:"=?",init:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-source/select-source.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){e.$watch("mySource.tagTypes",function(t){e.mySource.thingTypes=[],_.each(t,function(t){e.mySource.thingTypes.push({label:t,id:t})})},!0),e.$watch("mySource.sourceType",function(t){"tag"==t?delete e.mySource.thingList:delete e.mySource.tagList}),e.sourceTypes=[{text:"设备",value:"thing"},{text:"标签",value:"tag"}],e.andExpressOptions=[{text:"交集",value:!0},{text:"并集",value:!1}],e.init=function(){e.mySource=e.mySource||{},e.mySource.sourceType=e.mySource.tagList&&e.mySource.tagList.length>0?e.sourceTypes[1].value:e.sourceTypes[0].value},e.mySource.selectedType={},e.thingTypeChange=function(){}}]}}]),angular.module("BeehivePortal").directive("selectSchedule",["$compile",function(){return{restrict:"E",replace:!0,scope:{schedule:"=?",disabled:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-schedule/select-schedule.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){function t(e){return e?6==e.split(" ").length?e.substr(2):e:""}e.scheduleTypes=[{text:"间隔任务",value:"Interval"},{text:"定时任务",value:"Cron"}],e.intervalUnits=[{text:"秒",value:"Second"},{text:"分",value:"Minute"},{text:"小时",value:"Hour"},{text:"天",value:"Day"}],e.init=function(){e.schedule=e.schedule||{timeUnit:"Second",interval:0},e.initCron=t(e.schedule.cron)},e.$watch("schedule.cron",function(i){e.initCron=t(i)})}]}}]),angular.module("BeehivePortal").directive("selectPolicy",["$compile",function(){return{restrict:"E",replace:!0,scope:{policy:"=?",thingNumber:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-policy/select-policy.template.html",controller:["$scope","TriggerService","AppUtils",function(e){e.policyOptions=[{text:"所有",value:Trigger.PolicyTypeEnum.ALL},{text:"任意一个",value:Trigger.PolicyTypeEnum.ANY},{text:"指定数量",value:Trigger.PolicyTypeEnum.SOME},{text:"指定百分比",value:Trigger.PolicyTypeEnum.PERCENT}],e.init=function(){e.policy||(e.policy={groupPolicy:e.policyOptions[0].value})}}]}}]),angular.module("BeehivePortal").directive("multiSourcePicker",["$compile","$$Tag","$$Thing","$timeout","AppUtils",function(e,t,i,n,r){return{restrict:"E",replace:!0,scope:{sources:"=",resultSourceSet:"=?",disabled:"=?"},templateUrl:"app/components/portal/TriggerManager/directives/select-multiple-source/select-multiple-source.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e){e.removeSource=function(t){r.confirm("删除源","您确定要删除源吗？",function(){e.sources.remove(t)})}}]}}]),angular.module("BeehivePortal").directive("scheduleTrigger",["$compile",function(){return{restrict:"E",replace:!0,scope:{trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/schedule-trigger/schedule-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http","TriggerService","$$Type","$$Trigger","AppUtils",function(e,t,i,n,r,s,o,a,l,u){function c(){"Interval"==e.dataContainer.schedule.type?delete e.dataContainer.schedule.cron:(delete e.dataContainer.schedule.timeUnit,delete e.dataContainer.schedule.interval,e.dataContainer.schedule.cron="0 "+e.dataContainer.schedule.cron),e.trigger.setSchedule(e.dataContainer.schedule),delete e.trigger.source,delete e.trigger.predicate.condition,console.log(e.dataContainer.schedule)}function p(){var t=[];e.dataContainer.targetSchemas=[],_.each(e.dataContainer.myTargets,function(i,n){var r=new TriggerTarget,s={};i.thingList?s.thingList=i.thingList:(s.tagList=i.tagList,s.andExpress=i.andExpress,s.type=i.selectedType.id),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(i).then(function(t){o.getTypeSchemas(t).then(function(t){e.dataContainer.targetSchemas[n]=o.xSchemas(t)})}),r.setSource(s,i.sourceType,i.andExpress),t.push(r)}),e.trigger.setTargets(t)}function d(){_.each(e.dataContainer.targetSchemas,function(t,i){e.trigger.targets[i].command.actions=[],_.each(t.actions,function(t,n){var r={},s=!1;r[n]={},t._checked&&_.each(t.in.properties,function(e,t){e._checked&&(r[n][t]=e.value,s=!0)}),s&&e.trigger.targets[i].command.actions.push(r)})})}function g(){var t=o.getDataForRequest(e.trigger,"Schedule");l.save(t,function(t){u.alert("创建触发器成功！"),e.trigger.triggerID=t.triggerID},function(e){u.alert("创建触发器失败！错误信息:"+JSON.stringify(e))})}e.currentStep=1,e.triggerWhenConditions=o.triggerWhenConditions,e.dataContainer={predicate:{},schedule:{},myTargets:[],targetSchemas:[]},e.goStep=function(t){e.trigger.triggerID&&(e.currentStep=t)},e.init=function(){e.dataContainer.predicate=e.trigger.predicate,e.dataContainer.schedule=e.trigger.predicate.schedule,console.log(e.dataContainer.schedule),_.each(e.trigger.targets,function(t,i){e.dataContainer.myTargets.push(t),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(t).then(function(n){e.trigger.targets.thingTypes=n,o.getTypeSchemas(n).then(function(n){e.dataContainer.targetSchemas[i]=o.xSchemas(n),o.initTargetSchema(t,e.dataContainer.targetSchemas[i])})})})},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(t){switch(t){case 1:c();break;case 2:p();break;case 3:d(),g()}e.currentStep=e.currentStep>2?e.currentStep:t+1,console.log(JSON.stringify(e.trigger))},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,new TriggerTarget)}}]}}]),angular.module("BeehivePortal").directive("groupTrigger",["$compile","$$Tag","$$Thing","$timeout","$uibModal","$$Type",function(){return{restrict:"E",replace:!0,scope:{trigger:"="},templateUrl:"app/components/portal/TriggerManager/directives/group-trigger/group-trigger.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q","$http","TriggerService","$$Type","$$Trigger",function(e,t,i,n,r,s,o,a,l){function u(){"tag"==e.dataContainer.mySource.sourceType?e.dataContainer.mySource.thingList&&delete e.dataContainer.mySource.thingList:e.dataContainer.mySource.tagList&&delete e.dataContainer.mySource.tagList,o.getSourceTypes(e.dataContainer.mySource).then(function(t){"tag"==e.dataContainer.mySource.sourceType&&(e.myTrigger.source.type=e.dataContainer.mySource.selectedType),o.getTypeSchemas(t).then(function(t){e.dataContainer.sourceSchema=o.xSchemas(t)})}),e.myTrigger.setSource(e.dataContainer.mySource,e.dataContainer.mySource.sourceType)}function c(){e.myTrigger.setTriggersWhen(e.dataContainer.predicate.triggersWhen),e.myTrigger.setCondition(e.dataContainer.predicate.condition)}function p(){var t=[];e.dataContainer.targetSchemas=[],_.each(e.dataContainer.myTargets,function(i,n){var r=new TriggerTarget,s={};i.thingList?s.thingList=i.thingList:(s.tagList=i.tagList,s.andExpress=i.andExpress,s.type=i.selectedType.id),e.dataContainer.targetSchemas.push({}),o.getSourceTypes(i).then(function(t){o.getTypeSchemas(t).then(function(t){e.dataContainer.targetSchemas[n]=o.xSchemas(t)})}),r.setSource(s,i.sourceType,i.andExpress),t.push(r)}),e.myTrigger.setTargets(t)}function d(){_.each(e.dataContainer.targetSchemas,function(t,i){e.myTrigger.targets[i].command.actions=[],_.each(t.actions,function(t,n){var r={},s=!1;r[n]={},t._checked&&_.each(t.in.properties,function(e,t){e._checked&&(r[n][t]=e.value,s=!0)}),s&&e.myTrigger.targets[i].command.actions.push(r)})})}function g(){l.save(e.myTrigger)}e.myTrigger=_.clone(e.trigger),e.dataContainer={},e.currentStep=1,e.triggerWhenConditions=o.triggerWhenConditions,e.init=function(){e.dataContainer={mySource:{thingType:e.myTrigger.source.thingType,thingList:_.clone(e.myTrigger.source.thingList),tagList:_.clone(e.myTrigger.source.tagList),andExpress:e.myTrigger.source.andExpress},predicate:null,sourceSchema:null,myTargets:[],targetSchemas:[],policy:{groupPolicy:"All"}},o.getSourceTypes(e.dataContainer.mySource).then(function(t){e.dataContainer.mySource.thingTypes=t,e.dataContainer.mySource.thingType?o.getSchemaByType(e.dataContainer.mySource.thingType).$promise.then(function(t){e.dataContainer.predicate=e.myTrigger.predicate,e.dataContainer.sourceSchema=t},function(){}):o.getTypeSchemas(t).then(function(t){e.dataContainer.predicate=e.myTrigger.predicate,e.dataContainer.sourceSchema=o.xSchemas(t)})}),_.each(e.myTrigger.targets,function(t,i){o.getSourceTypes(t).then(function(n){e.dataContainer.myTargets.push({tagList:t.tagList,thingList:t.thingList,andExpress:t.andExpress,thingType:t.thingType,thingTypes:n}),e.dataContainer.targetSchemas.push({});var r;r=t.thingType?[t.thingType]:n,o.getTypeSchemas(r).then(function(n){var r=o.xSchemas(n);o.initTargetSchema(t,r),e.dataContainer.targetSchemas[i]=r})})})},e.previousStep=function(t){e.currentStep=t-1},e.nextStep=function(t){switch(t){case 1:u();break;case 2:c();break;case 3:p();break;case 4:d(),g()}e.currentStep=e.currentStep>3?e.currentStep:t+1,console.log(JSON.stringify(e.myTrigger))},e.createTarget=function(){e.dataContainer.myTargets.splice(0,0,new TriggerTarget)}}]}}]).controller("summaryTrigger.CreateSource",["$uibModalInstance","$scope",function(e,t){t.createSource=function(t){var i={name:t};e.close(i)},t.cancel=function(){e.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("UserGroupService",["$http","$q","Session",function(e){var t={};return t.getUserGroups=function(){return e({url:"app/data/userGroup.json",method:"get"})},t.getGroup=function(){return e({url:"app/data/group.json",method:"get"})},t}]),angular.module("BeehivePortal").controller("UserGroupController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("UserService",["$http","$q","Session",function(e){var t={};return t.getUserList=function(){return e({url:MyAPIs.SEARCH_USER,method:"get",data:{}})},t}]),angular.module("BeehivePortal").controller("UserController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").controller("UserController.EditUser",["$scope","$uibModalInstance","user","$$User","PortalService",function(e,t,i,n){e.user=i,e.ok=function(){n.update(i,function(){t.close(e.user),console.log("save user succeeded!")},function(){console.log("failed to save user!")})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("ThingAuthorityService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("ThingAuthorityController",["$scope","$rootScope","$state","AppUtils","$timeout","$$Thing","$$Tag","$q","$$Location",function(e,t,i,n,r,s,o,a,l){e.ownThings=[],e.selectedThings=[],e.settings={dataset:{},idFieldName:"globalThingID",tabs:[{dataset:[],name:"位置",mapper:{nameFieldName:"name",idFieldName:"id",mapperFieldName:"location"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"种类",mapper:{nameFieldName:"name",idFieldName:"name",mapperFieldName:"type"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"标签",mapper:{nameFieldName:"displayName",idFieldName:"displayName",mapperFieldName:"tags"},nameGenerator:function(e){return e.type+"-"+e.globalThingID}},{dataset:[],name:"全部",nameGenerator:function(e){return e.type+"-"+e.globalThingID}}]};var u=s.getAll().$promise;a.all([o.queryAll().$promise,u,l.queryAll().$promise]).then(function(t){var i=t[0],n=t[1],r=t[2],o=[],l=[],u=new LocationTree(_.pluck(r,"displayName"));_.each(r,function(e){var t=s.byTag({tagType:"Location",displayName:e.displayName});o.push(t.$promise)}),_.each(i,function(e){var t=s.byTag({tagType:"Custom",displayName:e.displayName});l.push(t.$promise)}),a.all([a.all(l),a.all(o)]).then(function(s){var o=s[0],a=s[1];_.each(i,function(e,t){_.each(o[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.tags)||(i.tags=[]),i.tags.indexOf(e.displayName)<0&&i.tags.push(e.displayName)})}),_.each(r,function(e,t){_.each(a[t],function(t){var i=_.find(n,function(e){return t.globalThingID==e.globalThingID});_.isArray(i.location)||(i.location=[]),i.location.indexOf(e.displayName)<0&&i.location.push(e.displayName)})}),r=u.tree.children,e.settings.existingNodeIDs=_.pluck(t[3],"globalThingID"),e.settings.dataset.data=n;var l=_.uniq(_.pluck(n,"type")),c=[];_.each(l,function(e){c.push({name:e})}),e.settings.tabs[0].dataset=r,e.settings.tabs[1].dataset=c,e.settings.tabs[2].dataset=_.where(i,{tagType:"Custom"}),e.settings.tabs[3].dataset=n,e.ready=!0})})}]),angular.module("BeehivePortal").factory("TypeViewService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("TypeViewController",["$scope","$rootScope","$state","AppUtils","$$Type","$uibModal",function(e,t,i,n,r,s){e.thingTypes=[],e.init=function(){return e.PermissionControl.allowAction("SEARCH_TYPES")?void(e.thingTypes=r.getAll()):!1},e.viewThings=function(t){e.navigateTo(e.navMapping.TYPE_THING_LIST,{typeName:t.type,from:"type"})},e.editType=function(e){var t=s.open({animation:!0,templateUrl:"app/components/portal/ThingViews/TypeView/EditType.template.html",controller:"TypeViewController.EditType",size:"lg",resolve:{type:_.clone(e)}});t.result.then(function(){},function(){})}}]).controller("TypeViewController.EditType",["$scope","$http","$uibModalInstance","type","$$Type","$timeout","$q",function(e,t,i,n,r,s,o){e.schema={};var a;e.init=function(){var t=new Promise(function(e){s(function(){var t=document.getElementById("jsoneditor"),i={mode:"code"};a=new JSONEditor(t,i),e(a)},50)});e.type=n;var i=r.getSchema({type:n.type}).$promise;o.all([t,i]).then(function(t){var i=t[1];i.name||(e.schema=null),e.schema=i,a.set(i)})},e.propertyRequired=function(e,t){return!!_.find(t,function(t){return t==e})},e.ok=function(){var t=a.get(),n={thingType:e.type.type,name:t.name,version:t.version,content:t};r.saveSchema(n,function(){i.close(e.type)})},e.cancel=function(){i.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("ThingListService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("ThingListController",["$scope","$rootScope","$state","AppUtils","$location","$$Thing",function(e,t,i,n,r,s){e.things=[],e.thingsForDisplay=[],e.queryThings=function(t,i){e.things="type"==t?s.byType({},{typeName:i}):s.byTag({tagType:"Custom",displayName:i})},e.init=function(){var t=i.params.from,n=i.params.id,r=null;switch(t){case"type":r=e.navMapping.TYPE_THING_DETAIL,n=i.params.typeName;break;case"tag":r=e.navMapping.TAG_THING_DETAIL,n=i.params.displayName}e.queryThings(t,n);var s=_.find(e.myMenu.itemList,function(e){return"查看详情"==e.text});_.extend(s,{callback:function(t){e.navigateTo(r,_.extend({thingid:t.globalThingID},i.params))}})}}]),angular.module("BeehivePortal").controller("ThingDetailController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$uibModal","$timeout","$$Trigger","$log",function(e,t,i,n,r,s,o,a,l,u){e.thing={},e.dataset={triggers:[]};var c;e.init=function(){e.thing=r.get({globalThingID:i.params.thingid},function(t){r.getOnboardingInfo({globalThingID:t.vendorThingID},function(t){_.extend(e.thing,t),u.debug(t)}),r.getTriggers({globalThingID:i.params.thingid},function(t){_.each(t,function(t){var i=new Trigger(t.type);i.init(t),e.dataset.triggers.push(i)})}),a(function(){var e={mode:"code"};c=document.getElementById("customEditor"),c=new JSONEditor(c,e)},50)})},e.editCustom=function(t){e.customOnEdit=!0,c.set(t)},e.refreshStatus=function(){e.thing=r.get({globalThingID:i.params.thingid})},e.submitCustomFields=function(t){t.custom=c.get(),r.save({},t,function(){n.alert("更新设备信息成功！","提示信息"),e.customOnEdit=!1})},e.goThingACL=function(){i.go(e.navMapping.LOCATHON_THING_ACL,i.params)},e.createTriggerModal=function(){var t=o.open({animation:!0,templateUrl:"app/components/portal/ThingViews/ThingRule.template.html",controller:"ThingDetailController.CreateTrigger",size:"lg",resolve:{thing:function(){return e.thing}}});t.result.then(function(t){e.dataset.triggers.push(t)})},e.deleteTrigger=function(t){t.triggerID?l.remove({},t,function(){e.dataset.triggers.remove(t)}):e.dataset.triggers.remove(t)},e.enableTrigger=function(e){l.enable({},e,function(){e.enable()})},e.disableTrigger=function(e){l.disable({},e,function(){e.disable()})},e.$on("deleteTrigger",function(t,i){n.confirm("提示信息","您确定要删除这个触发器吗？",function(){e.deleteTrigger(i)})}),e.$on("enableTrigger",function(t,i){n.confirm("提示信息","您确定要启用这个触发器吗？",function(){e.enableTrigger(i)})}),e.$on("disableTrigger",function(t,i){n.confirm("提示信息","您确定要禁用这个触发器吗？",function(){e.disableTrigger(i)})})}]).controller("ThingDetailController.CreateTrigger",["$scope","$uibModalInstance","thing",function(e,t,i){e.triggerBO={},e.ok=function(){var n=new Trigger(Trigger.TypeEnum.SIMPLE);n.setName(e.triggerBO.triggerName),n.setSource(i.globalThingID),t.close(n)},e.cancel=function(){t.dismiss()}}]),angular.module("BeehivePortal").controller("ThingACLController",["$scope","$rootScope","$state","AppUtils","$$User",function(e,t,i,n,r){e.users=r.query({role:"4"},function(e){console.log(e)
}),e.acls=[{name:"开关"},{name:"亮度"}]}]),angular.module("BeehivePortal").controller("TagViewController",["$scope","$rootScope","$state","AppUtils","$$Tag","$$Thing","$uibModal","$q","$http",function(e,t,i,n,r,s,o){e.thingTags=[],e.tagsForDisplay=[],e.init=function(){return e.PermissionControl.allowAction("SEARCH_TAGS")?void r.queryAll(function(t){e.thingTags=t},function(e){console.log(e)}):!1},e.viewThings=function(t){e.navigateTo(e.navMapping.TAG_THING_LIST,{id:t.tagName,from:"tag",displayName:t.displayName})},e.addTag=function(){var t=o.open({animation:!0,templateUrl:"app/components/portal/ThingViews/TagView/AddTag.template.html",controller:"TagViewController.AddTag",size:"md",resolve:{}});t.result.then(function(t){e.thingTags.push(t)},function(){})},e.deleteTag=function(t){n.confirm("删除标签","是否删除标签"+t.displayName,function(){return r.remove({},{tagName:t.displayName},function(){e.thingTags.remove(t)})})},e.editTag=function(e){var t=o.open({animation:!0,templateUrl:"app/components/portal/ThingViews/TagView/EditTag.template.html",controller:"TagViewController.EditTag",size:"lg",resolve:{tag:e}});t.result.then(function(t){_.extend(e,t)},function(){})}}]),angular.module("BeehivePortal").controller("TagViewController.AddTag",["$scope","$uibModalInstance","$$Tag",function(e,t,i){e.newTag={things:[]},e.ok=function(){i.create(e.newTag,function(e){e.count=0,e.displayName=e.tagName,t.close(e)},function(e){console.log(e)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("TagViewController.EditTag",["$scope","$uibModalInstance","$$Tag","$$Thing","$timeout","tag","$q","$$Location","PermissionControl",function(e,t,i,n,r,s,o,a,l){e.tag=s,e.existingIDs=[],e.selectedThings=[],e.init=function(){e.thingAllowed=l.isAllowed("SEARCH_THINGS")&&l.isAllowed("BING_TAG")&&l.isAllowed("UNBIND_TAG"),e.thingAllowed&&n.byTag({tagType:"Custom",displayName:s.displayName},function(t){e.selectedThings=_.uniq(_.pluck(t,"globalThingID")),e.existingIDs=_.clone(e.selectedThings)})},e.ok=function(){var r=e.selectedThings;i.update(e.tag,function(){e.thingAllowed&&n.bindTags({things:r.join(","),tags:e.tag.displayName},function(){var i=_.difference(e.existingIDs,r),s=r.length;i.length>0&&n.removeTags({things:i.join(","),tags:e.tag.displayName}),e.tag.count=s,t.close(e.tag)})},function(e){AppUtils.alert(e)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("LocationViewController",["$scope","$rootScope","$state","AppUtils","$$Tag","$$Thing","$$Location","PortalService",function(e,t,i,n,r,s,o){e.things=[],e.thingsForDisplay=[],e.selectedLocation={},e.init=function(){if(e.things=s.getAll(),e.locationsTree=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},!e.PermissionControl.allowAction("SEARCH_LOCATIONS"))return!1;e.locations=o.queryAll(function(t){e.locationTree=new LocationTree(_.pluck(t,"displayName"))});var t=_.find(e.myMenu.itemList,function(e){return"查看详情"==e.text});_.extend(t,{callback:function(t){e.navigateTo(e.navMapping.LOCATION_THING_DETAIL,{thingid:t.globalThingID})}})},e.selectLocation=function(t){e.things=s.byTag({tagType:"Location",displayName:t.id})},e.search=function(t){e.things=s.byTag({tagType:"Location",displayName:t.displayName})}}]),angular.module("BeehivePortal").controller("GatewayController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$$Location","$uibModal",function(e,t,i,n,r,s,o,a){e.things=[],e.init=function(){return e.locationsTree=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.PermissionControl.allowAction("SEARCH_LOCATIONS")?void o.queryAll(function(t){e.locationTree=new LocationTree(_.pluck(t,"displayName")).tree.children,e.selectLocation(e.locationTree[0])}):!1},e.selectLocation=function(t){r.byTag({tagType:"Location",displayName:t.id},function(t){e.things=_.filter(t,function(e){return"gateway-streetlight"==e.type})})},e.showGatewayThings=function(t){r.getEndNodes({},t,function(i){var n=i.results;e.endNodes=n,_.each(n,function(i,n){e.endNodes[n].kiiThingID=t.kiiThingID,e.endNodes[n].kiiAppID=t.kiiAppID,e.endNodes[n].states=r.getEndNode({},{kiiAppID:t.kiiAppID,thingID:i.thingID})})})},e.showReplaceModal=function(e){var t=a.open({animation:!0,templateUrl:"app/components/portal/ThingManager/Gateway/Replacement.template.html",controller:"GatewayController.Replacement",size:"md",resolve:{endNode:function(){return e}}});t.result.then(function(e){_.extend(e,e)},function(){console.log("Modal dismissed at: "+new Date)})},e.removeEndNode=function(t){n.confirm("删除节点","您确认要删除这个节点吗？",function(){r.removeEndNode({},t,function(){e.endNodes.remove(t)})})}}]).controller("GatewayController.Replacement",["$scope","$uibModalInstance","$$Thing","endNode","$http",function(e,t,i,n){e.endNode={kiiAppID:n.kiiAppID,kiiThingID:n.kiiThingID,endNodeVendorThingID:n.vendorThingID,thingID:n.thingID},e.ok=function(){i.replaceEndNode({},e.endNode,function(){n.vendorThingID=e.endNode.endNodeVendorThingID,t.close(n)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("ControlThingController",["$scope","$state","AppUtils","$$Thing","$$Type","TriggerService","$timeout",function(e,t,i,n,r,s,o){function a(){var t=e.dataContainer.mySource.sourceType;"tag"==t?(e.dataContainer.mySource.thingList&&delete e.dataContainer.mySource.thingList,e.dataContainer.mySource.type=e.dataContainer.mySource.selectedType.id):e.dataContainer.mySource.tagList&&delete e.dataContainer.mySource.tagList;var i=e.dataContainer.mySource;s.getSourceTypes(i).then(function(t){s.getTypeSchemas(t).then(function(t){e.dataContainer.sourceSchema=t[0]})})}function l(){return e.PermissionControl.isAllowed("SEARCH_THINGS")?(e.dataContainer={mySource:{},command:{}},void(e.currentStep=1)):void t.go("app.portal.Welcome")}function u(){var t=e.dataContainer.sourceSchema,r=[];_.each(t.actions,function(e,t){var i={},n=!1;i[t]={},e._checked&&_.each(e.in.properties,function(e,r){e._checked&&(i[t][r]=e.value,n=!0)}),n&&r.push(i)});var s=["thingList","tagList","andExpress","type"];_.each(e.dataContainer.mySource,function(t,i){-1==s.indexOf(i)&&delete e.dataContainer.mySource[i]});var a=new BeehiveCommand,u=[];_.extend(a,e.dataContainer.mySource),a.command.actions=r,u.push(a),n.sendCommand(u,function(){l(),i.alert("命令已发送成功","提示信息"),e.refreshed=!1,o(function(){e.refreshed=!0})})}e.init=function(){l(),e.refreshed=!0},e.nextStep=function(t){switch(t){case 1:a();break;case 2:u()}e.currentStep=2==t?2:e.currentStep+1}}]),angular.module("BeehivePortal").controller("AddThingController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$timeout",function(e,t,i,n,r,s,o){e.types=[];var a;e.init=function(){e.types=s.getAll(),e.thing=new BeehiveThing,o(function(){var e=document.getElementById("jsoneditor"),t={mode:"code"};a=new JSONEditor(e,t)},50)},e.saveThing=function(e){var t=a.get();t&&(e.custom=t),r.save(e,function(){n.alert("保存成功！","提示信息")})}}]),angular.module("BeehivePortal").directive("thingSelector",["$compile","$timeout",function(){return{restrict:"E",replace:!0,scope:{selectedThings:"=?",selectedThingTypes:"=?"},templateUrl:"app/shared/directives/thing-selector/thing-selector.template.html",controller:["$scope","$$Tag","$$Thing","$$Location","$$Type","$timeout","$q","PermissionControl",function(e,t,i,n,r,s,o,a){function l(t){e.things=_.filter(t,function(e){return e.fullKiiThingID})}e.dataset={tags:[],types:[],locations:[]},e.things=[],e.unselectedThings=[],e.thingTypes=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.init=function(){e.tagAllowed=a.isAllowed("SEARCH_TAGS")&&a.isAllowed("SEARCH_THINGS"),e.locationAllowed=a.isAllowed("SEARCH_LOCATIONS")&&a.isAllowed("SEARCH_THINGS"),e.allDisabled=!e.tagAllowed&&!e.locationAllowed&&!e.typeAllowed,e.tagAllowed&&(e.dataset.tags=t.queryAll()),e.locationAllowed&&n.queryAll(function(t){e.dataset.locations=new LocationTree(_.pluck(t,"displayName")).tree.children})},e.selectLocation=function(t){i.byTag({tagType:"Location",displayName:t.id},function(t){l(t),s(function(){e.whenThingChange()})})},e.selectTag=function(t){e.things=i.byTag({tagType:"Custom",displayName:t.displayName},function(t){l(t),s(function(){e.whenThingChange()})})},e.$watch("selectedThings",function(){e.whenThingChange()}),e.whenThingChange=function(){e.unselectedThings=_.filter(e.things,e.unselectedFilter),e.thingTypes=[],e.selectedTypes=[];var t=_.uniq(_.pluck(e.unselectedThings,"type"));_.each(t,function(t){e.thingTypes.push({name:t,children:[]})}),_.each(e.unselectedThings,function(t){var i=_.find(e.thingTypes,function(e){return e.name==t.type});t=_.clone(t),t.name=t.vendorThingID+"/"+t.globalThingID,i.children.push(t)}),e.displayedThings=_.filter(e.things,function(t){return _.find(e.selectedThings,function(e){return e==t.globalThingID})});var i=_.filter(e.selectedThings,function(t){return!_.find(e.things,function(e){return e.globalThingID==t})});_.each(i,function(t){e.selectedTypes.push({name:t,id:t})});var n=_.uniq(_.pluck(e.displayedThings,"type"));e.selectedThingTypes=n,_.each(n,function(t){e.selectedTypes.push({name:t,children:[]})}),_.each(e.displayedThings,function(t){var i=_.find(e.selectedTypes,function(e){return e.name==t.type});t=_.clone(t),t.name=t.globalThingID,i.children.push(t)})},e.unselectedFilter=function(t){return!_.find(e.selectedThings,function(e){return e==t.globalThingID})},e.selectUnselectedThing=function(t){e.selectedUnselectedThing=t},e.selectSelectedThing=function(t){e.selectedSelectedThing=t},e.addThing=function(t){t&&(e.selectedThings=e.selectedThings||[],e.selectedUnselectedThing=null,e.selectedThings.push(t.globalThingID),s(function(){e.whenThingChange()}))},e.removeThing=function(t){if(t){if(!t.globalThingID)return e.selectedThings.remove(t.id),void e.whenThingChange();e.selectedSelectedThing=null,e.selectedThings.remove(t.globalThingID),s(function(){e.whenThingChange()})}}}]}}]),angular.module("BeehivePortal").directive("thingPicker",["$compile","$$Tag","$$Thing","$timeout",function(){return{restrict:"E",replace:!0,scope:{selectedNodes:"=?",settings:"=?",ready:"=?"},templateUrl:"app/shared/directives/thing-picker/thing-picker.template.html",controller:["$scope","$$Tag","$$Thing","$timeout","$q",function(e,t,i,n){function r(e,t,i){e.ancentIds=t,e.id=i,_.each(e.children,function(n,s){var o=_.clone(t);o.push(e.id);var a=i+s;r(n,o,a)})}function s(){var t=[];_.each(e.tabs,function(e){_.each(e.treeRight,function(e){o(e,function(e){if(!e.children||0==e.children.length){var i=_.clone(e.reference);_.find(t,function(e){return e[a.idFieldName]==i[a.idFieldName]})||t.push(i),delete i.clones}})})}),e.selectedNodes=t,_.each(e.selectedNodes,function(t,i){e.selectedNodes[i]=_.clone(t),delete e.selectedNodes[i].ancentIds,delete e.selectedNodes[i].container,delete e.selectedNodes[i].reference,delete e.selectedNodes[i].referencedRightTree,delete e.selectedNodes[i].referencedLeftTree})}function o(e,t){if(e){if(e.children&&e.children.length)for(var i=e.children.length;i>=0;i--)o(e.children[i],t);return t(e)}}var a={tabs:[],id:"id",data:[]};e.tabs=[],e.settings=e.settings||{},e.settings=_.extend(a,e.settings),e.tabs=e.settings.tabs,e.selecteTab=function(t){n(function(){_.each(e.tabs,function(e){e.active=!1}),t.active=!0}),e.treeLeft=t.treeLeft,e.treeRight=t.treeRight},e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.$watch("ready",function(t){1==t&&n(e.onReady)}),e.init=function(){_.each(e.tabs,function(e){e.active=!1,e.treeLeft=[],e.treeRight=[]}),e.selecteTab(e.tabs[0]),e.treeLeft=e.tabs[0].treeLeft,e.treeRight=e.tabs[0].treeRight},e.onReady=function(){function t(t,i){var n=_.filter(t,function(e){return _.find(i,function(t){return t==e[a.idFieldName]})});_.each(n,function(t){_.each(t.clones,function(t){e.switchNodeReferences(t,!0)})})}function i(e,t,i){var n=i.mapper,s=i.treeLeft,a=i.treeRight,l=i.nameGenerator,u=i.name;n?_.each(e,function(e){o(e,function(e){e.children=e.children||[],e.name=e[n.nameFieldName],e.isFolder=!0,_.each(t,function(t){if(null!==t[n.mapperFieldName]&&(t[n.mapperFieldName]===e[n.idFieldName]||t[n.mapperFieldName]instanceof Array&&t[n.mapperFieldName].indexOf(e[n.idFieldName])>-1)){var i=_.clone(t);_.extend(i,{name:l(i),reference:t,referencedLeftTree:s,referencedRightTree:a}),t.clones=t.clones||[],t.clones.push(i),e.children.push(i)}})})}):_.each(e,function(e){_.extend(e,{name:l(e),reference:e,referencedLeftTree:s,referencedRightTree:a}),e.clones=e.clones||[],e.clones.push(e)}),_.each(e,function(e,t){r(e,[""],u+t.toString()),s.push(e),e.container=s}),_.each(e,function(e){o(e,function(e){e.children&&0!=e.children.length||!e.isFolder||e.container.remove(e)})})}e.existingNodes=e.settings.existingNodeIDs,e.queriedNodes=e.settings.dataset.data,_.each(e.tabs,function(t){i(t.dataset,e.queriedNodes,t)}),t(e.queriedNodes,e.existingNodes)},e.switchNode=function(e,t,i){function n(e,t){if(0==e.length)return[];var i=_.find(t,function(t){return t.id==e[0]});if(!i)return void 0;var r=n(e.removeFirst(),i.children);return void 0==r?void 0:r.concat([i])}function r(e,t){if(0!=t.length){var i=_.last(t);if(0==i.children.length&&t.length>1){var n=t[t.length-2];n.children.splice(n.children.indexOf(i),1),r(e,t.slice(0,t.length-1))}else 1==t.length&&0==i.children.length&&e.splice(e.indexOf(i),1)}}var s=n(e.ancentIds.removeFirst(),t);if(!s||0==s.length)return void(!e.isFolder&&t.indexOf(e)>-1&&(i.push(e),t.remove(e)));if(0!=_.where(s[0].children,{id:e.id}).length){s=s.reverse();var o=_.clone(s);_.each(o,function(e,t){o[t]=_.clone(e),o[t].children=[]});var a=!0,l=i;_.each(o,function(e,t){if(a){var i=_.find(l,function(t){return e.id===t.id});if(i)l=i.children;else{a=!1;for(var n=t;n<o.length;n++){var r=_.clone(o[n]);r.children=[],l.push(r),l=r.children}}}});var a=_.find(l,function(t){return t.id==e.id});a||l.push(e);var u;u=o.length>0?_.last(s).children:t,u.splice(u.indexOf(e),1),r(t,s)}},e.switchNodeReferences=function(t,i){o(t,function(t){if(!(t.children&&t.children.length>0)){if(t.reference){var n=t.reference;_.each(n.clones,function(t){i?e.switchNode(t,t.referencedLeftTree,t.referencedRightTree):e.switchNode(t,t.referencedRightTree,t.referencedLeftTree)})}else i?e.switchNode(t,t.referencedLeftTree,t.referencedRightTree):e.switchNode(t,t.referencedRightTree,t.referencedLeftTree);return!0}}),s()},e.addButtonClick=function(){e.switchNodeReferences(e.selectedLeftNode,!0),e.selectedLeftNode=null},e.removeButtonClick=function(){e.switchNodeReferences(e.selectedRightNode,!1),e.selectedRightNode=null},e.selectLeftNode=function(t){e.selectedLeftNode=t},e.selectRightNode=function(t){e.selectedRightNode=t}}]}}]),angular.module("BeehivePortal").directive("tagSelector",["$compile",function(){return{restrict:"E",scope:{selectedTags:"=?",tagTypes:"=?"},templateUrl:"app/shared/directives/tag-selector/tag-selector.template.html",controller:["$scope","$$Tag","$$Location","PermissionControl","$$Thing",function(e,t,i,n,r){function s(e){var t=e.indexOf("-"),i=e.substr(0,t),n=e.substr(t+1,e.length-t-1);return o(i,n)}function o(e,t){return r.byTag({tagType:e,displayName:t})}e.settings={name:"displayName",id:"displayName",unselectedTitle:"未选标签",selectedTitle:"已选标签"},e.tagThings=[],e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.init=function(){e.tagAllowed=n.isAllowed("SEARCH_TAGS"),e.locationAllowed=n.isAllowed("SEARCH_LOCATIONS"),e.dataset={},e.tagAllowed&&(e.dataset.tags=t.queryAll()),e.locationAllowed&&i.queryAll(function(t){e.dataset.locations=new LocationTree(_.pluck(t,"displayName")).tree.children}),e.whenSelectedItemChange()},e.addItem=function(t){var i="";if(i=t.fullTagName?e.addTag(t):e.addLocation(t),e.selectedTags=e.selectedTags||[],!(e.selectedTags.indexOf(i)>-1)){var n=s(i).$promise;n.then(function(t){e.selectedTags.indexOf(i)>-1||(e.selectedTags.push(i),e.tagThings.push({fullTagName:i,things:t}),e.whenSelectedItemChange())})}},e.addTag=function(t){return e.selectedTags=e.selectedTags||[],t.fullTagName},e.addLocation=function(e){var t="Location-"+e.id;return t},e.selectLeftItem=function(t){e.selectedLeftItem=t},e.selectRightItem=function(t){e.selectedRightItem=t},e.removeItem=function(t){e.selectedTags.remove(t.id),e.tagThings=_.reject(e.tagThings,function(e){return e.fullTagName==t.id}),e.whenSelectedItemChange()},e.whenSelectedItemChange=function(){e.selectedItems=[],_.each(e.selectedTags,function(t){e.selectedItems.push({name:t,id:t})}),e.tagTypes=[],_.each(e.tagThings,function(t){e.tagTypes=e.tagTypes.concat(_.pluck(t.things,"type"))}),e.tagTypes=_.uniq(e.tagTypes)},e.selectedThings=[]}]}}]),angular.module("BeehivePortal").directive("switchery",["$timeout",function(){return{restrict:"A",scope:{on:"=?switchery",disabled:"=?"},templateUrl:"app/shared/directives/switchery/switchery.template.html",replace:!0,link:function(e,t,i){e.on=e.on?!0:!1,e.yesText=i.yesText||"",e.noText=i.noText||"",e.switch=function(){e.disabled||(e.on=!e.on)}}}}]),angular.module("BeehivePortal").directive("rangeSlider",[function(){return{restrict:"E",replace:!0,templateUrl:"app/shared/directives/range-slider/range-slider.template.html",scope:{min:"=?",max:"=?",ngModel:"=?"},link:function(e){e.$watch("ngModel",function(t,i){t=parseFloat(t),(e.min||0==e.min)&&t<e.min&&(t=i),(e.max||0==e.max)&&t>e.max&&(t=i),e.ngModel=t})}}}]),angular.module("BeehivePortal").directive("pagion",["$compile","$location",function(e,t){return{restrict:"E",replace:!0,scope:{collection:"=?",display:"=?",index:"=?",onChanged:"=?"},templateUrl:"app/shared/directives/pagion/pagion.template.html",link:function(e){function i(){e.display=_.filter(e.collection,function(t,i){return i>=(e.index-1)*e.listMaxLength&&i<e.index*e.listMaxLength})}e.listMaxLength=window.pageListMaxLength,e.index=e.index||1,e.pageChanged=function(){i(),t.search({pageIndex:e.index}),_.isFunction(e.onChanged)&&e.onChanged(index,e.display)},e.$watch("collection",function(){i()},!0)}}}]),angular.module("BeehivePortal").directive("multiSelector",["$compile",function(){return{restrict:"E",replace:!0,scope:{ngModel:"=?",options:"=?",onChange:"=?",single:"=?",disabled:"=?"},templateUrl:"app/shared/directives/multi-selector/multi-selector.template.html",controller:["$scope",function(e){if(e.dataset={settings:{externalIdProp:"",showCheckAll:!1,showUncheckAll:!1,scrollable:!1,smartButtonMaxItems:3,smartButtonTextConverter:function(e){return e}},events:{}},e.tmp={},e.onChange){var t={onItemSelect:function(t){e.single&&angular.equals(e.tmp,t)?(e.ngModel={},e.onChange(t,!1),e.tmp={}):(e.tmp=t,e.onChange(t,!0))},onItemDeselect:function(){}};_.extend(e.dataset.events,t)}e.single&&(e.dataset.settings.selectionLimit=1)}]}}]),angular.module("BeehivePortal").directive("locationSelector",["$compile",function(){return{restrict:"E",replace:!0,scope:{selectedLocation:"=?"},templateUrl:"app/shared/directives/location-selector/location-selector.template.html",controller:["$scope","$$Location",function(e,t){t.queryAll(function(t){var i=_.pluck(t,"displayName");e.locations=new LocationTree(i).tree.children}),e.selectLocation=function(t,i){e.selectedLocation=i?t.id:null},e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}}}]}}]),angular.module("BeehivePortal").directive("itemSelector",["$compile",function(){return{restrict:"E",replace:!0,scope:{items:"=?",selectedItems:"=?",settings:"=?",disabled:"=?"},templateUrl:"app/shared/directives/item-selector/item-selector.template.html",controller:["$scope",function(e){e.items=e.items||[],e.selectedItems=e.selectedItems||[];var t={name:"name",id:"name",unselectedTitle:"Unselected",selectedTitle:"Selected"};e.settings=e.settings||{},e.settings=_.extend(t,e.settings),e.$watch("items",function(){e.whenItemChange()},!0),e.treeOptions={multiSelection:!1,nodeChildren:"children",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.init=function(){e.whenItemChange()},e.selectLeftItem=function(t){e.selectedLeftItem=t},e.selectRightItem=function(t){e.selectedRightItem=t},e.whenItemChange=function(){e.unselectedItems=_.filter(e.items,e.unselectedFilter)},e.unselectedFilter=function(i){return!_.find(e.selectedItems,function(e){return e[t.id]==i[t.id]})},e.addItem=function(t){t&&(e.selectedLeftItem=null,e.selectedItems.push(t),e.whenItemChange())},e.removeItem=function(t){t&&(e.selectedRightItem=null,e.selectedItems.remove(t),e.whenItemChange())}}]}}]),angular.module("BeehivePortal").directive("appSlider",["$timeout",function(){return{restrict:"E",templateUrl:"app/shared/directives/app-slider/app-slider.template.html",replace:!0,scope:{min:"=?",max:"=?",isInt:"=?",ngModel:"=?",disabled:"=?"},link:function(e){e.ngModel=e.ngModel||e.min,e.rangeSlider={value:e.ngModel,options:{floor:e.min,ceil:e.max,step:e.isInt?1:.01}}}}}]),angular.module("BeehivePortal").directive("appSelect",["$timeout",function(e){return{restrict:"A",templateUrl:"app/shared/directives/app-select/app-select.template.html",replace:!0,scope:{options:"=",selectedModel:"=",extraSetting:"=?",change:"=?",disabled:"=?"},link:function(t,i,n){function r(){var e=!1;e=n.valueOnly?_.find(t.options,function(e){return e.value==t.selectedModel}):_.find(t.options,function(e){return angular.equals(e,t.selectedModel)}),t.selectOption(e?e:t.options[0])}t.setting={text:"text"},t.myClass=n.class,t.setting=_.extend(t.setting,t.extraSetting),t.selectedOption={},t.$watch("selectedModel",function(e,t){angular.equals(e,t)||r()}),t.setting.text=n.text||t.setting.text,t.selectOption=function(i){t.selectedModel=n.valueOnly?i.value:_.clone(i),t.selectedOption=i,_.isFunction(t.change)&&e(function(){t.change(t.selectedModel)})},t.options&&t.options[0]&&r()}}}]),angular.module("BeehivePortal").factory("UserLoginService",["$http","$q","Session",function(e){var t={};return t.login=function(t){return e({method:"POST",url:MyAPIs.LOGIN,data:t,transformRequest:{}})},t}]),angular.module("BeehivePortal").controller("UserLoginController",["$scope","$rootScope","$state","AppUtils","UserLoginService","Session","$$User","$uibModal","PermissionControl",function(e,t,i,n,r,s,o,a,l){e.credentials={userID:"",password:""},e.login=function(e){if("admin"==e.userID&&"admin"==e.password){var e={accessToken:"super_token",company:"12312",createBy:null,kiiLoginName:"33032719891111",kiiUserID:"f83120e36100-2cc9-5e11-19d9-0df7b818",mail:"ff",modifyBy:null,phone:"ffa",role:"4",userID:"Admin",userName:"Admin"};s.setCredential(e),l.getAllPermissions(),i.go("app.portal.Welcome")}else o.login(e,function(e){s.setCredential(e),l.loadPermissions(e.permissions),i.go("app.portal.Welcome")},function(){n.alert("登陆失败")})},e.register=function(){a.open({animation:!0,template:angular.element("#registerModal")[0].outerHTML,controller:"UserLoginController.Register",size:"sm"})}}]),angular.module("BeehivePortal").controller("UserLoginController.Register",["$scope","$uibModalInstance","$$User","AppUtils",function(e,t,i,n){e.credentials={userID:"",password:""},e.register=function(e){i.register({},e,function(){n.alert("注册成功！请使用用户名登陆！"),t.close()},function(e,t){n.alert(t)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").factory("AdminLoginService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("AdminLoginController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").controller("WelcomeController",["$scope","$rootScope","$state","AppUtils","Session",function(){}]),angular.module("BeehivePortal").controller("UserManagerController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("TriggerService",["$rootScope","$$Type","$q","$$Thing",function(e,t,i,n){var r={};return r.triggerWhenConditions=[{text:"条件为真",value:Trigger.WhenEnum.CONDITION_TRUE},{text:"条件由假转真",value:Trigger.WhenEnum.CONDITION_FALSE_TO_TRUE},{text:"条件改变",value:Trigger.WhenEnum.CONDITION_CHANGED}],r._ScheduleTriggerFields=["predicate","triggerName","targets","type"],r._SimpleTriggerFields=["source","predicate","triggerName","targets","type"],r._GroupTriggerFields=["source","predicate","triggerName","targets","type"],r._SummaryTriggerFields=["source","predicate","triggerName","targets","type"],r.getDataForRequest=function(e,t){var i=_.clone(e),n=null;switch(t){case"Schedule":n=r._ScheduleTriggerFields;break;case"Simple":n=r._SimpleTriggerFields;break;case"Group":n=r._GroupTriggerFields;break;case"Summary":n=r._SummaryTriggerFields}return _.each(i,function(e,t){-1==n.indexOf(t)&&delete i[t]}),i},r.getSourceTypes=function(e){return new Promise(function(r){if(e.thingList&&e.thingList.length>0){var s=e.thingTypes;if(!s){var o=[];return _.each(e.thingList,function(e){var t=n.get({globalThingID:e}).$promise;o.push(t)}),void i.all(o).then(function(e){s=_.uniq(_.pluck(e,"type")),r(s)})}return void r(s)}return e.tagList?e.selectedType&&e.selectedType.id?void r([e.selectedType.id]):e.type?void r([e.type]):void t.byTags({tags:e.tagList},function(e){r(e)}):void r([])})},r.getTypeSchemas=function(e){var t=[];return _.each(e,function(e){t.push(r.getSchemaByType(e).$promise)}),i.all(t)},r.getSchemaProperties=function(e){var t=[];return _.each(e.statesSchema.properties,function(e,i){t.push(_.extend({name:i},e))}),t},r.getSchemaActions=function(e){return e.actions},r.initSchema=function(){},r.getSchemaByType=function(e){var i,n,s={};return s.$promise=new Promise(function(e,t){i=e,n=t}),t.getSchema({type:e},function(e){_.extend(s,e),r.initSchema(s),i(s)},n),s},r.xSchemas=function(e){if(1==e.length)return e[0];var t=e[0];return _.each(e,function(){}),t},r.initTargetSchema=function(e,t){_.each(e.command.actions,function(e){_.each(e,function(e,i){t.actions[i]&&(t.actions[i]._checked=!0,_.each(e,function(e,n){t.actions[i].in.properties[n].value=e,t.actions[i].in.properties[n]._checked=!0}))})})},r.xSchema=function(e,t){var i={statesSchema:{},actions:[]},n=e.statesSchema.properties,r=t.statesSchema.properties,s={},o=e.actions,a=t.actions,l={};return _.each(n,function(e,t){var i=r[t];i&&i.type==e.type&&(s[t]=i)}),_.each(o,function(e,t){if(a[t]){var i=a[t],n=!0;_.each(e.in.properties,function(e,t){i.in.properties[t]&&!i.in.properties[t].type!=e.type||(n=!1)}),n&&(l[t]=e)}}),i.statesSchema.properties=s,i.actions=l,i},r}]),angular.module("BeehivePortal").controller("TriggerManagerController",["$scope","$rootScope","$state","AppUtils","$$Thing","$$Type","$$Tag","$q","$timeout","$uibModal","$$Location","$$Trigger",function(e,t,i,n,r,s,o,a,l,u,c,p){e.triggers=[],e.init=function(){return e.PermissionControl.isAllowed("GET_TRIGGERS")?void p.getAll(function(t){console.log(t),_.each(t,function(t){var i=new Trigger(t.type);i.init(t),e.triggers.push(i)})}):void i.go("app.portal.Welcome")},e.createTrigger=function(){var t=u.open({animation:!0,templateUrl:"app/components/portal/TriggerManager/CreateTrigger.template.html",controller:"TriggerManagerController.CreateTrigger",size:"md",resolve:{}});t.result.then(function(t){e.triggers.splice(0,0,t)})},e.deleteTrigger=function(t){t.triggerID?p.remove({},t,function(){e.triggers.remove(t)}):e.triggers.remove(t)},e.enableTrigger=function(e){p.enable({},e,function(){e.enable()})},e.disableTrigger=function(e){p.disable({},e,function(){e.disable()})},e.$on("deleteTrigger",function(t,i){n.confirm("提示信息","您确定要删除这个触发器吗？",function(){e.deleteTrigger(i)})}),e.$on("enableTrigger",function(t,i){n.confirm("提示信息","您确定要启用这个触发器吗？",function(){e.enableTrigger(i)})}),e.$on("disableTrigger",function(t,i){n.confirm("提示信息","您确定要禁用这个触发器吗？",function(){e.disableTrigger(i)})}),e.dataset={}}]).controller("TriggerManagerController.CreateTrigger",["$scope","$uibModalInstance",function(e,t){e.triggerTypes=[{text:"定时任务",value:Trigger.TypeEnum.SIMPLE},{text:"多触发源",value:Trigger.TypeEnum.GROUP},{text:"汇总",value:Trigger.TypeEnum.SUMMARY}],e.triggerBO={},e.ok=function(e){var i=new Trigger(e.triggerType);i.setName(e.triggerName),t.close(i)},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").controller("ThingViewsController",["$scope","$rootScope","$state","AppUtils","$uibModal",function(e,t,i,n,r){e.openRemoteControl=function(e){var t=r.open({animation:!0,templateUrl:"app/components/portal/ThingViews/RemoteControl.template.html",controller:"ThingViewsController.RemoteControl",size:"md",resolve:{thing:function(){return e}}});t.result.then(function(){console.log(e)},function(){console.log("Modal dismissed at: "+new Date)})},e.myMenu={itemList:[{text:"查看详情",callback:function(t){e.navigateTo(e.navMapping.THING_DETAIL,{thingid:t.globalThingID})}},{text:"编辑",callback:function(e){var t=r.open({animation:!0,templateUrl:"app/components/portal/ThingViews/EditThing.template.html",controller:"ThingViewsController.EditThing",size:"md",resolve:{thing:function(){return e}}});t.result.then(function(t){_.extend(e,t)},function(){console.log("Modal dismissed at: "+new Date)})}},{text:"删除",callback:function(e){console.log("Delete thing"),console.log(e)}}],setting:{}}}]).controller("ThingViewsController.RemoteControl",["$scope","$uibModalInstance","thing","$timeout","TriggerService","$$Thing",function(e,t,i,n,r,s){function o(){var t=e.sourceSchema,i=[];return _.each(t.actions,function(e,t){var n={},r=!1;n[t]={},e._checked&&_.each(e.in.properties,function(e,i){e._checked&&(n[t][i]=e.value,r=!0)}),r&&i.push(n)}),e.command.command.actions=i,s.sendCommand([e.command])}e.init=function(){e.command=new BeehiveCommand,_.extend(e.command,{thingList:[i.globalThingID]}),e.thing=i,e.sourceSchema=r.getSchemaByType(e.thing.type)},e.ok=function(){o().$promise.then(function(){t.close(e.thing)})},e.cancel=function(){t.dismiss("cancel")}}]).controller("ThingViewsController.EditThing",["$scope","$uibModalInstance","thing","$$Thing","$$Tag",function(e,t,i,n,r){e.thing=i,_.each(e.thing.tags,function(t,i){var n=t.split("-");n.splice(0,1),e.thing.tags[i]=n.join("-")});var s=_.clone(e.thing.tags);e.ok=function(){e.saveTags()},e.cancel=function(){t.dismiss("cancel")},r.queryAll(function(t){e.queriedTags=_.where(t,{tagType:"Custom"}),console.log(t)},function(e){console.log(e)}),e.removeTag=function(t){e.thing.tags=_.reject(e.thing.tags,function(e){return e==t})},e.saveTags=function(){var r=_.pluck(_.where(e.queriedTags,{_checked:!0}),"tagName"),o=i.tags,a=r.concat(o);n.bindTags({things:e.thing.globalThingID,tags:a.join(",")},function(){var i=_.difference(s,a);_.each(i,function(t){n.removeTag({globalThingID:e.thing.globalThingID,tagName:t})}),t.close(e.thing)})}}]),angular.module("BeehivePortal").controller("ThingManagerController",["$scope","$rootScope","$state","AppUtils","$uibModal",function(){}]),angular.module("BeehivePortal").controller("SettingsController",["$scope","$rootScope","$state","AppUtils","$$User","$http",function(e,t,i,n,r,s){e.password={oldPassword:"",newPassword:"",confirmPassword:""},e.changePassword=function(e){var t={method:"POST",url:MyAPIs.OPERATOR+"/changepassword",data:e,headers:{accessToken:"Bearer "+MyApp.credential.accessToken}};return e.newPassword!=e.confirmPassword?void n.alert("新密码与输入的确认密码不一致，请重新输入！"):void s(t).then(function(){n.alert("更改密码成功！")},function(){n.alert("更改密码失败！")})}}]),function(){function e(){_.extend(this,{thingList:null,tagList:null,command:{schema:"test",actions:[],schemaVersion:0,metadata:{}}})
}function t(){this.name="",this.expressList=[],this.source={}}var i=function(e){var t={triggerName:"",type:e,predicate:{eventSource:"states",triggersWhen:i.WhenEnum.CONDITION_TRUE,condition:{}},source:{},targets:[],summarySource:{},recordStatus:"disable"};_.extend(this,t),e==i.TypeEnum.SUMMARY?delete this.source:delete this.summarySource};i.PolicyTypeEnum={ANY:"Any",ALL:"All",SOME:"Some",PERCENT:"Percent"},i.prototype.init=function(e){_.extend(this,e),this.triggerName||this.setName("未命名")},i.prototype.setSource=function(e,t){this.source=this.type==i.TypeEnum.SIMPLE?{thingID:e}:"thing"==t?{thingList:e.thingList}:{tagList:e.tagList,type:e.type,andExpress:e.andExpress}},i.prototype.disable=function(){this.recordStatus="disable"},i.prototype.enable=function(){this.recordStatus="enable"},i.prototype.setSchedule=function(e){this.predicate.schedule=e},i.prototype.setName=function(e){this.triggerName=e},i.prototype.setTriggersWhen=function(e){this.predicate.triggersWhen=e},i.prototype.setTriggerType=function(e){this.type=e},i.prototype.setTargets=function(e){this.targets=e},i.prototype.addTarget=function(e){this.targets.push(e)},i.prototype.removeTarget=function(e){this.targets.remove(e)},i.prototype.setCondition=function(e){this.predicate.condition=e},i.WhenEnum={CONDITION_TRUE:"CONDITION_TRUE",CONDITION_FALSE_TO_TRUE:"CONDITION_FALSE_TO_TRUE",CONDITION_CHANGED:"CONDITION_CHANGED"},i.TypeEnum={SIMPLE:"Simple",GROUP:"Group",SUMMARY:"Summary"},i.prototype.addSummarySource=function(e){this.summarySource[e.name]=e},e.prototype.addAction=function(e){this.command.actions.push(e)},e.prototype.setSchemaVersion=function(e){this.command.schemaVersion=e},e.prototype.setMetaData=function(e){this.command.metadata=e},e.prototype.setSource=function(e,t,i){_.each(this,function(e,t){delete this[t]}),"thing"==t?this.thingList=e.thingList:(this.tagList=e.tagList,this.andExpress=i,this.type=e.type)},t.prototype.setSource=function(e){this.source=e},t.prototype.setName=function(e){this.name=e},t.prototype.addExpression=function(e,t,i){this.expressList.pus({stateName:e,"function":t,summaryAlias:i})},t.FunctionEnum={SUM:"Sum",COUNT:"Count",MAX:"Max",MIN:"Min",AVG:"Avg"},window.TriggerTarget=e,window.TriggerSummarySource=t,window.Trigger=i}(),function(){function e(e){var t=this;t.separator="-",t.locations=[],t.tree=new i("",""),_.each(e,function(e){t.merge(e)}),this.isHeader=!0}function t(e,n){!e instanceof i||!n instanceof i||e.name!=n.name||_.each(n.children,function(i){var n=_.find(e.children,function(e){return e.name==i.name});void 0==n?e.children.push(i):t(n,i)})}var i=function(e,t){this.id=t,this.name=e,this.container=[],this.children=[]};window.LocationTree=e,e.prototype.parse=function(e){var t=e.split(this.separator),n=new i("",""),r=n,s=[],o=this;return _.each(t,function(e){s.push(e);var t=new i(e,s.join(o.separator));t.container=r.children,r.children.push(t),r=t}),n},e.prototype.merge=function(e){var i=this.parse(e);t(this.tree,i),this.locations.push(e)}}(),function(){function e(){this.vendorThingID=null,this.location=null,this.type=null,this.globalThingID=null,this.kiiAppID="192b49ce"}window.BeehiveThing=e}(),function(){function e(){_.extend(this,{command:{actions:{},title:"Test title",description:"Test description",schema:"SmartLight",schemaVersion:1}})}window.BeehiveCommand=e}(),angular.module("BeehivePortal").filter("checked",function(){return function(e){if(_.isArray(e))return _.where(e,{_checked:!0});var t={};return _.each(e,function(e,i){e._checked&&(t[i]=e)}),t}}),angular.module("BeehivePortal").factory("SecureService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("SecureController",["$scope","$rootScope","$state","AppUtils",function(){}]),angular.module("BeehivePortal").factory("PortalService",["$http","$q","Session","$state","PermissionControl",function(e,t,i,n,r){var s={};return s.getStateChan=function(e){var t=[];t.push(e);for(var i=e;i.previous;)i=n.get(i.previous),t.push(i);return t.reverse(),t},s.isActive=function(e){var t=s.getStateChan(n.current),i=n.get(e);return t.indexOf(i)>-1},s.getPortalNavs=function(){return[{name:"用户管理",state:n.get("app.portal.UserManager"),icon:"fa-user",subViews:[{name:"用户列表",state:n.get("app.portal.UserManager.User.UserList"),hidden:!r.isAllowed("GET_USER")},{name:"群组列表",state:n.get("app.portal.UserManager.UserGroup.UserGroupList")}]},{name:"设备管理",state:n.get("app.portal.ThingManager"),hidden:!r.isAllowed("SEARCH_LOCATIONS")&&!r.isAllowed("SEARCH_TAGS")&&!r.isAllowed("SEARCH_TYPE"),icon:"fa-desktop",subViews:[{name:"新设备",state:n.get("app.portal.ThingManager.AddThing"),hidden:!r.isAllowed("CREATE_THING")||!r.isAllowed("SEARCH_LOCATIONS")},{name:"网关管理",state:n.get("app.portal.ThingManager.Gateway"),hidden:!r.isAllowed("SEARCH_THINGS")||!r.isAllowed("SEARCH_LOCATIONS")},{name:"控制设备",state:n.get("app.portal.ThingManager.ControlThing"),hidden:!r.isAllowed("SEARCH_THINGS")||!r.isAllowed("SEARCH_LOCATIONS")&&!r.isAllowed("SEARCH_TAGS")}]},{name:"设备视图",state:n.get("app.portal.ThingViews"),hidden:!r.isAllowed("SEARCH_LOCATIONS")&&!r.isAllowed("SEARCH_TAGS")&&!r.isAllowed("SEARCH_TYPE"),icon:"fa-table",subViews:[{name:"位置视图",state:n.get("app.portal.ThingViews.LocationView"),hidden:!r.isAllowed("SEARCH_LOCATIONS")},{name:"标签视图",state:n.get("app.portal.ThingViews.TagView"),hidden:!r.isAllowed("SEARCH_TAGS")},{name:"种类视图",state:n.get("app.portal.ThingViews.TypeView"),hidden:!r.isAllowed("SEARCH_TYPES")}]},{name:"触发器管理",state:n.get("app.portal.TriggerManager"),icon:"fa-exchange",hidden:!r.isAllowed("GET_TRIGGERS")},{name:"设置",state:n.get("app.portal.Settings"),icon:"fa-cogs"}]},s.navMapping={USRE_MANAGEMENT:"app.portal.UserManager",THING_MANAGEMENT:"app.portal.ThingManager",THING_VIEWS:"app.portal.ThingViews",USER_LIST:"app.portal.UserManager.User.UserList",USER_GROUP:"app.portal.UserManager.UserGroup.UserGroupList",USER_GROUP_EDITOR:"app.portal.UserManager.UserGroup.UserGroupEdit",NEW_USER:"app.portal.UserManager.User.NewUser",USER_INFO:"app.portal.UserManager.User.UserInfo",LOCATION_THING_DETAIL:"app.portal.ThingViews.LocationThingDetail",TYPE_THING_DETAIL:"app.portal.ThingViews.TypeThingDetail",TAG_THING_DETAIL:"app.portal.ThingViews.TagThingDetail",LOCATION_THING_LIST:"app.portal.ThingViews.LocationThingList",TYPE_THING_LIST:"app.portal.ThingViews.TypeThingList",TAG_THING_LIST:"app.portal.ThingViews.TagThingList",USER_THING_AUTH:"app.portal.UserManager.User.UserThingAuthority",USER_THING_ACL:"app.portal.UserManager.User.UserThingACL",GROUP_USER_LIST:"app.portal.UserManager.UserGroup.GroupUserList",GROUP_USER_INFO:"app.portal.UserManager.UserGroup.UserInfo",GROUP_USER_THING_AUTH:"app.portal.UserManager.UserGroup.GroupUserThingAuthority",GROUP_USER_THING_ACL:"app.portal.UserManager.UserGroup.GroupUserThingACL",GROUP_THING_AUTH:"app.portal.UserManager.UserGroup.GroupThingAuthority",GROUP_THING_ACL:"app.portal.UserManager.UserGroup.GroupThingALC",LOCATION_VIEW:"app.portal.ThingViews.LocationView",LOCATHON_THING_ACL:"app.portal.ThingViews.LocationThingACL",TAG_THING_ACL:"app.portal.ThingViews.TagThingACL",TYPE_THING_ACL:"app.portal.ThingViews.TypeThingACL",TAG_VIEW:"app.portal.ThingViews.TagView",TYPE_VIEW:"app.portal.ThingViews.TypeView",SETTINGS:"app.portal.Settings",WELCOME:"app.portal.Welcome",TRIGGER_MANAGEMENT:"app.portal.TriggerManager"},s}]).factory("PermissionControl",["AppUtils","$state",function(e,t){var i={};return i._init=function(){i.allowedPermissions=e.getSessionItem(AppTags.PERMISSION)||[]},i.TagsEnum={GET_USER:"GET /users/*",SEARCH_USERS:"POST /users/simplequery",CREATE_USER:"POST /users",DELETE_USER:"DELETE /users/*",UPDATE_USER:"PATCH /users/*",UPDATE_THIRD_PARTY_USER:"PATCH /users/*/custom",GET_ALL_GROUPS:"GET /usergroup/list",GET_GROUP:"GET /usergroup/*",SERACH_GROUPS:"POST /usergroup/simplequery*",CREATE_USER_GROUP:"POST /usergroup",DELETE_USERGROUP:"DELETE /usergroup/*",ADD_GROUP_MEMBER:"POST /usergroup/*/user/*",REMOVE_GROUP_MEMBER:"DELETE /usergroup/*/user/*",BIND_USERGROUP_TAG:"POST /tags/*/userGroups/*",DELETE_USERGROUP_TAG:"DELETE /tags/*/userGroups/*",GET_USERGROUP_TAG:"GET /usergroup/*/tags",SEARCH_TAGS:"GET /tags/search*",SEARCH_LOCATIONS:"GET /tags/locations/*",GET_ALL_LOCATIONS:"GET /tags/locations",SEARCH_TYPES:"GET /things/types/*",GET_ALL_TYPES:"GET /things/types",DELETE_TAG:"DELETE /tags/custom/*",CREATE_TAG:"POST /tags/custom",BING_TAG:"POST /things/*/tags/*",BIND_THING_TAG_CUSTOM:"POST /things/*/tags/custom/*",UNBIND_TAG:"DELETE /things/*/tags/*",UNBIND_TAG_CUSTOM:"DELETE /things/*/tags/custom/*",GET_GROUP_PERMISSIONS:"GET /permission/userGroup/*",GET_ALL_PERMISSIONS:"GET /permission/list",BIND_PERMISSION:"POST /permission/*/userGroup/*",UNBIND_PERMISSION:"DELETE /permission/*/userGroup/*",CREATE_TRIGGER:"POST /triggers/createTrigger",SEARCH_THINGS:"GET /things/search*",GET_THING:"GET /things/*",CREATE_THING:"POST /things",DELETE_THING:"DELETE /things/*",SEARCH_THING_TYPES:"GET /things/types/",GET_TYPE_BY_TAG:"GET /things/types/tagID/*",DELETE_TRIGGER:"DELETE /triggers/*",ENABLE_TRIGGER:"PUT /triggers/*/enable",DISABLE_TRIGGER:"PUT /triggers/*/disable",GET_TRIGGERS:"GET /triggers/*"},i.allowedPermissions=[],i.loadPermissions=function(t){i.allowedPermissions=[],_.each(t,function(e){_.each(i.TagsEnum,function(t,n){t==e&&i.allowedPermissions.push(n)})}),e.setSessionItem(AppTags.PERMISSION,i.allowedPermissions)},i.getAllPermissions=function(){i.allowedPermissions=[],_.each(i.TagsEnum,function(e){i.allowedPermissions.push(e)}),i.loadPermissions(i.allowedPermissions)},i.isAllowed=function(e){return i.allowedPermissions.indexOf(e)>-1?!0:!1},i.allowAction=function(n,r){return i.isAllowed(n)?!0:(_.isFunction(r)&&r(),e.alert("对不起，您没有该资源的访问权限，请联系管理员或尝试重新登录！","没有访问权限",function(){t.go("app.portal.Welcome")}),!1)},i.destroy=function(){i.allowedPermissions=[],e.removeSessionItem(AppTags.PERMISSION)},i._init(),i}]),angular.module("BeehivePortal").factory("$$User",["$resource",function(e){var t=e(MyAPIs.USER+"/:id",{id:"@userID"},{update:{method:"PATCH"},remove:{method:"DELETE"},create:{url:MyAPIs.USER,method:"POST"},query:{url:MyAPIs.USER+"/simplequery",method:"POST",isArray:!0},register:{url:MyAPIs.OPERATOR+"/register",method:"POST"},login:{url:MyAPIs.OPERATOR+"/login",method:"POST"},changePassword:{url:MyAPIs.OPERATOR+"/changepassword",method:"POST"},logout:{url:MyAPIs.OPERATOR+"logout",method:"POST"}});return t}]).factory("$$UserGroup",["$resource",function(e){var t=e(MyAPIs.USER_GROUP+"/:id",{id:"@userGroupID"},{addUser:{method:"POST",url:MyAPIs.USER_GROUP+"/:userGroupID/user/:userID",params:{userGroupID:"@userGroupID",userID:"@userID"}},deleteUser:{method:"DELETE",url:MyAPIs.USER_GROUP+"/:userGroupID/user/:userID",params:{userGroupID:"@userGroupID",userID:"@userID"}},update:{method:"PATCH"},remove:{method:"DELETE"},get:{url:MyAPIs.USER_GROUP+"/:userGroupID",method:"GET",params:{userGroupID:"@userGroupID"}},getList:{url:MyAPIs.USER_GROUP+"/all",method:"GET",isArray:!0},getMyGroups:{url:MyAPIs.USER_GROUP+"/list",method:"GET",isArray:!0},withUserData:{url:MyAPIs.USER_GROUP+"/simplequery",method:"POST",transformRequest:function(e){return e.includeUserData=1,e}},create:{url:MyAPIs.USER_GROUP,method:"POST"},query:{url:MyAPIs.USER_GROUP+"/simplequery",method:"POST",isArray:!0},getPermissions:{url:MyAPIs.USER_GROUP+"",method:"GET"}});return t}]).factory("$$Thing",["$resource",function(e){var t=e(MyAPIs.THING+"/:globalThingID",{},{save:{url:MyAPIs.THING,params:{globalThingID:"@globalThingID"},method:"POST"},getAll:{url:MyAPIs.THING+"/search",method:"GET",isArray:!0},remove:{method:"DELETE"},bindTags:{url:MyAPIs.THING+"/:thingids/tags/custom/:tags",params:{thingids:"@things",tags:"@tags"},method:"POST"},removeTags:{url:MyAPIs.THING+"/:things/tags/custom/:tags",params:{things:"@things",tags:"@tags"},method:"DELETE"},byTag:{url:MyAPIs.THING+"/search?tagType=:tagType&displayName=:displayName",params:{tagType:"@tagType",displayName:"@displayName"},method:"GET",isArray:!0},byType:{url:MyAPIs.THING+"/types/:typeName",params:{typeName:"@typeName"},method:"GET",isArray:!0},sendCommand:{url:MyAPIs.THING_IF+"/command/",method:"POST",isArray:!0},getTypeByTag:{method:"GET",url:MyAPIs.THING+"/types/fulltagname/:fullTagNames",isArray:!0,params:{fullTagNames:"@fullTagNames"}},getTriggers:{method:"GET",url:MyAPIs.TRIGGER+"/triggerList/:globalThingID",isArray:!0,params:{globalThingID:"@globalThingID"}},getOnboardingInfo:{method:"GET",url:MyAPIs.ONBOARDING+"/:globalThingID",params:{globalThingID:"@globalThingID"}},getEndNodes:{url:"http://api-development-beehivecn3.internal.kii.com/thing-if/apps/:kiiAppID/things/:kiiThingID/end-nodes",params:{kiiThingID:"@kiiThingID",kiiAppID:"@kiiAppID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"},method:"GET"},getEndNode:{url:"http://api-development-beehivecn3.internal.kii.com/thing-if/apps/:kiiAppID/targets/THING::thingID/states",params:{thingID:"@thingID",kiiAppID:"@kiiAppID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"},method:"GET"},replaceEndNode:{url:"http://api-development-beehivecn3.internal.kii.com/thing-if/apps/:kiiAppID/things/:kiiThingID/end-nodes/:thingID",params:{thingID:"@thingID",kiiAppID:"@kiiAppID",kiiThingID:"@kiiThingID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"},transformRequest:function(e){return e=_.clone(e),_.each(e,function(t,i){"endNodeVendorThingID"!=i&&"endNodePassword"!=i&&delete e[i]}),JSON.stringify(e)},method:"PATCH"},removeEndNode:{method:"DELETE",url:"http://api-development-beehivecn3.internal.kii.com/thing-if/apps/:kiiAppID/things/:kiiThingID/end-nodes/:thingID",params:{thingID:"@thingID",kiiAppID:"@kiiAppID",kiiThingID:"@kiiThingID"},headers:{Authorization:"Bearer c63Z840BhnyLgyL6TAoKeq0iGdUM6L1vZemenWrWjxc"}}});return t}]).factory("$$Tag",["$resource",function(e){var t=e(MyAPIs.TAG+"/:id",{id:"@tagName"},{query:{method:"GET"},queryAll:{url:MyAPIs.TAG+"/search?tagType=Custom",method:"GET",isArray:!0},create:{url:MyAPIs.TAG+"/custom",method:"POST"},update:{url:MyAPIs.TAG+"/custom",method:"POST"},remove:{url:MyAPIs.TAG+"/custom/:id",params:{id:"@tagName"},method:"DELETE"}});return t}]).factory("$$Location",["$resource",function(e){var t=e(MyAPIs.TAG+"/:id",{id:"@tagName"},{queryAll:{method:"GET",isArray:!0,url:MyAPIs.TAG+"/search?tagType=Location"}});return t}]).factory("$$Type",["$resource",function(e){var t=e(MyAPIs.TYPE,{},{getAll:{method:"GET",isArray:!0},getSchema:{url:MyAPIs.SCHEMA+"?thingType=:type&name=:type&version=1",params:{type:"@type"},method:"GET"},saveSchema:{url:MyAPIs.SCHEMA,method:"POST"},byTags:{url:MyAPIs.TYPE+"/fulltagname/:tags",params:{tags:"@tags"},method:"GET",isArray:!0}});return t}]).factory("$$Permission",["$resource",function(e){var t=e(MyAPIs.PERMISSION,{},{getList:{url:MyAPIs.PERMISSION+"/list",method:"GET",isArray:!0},byGroup:{url:MyAPIs.PERMISSION+"/userGroup/:userGroupID",method:"GET",params:{userGroupID:"@userGroupID"},isArray:!0},bindGroup:{url:MyAPIs.PERMISSION+"/:permissionID/userGroup/:userGroupID",params:{userGroupID:"@userGroupID",permissionID:"@permissionID"},method:"POST"},unbindGroup:{url:MyAPIs.PERMISSION+"/:permissionID/userGroup/:userGroupID",method:"DELETE",params:{userGroupID:"@userGroupID",permissionID:"@permissionID"}}});return t}]).factory("$$Trigger",["$resource",function(e){var t=e(MyAPIs.TRIGGER,{},{getAll:{url:MyAPIs.TRIGGER+"/all",method:"GET",isArray:!0,transformResponse:function(e){return e=JSON.parse(e),e=_.reject(e,function(e){return e.type==t.TypeEnum.SIMPLE&&e.source&&e.source.thingID?!0:!1})}},save:{url:MyAPIs.TRIGGER+"/createTrigger",method:"POST"},remove:{url:MyAPIs.TRIGGER+"/:triggerID",method:"DELETE",params:{triggerID:"@triggerID"}},enable:{url:MyAPIs.TRIGGER+"/:triggerID/enable",method:"PUT",params:{triggerID:"@triggerID"}},disable:{url:MyAPIs.TRIGGER+"/:triggerID/disable",method:"PUT",params:{triggerID:"@triggerID"}}});return t.TypeEnum={SIMPLE:"Simple",GROUP:"Group",SUMMARY:"Summary"},t}]),angular.module("BeehivePortal").controller("PortalController",["$scope","$rootScope","$state","AppUtils","Session","PermissionControl","PortalService",function(e,t,i,n,r,s,o){e.PermissionControl=s,t.PermissionControl=s,e.portalNavs=o.getPortalNavs(),e.getStateChan=o.getStateChan,e.isActive=o.isActive,e.navMapping=o.navMapping,e.navigateTo=function(e,t){i.go(e,_.extend(i.params,t))},e.portalInit=function(){},e.getFirstChild=function(e){return _.find(e.subViews,function(e){return!e.hidden})},e.toggleMenu=function(){$(".left-side").toggleClass("sidebar-offcanvas"),$(".right-side").toggleClass("shrink")},e.logout=function(){r.destroy(),s.destroy(),i.go("app.secure.UserLogin")}}]),angular.module("BeehivePortal").factory("AppUtils",["$http","$location","$q","$state","$timeout","$uibModal",function(e,t,i,n,r,s){return window.app={},app.utils={initialize:function(){this._initialize()},_initialize:function(){this._IEPlaceholder(),String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.lowerFirstLetter=function(){return this.charAt(0).toLowerCase()+this.slice(1)},Array.prototype.removeFirst=function(){return this.slice(1,this.length)},Array.prototype.remove=function(e){var t=this.indexOf(e);return t>-1?this.splice(t,1):this},window.alertMessage=function(e){app.utils.alert(e,"提示")}},_IEPlaceholder:function(){var e=document,t=e.getElementsByTagName("input"),i="placeholder"in e.createElement("input"),n=function(e){var t=e.getAttribute("placeholder"),i=e.defaultValue;""==i&&(e.value=t),$(e).on("focus",function(){e.value===t&&(this.value="")}),$(e).on("blur",function(){""===e.value&&(this.value=t)})};if(!i)for(var r=0,s=t.length;s>r;r++){var o=t[r],a=o.getAttribute("placeholder");"text"!==o.type&&"password"!==o.type||!a||n(o)}},getSessionItem:function(e){return $.parseJSON(sessionStorage.getItem(e))},setSessionItem:function(e,t){sessionStorage.setItem(e,JSON.stringify(t))},clearSession:function(){sessionStorage.clear()},removeSessionItem:function(e){sessionStorage.removeItem(e)},alert:function(e,t,i){t=t||"提示";var n="";n+='<div class="modal-content">',n+='  <div class="modal-header ng-scope">',n+='      <h3 class="modal-title">'+t+"</h3>",n+="  </div>",n+='  <div class="modal-body clearfix">',n+='    <div class="col-sm-12">',n+="      "+e,n+="    </div>",n+="  </div>",n+='  <div class="modal-footer ng-scope">',n+='      <button class="btn btn-primary" style="width:100%;" type="button" ng-click="ok()">OK</button>',n+="  </div>",n+="</div>";var r=s.open({animation:!0,template:n,controller:"AppUtils.Alert",size:"sm"});r.result.then(function(){_.isFunction(i)&&i()},function(){_.isFunction(i)&&i()})},confirm:function(e,t,i){var n="";n+='<div class="modal-content">',n+='  <div class="modal-header ng-scope">',n+='      <h3 class="modal-title">'+e+"</h3>",n+="  </div>",n+='  <div class="modal-body clearfix">',n+='    <div class="col-sm-12">',n+="      "+t,n+="    </div>",n+="  </div>",n+='  <div class="modal-footer ng-scope">',n+='      <button class="btn btn-primary" type="button" ng-click="ok()">OK</button>',n+='      <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>',n+="  </div>",n+="</div>";var r=s.open({animation:!0,template:n,controller:"AppUtils.Confirm",size:"sm",resolve:{func:function(){return i}}});return r.result}},app.utils}]),angular.module("BeehivePortal").controller("AppUtils.Confirm",["$scope","$uibModalInstance","func",function(e,t,i){e.ok=function(){t.close(i())},e.cancel=function(){t.dismiss("cancel")}}]).controller("AppUtils.Alert",["$scope","$uibModalInstance",function(e,t){e.ok=function(){t.dismiss("cancel")}}]),angular.module("BeehivePortal").directive("ngRightClick",["$parse",function(e){return function(t,i,n){var r=e(n.ngRightClick);i.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),r(t,{$event:e})})})}}]).directive("permitted",["PermissionControl",function(e){return{link:function(t,i,n){var r=n.permitted.split("&"),s=!0;_.each(r,function(t){s&=e.allowAction(t)}),s||i.remove()}}}]).directive("input",[function(){return{link:function(e,t,i){e.$watch("ngModel",function(t){("range"==i.type||"number"==i.type)&&(e.ngModel=parseFloat(t))})}}}]),function(){var e="https://114.215.196.178:443",t=e+"/beehive-portal/api";window.MyAPIs={OPERATOR:"/oauth2",USER:"/users",USER_GROUP:"/usergroup",THING:"/things",TAG:"/tags",TYPE:"/things/types",PERMISSION:"/permission",TRIGGER:"/triggers",THING_IF:"/thing-if",ONBOARDING:"/onboardinghelper"};for(apiName in window.MyAPIs)window.MyAPIs[apiName]=t+window.MyAPIs[apiName];window.MyAPIs.SCHEMA=e+"/demohelper/api/industrytemplate";var i="Beehive";window.AppTags={USER:i+"USER",PERMISSION:i+"PERMISSION"},window.pageListMaxLength=20}(),angular.module("BeehivePortal").service("Session",["localStorageService","AppUtils","$http",function(e,t,i){var n={};return window.MyApp=window.MyApp||{},n.setCredential=function(e){t.setSessionItem("credential",e),n.useCredential()},n.useCredential=function(){var e=t.getSessionItem("credential");e&&(window.MyApp.credential=e,i.defaults.headers.common.Authorization="Bearer "+e.accessToken)},n.getCredential=function(){return t.getSessionItem("credential")},window.MyApp.credential=n.getCredential(),n.StatusType={SIGNEDIN:"loggedin",TIMEOUT:"timeout",UNKNOWN:"unknon"},n._status=n.StatusType.UNKNOWN,n.setUser=function(e){t.setSessionItem(AppTags.USER,e),n._status=n.StatusType.SIGNEDIN},n.destroy=function(){t.clearSession(),n._status=n.StatusType.UNKNOWN},n.currentUser=function(){return e.get(AppTags.USER)},n.getStatus=function(){return n._status},n.isAuthen=function(){return n._status==n.StatusType.SIGNEDIN},n}]),angular.module("BeehivePortal").factory("AppService",["$http","$q","Session",function(){var e={};return e}]),angular.module("BeehivePortal").controller("AppController",["$scope","$rootScope","$state","AppUtils","Session",function(e,t,i,n,r){r.useCredential()}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app",templateUrl:"app/app.html",controller:"AppController"}).state("app.portal",{url:"/portal",templateUrl:"app/components/portal/portal.html",controller:"PortalController"}).state("app.secure",{url:"/secure",templateUrl:"app/components/secure/secure.html",controller:"SecureController"}),t.otherwise("app/secure/UserLogin")}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager",{url:"/UserManager",templateUrl:"app/components/portal/UserManager/UserManager.html",controller:"UserManagerController",redirectTo:"app.portal.UserManager.User.UserList","abstract":!0,stateName:"用户管理"}).state("app.portal.ThingManager",{url:"/ThingManager",templateUrl:"app/components/portal/ThingManager/ThingManager.html",controller:"ThingManagerController",redirectTo:"app.portal.ThingManager.AddThing","abstract":!0,stateName:"设备管理"}).state("app.portal.Settings",{url:"/Settings",templateUrl:"app/components/portal/Settings/Settings.html",controller:"SettingsController",stateName:"设置"}).state("app.portal.Welcome",{url:"/Welcome",templateUrl:"app/components/portal/Welcome/Welcome.html",controller:"WelcomeController",stateName:"欢迎"}).state("app.portal.TriggerManager",{url:"/TriggerManager",templateUrl:"app/components/portal/TriggerManager/TriggerManager.html",controller:"TriggerManagerController",stateName:"触发器管理"}).state("app.portal.ThingViews",{url:"/ThingViews",templateUrl:"app/components/portal/ThingViews/ThingViews.html",controller:"ThingViewsController",stateName:"设备视图","abstract":!0,redirectTo:"app.portal.ThingViews.LocationView"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.secure.AdminLogin",{url:"/AdminLogin",templateUrl:"app/components/secure/AdminLogin/AdminLogin.html",controller:"AdminLoginController"}).state("app.secure.UserLogin",{url:"/UserLogin",templateUrl:"app/components/secure/UserLogin/UserLogin.html",controller:"UserLoginController"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.ThingManager.AddThing",{url:"/AddThing",templateUrl:"app/components/portal/ThingManager/AddThing/AddThing.html",controller:"AddThingController",stateName:"添加新设备",previous:"app.portal.ThingManager"}).state("app.portal.ThingManager.Gateway",{url:"/Gateway",templateUrl:"app/components/portal/ThingManager/Gateway/Gateway.html",controller:"GatewayController",stateName:"网关",previous:"app.portal.ThingManager"}).state("app.portal.ThingManager.ControlThing",{url:"/ControlThing",templateUrl:"app/components/portal/ThingManager/ControlThing/ControlThing.html",controller:"ControlThingController",stateName:"控制设备",previous:"app.portal.ThingManager"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.ThingViews.LocationView",{url:"/LocationView",templateUrl:"app/components/portal/ThingViews/LocationView/LocationView.html",controller:"LocationViewController",previous:"app.portal.ThingViews",stateName:"位置视图"}).state("app.portal.ThingViews.TypeView",{url:"/TypeView",templateUrl:"app/components/portal/ThingViews/TypeView/TypeView.html",controller:"TypeViewController",previous:"app.portal.ThingViews",stateName:"种类视图"}).state("app.portal.ThingViews.TagView",{url:"/TagView",templateUrl:"app/components/portal/ThingViews/TagView/TagView.html",controller:"TagViewController",previous:"app.portal.ThingViews",stateName:"标签视图"}).state("app.portal.ThingViews.LocationThingDetail",{url:"/LocationView/ThingDetail/:thingid?from",templateUrl:"app/components/portal/ThingViews/ThingDetail/ThingDetail.html",controller:"ThingDetailController",previous:"app.portal.ThingViews.LocationView",stateName:"设备详情"}).state("app.portal.ThingViews.TypeThingDetail",{url:"/TypeView/ThingList/:typeName/ThingDetail/:thingid?from",templateUrl:"app/components/portal/ThingViews/ThingDetail/ThingDetail.html",controller:"ThingDetailController",previous:"app.portal.ThingViews.TypeThingList",stateName:"设备详情"}).state("app.portal.ThingViews.TypeThingList",{url:"/TypeView/ThingList/:typeName?from",templateUrl:"app/components/portal/ThingViews/ThingList/ThingList.html",controller:"ThingListController",previous:"app.portal.ThingViews.TypeView",stateName:"设备列表"}).state("app.portal.ThingViews.TagThingDetail",{url:"/TagView/TagThingList/:displayName/ThingDetail/:thingid?from",templateUrl:"app/components/portal/ThingViews/ThingDetail/ThingDetail.html",controller:"ThingDetailController",previous:"app.portal.ThingViews.TagThingList",stateName:"设备详情"}).state("app.portal.ThingViews.TagThingList",{url:"/TagView/ThingList/:displayName/?type&from",templateUrl:"app/components/portal/ThingViews/ThingList/ThingList.html",controller:"ThingListController",previous:"app.portal.ThingViews.TagView",stateName:"设备列表"}).state("app.portal.ThingViews.LocationThingACL",{url:"/LocationView/ThingDetail/:thingid/acl?from",templateUrl:"app/components/portal/ThingViews/ThingACL/ThingACL.html",controller:"ThingACLController",previous:"app.portal.ThingViews.LocationThingDetail",stateName:"设备使用权限"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager.User",{url:"/User",templateUrl:"app/components/portal/UserManager/User/User.html",controller:"UserController","abstract":!0}).state("app.portal.UserManager.UserGroup",{url:"/UserGroupS",templateUrl:"app/components/portal/UserManager/UserGroup/UserGroup.html",controller:"UserGroupController","abstract":!0})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager.User.SearchUser",{url:"/SearchUser",templateUrl:"app/components/portal/UserManager/User/SearchUser/SearchUser.html",controller:"SearchUserController",stateName:"查询业主",previous:"app.portal.UserManager.User.UserList"}).state("app.portal.UserManager.User.NewUser",{url:"/NewUser",templateUrl:"app/components/portal/UserManager/User/NewUser/NewUser.html",controller:"NewUserController",stateName:"新建业主",previous:"app.portal.UserManager.User.UserList"}).state("app.portal.UserManager.User.UserList",{url:"/UserList",templateUrl:"app/components/portal/UserManager/User/UserList/UserList.html",controller:"UserListController",stateName:"业主列表",previous:"app.portal.UserManager"}).state("app.portal.UserManager.User.UserInfo",{url:"/:userID/UserInfo",templateUrl:"app/components/portal/UserManager/User/UserInfo/UserInfo.html",controller:"UserInfoController",stateName:"业主详情",previous:"app.portal.UserManager.User.UserList"}).state("app.portal.UserManager.User.UserThingAuthority",{url:"/:userID/ThingAuthority",templateUrl:"app/components/portal/UserManager/User/UserThingAuthority/UserThingAuthority.html",controller:"UserThingAuthorityController",stateName:"设备所有权",previous:"app.portal.UserManager.User.UserInfo"}).state("app.portal.UserManager.User.UserThingACL",{url:"/:userID/ThingACL",templateUrl:"app/components/portal/UserManager/User/UserThingACL/UserThingACL.html",controller:"UserThingACLController",stateName:"设备控制权",previous:"app.portal.UserManager.User.UserInfo"})}]),angular.module("BeehivePortal").config(["$stateProvider","$urlRouterProvider",function(e){e.state("app.portal.UserManager.UserGroup.UserGroupList",{url:"/UserGroupList",templateUrl:"app/components/portal/UserManager/UserGroup/UserGroupList/UserGroupList.html",controller:"UserGroupListController",stateName:"群组列表",previous:"app.portal.UserManager"}).state("app.portal.UserManager.UserGroup.UserGroupEdit",{url:"/UserGroupList/:userGroupID/edit",templateUrl:"app/components/portal/UserManager/UserGroup/GroupEditor/GroupEditor.html",controller:"GroupEditorController",stateName:"编辑群组",previous:"app.portal.UserManager.UserGroup.UserGroupList"}).state("app.portal.UserManager.UserGroup.GroupUserList",{url:"/GroupUser/:userGroupID/UserList",templateUrl:"app/components/portal/UserManager/UserGroup/GroupUserList/GroupUserList.html",controller:"GroupUserListController",stateName:"业主列表",previous:"app.portal.UserManager.UserGroup.UserGroupList"}).state("app.portal.UserManager.UserGroup.UserInfo",{url:"/:userGroupID/UserInfo/:userID",templateUrl:"app/components/portal/UserManager/User/UserInfo/UserInfo.html",controller:"UserInfoController",stateName:"用户列表",previous:"app.portal.UserManager.UserGroup.GroupUserList"}).state("app.portal.UserManager.UserGroup.GroupThingAuthority",{url:"/:userGroupID/ThingAuthority",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingAuthority/GroupThingAuthority.html",controller:"UserThingAuthorityController",stateName:"设备所有权",previous:"app.portal.UserManager.UserGroup.UserGroupEdit"}).state("app.portal.UserManager.UserGroup.GroupThingACL",{url:"/:userGroupID/ThingACL",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingACL/GroupThingACL.html",controller:"GroupThingACLController",stateName:"设备控制权",previous:"app.portal.UserManager.UserGroup.UserGroupEdit"}).state("app.portal.UserManager.UserGroup.GroupUserThingAuthority",{url:"/:userGroupID/ThingAuthority",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingAuthority/GroupThingAuthority.html",controller:"UserThingAuthorityController",stateName:"设备所有权",previous:"app.portal.UserManager.UserGroup.UserInfo"}).state("app.portal.UserManager.UserGroup.GroupUserThingACL",{url:"/:userGroupID/ThingACL",templateUrl:"app/components/portal/UserManager/UserGroup/GroupThingACL/GroupThingACL.html",controller:"GroupThingACLController",stateName:"设备控制权",previous:"app.portal.UserManager.UserGroup.UserInfo"})}]),angular.module("BeehivePortal").run(["$templateCache",function(e){e.put("app/app.html",'<div class="app"><div id="spinner" style="display:none;"><div class="loader">Loading...</div></div><div ui-view=""></div></div>'),e.put("app/components/portal/portal.html",'<div class="app-portal skin-black" id="wrapper" ng-init="portalInit()"><header class="header"><a href="index.html" class="logo">蜂巢大厦</a><nav class="navbar navbar-static-top" role="navigation"><a class="navbar-btn sidebar-toggle" ng-click="toggleMenu()"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></a><div class="navbar-right"><ul class="nav navbar-nav"><li class="dropdown messages-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-envelope"></i></a></li><li class="dropdown tasks-menu"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-tasks"></i></a></li><li class="dropdown user user-menu" uib-dropdown=""><a href="#" class="dropdown-toggle" uib-dropdown-toggle=""><i class="fa fa-user"></i> <span>{{credential.userName}} <i class="caret"></i></span></a><ul class="dropdown-menu dropdown-custom dropdown-menu-right"><li><a ng-click="logout()"><i class="fa fa-ban fa-fw pull-right"></i> 用户登出</a></li></ul></li></ul></div></nav></header><div class="wrapper row-offcanvas row-offcanvas-left"><aside class="left-side" style="min-height: 100%;"><section class="sidebar"><div class="user-panel"><div class="pull-left image"><img src="images/kiicloud-logo.png" class="img-circle" alt="User Image"></div><div class="pull-left info"><p>Hello, {{credential.userName}}</p><a href="#"><i class="fa fa-circle text-success"></i> Online</a></div></div><form action="#" method="get" class="sidebar-form"><div class="input-group"><input type="text" name="q" class="form-control" placeholder="Search..."> <span class="input-group-btn"><button type="submit" name="seach" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button></span></div></form><ul class="sidebar-menu"><li ng-repeat="nav in portalNavs | orderBy: \'order\'" ng-class="{\'active\':isActive(nav.state.name)}" ng-if="!nav.hidden"><a ui-sref="{{(!nav.state.abstract? nav.state.name: getFirstChild(nav).state.name)}}($state.params)"><i class="fa fa-fw" ng-class="nav.icon"></i> {{nav.name}}<span class="fa arrow"></span></a><ul class="nav nav-second-level" uib-collapse="!isActive(nav.state.name)"><li ng-repeat="subNav in nav.subViews | orderBy: \'order\'" ng-if="!subNav.hidden" ng-class="{\'active\': isActive(subNav.state.name)}"><a ui-sref="{{(!subNav.state.abstract? subNav.state.name: subNav.state.redirectTo)}}($state.params)">{{subNav.name}}</a><ul class="nav nav-third-level" uib-collapse="!subNav._active"><li ng-if="!thirdNav.hidden" ng-repeat="thirdNav in subNav.subViews | orderBy: \'-order\'" ng-class="{\'active\': isActive(thirdNav.state.name)}"><a ui-sref="{{(!thirdNav.state.abstract? thirdNav.state.name: thirdNav.state.redirectTo)}}($state.params)">{{thirdNav.name}}</a></li></ul></li></ul></li></ul></section></aside><aside class="right-side shrink"><section class="content"><ol class="breadcrumb"><li ng-repeat="nav in getStateChan($state.current)"><a ui-sref="{{(!nav.abstract? nav.name: nav.redirectTo)}}($state.params)">{{nav.stateName}}</a></li></ol><div class="row portal-row" ng-if="$state.current.description && $state.current.description!=\'\'" )=""><div class="module-description">{{$state.current.description}}</div></div><div><div ui-view="" class="portal-content-body"></div></div></section></aside></div></div>'),e.put("app/components/secure/secure.html",'<div class="app-secure"><div ui-view=""></div></div>'),e.put("app/components/portal/Settings/Settings.html",'<div class="app-portal-settings"><section class="panel"><header class="panel-heading">更改密码</header><div class="panel-body"><div class="row portal-row clearfix"><div class="col-sm-4">旧密码</div><div class="col-sm-8"><input ng-model="password.oldPassword" type="password" required="" class="form-control" placeholder="旧密码"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">新密码</div><div class="col-sm-8"><input ng-model="password.newPassword" type="password" required="" class="form-control" placeholder="新密码"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">确认密码</div><div class="col-sm-8"><input ng-model="password.confirmPassword" type="password" required="" class="form-control" placeholder="确认密码"></div></div><div class="portal-row clearfix"><input type="submit" value="提交" name="submit" ng-click="changePassword(password)" class="btn btn-danger pull-right"></div></div></section></div>'),e.put("app/components/portal/ThingManager/ThingManager.html",'<div class="app-portal-thingmanager"><div ui-view=""></div></div>'),e.put("app/components/portal/ThingViews/EditThing.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">编辑设备标签</h3></div><div class="modal-body ng-scope clearfix"><div class="col-sm-12"><form novalidate="" name="newUserForm" ng-submit="createUser()"><div class="row portal-row clearfix"><div class="col-sm-4">设备种类</div><div class="col-sm-8">{{thing.type}}</div></div><div class="row portal-row clearfix"><div class="col-sm-4">设备ID</div><div class="col-sm-8">{{thing.globalThingID}}</div></div><div class="row portal-row clearfix"><div class="col-sm-4">设备位置</div><div class="col-sm-8">{{thing.location}}</div></div><div class="row portal-row clearfix"><div class="col-sm-4">标签</div><div class="col-sm-8"><span class="label label-info" style="display:inline-block; margin-right: 5px;" ng-repeat="tag in thing.tags">{{tag}} <span class="fa fa-remove" ng-click="removeTag(tag)"></span></span></div></div><div><table><thead><tr><th width="40%">选择</th><th>标签名</th></tr></thead><tbody><tr ng-repeat="tag in queriedTags"><td><input type="checkbox" ng-model="tag._checked"></td><td>{{tag.displayName}}</td></tr></tbody></table></div></form></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">提交</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/RemoteControl.template.html",'<div class="modal-content" ng-init="init()"><div class="modal-header"><h3 class="modal-title">远程控制</h3></div><div class="modal-body clearfix"><trigger-command my-actions="sourceSchema.actions"></trigger-command></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">发送命令</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/ThingRule.template.html",'<div class="modal-content"><div class="modal-header"><h3 class="modal-title">编辑规则</h3></div><div class="modal-body clearfix"><div class="form-group"><label>触发器名称</label> <input class="form-control" type="text" placeholder="触发器名称" ng-model="triggerBO.triggerName"></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/ThingViews.html",'<div class="app-portal-thingviews"><div ui-view=""></div></div>'),e.put("app/components/portal/TriggerManager/CreateTrigger.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">新增触发器</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">触发器名称</div><div class="col-sm-8"><input ng-model="triggerBO.triggerName" type="text" class="form-control" placeholder="触发器名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">触发器类型</div><div class="col-sm-8"><div app-select="" selected-model="triggerBO.triggerType" options="triggerTypes" class="input-group-btn" text="text" value-only="true"></div></div></div></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok(triggerBO)" ng-disable="triggerBO.triggerName.length==0">确认</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/TriggerManager/TriggerManager.html",'<div class="app-portal-triggermanager" ng-init="init()"><div class="new-trigger" ng-click="createTrigger()" permitted="CREATE_TRIGGER"><span class="fa fa-plus"></span> 新建触发器</div><uib-accordion close-others="true"><uib-accordion-group heading="{{trigger.triggerName}}" ng-repeat="trigger in triggers"><div ng-include="\'app/components/portal/TriggerManager/TriggerSetting.template.html\'"></div></uib-accordion-group></uib-accordion></div>'),e.put("app/components/portal/TriggerManager/TriggerSetting.template.html",'<summary-trigger ng-if="trigger.type==\'Summary\'" trigger="trigger" class="trigger-setting"></summary-trigger><group-trigger ng-if="trigger.type==\'Group\'" trigger="trigger" class="trigger-setting"></group-trigger><schedule-trigger ng-if="trigger.type==\'Simple\'" trigger="trigger" class="trigger-setting"></schedule-trigger>'),e.put("app/components/portal/UserManager/UserManager.html",'<div class="app-portal-usermanager"><div ui-view=""></div></div>'),e.put("app/components/portal/Welcome/Welcome.html",'<div class="app-portal-welcome"><h3>欢迎使用蜂巢智能管理平台</h3></div>'),e.put("app/components/secure/AdminLogin/AdminLogin.html",'<div class="app-secure-adminlogin"><div ui-view=""></div></div>'),e.put("app/components/secure/UserLogin/UserLogin.html",'<div class="app-secure-userlogin"><div class="app-logo-bg"><span class="fa fa-paper-plane-o app-icon"></span> <span>蜂巢智能管理平台</span></div><div class="login-form-box"><form name="loginForm" class="form-signin" role="form" novalidate="" ng-submit="login(credentials)"><div class="form-item-header">用户登录</div><fieldset><div class="input-group margin-bottom-sm" ng-class="nameInputFoucsClass"><span class="input-group-addon"><i class="fa fa-user fa-fw"></i></span> <input type="text" class="form-control" placeholder="用户名" name="username" ng-model="credentials.userID" required="" autofocus=""></div><div class="input-group margin-bottom-sm" ng-class="pwdInputFoucsClass"><span class="input-group-addon"><i class="fa fa-unlock fa-fw"></i></span> <input type="password" class="form-control" name="password" placeholder="密码" ng-model="credentials.password" required=""></div><div class="margin-bottom-sm"><input type="checkbox" id="rememberMe" name="rememberMe"> <label for="rememberMe">记住我 <input type="checkbox" switchery="credentials.rememberMe" yes-text="是" no-text="否"></label></div><div class="item-submit"><button type="submit" class="btn btn-danger item-submit-button"><span>登录</span></button></div></fieldset></form></div><div class="tip-wrap"><a id="register" class="ui-commandlink ui-widget" ng-click="register()"><span>注册</span></a></div><div class="powered-by">Powered by <span><img class="login-logo" src="images/kiicloud-logo.png" width="60px"></span>Kii China Team<div class="version-msg">Version 1.0b</div></div><div class="hidden"><div class="modal-content" id="registerModal"><div class="modal-header ng-scope"><h3 class="modal-title">用户注册</h3></div><div class="modal-body clearfix app-secure-userlogin"><div class="input-group margin-bottom-sm" ng-class="nameInputFoucsClass"><span class="input-group-addon"><i class="fa fa-user fa-fw"></i></span> <input type="text" class="form-control" placeholder="用户ID" name="username" ng-model="credentials.userID" required="" autofocus=""></div><div class="input-group margin-bottom-sm" ng-class="pwdInputFoucsClass"><span class="input-group-addon"><i class="fa fa-unlock fa-fw"></i></span> <input type="password" class="form-control" name="password" placeholder="密码" ng-model="credentials.password" required=""></div><div class="item-submit"><button type="submit" class="btn btn-danger item-submit-button" ng-click="register(credentials)"><span>注册</span></button></div><div class="item-submit"><button type="submit" class="btn btn-danger item-submit-button" ng-click="cancel()"><span>取消</span></button></div></div></div></div></div>'),e.put("app/shared/directives/app-select/app-select.template.html",'<div class="select-inline" ng-class="myClass" uib-dropdown=""><button id="search-filter" ng-disabled="disabled" type="button" class="btn btn-default" uib-dropdown-toggle="">{{selectedOption[setting.text]}}<span class="caret"></span></button><ul class="dropdown-menu" role="menu" aria-labelledby="search-filter"><li ng-repeat="option in options" role="menuitem" ng-click="selectOption(option)"><a>{{option[setting.text]}}</a></li></ul></div>'),e.put("app/shared/directives/app-slider/app-slider.template.html",'<div><rzslider rz-slider-model="rangeSlider.value" rz-slider-options="rangeSlider.options"></rzslider></div>'),e.put("app/shared/directives/item-selector/item-selector.template.html",'<div ng-init="init()"><div class="row"><div class="col-xs-5" ng-if="!disabled"><uib-tabset><uib-tab heading="{{settings.unselectedTitle}}"><treecontrol class="tree-classic" tree-model="unselectedItems" options="treeOptions" on-selection="selectLeftItem(node)">{{node[settings.name]}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-2 mid-column" style="padding-top: 130px;" ng-if="!disabled"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedLeftItem" ng-click="addItem(selectedLeftItem)">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedRightItem" ng-click="removeItem(selectedRightItem)">《撤回</button></div></div><div ng-class="{\'col-xs-12\': disabled, \'col-xs-5\': !disabled}"><uib-tabset><uib-tab heading="{{settings.selectedTitle}}"><treecontrol class="tree-classic" tree-model="selectedItems" options="treeOptions" on-selection="selectRightItem(node)">{{node[settings.name]}}</treecontrol></uib-tab></uib-tabset></div></div></div>'),e.put("app/shared/directives/location-selector/location-selector.template.html",'<div><uib-tabset><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="locations" options="treeOptions" on-selection="selectLocation(node, selected)">{{node[\'name\']}}</treecontrol></uib-tab></uib-tabset></div>'),e.put("app/shared/directives/multi-selector/multi-selector.template.html",'<span class="app-multi-selector"><div ng-dropdown-multiselect="" options="options" selected-model="ngModel" extra-settings="dataset.settings" events="dataset.events"></div></span>'),e.put("app/shared/directives/pagion/pagion.template.html",'<div><uib-pagination total-items="collection.length" items-per-page="listMaxLength" ng-model="index" ng-change="pageChanged()" previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"></uib-pagination></div>'),e.put("app/shared/directives/range-slider/range-slider.template.html",'<div class="range-slider"><input type="range" step="1" min="{{min}}" max="{{max}}" ng-model="ngModel"> <input type="text" class="range-display form-control" ng-model="ngModel"></div>'),e.put("app/shared/directives/switchery/switchery.template.html",'<div class="switchery pull-right" ng-class="{\'on\':on}" ng-click="switch()"><div class="selector"><div class="option">{{yesText}}</div><div class="option">{{noText}}</div></div><div class="slider"><div class="dile"></div><div class="dile"></div><div class="dile"></div></div></div>'),e.put("app/shared/directives/tag-selector/tag-selector.template.html",'<div ng-init="init()"><div class="row"><div class="col-xs-5" ng-if="!disabled"><uib-tabset><uib-tab heading="标签" ng-if="tagAllowed"><treecontrol class="tree-classic" tree-model="dataset.tags" options="treeOptions" on-selection="selectLeftItem(node)">{{node[\'displayName\']}}</treecontrol></uib-tab><uib-tab heading="位置" ng-if="locationAllowed"><treecontrol class="tree-classic" tree-model="dataset.locations" options="treeOptions" on-selection="selectLeftItem(node)">{{node[\'name\']}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-2 mid-column" style="padding-top: 130px;" ng-if="!disabled"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedLeftItem" ng-click="addItem(selectedLeftItem)">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedRightItem" ng-click="removeItem(selectedRightItem)">《撤回</button></div></div><div ng-class="{\'col-xs-12\': disabled, \'col-xs-5\': !disabled}"><uib-tabset><uib-tab heading="已选"><treecontrol class="tree-classic" tree-model="selectedItems" options="treeOptions" on-selection="selectRightItem(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div></div></div>'),e.put("app/shared/directives/tag-selector/tree.template.html",'<ul {{options.ulclass}}=""><li ng-repeat="node in node.{{options.nodeChildren}} | filter:filterExpression:filterComparator {{options.orderBy}}" ng-class="headClass(node)" {{options.liclass}}="" set-node-to-data=""><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i> <i class="tree-leaf-head {{options.iLeafClass}}"></i><div class="tree-label {{options.labelClass}}" ng-class="[selectedClass(), unselectableClass()]" ng-click="selectNodeLabel(node)" tree-transclude=""></div><treeitem ng-if="nodeExpanded()"></treeitem></li></ul>'),e.put("app/shared/directives/thing-picker/thing-picker.template.html",'<div ng-init="init()"><div class="col-sm-5 tabs-with-border"><uib-tabset><uib-tab heading="{{tab.name}}" select="selectLocation()" active="tab.active" ng-repeat="tab in tabs"><treecontrol class="tree-classic" tree-model="tab.treeLeft" options="treeOptions" on-selection="selectLeftNode(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-sm-2 mid-column" style="padding-top: 130px;"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedLeftNode" ng-click="addButtonClick()">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedRightNode" ng-click="removeButtonClick()">《撤回</button></div></div><div class="col-sm-5 tabs-with-border"><uib-tabset><uib-tab heading="{{tab.name}}" select="selectLocation()" active="tab.active" ng-repeat="tab in tabs"><treecontrol class="tree-classic" tree-model="tab.treeRight" options="treeOptions" on-selection="selectRightNode(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div></div>'),e.put("app/shared/directives/thing-selector/thing-selector.template.html",'<div ng-init="init()"><div class="row"><div class="col-xs-4" ng-if="!allDisabled"><uib-tabset><uib-tab heading="标签" ng-if="tagAllowed"><treecontrol class="tree-classic" tree-model="dataset.tags" options="treeOptions" on-selection="selectTag(node)">{{node.displayName}}</treecontrol></uib-tab><uib-tab heading="位置" ng-if="locationAllowed"><treecontrol class="tree-classic" tree-model="dataset.locations" options="treeOptions" on-selection="selectLocation(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-3" ng-if="!allDisabled"><uib-tabset><uib-tab heading="未选设备"><treecontrol class="tree-classic" tree-model="thingTypes" options="treeOptions" on-selection="selectUnselectedThing(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-2 mid-column" style="padding-top: 130px;" ng-if="!allDisabled"><div class="portal-row"><button class="btn btn-success pull-mid" ng-disabled="!selectedUnselectedThing" ng-click="addThing(selectedUnselectedThing)">赋予》</button></div><div class="portal-row"><button class="btn btn-danger pull-mid" ng-disabled="!selectedSelectedThing" ng-click="removeThing(selectedSelectedThing)">《撤回</button></div></div><div ng-class="{\'col-xs-12\': allDisabled, \'col-xs-3\': !allDisabled}"><uib-tabset><uib-tab heading="已选设备"><treecontrol class="tree-classic" tree-model="selectedTypes" options="treeOptions" on-selection="selectSelectedThing(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div></div></div>'),e.put("app/components/portal/ThingManager/AddThing/AddThing.html",'<div class="app-portal-thingmanager-addthing" ng-init="init()"><div class="panel"><div class="panel-heading">添加新设备</div><div class="panel-body"><div class="row"><div class="col-xs-6"><div class="form-group"><label>vendorThingID</label> <input class="form-control" type="text" ng-model="thing.vendorThingID"></div><div class="form-group"><label>种类</label> <input class="form-control" type="text" ng-model="thing.type"></div><div class="form-group"><label>自定义字段</label><div id="jsoneditor" style="height:300px; width:100%;"></div></div><div class="form-group"><button ng-click="saveThing(thing)" class="btn btn-success pull-right">添加设备</button></div></div><div class="col-xs-6"><div class="form-group"><label>位置</label><location-selector selected-location="thing.location"></location-selector></div></div></div></div></div></div>'),e.put("app/components/portal/ThingManager/ControlThing/ControlThing.html",'<div class="app-portal-thingmanager-controlthing" ng-init="init()"><div class="panel"><div class="panel-heading">发送设备命令</div><div class="panel-body"><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><source-picker my-source="dataContainer.mySource" init="init" ng-if="refreshed"></source-picker></uib-slide><uib-slide active="currentStep == 2"><trigger-command my-actions="dataContainer.sourceSchema.actions" ng-if="refreshed"></trigger-command></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><button class="btn btn-danger pull-right margin-left" ng-click="nextStep(currentStep)">{{currentStep < 2?\'下一步\':\'完成\'}}</button> <button class="btn btn-success pull-right" ng-click="currentStep = currentStep - 1" ng-show="currentStep>1">上一步</button></div></div></div></div>'),e.put("app/components/portal/ThingManager/Gateway/Gateway.html",'<div class="app-portal-thingmanager-gateway" ng-init="init()"><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><div class="row clearfix"><div class="col-xs-4 clearfix"><uib-tabset><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="locationTree" options="treeOptions" on-selection="selectLocation(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-8 clearfix"><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">ID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">种类</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="thing in things" ng-click="showGatewayThings(thing)"><td>{{thing.globalThingID}}</td><td class="sorting_1">{{thing.type}}</td></tr></tbody></table></div></div></div></section><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><table class="table"><thead><th>设备ID</th><th>状态</th><th>操作</th></thead><tbody><tr ng-repeat="thing in endNodes"><td>{{thing.vendorThingID}}</td><td>{{thing.states}}</td><td width="124px"><button class="btn btn-info" ng-click="showReplaceModal(thing)">替换</button> <button class="btn btn-danger" ng-click="removeEndNode(thing)">删除</button></td></tr></tbody></table></div></section></div>'),e.put("app/components/portal/ThingManager/Gateway/Replacement.template.html",'<div class="modal-content"><div class="modal-header"><h3 class="modal-title">替换设备</h3></div><div class="modal-body clearfix"><div class="form-group"><label>endNodeVendorThingID</label> <input class="form-control" type="text" ng-model="endNode.endNodeVendorThingID"></div><div class="form-group"><label>endNodePassword</label> <input class="form-control" type="text" ng-model="endNode.endNodePassword"></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/LocationView/LocationView.html",'<div class="app-portal-thingviews-locationview" ng-init="init()"><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><div class="row clearfix"><div class="col-xs-4 clearfix"><uib-tabset><uib-tab heading="位置"><treecontrol class="tree-classic" tree-model="locationTree.tree.children" options="treeOptions" on-selection="selectLocation(node)">{{node.name}}</treecontrol></uib-tab></uib-tabset></div><div class="col-xs-8 clearfix"><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">ID</th><th>vendorThingID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">种类</th><th class="text-center">已登陆</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="thing in thingsForDisplay" context-menu="myMenu" target="thing"><td>{{thing.globalThingID}}</td><td>{{thing.vendorThingID}}</td><td class="sorting_1">{{thing.type}}</td><td class="text-center"><span class="fa" ng-class="thing.fullKiiThingID?\'fa-check\': \'fa-remove\'"></span></td></tr></tbody></table><div class="pull-right"><pagion collection="things" display="thingsForDisplay"></pagion></div></div></div></div></section></div>'),e.put("app/components/portal/ThingViews/TagView/AddTag.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">新增标签</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">标签名称</div><div class="col-sm-8"><input ng-model="newTag.displayName" type="text" class="form-control" placeholder="标签名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">描述</div><div class="col-sm-8"><input ng-model="newTag.description" type="text" class="form-control" placeholder="描述"></div></div></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/TagView/DeleteTag.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">删除标签</h3></div><div class="modal-body clearfix"><div class="col-sm-12">是否删除标签: {{tag.displayName}}</div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/ThingViews/TagView/EditTag.template.html",'<div class="modal-content" ng-init="init()"><div class="modal-header ng-scope"><h3 class="modal-title">编辑标签</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">标签名称</div><div class="col-sm-8"><input ng-model="tag.displayName" ng-disabled="true" type="text" class="form-control" placeholder="标签名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">描述</div><div class="col-sm-8"><input ng-model="tag.description" type="text" class="form-control" placeholder="描述"></div></div><thing-selector selected-things="selectedThings" ng-if="thingAllowed"></thing-selector></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">更新</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/TagView/TagView.html",'<div class="app-portal-thingviews-tagview" ng-init="init()"><div class="row portal-row"><div class="col-lg-12"><button class="btn btn-danger" ng-click="addTag()">新增标签</button></div></div><div class="portal-row"><div class="modules-outputs-content graph-tile" ng-repeat="tag in tagsForDisplay"><div class="module-top"><div class="overlay" ng-click="viewThings(tag)"><div class="viewReport">查看</div></div><div class="outputs-content-img"><img ng-src="{{\'images/tag.jpeg\'}}"></div></div><div class="moduleDetails"><div class="per-info"><span class="info">{{tag.displayName}}<br>设备数量： {{tag.count}}</span></div><div class="modulesActionBottom"><div class="item action-button" ng-click="goThingAuth(group)"><span class="fa fa-cloud-download"></span> <span class="item-text">添加设备</span></div></div></div><div class="modulesActionsTop"><i class="fa fa-pencil-square-o" uib-tooltip="编辑" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top" ng-click="editTag(tag)"></i> <i class="fa fa-trash-o" uib-tooltip="删除" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top" ng-click="deleteTag(tag)"></i></div></div></div><div class="portal-row"><div class="pull-right"><pagion collection="thingTags" display="tagsForDisplay"></pagion></div></div></div>'),e.put("app/components/portal/ThingViews/ThingACL/ThingACL.html",'<div class="app-portal-thingviews-thingacl"><div class="panel"><div class="panel-heading"><span>设备使用权限控制</span></div><div class="panel-body"><div class="portal-row"><label ng-repeat="acl in acls"><input type="checkbox" ng-model="acl._checked">{{acl.name}}</label></div><div class="portal-row"><table class="table"><thead><th>用户姓名</th><th>用户ID</th><th>选择</th></thead><tbody><tr ng-repeat="user in users"><td>{{user.userName}}</td><td>{{user.userID}}</td><td><input type="checkbox" ng-model="user._checked"></td></tr></tbody></table></div></div></div></div>'),e.put("app/components/portal/ThingViews/ThingDetail/ThingDetail.html",'<div class="app-portal-thingviews-thingdetail" ng-init="init()"><div class="row"><div class="col-sm-5"><div class="panel"><div class="panel-heading">属性</div><div class="panel-body"><table><tr><td class="title">设备ID</td><td>{{thing.globalThingID}}</td></tr><tr><td class="title">vendorThingID</td><td>{{thing.vendorThingID}}</td></tr><tr><td class="title">设备位置</td><td>{{thing.location}}</td></tr><tr><td class="title">设备种类</td><td>{{thing.type}}</td></tr><tr><td class="title">位置</td><td>{{thing.location}}</td></tr><tr><td class="title">标签</td><td>{{thing.tags.join(\', \')}}</td></tr><tr><td class="title">已登录</td><td><span class="fa" ng-class="thing.fullKiiThingID?\'fa-check\': \'fa-remove\'"></span></td></tr></table></div></div><div class="panel"><div class="panel-heading">设备状态 <span class="fa fa-refresh operator" ng-click="refreshStatus()"></span></div><div class="panel-body"><table ng-show="!statusOnEdit"><tr ng-repeat="(key, value) in thing.status"><td class="title">{{key}}</td><td>{{value}}</td></tr></table></div></div></div><div class="col-sm-7"><div class="panel" ng-if="thing.kiiAppID"><div class="panel-heading">设备登录信息</div><div class="panel-body"><table><tr><td class="title">kiiAppID</td><td>{{thing.kiiAppID}}</td></tr><tr><td class="title">kiiAppKey</td><td>{{thing.kiiAppKey}}</td></tr><tr><td class="title">ownerID</td><td>{{thing.ownerID}}</td></tr><tr><td class="title">ownerToken</td><td>{{thing.ownerToken}}</td></tr><tr><td class="title">kiiSiteUrl</td><td>{{thing.kiiSiteUrl}}</td></tr><tr><td class="title">password</td><td>{{thing.password}}</td></tr></table></div></div><div class="panel"><div class="panel-heading">自定义字段 <span ng-show="!customOnEdit" class="fa fa-edit" ng-click="editCustom(thing.custom)"></span> <span ng-show="customOnEdit" class="fa fa-remove" ng-click="customOnEdit = false"></span></div><div class="panel-body"><table ng-show="!customOnEdit"><tr ng-repeat="(key, value) in thing.custom"><td class="title">{{key}}</td><td>{{value}}</td></tr></table><div ng-show="customOnEdit"><div class="form-group"><div id="customEditor" style="height:300px; width:100%;"></div></div><div><button class="btn btn-success pull-right" ng-click="submitCustomFields(thing)">更新</button></div></div></div></div></div></div><div class="panel"><div class="panel-heading">触发器</div></div><div class="new-trigger" ng-click="createTriggerModal()"><span class="fa fa-plus"></span> 新建触发器</div><uib-accordion close-others="true"><uib-accordion-group heading="{{trigger.triggerName}}" ng-repeat="trigger in dataset.triggers"><single-trigger trigger="trigger"></single-trigger></uib-accordion-group></uib-accordion><hr><div class="clearfix"><div class="pull-right"><button class="btn btn-danger">控制历史</button> <button class="btn btn-danger" ng-click="openRemoteControl(thing)">远程控制</button> <button class="btn btn-danger" ng-click="goThingACL()">控制权限</button></div></div></div>'),e.put("app/components/portal/ThingViews/ThingList/ThingList.html",'<div class="app-portal-thingviews-thinglist" ng-init="init()"><section class="panel"><header class="panel-heading">设备列表</header><div class="panel-body"><table class="table table-striped table-bordered table-hover dataTable no-footer" role="grid"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">设备ID</th><th class="sorting">vendorThingID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">种类</th><th class="sorting" rowspan="1" colspan="1">位置</th><th class="sorting" rowspan="1" colspan="1">标签</th><th class="text-center">已登陆</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="thing in things" context-menu="myMenu" target="thing"><td>{{thing.globalThingID}}</td><td>{{thing.vendorThingID}}</td><td class="sorting_1">{{thing.type}}</td><td>{{thing.location}}</td><td>{{thing.tags.join(\',\')}}</td><td class="text-center"><span class="fa" ng-class="thing.fullKiiThingID?\'fa-check\': \'fa-remove\'"></span></td></tr></tbody></table><div class="pull-right"><pagion collection="things" display="thingsForDisplay"></pagion></div></div></section></div>'),e.put("app/components/portal/ThingViews/TypeView/EditType.template.html",'<div class="modal-content" ng-init="init()"><div class="modal-header ng-scope"><h3 class="modal-title">编辑类型</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">类型名称</div><div class="col-sm-8"><input ng-model="type.type" ng-disabled="true" type="text" class="form-control" placeholder="标签名称"></div></div><div class="row portal-row clearfix"><uib-tabset><uib-tab heading="行业模板" ng-if="schema" active="schemaViewActive"><div class="form-group"><label>版本：{{schema.version}}</label></div><hr><div class="form-group"><h4>属性</h4><table class="table"><thead><th>名称</th><th>种类</th><th>值域</th><th>描述</th></thead><tbody><tr ng-repeat="(key, value) in schema.statesSchema.properties"><td>{{key}}</td><td><code class="bg-primary">{{value.type}}</code></td><td><code ng-if="value.minimum || value.minimum == 0">{{\'> \' + value.minimum}}</code> <code ng-if="value.maximum || value.maximum == 0">{{\'< \' + value.maximum}}</code></td><td>{{value.description}}</td></tr></tbody></table></div><hr><div class="form-group"><h4>命令</h4><uib-accordion close-others="oneAtATime"><uib-accordion-group heading="{{key}}" ng-repeat="(key, value) in schema.actions"><div class="form-group"><uib-tabset><uib-tab heading="输入"><property-tree my-property="value.in"></property-tree></uib-tab><uib-tab heading="输出"><property-tree my-property="value.out"></property-tree></uib-tab></uib-tabset></div></uib-accordion-group></uib-accordion></div></uib-tab><uib-tab heading="编辑行业模板" active="schemaEditorActive"><div id="jsoneditor" style="height:300px; width:100%;"></div></uib-tab></uib-tabset></div></div></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">更新</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/ThingViews/TypeView/TypeView.html",'<div class="app-portal-thingviews-typeview" ng-init="init()"><div class="modules-outputs-content graph-tile" ng-repeat="type in thingTypes"><div class="module-top"><div class="overlay"><div class="viewReport" ng-click="viewThings(type)">查看</div></div><div class="outputs-content-img"><img ng-src="{{\'images/bulb.jpeg\'}}"></div></div><div class="moduleDetails"><div class="per-info"><span class="info">{{type.type}}<br>设备数量： {{type.count}}</span></div><div class="modulesActionBottom"></div></div><div class="modulesActionsTop"><i class="fa fa-pencil-square-o" uib-tooltip="编辑" ng-click="editType(type)" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top"></i> <i class="fa fa-trash-o" uib-tooltip="删除" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top"></i></div></div></div>'),e.put("app/components/portal/UserManager/ThingAuthority/ThingAuthority.html",'<div class="app-portal-usermanager-thingauthority" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-picker existing-nodes="ownThings" selected-nodes="selectedThings" settings="settings" ready="ready"></thing-picker></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/User/EditUser.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">编辑用户资料</h3></div><div class="modal-body ng-scope"><form novalidate="" name="newUserForm" ng-submit="createUser()"><div class="row portal-row clearfix"><div class="col-sm-4">姓名</div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" placeholder="姓名" required="" ng-model="user.userName"><div app-select="" selected-model="user.custom.sex" options="sexOptions" class="btn-group input-group-btn" text="text"></div></div></div></div><div class="row portal-row clearfix"><div class="col-sm-4">身份证</div><div class="col-sm-8"><input ng-model="user.userID" type="text" required="" class="form-control" placeholder="身份证" ng-disabled="true"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">公司</div><div class="col-sm-8"><input ng-model="user.company" type="text" class="form-control" placeholder="公司"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">电话</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="电话" ng-model="user.phone"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">邮箱地址</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="邮箱地址" ng-model="user.mail"></div></div></form></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/UserManager/User/User.html",'<div class="app-portal-usermanager-user"><div ui-view=""></div></div>'),e.put("app/components/portal/UserManager/UserGroup/UserGroup.html",'<div class="app-portal-usermanager-usergroup"><div ui-view=""></div></div>'),e.put("app/components/portal/TriggerManager/directives/group-trigger/group-trigger.template.html",'<div ng-init="init()" class="group-trigger"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="currentStep = 1">1</div><div class="bar"></div><label>触发器源</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="currentStep = 2">2</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="currentStep = 3">3</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>4, \'current\': currentStep==4, \'todo\': currentStep<4}"><div class="round" ng-click="currentStep = 4">4</div><label>触发命令</label></div></div></div><hr><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><source-picker my-source="dataContainer.mySource"></source-picker></uib-slide><uib-slide active="currentStep == 2"><uib-tabset><uib-tab heading="触发条件集"><div class="trigger-when"><span>何时触发：</span><div app-select="" value-only="true" selected-model="dataContainer.predicate.triggersWhen" options="triggerWhenConditions"></div></div><div><condition-tree schema="dataContainer.sourceSchema.statesSchema.properties" result="dataContainer.predicate.condition"></condition-tree></div></uib-tab><uib-tab heading="触发策略"><select-policy policy="dataContainer.policy"></select-policy></uib-tab><uib-tab heading="定时器"><div class="form-group text-left"><label><input type="checkbox" ng-disabled="!!trigger.triggerID" ng-model="dataContainer.schedule.enabled">启用定时器</label></div><select-schedule schedule="dataContainer.schedule" ng-if="dataContainer.schedule.enabled" disabled="trigger.triggerID"></select-schedule></uib-tab></uib-tabset></uib-slide><uib-slide active="currentStep == 3"><div class="new-source" ng-click="createTarget()"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker sources="dataContainer.myTargets"></multi-source-picker></uib-slide><uib-slide active="currentStep == 4"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{\'命令-\' + ($index + 1)}}" ng-repeat="targetSchema in dataContainer.targetSchemas"><trigger-command my-actions="targetSchema.actions"></trigger-command></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><button class="btn btn-danger pull-right margin-left" ng-click="nextStep(currentStep)">{{currentStep < 4?\'下一步\':\'完成\'}}</button> <button class="btn btn-success pull-right" ng-click="previousStep(currentStep)" ng-show="currentStep>1">上一步</button></div></div>'),e.put("app/components/portal/TriggerManager/directives/schedule-trigger/schedule-trigger.template.html",'<div ng-init="init()"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="goStep(1)">1</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="goStep(2)">2</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="goStep(3)">3</div><label>触发命令</label></div></div></div><hr><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><select-schedule schedule="dataContainer.schedule" disabled="trigger.triggerID"></select-schedule></uib-slide><uib-slide active="currentStep == 2"><div class="new-source" ng-click="createTarget()" ng-if="!trigger.triggerID"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker sources="dataContainer.myTargets" disabled="trigger.triggerID"></multi-source-picker></uib-slide><uib-slide active="currentStep == 3"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{\'命令-\' + ($index + 1)}}" ng-repeat="targetSchema in dataContainer.targetSchemas"><trigger-command my-actions="targetSchema.actions" disabled="trigger.triggerID"></trigger-command></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><trigger-control-group trigger="trigger"></trigger-control-group><div class="pull-right"><button class="btn btn-success" ng-click="previousStep(currentStep)" ng-show="currentStep>1" ng-if="!trigger.triggerID">上一步</button> <button class="btn btn-info" ng-click="nextStep(currentStep)" ng-if="!trigger.triggerID">{{currentStep < 3?\'下一步\':\'完成\'}}</button></div></div></div>'),e.put("app/components/portal/TriggerManager/directives/select-multiple-source/select-multiple-source.template.html",'<div><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{source.name ||(\'源-\' + ($index + 1))}}" ng-repeat="source in sources"><div ng-if="!disabled"><button class="btn btn-danger pull-right" ng-click="removeSource(source)"><span class="fa fa-remove"></span>删除源</button></div><source-picker my-source="source" disabled="disabled"></source-picker></uib-accordion-group></uib-accordion></div>'),e.put("app/components/portal/TriggerManager/directives/select-policy/select-policy.template.html",'<div class="select-policy text-left" ng-init="init()"><div class="form-group">当<div app-select="" options="policyOptions" selected-model="policy.groupPolicy" value-only="true"></div>的源设备的条件被满足时触发。</div><div class="form-group" ng-if="policy.groupPolicy==\'Some\'"><label>满足条件的设备数量：</label><div class="range-container"><range-slider min="0" max="thingNumber" ng-model="policy.criticalNumber"></range-slider>个设备</div></div><div class="form-group" ng-if="policy.groupPolicy==\'Percent\'"><label>满足条件的设备百分比：</label><div class="range-container"><range-slider min="0" max="100" ng-model="policy.criticalPercent"></range-slider>%</div></div></div>'),e.put("app/components/portal/TriggerManager/directives/select-schedule/select-schedule.template.html",'<div class="select-schedule text-left" ng-init="init()"><div class="form-group"><span>定时器类型</span><div app-select="" disabled="disabled" selected-model="schedule.type" value-only="true" options="scheduleTypes"></div></div><div class="form-group" ng-if="schedule.type != \'Cron\'"><table><tr><td><input type="text" ng-disabled="disabled" ng-model="schedule.interval" class="form-control"></td><td><div disabled="disabled" app-select="" selected-model="schedule.timeUnit" options="intervalUnits" value-only="true"></div></td></tr></table></div><div class="form-group" ng-if="schedule.type == \'Cron\'"><cron-selection ng-disabled="disabled" output="schedule.cron" init="initCron"></cron-selection></div></div>'),e.put("app/components/portal/TriggerManager/directives/select-source/select-source.template.html",'<div ng-init="init()"><div class="text-left clearfix"><div class="pull-left"><span>源类型</span><div app-select="" disabled="disabled" selected-model="mySource.sourceType" options="sourceTypes" class="input-group-btn" text="text" value-only="true"></div></div><div class="pull-left" style="margin-left: 50px" ng-if="mySource.sourceType == \'tag\'"><span>交并集</span><div app-select="" disabled="disabled" selected-model="mySource.andExpress" options="andExpressOptions" value-only="true"></div></div><div class="pull-left" style="margin-left: 50px" ng-if="mySource.sourceType == \'tag\'"><span>设备类型</span><multi-selector single="true" ng-if="!disabled" ng-model="mySource.selectedType" options="mySource.thingTypes" on-change="thingTypeChange"></multi-selector><button ng-if="disabled" disabled="disabled" class="btn btn-default">{{mySource.type}}</button></div></div><hr><div ng-if="!disabled"><div ng-show="mySource.sourceType ==\'thing\'"><thing-selector selected-things="mySource.thingList" selected-thing-types="mySource.thingTypes"></thing-selector></div><div ng-show="mySource.sourceType ==\'tag\'"><tag-selector selected-tags="mySource.tagList" tag-types="mySource.tagTypes"></tag-selector></div></div><div ng-if="disabled"><div ng-if="mySource.thingList.length>0">已选设备: {{mySource.thingList.join(\',\')}}</div><div ng-if="mySource.tagList.length>0">已选标签: {{mySource.tagList.join(\',\')}}</div></div></div>'),e.put("app/components/portal/TriggerManager/directives/single-trigger/single-trigger.template.html",'<div ng-init="init()"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="goStep(1)">1</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="goStep(2)">2</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="goStep(3)">3</div><label>触发命令</label></div></div></div><hr><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><uib-tabset><uib-tab heading="条件"><div class="trigger-when"><span>何时触发：</span><div app-select="" value-only="true" disabled="trigger.triggerID" selected-model="dataContainer.predicate.triggersWhen" options="triggerWhenConditions"></div></div><div><condition-tree disabled="trigger.triggerID" schema="dataContainer.sourceSchema.statesSchema.properties" result="dataContainer.predicate.condition"></condition-tree></div></uib-tab><uib-tab heading="定时器"><div class="form-group text-left"><label><input type="checkbox" ng-disabled="!!trigger.triggerID" ng-model="dataContainer.schedule.enabled">启用定时器</label></div><select-schedule ng-if="dataContainer.schedule.enabled" disabled="trigger.triggerID" schedule="dataContainer.schedule"></select-schedule></uib-tab></uib-tabset></uib-slide><uib-slide active="currentStep == 2"><div class="new-source" ng-click="createTarget()" ng-if="!trigger.triggerID"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker sources="dataContainer.myTargets" disabled="trigger.triggerID"></multi-source-picker></uib-slide><uib-slide active="currentStep == 3"><uib-accordion close-others="true" class="multi-source"><uib-accordion-group heading="{{\'命令-\' + ($index + 1)}}" ng-repeat="targetSchema in dataContainer.targetSchemas"><trigger-command disabled="trigger.triggerID" my-actions="targetSchema.actions"></trigger-command></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><trigger-control-group trigger="trigger"></trigger-control-group><div class="pull-right" ng-if="!trigger.triggerID"><button class="btn btn-success" ng-click="previousStep(currentStep)" ng-show="currentStep>1">上一步</button> <button class="btn btn-danger" ng-click="nextStep(currentStep)">{{currentStep < 3?\'下一步\':\'完成\'}}</button></div></div></div>'),e.put("app/components/portal/TriggerManager/directives/summary-trigger/summary-trigger.template.html",'<div ng-init="init()"><div class="step-bar"><div class="sui-steps-round steps-round-auto"><div class="wrap" ng-class="{\'finished\': currentStep>1, \'current\': currentStep==1, \'todo\': currentStep<1}"><div class="round" ng-click="currentStep = 1">1</div><div class="bar"></div><label>触发器源</label></div><div class="wrap" ng-class="{\'finished\': currentStep>2, \'current\': currentStep==2, \'todo\': currentStep<2}"><div class="round" ng-click="currentStep = 2">2</div><div class="bar"></div><label>触发表达式</label></div><div class="wrap" ng-class="{\'finished\': currentStep>3, \'current\': currentStep==3, \'todo\': currentStep<3}"><div class="round" ng-click="currentStep = 3">3</div><div class="bar"></div><label>触发条件</label></div><div class="wrap" ng-class="{\'finished\': currentStep>4, \'current\': currentStep==4, \'todo\': currentStep<4}"><div class="round" ng-click="currentStep = 4">4</div><div class="bar"></div><label>触发目标</label></div><div ng-class="{\'finished\': currentStep>5, \'current\': currentStep==5, \'todo\': currentStep<5}"><div class="round" ng-click="currentStep = 5">5</div><label>触发命令</label></div></div></div><uib-carousel no-wrap="noWrapSlides"><uib-slide active="currentStep == 1"><div class="new-source" ng-click="createSource()"><span class="fa fa-plus"></span> 新建源</div><multi-source-picker sources="dataContainer.mySources"></multi-source-picker></uib-slide><uib-slide active="currentStep == 2"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{name}}" ng-repeat="(name, source) in trigger.summarySource"><div class="source-aggregation-settings"><table class="table"><thead><tr role="row"><th>字段名</th><th>聚合函数</th><th>聚合名</th><th>选择</th></tr></thead><tbody><tr ng-repeat="field in source.schema"><td>{{field.name}}</td><td><div app-select="" selected-model="field[\'function\']" disabled="!field._checked" value-only="true" options="aggregationFunctions"></div></td><td><input type="text" ng-model="field.summaryAlias" class="form-control" ng-disabled="!field._checked"></td><td><input type="checkbox" ng-model="field._checked"></td></tr></tbody></table></div></uib-accordion-group></uib-accordion></uib-slide><uib-slide active="currentStep == 3"><div class="trigger-when"><span>何时触发：</span><div app-select="" selected-model="myTrigger.predicate.triggersWhen" options="triggerWhenConditions"></div></div><div><condition-tree schema="summarySchema" result="dataContainer.summaryConditionClause"></condition-tree></div></uib-slide><uib-slide active="currentStep == 4"><div class="new-source" ng-click="createTarget()"><span class="fa fa-plus"></span> 新建目标</div><multi-source-picker ready="ready" dataset="dataset" sources="dataContainer.myTargets"></multi-source-picker></uib-slide><uib-slide active="currentStep == 5"><uib-accordion close-others="oneAtATime" class="multi-source"><uib-accordion-group heading="{{ \'目标源-\' + ($index + 1) }}" ng-repeat="target in myTrigger.targets"><textarea type="text" class="form-control" ng-model="target.command"></textarea></uib-accordion-group></uib-accordion></uib-slide></uib-carousel><hr><div class="panel-foot clearfix"><button class="btn btn-danger pull-right margin-left" ng-click="nextStep(currentStep)">{{currentStep<5?\'下一步\':\'完成\'}}< button=""><button class="btn btn-success pull-right" ng-click="previousStep(currentStep)" ng-show="currentStep>1">上一步</button></5?\'下一步\':\'完成\'}}<></button></div><script type="text/ng-template" id="/app/components/TriggerManager/new-source.html"><div class="modal-content"> <div class="modal-header ng-scope"> <h3 class="modal-title">新增触发源</h3> </div> <div class="modal-body clearfix"> <div class="col-sm-12"> <div class="row portal-row clearfix"> <div class="col-sm-4">触发源名称</div> <div class="col-sm-8"><input ng-model="sourceName" type="text" class="form-control" placeholder="触发源名称" /></div> </div> </div> </div> <div class="modal-footer ng-scope"> <button class="btn btn-primary" type="button" ng-click="createSource(sourceName)" ng-disable="sourceName.length==0">确认</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button> </div> </div></script></div>'),e.put("app/components/portal/TriggerManager/directives/trigger-command/trigger-command.template.html",'<div class="text-left trigger-command"><div class="form-group"><label>可选命令：</label><div><multi-selector ng-model="selectedActions" options="actionOptions" disabled="disabled"></multi-selector></div></div><div class="form-group"><uib-accordion close-others="oneAtATime"><uib-accordion-group heading="{{action.label}}" ng-repeat="action in selectedActions"><table class="table"><thead><th>名称</th><th>种类</th><th>值</th><th>值域</th><th>描述</th><th>选择</th></thead><tbody><tr ng-repeat="(propertyKey, propertyValue) in action.action.in.properties"><td><span ng-if="!propertyValue.properties">{{propertyKey}}</span> <a ng-if="propertyValue.properties" style="cursor:pointer" ng-click="collapseControllers[propertyKey] = !collapseControllers[propertyKey]">{{propertyKey}}</a></td><td><code class="bg-primary">{{propertyValue.type}}</code></td><td><div class="clearfix pull-left"><div ng-if="propertyValue.type==\'boolean\'"><div switchery="propertyValue.value" yes-text="开" no-text="关" disabled="disabled"></div></div><div ng-if="propertyValue.type==\'string\'"><input class="form-control" type="text" ng-model="propertyValue.value" ng-disabled="disabled"></div><div ng-if="propertyValue.type==\'integer\' || propertyValue.type==\'float\'"><div ng-if="(propertyValue.minimum || propertyValue.minimum == 0) && (propertyValue.maximum || propertyValue.maximum == 0)" class="range-type"><div class="range-container"><input class="form-control" type="range" min="propertyValue.minimum" max="propertyValue.maximum" ng-model="propertyValue.value" step="{{propertyValue.type==\'integer\'?1: 0.01}}" ng-disabled="disabled"></div><input ng-model="propertyValue.value" class="form-control pull-left" type="text" ng-disabled="true"></div><div ng-if="(!propertyValue.minimum && propertyValue.minimum != 0) || (!propertyValue.maximum && propertyValue.maximum != 0)"><input class="form-control" type="number" ng-model="propertyValue.value" ng-disabled="disabled"></div></div></div></td><td><code ng-if="propertyValue.minimum || propertyValue.minimum == 0">{{\'> \' + propertyValue.minimum}}</code> <code ng-if="propertyValue.maximum || propertyValue.maximum == 0">{{\'< \' + propertyValue.maximum}}</code></td><td>{{propertyValue.description}}</td><td><input type="checkbox" ng-model="propertyValue._checked" ng-disabled="propertyRequired(propertyKey, myProperty.required) || disabled"></td></tr></tbody></table></uib-accordion-group></uib-accordion></div></div>'),e.put("app/components/portal/TriggerManager/directives/trigger-control-group/trigger-control-group.template.html",'<div class="form-group pull-left"><button class="btn btn-danger" ng-click="deleteTrigger(trigger)">删除触发器</button> <button class="btn btn-info" ng-if="trigger.recordStatus == \'disable\' && trigger.triggerID" ng-click="enableTrigger(trigger)">启用触发器</button> <button class="btn btn-info" ng-if="trigger.recordStatus != \'disable\' && trigger.triggerID" ng-click="disableTrigger(trigger)">禁用触发器</button></div>'),e.put("app/components/portal/UserManager/User/NewUser/NewUser.html",'<div class="app-portal-usermanager-user-newuser" ng-init="init()"><section class="panel"><header class="panel-heading">用户信息</header><div class="panel-body"><form novalidate="" name="newUserForm" ng-submit="createUser()"><div class="row portal-row clearfix"><div class="col-sm-4">姓名</div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" placeholder="姓名" required="" ng-model="newUser.userName"><div app-select="" selected-model="newUser.custom.sex" options="sexOptions" class="btn-group input-group-btn" text="text"></div></div></div></div><div class="row portal-row clearfix"><div class="col-sm-4">身份证</div><div class="col-sm-8"><input ng-model="newUser.userID" type="text" required="" class="form-control" placeholder="身份证"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">公司</div><div class="col-sm-8"><input ng-model="newUser.company" type="text" class="form-control" placeholder="公司"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">电话</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="电话" ng-model="newUser.phone"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">邮箱地址</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="邮箱地址" ng-model="newUser.mail"></div></div><div class="row portal-row clearfix"><div class="col-sm-12"><input type="submit" value="提交" name="submit" class="btn btn-danger pull-right"></div></div></form></div></section></div>'),e.put("app/components/portal/UserManager/User/SearchUser/SearchUser.html",'<div class="app-portal-usermanager-user-searchuser"><div ui-view=""></div></div>'),e.put("app/components/portal/UserManager/User/UserInfo/UserInfo.html",'<div class="app-portal-usermanager-user-userinfo" ng-init="init()"><section class="panel"><header class="panel-heading">用户信息</header><div class="panel-body"><div class="row portal-row clearfix"><div class="col-sm-4">姓名</div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" placeholder="姓名" ng-model="user.userName" ng-disabled="true"> <span class="btn-group input-group-btn"><button class="btn btn-default" disabled="">{{user.custom.sex.text}}</button></span></div></div></div><div class="row portal-row clearfix"><div class="col-sm-4">身份证</div><div class="col-sm-8"><input ng-model="user.userID" type="text" class="form-control" placeholder="身份证" ng-disabled="true"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">公司</div><div class="col-sm-8"><input ng-model="user.company" type="text" class="form-control" placeholder="身份证" ng-disabled="true"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">电话</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="电话" ng-model="user.phone" ng-disabled="true"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">邮箱地址</div><div class="col-sm-8"><input type="text" class="form-control" placeholder="邮箱地址" ng-model="user.mail" ng-disabled="true"></div></div><div class="portal-row clearfix"><div class="pull-right"><button class="btn btn-danger" ng-click="editUser()" permitted="UPDATE_USER&GET_USER">编辑</button> <button class="btn btn-danger" ng-click="deleteUser()" permitted="DELETE_USER">删除</button> <button class="btn btn-danger" ng-click="goThingAuth()">设备拥有权限</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/User/UserList/ActivateUser.template.html",'<div class="modal-content"><div class="modal-header ng-scope"><h3 class="modal-title">激活用户</h3></div><div class="modal-body ng-scope"><form novalidate="" name="newUserForm"><div class="row portal-row clearfix"><div class="col-sm-4">姓名</div><div class="col-sm-8"><div class="input-group">{{user.userName}}</div></div></div><div class="row portal-row clearfix"><div class="col-sm-4">密码</div><div class="col-sm-8"><input ng-model="user.password" type="text" required="" class="form-control" placeholder="用户密码"></div></div></form></div><div class="modal-footer ng-scope"><button class="btn btn-primary" type="button" ng-click="register()">激活</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/UserManager/User/UserList/UserList.html",'<div class="app-portal-usermanager-user-userlist" ng-init="init()"><section class="panel"><header class="panel-heading">业主信息</header><div class="panel-body" permitted="SEARCH_USERS"><div class="row"><div class="col-sm-6" permitted="CREATE_USER"><button class="btn btn-danger pull-left" ng-click="navigateTo(navMapping.NEW_USER)">新增业主+</button></div><div class="pull-right col-sm-6"><div class="row"><div class="col-sm-4"><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button></span></div></div></div></div></div></div><div class="panel-body" permitted="SEARCH_USERS"><table class="table table-striped table-bordered table-hover dataTable no-footer break-word"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">业主ID</th><th class="sorting" rowspan="1" colspan="1">业主姓名</th><th class="sorting" rowspan="1" colspan="1">性别</th><th class="sorting" rowspan="1" colspan="1">邮箱</th><th class="sorting" rowspan="1" colspan="1">电话</th><th class="sorting" rowspan="1" colspan="1">公司</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="user in userListForDisplay" context-menu="myMenu" target="user"><td>{{user.userID}}</td><td>{{user.userName}}</td><td>{{user.custom.sex.text}}</td><td>{{user.mail}}</td><td>{{user.phone}}</td><td class="center">{{user.company}}</td></tr></tbody></table><div class="pull-right"><pagion collection="userList" display="userListForDisplay"></pagion></div></div></section></div>'),e.put("app/components/portal/UserManager/User/UserThingACL/UserThingACL.html",'<div class="app-portal-usermanager-userthingacl" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-selector selected-things="selectedThings"></thing-selector></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/User/UserThingAuthority/UserThingAuthority.html",'<div class="app-portal-usermanager-userthingauthority" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-picker existing-nodes="ownThings" selected-nodes="selectedThings" settings="settings" ready="ready"></thing-picker></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupEditor/GroupEditor.html",'<div class="app-portal-usermanager-usergroup-groupeditor" ng-init="init()"><section class="panel"><header class="panel-heading">群组信息</header><div class="panel-body"><div class="form-group"><label>群组名称</label> <input ng-model="group.userGroupName" type="text" class="form-control" placeholder="群组名称"></div><div class="form-group"><label>描述</label> <input ng-model="group.description" type="text" class="form-control" placeholder="描述"></div><div class="form-group"><label>群组用户:</label></div><hr><div class="clearfix form-group"><span ng-repeat="user in group._users" class="btn btn-info username">{{user.userName}} <span class="fa fa-remove" ng-click="removeUser(user, group)" ng-if="PermissionControl.isAllowed(\'REMOVE_GROUP_MEMBER\')"></span></span></div><hr><div ng-if="group.tags"><div class="form-group"><label>标签</label></div><hr><div class="form-group"><span ng-repeat="tag in group.tags" class="btn btn-info thing-tag">{{tag.displayName}} <span class="fa fa-remove" ng-click="removeUser(user, group)"></span></span></div><hr></div><div class="clearfix"><button class="btn btn-danger pull-right" ng-click="saveGroup()">保存</button></div></div></section><section class="panel" ng-if="PermissionControl.isAllowed(\'SEARCH_USERS\')"><div class="panel-body"><div class="col-sm-4"><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button></span></div></div></div></section><section class="panel" ng-if="PermissionControl.isAllowed(\'SEARCH_USERS\')"><header class="panel-heading">查询结果</header><div class="panel-body"><table class="table table-striped table-bordered table-hover dataTable no-footer break-word"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">业主ID</th><th class="sorting" rowspan="1" colspan="1">业主姓名</th><th class="sorting" rowspan="1" colspan="1">性别</th><th class="sorting" rowspan="1" colspan="1">邮箱</th><th class="sorting" rowspan="1" colspan="1">电话</th><th class="sorting" rowspan="1" colspan="1">公司</th><th class="sorting" rowspan="1" colspan="1">操作</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="user in userListForDisplay"><td>{{user.userID}}</td><td>{{user.userName}}</td><td>{{user.custom.sex.text}}</td><td>{{user.mail}}</td><td>{{user.phone}}</td><td class="center">{{user.company}}</td><td align="center"><button class="btn btn-success" ng-click="addUser(user,group)">添加</button></td></tr></tbody></table><div class="pull-right"><pagion collection="userList" display="userListForDisplay"></pagion></div></div></section><section class="panel" ng-if="PermissionControl.isAllowed(\'SEARCH_TAGS\')"><div class="panel-body"><div class="col-sm-4"><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button></span></div></div></div></section><section class="panel" ng-if="PermissionControl.isAllowed(\'SEARCH_TAGS\')"><header class="panel-heading">查询结果</header><div class="panel-body"><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">标签名</th><th class="sorting" rowspan="1" colspan="1">设备数</th><th class="sorting" rowspan="1" colspan="1" width="80px">操作</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="tag in tagsForDisplay"><td>{{tag.displayName}}</td><td>{{tag.count}}</td><td align="center"><button class="btn btn-success" ng-click="addTag(tag, group)">添加</button></td></tr></tbody></table><div class="pull-right"><pagion collection="tags" display="tagsForDisplay"></pagion></div></div></section><section class="panel" ng-if="PermissionControl.isAllowed(\'GET_GROUP_PERMISSIONS\')"><header class="panel-heading">群组权限</header><div class="panel-body"><table class="table"><thead><tr><th>权限名称</th><th>资源</th><th>描述</th><th align="center" width="60px">操作</th></tr></thead><tbody><tr ng-repeat="permission in groupPermission"><td>{{permission.name}}</td><td>{{permission.action}}</td><td>{{permission.description}}</td><td ng-if="PermissionControl.isAllowed(\'UNBIND_PERMISSION\')"><button class="btn btn-danger" ng-click="unbindPermission(permission, group)">删除</button></td></tr></tbody></table></div></section><section class="panel" ng-if="PermissionControl.isAllowed(\'GET_ALL_PERMISSIONS\') || PermissionControl.isAllowed(\'GET_GROUP_PERMISSIONS\')"><header class="panel-heading">未添加权限</header><div class="panel-body"><table class="table"><thead><tr><th>权限名称</th><th>资源</th><th>描述</th><th align="center" width="60px">操作</th></tr></thead><tbody><tr ng-repeat="permission in permissionList"><td>{{permission.name}}</td><td>{{permission.action}}</td><td>{{permission.description}}</td><td ng-if="PermissionControl.isAllowed(\'BIND_PERMISSION\')"><button ng-click="bindPermission(permission, group)" class="btn btn-success">添加</button></td></tr></tbody></table></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupThingACL/GroupThingACL.html",'<div class="app-portal-usermanager-groupthingacl" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-picker existing-nodes="ownThings" selected-nodes="selectedThings" settings="settings" ready="ready"></thing-picker></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupThingAuthority/GroupThingAuthority.html",'<div class="app-portal-usermanager-groupthingauthority" ng-init="init()"><section class="panel"><header class="panel-heading">设置设备控制权限</header><div class="panel-body"><div class="portal-row clearfix"><thing-picker existing-nodes="ownThings" selected-nodes="selectedThings" settings="settings" ready="ready"></thing-picker></div><div class="portal-row clearfix"><div class="col-lg-12"><button class="pull-right btn btn-danger">提交</button></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupUserList/AddUser.template.html",'<div class="modal-content"><div class="modal-header"><h3 class="modal-title">添加用户</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">查询用户</div><div class="col-sm-8"><div class="input-group"><div class="btn-group input-group-btn" uib-dropdown=""><button id="search-filter" type="button" class="btn btn-default" uib-dropdown-toggle="">用户名<span class="caret"></span></button><ul class="dropdown-menu" role="menu" aria-labelledby="search-filter"><li role="menuitem"><a>用户名</a></li><li role="menuitem"><a>ID</a></li></ul></div><input type="text" class="form-control" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button">Go!</button></span></div></div></div></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">OK</button> <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button></div></div>'),e.put("app/components/portal/UserManager/UserGroup/GroupUserList/GroupUserList.html",'<div class="app-portal-usermanager-usergroup-groupuserlist" ng-init="init()"><section class="panel"><header class="panel-heading">用户列表</header><div class="panel-body"><div class="clearfix portal-row row"><div class="col-sm-6"><span>群组名称：</span> <span>{{userGroup.name}}</span></div><div class="pull-right col-sm-6"><div class="input-group"><div class="btn-group input-group-btn" uib-dropdown=""><button id="search-filter" type="button" class="btn btn-default" uib-dropdown-toggle="">用户名<span class="caret"></span></button><ul class="dropdown-menu" role="menu" aria-labelledby="search-filter"><li role="menuitem"><a>用户名</a></li><li role="menuitem"><a>ID</a></li></ul></div><input type="text" class="form-control" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button">Go!</button></span></div></div></div><div class="portal-row"><table class="table table-striped table-bordered table-hover dataTable no-footer"><thead><tr role="row"><th class="sorting_asc" rowspan="1" colspan="1">ID</th><th class="sorting" rowspan="1" colspan="1" aria-sort="ascending">用户名</th><th class="sorting" rowspan="1" colspan="1">邮箱</th><th class="sorting" rowspan="1" colspan="1">电话</th><th class="sorting" rowspan="1" colspan="1">地址</th><th class="sorting" rowspan="1" colspan="1">状态</th></tr></thead><tbody><tr class="gradeA" ng-class="{\'odd\':$index%2==1}" role="row" ng-repeat="user in userListForDisplay" context-menu="myMenu" target="user"><td>{{user.userID}}</td><td class="sorting_1">{{user.userName}}</td><td>{{user.email}}</td><td>{{user.phone}}</td><td class="center">{{user.address}}</td><td class="center">{{user.status}}</td></tr></tbody></table><div class="pull-right"><pagion collection="userList" display="userListForDisplay"></pagion></div></div></div></section></div>'),e.put("app/components/portal/UserManager/UserGroup/ResourceAuthority/ResourceAuthority.html",'<div class="app-portal-usermanager-usergroup-resourceauthority"><div ui-view=""></div></div>'),e.put("app/components/portal/UserManager/UserGroup/UserGroupList/NewUserGroup.template.html",'<div class="modal-content"><div class="modal-header"><h3 class="modal-title">新增群组</h3></div><div class="modal-body clearfix"><div class="col-sm-12"><div class="row portal-row clearfix"><div class="col-sm-4">群组名称</div><div class="col-sm-8"><input ng-model="newGroup.userGroupName" type="text" class="form-control" placeholder="群组名称"></div></div><div class="row portal-row clearfix"><div class="col-sm-4">描述</div><div class="col-sm-8"><input ng-model="newGroup.description" type="text" class="form-control" placeholder="描述"></div></div></div></div><div class="modal-footer"><button class="btn btn-primary" type="button" ng-click="ok()">提交</button> <button class="btn btn-warning" type="button" ng-click="cancel()">取消</button></div></div>'),e.put("app/components/portal/UserManager/UserGroup/UserGroupList/UserGroupList.html",'<div class="app-portal-usermanager-usergroup-usergrouplist" ng-init="init()"><div class="panel"><div class="panel-body"><div app-select="" selected-model="groupType" options="groupTypes" class="input-group-btn" text="text"></div></div></div><div class="panel"><div class="panel-body"><div class="row clearfix"><div class="col-sm-6"><button class="btn btn-danger" ng-click="createGroup()">新增群组+</button></div><div class="pull-right col-sm-6"><div class="col-sm-4"><div app-select="" selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div></div><div class="col-sm-8"><div class="input-group"><input type="text" class="form-control" ng-model="searchValue" placeholder="Search for..."> <span class="input-group-btn"><button class="btn btn-default" type="button" ng-click="queryUserGroups(queryFiled.value, searchValue)">Go!</button></span></div></div></div></div></div></div><div class="portal-row"><div class="modules-outputs-content graph-tile" ng-repeat="group in userGroupsForDisplay"><div class="module-top"><div class="overlay" ng-click="goUserList(group)"><div class="viewReport">查看</div></div><div class="outputs-content-img"><img ng-src="{{\'images/group.jpg\'}}"></div></div><div class="moduleDetails"><div class="per-info"><span class="info">{{group.userGroupName}}</span></div><div class="modulesActionBottom"><div class="item action-button" ng-click="goThingAuth(group)"><span class="fa fa-cloud-download"></span> <span class="item-text">设置权限</span></div></div></div><div class="modulesActionsTop"><i class="fa fa-pencil-square-o" uib-tooltip="编辑" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top" ng-click="goEdit(group)"></i> <i class="fa fa-trash-o" ng-if="PermissionControl.isAllowed(\'DELETE_USERGROUP\')" ng-click="deleteGroup(group)" uib-tooltip="删除" uib-tooltip-trigger="mouseenter" uib-tooltip-placement="top"></i></div></div></div><div class="pull-right"><pagion collection="userGroups" display="userGroupsForDisplay"></pagion></div></div>'),e.put("app/components/portal/ThingViews/TypeView/directives/property-tree/property-tree.template.html",'<div><div class="form-group"><label>名称</label><div>{{myProperty.title}}</div></div><div class="form-group"><label>属性</label><table class="table"><thead><th>名称</th><th>种类</th><th>值域</th><th>描述</th><th>必须</th></thead><tbody><tr ng-repeat-start="(propertyKey, propertyValue) in myProperty.properties"><td><span ng-if="!propertyValue.properties">{{propertyKey}}</span> <a ng-if="propertyValue.properties" style="cursor:pointer" ng-click="collapseControllers[propertyKey] = !collapseControllers[propertyKey]">{{propertyKey}}</a></td><td><code class="bg-primary">{{propertyValue.type}}</code></td><td><code ng-if="propertyValue.minimum || propertyValue.minimum == 0">{{\'> \' + propertyValue.minimum}}</code> <code ng-if="propertyValue.maximum || propertyValue.maximum == 0">{{\'< \' + propertyValue.maximum}}</code></td><td>{{propertyValue.description}}</td><td><span class="fa" ng-class="propertyRequired(propertyKey, myProperty.required)?\'fa-check text-success\': \'fa-remove text-danger\'"></span></td></tr><tr ng-repeat-end=""><td colspan="5" ng-if="propertyValue.properties" ng-show="collapseControllers[propertyKey]" style="background: rgba(0,0,0,0.05); padding-left:20px;"><div uib-collapse="!collapseControllers[propertyKey]"><property-tree my-property="propertyValue"></property-tree></div></td></tr></tbody></table></div></div>')
}]);