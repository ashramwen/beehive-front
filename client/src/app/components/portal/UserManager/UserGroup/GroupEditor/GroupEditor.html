<div class="app-portal-usermanager-usergroup-groupeditor" ng-init="init()">
  <section class="panel">
    <header class="panel-heading">群组信息</header>
    <div class="panel-body">
      <div class="form-group">
        <label>群组名称</label>
        <input ng-model="group.userGroupName" type="text" class="form-control" placeholder="群组名称" />
      </div>
      <div class="form-group">
        <label>描述</label>
        <input ng-model="group.description" type="text" class="form-control" placeholder="描述" />
      </div>
      <div class="form-group">
        <label>群组用户:</label>
      </div>
      <hr/>
      <div class="clearfix form-group">
        <span ng-repeat="user in group._users" class="btn btn-info username">{{user.userName}} <span class="fa fa-remove" ng-click="removeUser(user, group)" ng-if="PermissionControl.isAllowed('REMOVE_GROUP_MEMBER')"></span></span>
      </div>
      <hr/>
      <div ng-if="group.tags">
        <div class="form-group">
          <label>标签</label>
        </div>
        <hr/>
        <div class="form-group">
          <span ng-repeat="tag in group.tags" class="btn btn-info thing-tag">
            {{tag.displayName}} <span class="fa fa-remove" ng-click="removeUser(user, group)"></span>
          </span>
        </div>
        <hr/>
      </div>
      <div class="clearfix">
        <button class="btn btn-danger pull-right" ng-click="saveGroup()">保存</button> 
      </div>
    </div>
  </section>

  <!-- =============================== Users =============================== -->
  <section class="panel" ng-if="PermissionControl.isAllowed('SEARCH_USERS')">
    <div class="panel-body">
      <div class="col-sm-4">
        <div app-select selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div>
      </div>
      <div class="col-sm-8">
        <div class="input-group">
          <input type="text" class="form-control" ng-model="searchValue" placeholder="Search for...">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button>
          </span>
        </div>
      </div>
    </div>
  </section>
  <section class="panel" ng-if="PermissionControl.isAllowed('SEARCH_USERS')">
    <header class="panel-heading">查询结果</header>
    <div class="panel-body">
      <table class="table table-striped table-bordered table-hover dataTable no-footer">
        <thead>
            <tr role="row">
              <th class="sorting_asc" rowspan="1" colspan="1">业主ID</th>
              <th class="sorting" rowspan="1" colspan="1">业主姓名</th>
              <th class="sorting" rowspan="1" colspan="1">性别</th>
              <th class="sorting" rowspan="1" colspan="1">邮箱</th>
              <th class="sorting" rowspan="1" colspan="1">电话</th>
              <th class="sorting" rowspan="1" colspan="1">公司</th>
              <th class="sorting" rowspan="1" colspan="1">操作</th>
            </tr>
        </thead>
        <tbody>
          <tr class="gradeA" ng-class="{'odd':$index%2==1}" role="row" ng-repeat="user in userListForDisplay">
            <td>{{user.userID}}</td>
            <td>{{user.userName}}</td>
            <td>{{user.custom.sex.text}}</td>
            <td>{{user.mail}}</td>
            <td>{{user.phone}}</td>
            <td class="center">{{user.company}}</td>
            <td align="center">
              <button class="btn btn-danger" ng-click="addUser(user,group)">添加</button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="pull-right">
        <pagion collection="userList" display="userListForDisplay"></pagion>
      </div>
    </div>
  </section>
  <!-- =============================== End of Users =============================== -->

  <!-- ================================= Tags ===================================== -->
  <section class="panel" ng-if="PermissionControl.isAllowed('SEARCH_TAGS')">
    <div class="panel-body">
      <div class="col-sm-4">
        <div app-select selected-model="queryFiled" options="queryOptions" class="input-group-btn" text="text"></div>
      </div>
      <div class="col-sm-8">
        <div class="input-group">
          <input type="text" class="form-control" ng-model="searchValue" placeholder="Search for...">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button" ng-click="queryUsers(queryFiled.value, searchValue)">Go!</button>
          </span>
        </div>
      </div>
    </div>
  </section>
  <section class="panel" ng-if="PermissionControl.isAllowed('SEARCH_TAGS')">
    <header class="panel-heading">查询结果</header>
    <div class="panel-body">
      <table class="table table-striped table-bordered table-hover dataTable no-footer">
        <thead>
            <tr role="row">
              <th class="sorting_asc" rowspan="1" colspan="1">标签名</th>
              <th class="sorting" rowspan="1" colspan="1">设备数</th>
              <th class="sorting" rowspan="1" colspan="1">操作</th>
            </tr>
        </thead>
        <tbody>
          <tr class="gradeA" ng-class="{'odd':$index%2==1}" role="row" ng-repeat="tag in tagsForDisplay">
            <td>{{tag.displayName}}</td>
            <td>{{tag.count}</td>
            <td align="center">
              <button class="btn btn-danger" ng-click="addTag(tag, group)">添加</button>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="pull-right">
        <pagion collection="tags" display="tagsForDisplay"></pagion>
      </div>
    </div>
  </section>
  <!-- ================================= End of Tags ===================================== -->

  <section class="panel" ng-if="PermissionControl.isAllowed('GET_GROUP_PERMISSIONS')">
    <header class="panel-heading">群组权限</header>
    <div class="panel-body">
      <table class="table">
        <thead>
          <tr><th>权限名称</th><th>资源</th><th>描述</th><th align="center" width="60px">操作</th></tr>
        </thead>
        <tbody>
          <tr ng-repeat="permission in groupPermission">
            <td>{{permission.name}}</td>
            <td>{{permission.action}}</td>
            <td>{{permission.description}}</td>
            <td ng-if="PermissionControl.isAllowed('UNBIND_PERMISSION')"><button class="btn btn-danger" ng-click="unbindPermission(permission, group)">删除</button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section class="panel" ng-if="PermissionControl.isAllowed('GET_ALL_PERMISSIONS') || PermissionControl.isAllowed('GET_GROUP_PERMISSIONS')">
    <header class="panel-heading">未添加权限</header>
    <div class="panel-body">
      <table class="table">
        <thead>
          <tr><th>权限名称</th><th>资源</th><th>描述</th><th align="center" width="60px">操作</th></tr>
        </thead>
        <tbody>
          <tr ng-repeat="permission in permissionList">
            <td>{{permission.name}}</td>
            <td>{{permission.action}}</td>
            <td>{{permission.description}}</td>
            <td ng-if="PermissionControl.isAllowed('BIND_PERMISSION')"><button ng-click="bindPermission(permission, group)" class="btn btn-success">添加</button></td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>